const t={debug:!1,locale:"en-US",shadowDomMode:"auto",enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1};function e(){return t}const s=e();function n(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:o,hint:r,t:i,o:c,i:d}=t;s.debug&&(console.group(`[Structive Error] ${n}: ${e}`),o&&console.log("Context:",o),r&&console.log("Hint:",r),i&&console.log("Docs:",i),d&&console.error("Cause:",d),console.groupEnd());const a=new Error(e);throw a.code=n,o&&(a.context=o),r&&(a.hint=r),i&&(a.t=i),c&&(a.o=c),d&&(a.i=d),a}const o=(t,e)=>({l:t,h:e});function r(t){n({code:"FLT-202",message:`${t} requires at least one option`,context:o("Filter.optionsRequired",t),t:"./docs/error-codes.md#flt"})}function i(t){n({code:"FLT-202",message:`${t} requires a number as option`,context:o("Filter.optionMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function c(t){n({code:"FLT-202",message:`${t} requires a number value`,context:o("Filter.valueMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function d(t){n({code:"FLT-202",message:`${t} requires a date value`,context:o("Filter.valueMustBeDate",t),t:"./docs/error-codes.md#flt"})}const a=e();function l(t){return!(!t||isNaN(Number(t)))}const h={eq:t=>{const e=t?.[0]??r("eq");return t=>"number"==typeof t?(l(e)||i("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??r("ne");return t=>"number"==typeof t?(l(e)||i("ne"),t!==Number(e)):t!==e},not:t=>t=>{var e;return"boolean"!=typeof t&&n({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:o("Filter.valueMustBeBoolean",e),t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??r("lt");return l(e)||i("lt"),t=>("number"!=typeof t&&c("lt"),t<Number(e))},le:t=>{const e=t?.[0]??r("le");return l(e)||i("le"),t=>("number"!=typeof t&&c("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??r("gt");return l(e)||i("gt"),t=>("number"!=typeof t&&c("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??r("ge");return l(e)||i("ge"),t=>("number"!=typeof t&&c("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??r("inc");return l(e)||i("inc"),t=>("number"!=typeof t&&c("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??r("dec");return l(e)||i("dec"),t=>("number"!=typeof t&&c("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??r("mul");return l(e)||i("mul"),t=>("number"!=typeof t&&c("mul"),t*Number(e))},div:t=>{const e=t?.[0]??r("div");return l(e)||i("div"),t=>("number"!=typeof t&&c("div"),t/Number(e))},mod:t=>{const e=t?.[0]??r("mod");return l(e)||i("mod"),t=>("number"!=typeof t&&c("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return l(e)||i("fix"),t=>("number"!=typeof t&&c("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a.locale;return t=>("number"!=typeof t&&c("locale"),t.toLocaleString(e))},uc:t=>t=>String(t).toUpperCase(),lc:t=>t=>String(t).toLowerCase(),cap:t=>t=>{const e=String(t);return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>String(t).trim(),slice:t=>{const e=t?.[0]??r("slice");return l(e)||i("slice"),t=>String(t).slice(Number(e))},substr:t=>{const e=t?.[0]??r("substr");l(e)||i("substr");const s=t?.[1]??r("substr");return l(s)||i("substr"),t=>String(t).substr(Number(e),Number(s))},pad:t=>{const e=t?.[0]??r("pad");l(e)||i("pad");const s=t?.[1]??"0";return t=>String(t).padStart(Number(e),s)},rep:t=>{const e=t?.[0]??r("rep");return l(e)||i("rep"),t=>String(t).repeat(Number(e))},rev:t=>t=>String(t).split("").reverse().join(""),int:t=>t=>parseInt(String(t),10),float:t=>t=>parseFloat(String(t)),round:t=>{const e=t?.[0]??"0";return l(e)||i("round"),t=>{"number"!=typeof t&&c("round");const s=Math.pow(10,Number(e));return Math.round(t*s)/s}},floor:t=>{const e=t?.[0]??"0";return l(e)||i("floor"),t=>{"number"!=typeof t&&c("floor");const s=Math.pow(10,Number(e));return Math.floor(t*s)/s}},ceil:t=>{const e=t?.[0]??"0";return l(e)||i("ceil"),t=>{"number"!=typeof t&&c("ceil");const s=Math.pow(10,Number(e));return Math.ceil(t*s)/s}},percent:t=>{const e=t?.[0]??"0";return l(e)||i("percent"),t=>("number"!=typeof t&&c("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||d("ymd");const s=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${s}${e}${n}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??r("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},u=h,f=h;let m=0;function p(){return++m}const g={};const w={};function y(t,e){const s=new CSSStyleSheet;s.replaceSync(e),function(t,e){w[t]=e}(t,s)}function x(t,e){let s=t;if(0===e.length)return s;for(let t=0;t<e.length&&(s=s?.childNodes[e[t]]??null,null!==s);t++);return s}function b(t,e){const s=t[e.name];return s||n({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{l:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),s(e.options)}const S=new Map;const C=new Map;function v(t,e){let s=C.get(t);s||(s=new Map,C.set(t,s));let n=s.get(e);return n||(n=function(t,e){let s=S.get(e);if(void 0===s){s=[];for(let n=0;n<e.length;n++)s.push(b(t,e[n]));S.set(e,s)}return s}(t,e),s.set(e,n)),n}class I{u;m;p;S;C;v;get node(){return this.m}get name(){return this.p}get I(){return this.S}get binding(){return this.u}get P(){return this.v}get filters(){return this.C}get T(){return[]}constructor(t,e,s,n,o,r){this.u=t,this.m=e,this.p=s,this.S=n,this.C=o,this.v=r}get B(){return!1}U(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNode.assignValue",name:this.name},t:"./docs/error-codes.md#bind"})}N(t,e){n({code:"BIND-301",message:"Binding updateElements not implemented",context:{l:"BindingNode.updateElements",name:this.name},t:"./docs/error-codes.md#bind"})}$(t){}_(t){const e=this.binding.M.L(t.R,t.k);this.U(e)}A(){}D(){}get F(){return this.node instanceof HTMLSelectElement}get value(){return null}get V(){return null}}class P extends I{U(t){const e=this.node,s=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.setAttribute(this.I,s)}}const T={},B="data-bind",U="@@:",N="@@|",$=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),_="$connectedCallback",L="$disconnectedCallback",M="$updatedCallback",E={};class R{static id=0;id=++R.id;O=this.id.toString();pattern;W;H;q;j;G;Z;J;K;X;Y;tt;et;st;nt;ot;rt;it;ct;dt;ht;constructor(t){const e=e=>t===e?this:k(e),s=t.split("."),n=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<s.length;t++)l+=s[t],"*"===s[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),n.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=n.length>1?n[n.length-2]:null;this.pattern=t,this.W=s,this.H=s[s.length-1],this.q=n,this.j=new Set(n),this.G=o,this.Z=new Set(o),this.J=r,this.K=new Set(r),this.Y=i,this.X=c,this.tt=new Set(c),this.et=d,this.st=new Set(d),this.nt=a,this.ot=new Set(a),this.rt=f,this.it=f?e(f):null,this.ct=m,this.dt=m?e(m):null,this.ht=u}}function k(t){$.has(t)&&n({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{l:"StateProperty.getStructuredPathInfo",ut:t},t:"./docs/error-codes.md#state"});const e=E[t];return void 0!==e?e:E[t]=new R(t)}class A{ct;ft;name;wt;level;constructor(t,e,s){this.ct=t,this.ft=t?`${t}.${e}`:e,this.name=e,this.level=s,this.wt=new Map}find(t,e=0){if(e>=t.length)return null;const s=t[e],n=this.wt.get(s);return n?e===t.length-1?n:n.find(t,e+1):null}appendChild(t){let e=this.wt.get(t);if(!e){const s=this.ct?`${this.ct}.${this.name}`:this.name;e=new A(s,t,this.level+1),this.wt.set(t,e)}return e}}const D=new Map;function F(t,e){let s=D.get(t);s||(s=new Map,D.set(t,s));let n=s.get(e)??null;if(n)return n;const o=k(e);return n=t.find(o.W),s.set(e,n),n}function V(t,e){const s=k(e);if(null===s.ct)return t.appendChild(e);{let e=F(t,s.ct);return null===e&&(e=V(t,s.ct)),e.appendChild(s.H)}}const O="state",W=Symbol.for(`${O}.GetByRef`),H=Symbol.for(`${O}.SetByRef`),q=Symbol.for(`${O}.ConnectedCallback`),j=Symbol.for(`${O}.DisconnectedCallback`),z=Symbol.for(`${O}.UpdatedCallback`),G=Symbol.for(`${O}.GetListIndexesByRef`),Z=new Map;class Q{static id=0;id=++Q.id;name;elements;yt;ht;xt;bt;info;constructor(t){const e=t.split("."),s=e.slice(),n=[];let o=0,r=0,i="",c=0,d="none";const a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)s[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(s[t]="*",a.push(e),r++,c++)}i+=d,n.push(i),i+=t<e.length-1?".":""}const l=k(s.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.yt=n,this.ht=c,this.xt=d,this.bt=a,this.info=l}}function J(t){let e;return Z.get(t)??(Z.set(t,e=new Q(t)),e)}class K{info;St;get Ct(){return null===this.St?null:this.St.deref()??n({code:"LIST-201",message:"listIndex is null",context:{l:"StatePropertyRef.get listIndex",O:this.info.O,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.St=null!==e?new WeakRef(e):null,this.key=null===e?t.O:`${t.O}#${e.O}`}get vt(){const t=this.info.dt;if(!t)return null;return tt(t,(this.info.ht>t.ht?this.Ct?.at(-2):this.Ct)??null)}}const X=new WeakMap,Y={};function tt(t,e){let s=null;if(null!==e){let n;if(void 0===(n=X.get(e)))s=new K(t,e),X.set(e,{[t.pattern]:s});else if(void 0===(s=n[t.pattern]))return n[t.pattern]=new K(t,e)}else if(void 0===(s=Y[t.pattern]))return Y[t.pattern]=new K(t,null);return s}function et(t,e){const s=t.It;if(null===s)return null;if(null===s.Ct)return null;const n=s.info.Y[e];return void 0!==n?s.Ct.at(n):null}function st(t,e,s){switch(t.xt){case"none":return null;case"context":return et(s,t.info.rt??n({code:"STATE-202",message:"lastWildcardPath is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"}))??n({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#list"});case"all":{let s=null;for(let o=0;o<t.info.ht;o++){const r=t.info.nt[o]??n({code:"STATE-202",message:"wildcardParentPattern is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"}),i=tt(r,s),c=e[G](i)??n({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",Pt:r.pattern},t:"./docs/error-codes.md#list"}),d=t.bt[o]??n({code:"STATE-202",message:"wildcardIndex is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"});s=c[d]??n({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",Pt:r.pattern,Tt:d},t:"./docs/error-codes.md#list"})}return s}case"partial":n({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"})}}const nt={};for(let t=0;t<32;t++)nt[`$${t+1}`]=t;let ot=0,rt=0;class it{id=++rt;O=rt.toString();Bt;position;length;Ut;Nt;$t;_t;constructor(t,e){this.Bt=t,this.position=t?t.position+1:0,this.length=this.position+1,this.Ut=e,this.Nt=ot}get index(){return this.Ut}set index(t){this.Ut=t,this.Nt=++ot,this.Lt[this.position]=t}get version(){return this.Nt}get Mt(){return null!==this.Bt&&(this.Bt.Mt||this.Bt.version>this.Nt)}get Lt(){return null===this.Bt?void 0===this.$t&&(this.$t=[this.Ut]):(void 0===this.$t||this.Mt)&&(this.$t=[...this.Bt.Lt,this.Ut],this.Nt=ot),this.$t}get Et(){return null===this.Bt?void 0===this._t&&(this._t=[new WeakRef(this)]):void 0===this._t&&(this._t=[...this.Bt.Et,new WeakRef(this)]),this._t}get Rt(){return`$${this.position+1}`}at(t){return t>=0?this.Et[t]?.deref()||null:this.Et[this.Et.length+t]?.deref()||null}}function ct(t,e){return new it(t,e)}function dt(t,e,s,o){let r;!function(t,e){if(t.kt>=0){const s=t.It?.info??null;null!==s&&t.Ft.Dt.At.has(s.pattern)&&s.pattern!==e.info.pattern&&t.Ft.Dt.Vt(s.pattern,e.info.pattern)}}(o,e);const i=o.Ft.Dt.Ot.has(e.info.pattern),c=e.info.ht>0||o.Ft.Dt.Wt.has(e.info.pattern);let d=null;if(c||i){d=o.Ft.Ht(e);const t=o.Ft.qt.get(e.info.pattern);if(null!==d){if(void 0===t)return d.value;if(d.version>o.jt.version)return d.value;if(!(d.version<t.version||d.zt<t.zt))return d.value}}if(o.Ft.Gt.startsWith(e.info)&&0===o.Ft.Dt.Wt.intersection(e.info.j).size)return o.Ft.Gt.get(e);if(e.info.pattern in t){0===o.Zt.length&&n({code:"STC-002",message:"handler.refStack is empty in getByRef",context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o.kt++,o.kt>=o.Zt.length&&o.Zt.push(null),o.Zt[o.kt]=o.It=e;try{return r=Reflect.get(t,e.info.pattern,s)}finally{if(o.Zt[o.kt]=null,o.kt--,o.It=o.kt>=0?o.Zt[o.kt]:null,c||i){let t=null;if(i){if(null!==o.Qt&&!o.Qt.Jt.has(e))if(d){const t=d.Et??[],s=d.value;Array.isArray(s)||n({code:"STC-001",message:`Property "${e.info.pattern}" is expected to be an array for list management.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o.Qt.Jt.set(e,{Et:t,value:s})}else o.Qt.Jt.set(e,{Et:[],value:[]});t=function(t,e,s,n){const o=Array.isArray(e)?e:[],r=Array.isArray(s)?s:[],i=[];if(0===r.length)return[];if(0===o.length){for(let e=0;e<r.length;e++){const s=ct(t,e);i.push(s)}return i}if(function(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}(o,r))return n;const c=new Map;for(let t=0;t<o.length;t++)c.set(o[t],t);for(let e=0;e<r.length;e++){const s=r[e],o=c.get(s);if(void 0===o){const s=ct(t,e);i.push(s)}else{const t=n[o];t.index!==e&&(t.index=e),i.push(t)}}return i}(e.Ct,d?.value,r,d?.Et??[])}const s=d??{value:null,Et:null,version:0,zt:0};s.value=r,s.Et=t,s.version=o.jt.version,s.zt=o.jt.zt,o.Ft.Kt(e,s)}}}else n({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"})}function at(t,e,s,o,r){const i=r.Ft.Dt.elements.has(e.info.pattern);let c=null,d=null;if(i&&(c=e.vt??n({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",scope:"element",Xt:e.info.pattern},t:"./docs/error-codes.md#state"}),d=r.jt.Yt.get(c)||null,null===d)){const t=o[W](c)??[];Array.isArray(t)||n({code:"STATE-202",message:"Expected array value for list elements",context:{l:"StateClass.setByRef",scope:"element",Xt:c.info.pattern},t:"./docs/error-codes.md#state"}),d={value:[...t],Et:[...o[G](c)??[]]},r.jt.Yt.set(c,d)}try{if(r.Ft.Gt.startsWith(e.info)&&0===r.Ft.Dt.te.intersection(e.info.j).size)return r.Ft.Gt.set(e,s);if(!(e.info.pattern in t)){const i=e.info.dt??n({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",Xt:e.info.pattern},t:"./docs/error-codes.md#state"}),c=tt(i,i.ht<e.info.ht?e.Ct?.Bt??null:e.Ct),d=dt(t,c,o,r);null!==d&&"object"==typeof d||n({code:"STATE-202",message:"Parent value is not an object",context:{l:"StateClass.setByRef",Xt:c.info.pattern},t:"./docs/error-codes.md#state"});const a=e.info.H;if("*"===a){const t=e.Ct?.index??n({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{l:"StateClass.setByRef",Xt:e.info.pattern},t:"./docs/error-codes.md#state"});return Reflect.set(d,t,s)}return Reflect.set(d,a,s)}r.kt++,r.kt>=r.Zt.length&&r.Zt.push(null),r.Zt[r.kt]=r.It=e;try{return Reflect.set(t,e.info.pattern,s,o)}finally{r.Zt[r.kt]=null,r.kt--,r.It=r.kt>=0?r.Zt[r.kt]:null}}finally{if(r.jt.ee(e),i){const t=d.value.indexOf(s),i=o[G](c)??[],a=e.Ct.index,l=-1!==t?d.Et[t]:ct(c.Ct,-1);i[a]=l;const h=o[W](c)??[];null!==h&&Array.isArray(h)||n({code:"STATE-202",message:"Parent value is not an array during swap check",context:{l:"StateClass.setByRef",scope:"element swap",Xt:c.info.pattern},t:"./docs/error-codes.md#state"});if(new Set(h).size===d.value.length){for(let t=0;t<i.length;t++)i[t].index=t;r.jt.Yt.delete(c)}}}}function lt(t,e,s,o){return(e,r,i)=>{const c=k(e),d=o.It?.info??null;null!==d&&d.pattern!==c.pattern&&o.Ft.Dt.At.has(d.pattern)&&o.Ft.Dt.Vt(d.pattern,c.pattern),c.nt.length>r.length&&n({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{l:"StateClass.resolve",path:e,se:c.nt.length,oe:r.length},t:"./docs/error-codes.md#state"});let a=null;for(let e=0;e<c.nt.length;e++){const i=c.nt[e],d=tt(i,a);dt(t,d,s,o);const l=s[G](d);null===l&&n({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern},t:"./docs/error-codes.md#list"});const h=r[e];a=l[h]??n({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern,index:h},t:"./docs/error-codes.md#list"})}const l=tt(c,a),h=void 0!==i;if(H in s){if(!h)return dt(t,l,s,o);at(t,l,i,s,o)}else{if(!h)return dt(t,l,s,o);n({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{l:"StateClass.resolve",path:e},t:"./docs/error-codes.md#state"})}}}function ht(t,e,s,o){return t=>{"function"!=typeof t&&n({code:"STATE-203",message:"Callback is not a function",context:{l:"StateClass.invoke",re:t},t:"./docs/error-codes.md#state"});const e=o.jt.ie((()=>Reflect.apply(t,s,[])));return e instanceof Promise&&e.catch((t=>{n({code:"STATE-204",message:"Invoke callback rejected",context:{l:"StateClass.invoke"},t:"./docs/error-codes.md#state",o:"error",i:t instanceof Error?t:new Error(String(t))})})),e}}function ut(t,e,s,o){const r=nt[e];if(void 0!==r){const t=o.It?.Ct;return t?.Lt[r]??n({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{ce:String(e),Lt:t?.Lt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return lt(t,0,s,o);case"$getAll":return function(t,e,s,o){const r=lt(t,0,s,o);return(e,i)=>{let c=i;const d=k(e),a=o.It?.info??null;if(null!==a&&a.pattern!==d.pattern&&o.Ft.Dt.At.has(a.pattern)&&o.Ft.Dt.Vt(a.pattern,d.pattern),void 0===c){for(let t=0;t<d.X.length;t++){const e=d.X[t]??n({code:"BIND-201",message:"Wildcard info is missing",context:{l:"StateClass.getAll",Tt:t,pattern:d.pattern},t:"./docs/error-codes.md#bind"}),s=et(o,e.pattern);if(s){c=s.Lt;break}}void 0===c&&(c=[])}const l=(e,r,i,c,d,a,h)=>{const u=e[r]??null;if(null===u)return void h.push(a);const f=tt(u,i);dt(t,f,s,o);const m=s[G](f);null===m&&n({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern},t:"./docs/error-codes.md#list"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const s=m[t];l(e,r+1,s,c,d+1,a.concat(s.index),h)}else{const t=m[p]??n({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern,index:p},t:"./docs/error-codes.md#list"});r+1<e.length?l(e,r+1,t,c,d+1,a.concat(t.index),h):h.push(a.concat(t.index))}},h=[];l(d.nt,0,null,c,0,[],h);const u=[];for(let t=0;t<h.length;t++)u.push(r(d.pattern,h[t]));return u}}(t,0,s,o);case"$trackDependency":return function(t,e,s,o){return t=>{const e=o.It?.info??n({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{l:"StateClass.trackDependency",path:t},t:"./docs/error-codes.md#state"});o.Ft.Dt.Wt.has(e.pattern)&&e.pattern!==t&&o.Ft.Dt.Vt(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>ys?.navigate(t);case"$component":return o.Ft.de;case"$invoke":return ht(0,0,s,o);case"$wrap":return t=>{const e=ht(0,0,s,o);return()=>e(t)};case"$updateComplete":return o.jt.ae}const r=J(e),i=st(r,s,o),c=tt(r.info,i);return dt(t,c,s,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,s);switch(e){case W:return e=>dt(t,e,s,o);case H:return(e,n)=>at(t,e,n,s,o);case G:return e=>function(t,e,s,o){if(o.Ft.Dt.Ot.has(e.info.pattern)||n({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),o.Ft.Gt.startsWith(e.info)&&0===o.Ft.Dt.Wt.intersection(e.info.j).size)return o.Ft.Gt.he(e)??[];dt(t,e,s,o);const r=o.Ft.Ht(e);null===r&&n({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"});const i=r.Et;return null===i&&n({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),i}(t,e,s,o);case q:return()=>function(t,e,s){const n=Reflect.get(t,_);if("function"==typeof n)return n.call(s)}(t,0,s);case j:return()=>function(t,e,s){const n=Reflect.get(t,L);if("function"==typeof n)return n.call(s)}(t,0,s);case z:return e=>function(t,e,s){const n=Reflect.get(t,M);if("function"==typeof n){const t=new Set,o={};for(const s of e){const e=s.info.pattern;if(t.add(e),s.info.ht>0){const t=s.Ct.index,n=o[e];void 0===n?o[e]=[t]:n.push(t)}}return n.call(s,Array.from(t),o)}}(t,e,s)}}}let ft=class{Ft;jt;Qt;Zt=Array(32).fill(null);kt=-1;It=null;ue=void 0;symbols=new Set([W,G]);fe=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,s){this.Ft=t,this.jt=e,this.Qt=s}get(t,e,s){return ut(t,e,s,this)}set(t,e,s,o){n({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{l:"createReadonlyStateProxy.set",ce:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.fe.has(e)}};function mt(t,e,s){return new ft(t,e,s)}function pt(t,e){return new Proxy(t,e)}class gt{Ft;jt;Qt=null;Zt=Array(32).fill(null);kt=-1;It=null;ue=void 0;symbols=new Set([W,H,G,q,j,z]);fe=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component","$invoke","$wrap","$updateComplete"]);constructor(t,e){this.Ft=t,this.jt=e}get(t,e,s){return ut(t,e,s,this)}set(t,e,s,n){return function(t,e,s,n,o){if("string"==typeof e){const r=J(e),i=st(r,n,o);return at(t,tt(r.info,i),s,n,o),!0}return Reflect.set(t,e,s,n)}(t,e,s,n,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.fe.has(e)}}function wt(t,e,s,o,r){const i=new gt(t,e),c=new Proxy(s,i);return function(t,e,s){let o;if(void 0!==t.ue&&n({code:"STATE-301",message:"already in loop context",context:{l:"setLoopContext",me:!0},t:"/docs/error-codes.md#state",hint:"Ensure handler.loopContext is cleared before invoking setLoopContext again.",o:"error"}),e){t.ue=e,t.kt++,t.kt>=t.Zt.length&&t.Zt.push(null),t.Zt[t.kt]=t.It=e.pe;try{o=s()}catch(e){throw t.Zt[t.kt]=null,t.kt--,t.It=t.kt>=0?t.Zt[t.kt]:null,t.ue=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.Zt[t.kt]=null,t.kt--,t.It=t.kt>=0?t.Zt[t.kt]:null,t.ue=void 0}));t.Zt[t.kt]=null,t.kt--,t.It=t.kt>=0?t.Zt[t.kt]:null,t.ue=void 0}else{t.ue=e;try{o=s()}catch(e){throw t.ue=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.ue=void 0}));t.ue=void 0}return o}(i,o,(()=>r(c,i)))}class yt{we=new Set;ye=new Set;Jt=new Map;xe;be;Se=[];Ce=new Set;ve=null;Ie=null;Pe="build";Te=[];Be=[];constructor(t,e){this.xe=t,this.be=e}get Ue(){return this.Se}get Ne(){return this.Ce}get $e(){return this.Te}get _e(){return this.Be}get R(){return this.ve||n({code:"UPD-002",message:"ReadonlyState not initialized",context:{l:"Updater.Renderer.readonlyState"},t:"./docs/error-codes.md#upd"}),this.ve}get k(){return this.Ie||n({code:"UPD-002",message:"ReadonlyHandler not initialized",context:{l:"Updater.Renderer.readonlyHandler"},t:"./docs/error-codes.md#upd"}),this.Ie}get Le(){return this.Pe}Me(t){const e=mt(this.xe,this.be,this),s=pt(this.xe.state,e);this.ve=s,this.Ie=e;try{return t(s,e)}finally{this.ve=null,this.Ie=null}}Ee(t){this.ye.clear(),this.we.clear(),this.Se=[...t],this.Ce=new Set(t),this.Me((()=>{const e=[],s=new Set,o=new Map,r=new Set;for(let i=0;i<t.length;i++){const c=t[i];if(r.add(c),!this.xe.Dt.elements.has(c.info.pattern)){e.push(c),s.add(c.info.pattern);continue}const d=c.vt??n({code:"UPD-004",message:`ParentInfo is null for ref: ${c.key}`,context:{l:"Updater.Renderer.render",Re:c.key,pattern:c.info.pattern},t:"./docs/error-codes.md#upd"});o.has(d)||o.set(d,new Set),o.get(d).add(c)}for(const[t,e]of o){if(r.has(t)){for(const t of e)this.ye.add(t);continue}const s=this.xe.ke(t);for(let t=0;t<s.length;t++)this.we.has(s[t])||s[t]._(this);this.ye.add(t)}0===s.intersection(this.xe.Dt.Ae).size&&(this.Pe="direct");for(let t=0;t<e.length;t++){const s=e[t],o=F(this.xe.Dt.De,s.info.pattern);null===o&&n({code:"PATH-101",message:`PathNode not found: ${s.info.pattern}`,context:{l:"Updater.Renderer.render",pattern:s.info.pattern},t:"./docs/error-codes.md#path"}),this.ye.has(s)||this.Fe(s,o)}if(this.xe.Ve.size>0)for(const t of this.xe.Ve){const s=this.xe.Oe.get(t)??new Set;for(const t of s)t.$(e)}"direct"!==this.Pe&&this.We(),this.He()}))}We(){this.Pe="apply";try{for(let t=0;t<this.Te.length;t++)this.Te[t]._(this)}finally{this.Te=[]}}He(){this.Pe="applySelect";try{for(let t=0;t<this.Be.length;t++)this.Be[t]._(this)}finally{this.Be=[]}}Fe(t,e){this.ye.add(t);const s=this.xe.ke(t);for(let t=0;t<s.length;t++)this.we.has(s[t])||s[t]._(this);let o=new Set;if(this.xe.Dt.Ot.has(t.info.pattern)){const e=new Set(this.R[G](t)??[]),{Et:s}=this.Jt.get(t)??{},n=new Set(s??[]);o=e.difference(n)}for(const[s,n]of e.wt){const e=k(n.ft);if("*"===s)for(const t of o){const s=tt(e,t);this.ye.has(s)||this.Fe(s,n)}else{const s=tt(e,t.Ct);this.ye.has(s)||this.Fe(s,n)}}const r=this.xe.Dt.qe.get(t.info.pattern);if(r)for(const t of r){const e=k(t),s=F(this.xe.Dt.De,e.pattern);if(null===s&&n({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{l:"Updater.Renderer.renderItem",pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.ht>0){const t=e.nt,n=(o,r,i)=>{const c=this.R[G](o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const s=tt(i,c[e]);n(s,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const n=tt(e,c[t]);this.ye.has(n)||this.Fe(n,s)}},o=tt(e.nt[0],null);n(o,0,e.nt[1]||null)}else{const t=tt(e,null);this.ye.has(t)||this.Fe(t,s)}}}je(t){this.Me((()=>{t._(this),this.We(),this.He()}))}}function xt(t,e,s,n){const o=new yt(e,s);try{o.Ee(t)}finally{n.resolve()}}class bt{xe;be;ze=Promise.withResolvers();Ge;constructor(t,e,s){this.xe=t,this.be=e,this.Ge=s,this.Ze()}async Ze(){const t=[];let e=null,s=!0;for(;null===e;){e=await this.ze.promise??null;const s=this.be.Qe();if(0===s.length)continue;const n=Promise.withResolvers();t.push(n.promise);try{xt(s,this.xe,this.be,n)}catch(t){console.error("Rendering error:",t),n.reject()}}try{await Promise.all(t)}catch(t){s=!1}finally{e.resolve(s)}}Je(){this.ze.resolve(),this.ze=Promise.withResolvers()}terminate(){this.ze.resolve(this.Ge)}}function St(t,e,s){return new bt(t,e,s)}class Ct{Nt=0;Ke=[];Xe=[];ze=null;Ye=null;ts;constructor(t){this.ts=t}es(){const t=Promise.withResolvers();return this.Ke.push(t),null===this.ze?null===this.Ye?this.Ze():this.Ye.promise.then((()=>{this.Ze()})):this.ze.reject(),t}ss(){return this.Nt++,this.Nt}ns(){const t=this.ss();this.ze=Promise.withResolvers(),this.Xe=this.Xe.concat(...this.Ke),this.Ke=[];const e=[...this.Xe],s=this.Xe.map((t=>t.promise));return Promise.allSettled(s).then((()=>{this.Nt===t?(null===this.ze&&n({code:"UPD-007",message:"UpdateActivityTracker waitResolver is null.",context:{l:"UpdateActivityTracker.nextWaitPromise"},t:"./docs/error-codes.md#upd"}),this.Xe=[],this.ze.resolve()):this.Xe=this.Xe.filter((t=>!e.includes(t)))})),this.ze.promise}async Ze(){if(null===this.Ye){this.Ye=Promise.withResolvers();try{for(;;){const t=this.ns();try{if(await t,this.ze=null,0===this.Ke.length&&0===this.Xe.length){this.ts.terminate();break}}catch(t){continue}}}finally{null!==this.Ye&&this.Ye.resolve(),this.Ye=null}}}get rs(){return null!==this.Ye}}function vt(t){return new Ct(t)}class It{Yt=new Map;cs=[];ds=!1;xe;Nt;ls=0;hs=[];us=new Map;Ge=Promise.withResolvers();ts;fs=!0;ps;constructor(t){this.xe=t,this.Nt=t.gs(),this.ts=St(t,this,this.Ge),this.ps=vt(this.ts),t.ws.enqueue(this.Ge.promise),this.Ge.promise.finally((()=>{this.fs=!1}))}get version(){return this.Nt}get zt(){return this.ls}get ae(){return this.Ge.promise}ys(){this.fs&&n({code:"UPD-006",message:"Updater has already been used. Create a new Updater instance for rebuild.",context:{l:"Updater._rebuild"},t:"./docs/error-codes.md#upd"}),this.fs=!0,this.Ge=Promise.withResolvers(),this.Nt=this.xe.gs(),this.ts=St(this.xe,this,this.Ge),this.ps=vt(this.ts),this.xe.ws.enqueue(this.Ge.promise),this.Ge.promise.finally((()=>{this.fs=!1}))}ee(t){this.ls++,this.cs.push(t),this.hs.push(t),this.xs(this.xe,t.info.pattern,this.xe.qt,this.ls),this.ts.Je()}update(t,e){const s=this.ps.es(),o=wt(this.xe,this,this.xe.state,t,((t,s)=>e(t,s))),r=()=>{if(this.xe.Dt.bs&&this.hs.length>0){const t=this.hs;this.hs=[],queueMicrotask((()=>{const e=this.update(null,(e=>e[z](t)));e instanceof Promise&&e.catch((()=>{n({code:"UPD-005",message:"An error occurred during asynchronous state update.",context:{l:"Updater.update.updatedCallback"},t:"./docs/error-codes.md#upd"})}))}))}else s.resolve()};return o instanceof Promise?o.finally((()=>{r()})):(r(),o)}Qe(){const t=this.cs;return this.cs=[],t}je(t){const e=this.ps.es(),s=(n=this.xe,new yt(n,this));var n;try{s.je(t)}finally{e.resolve()}}ie(t){this.fs||this.ys();const e=this.ps.es();try{return t()}finally{e.resolve()}}Ss(t,e,s,o,r){if(o.has(e))return;if(r&&t.Dt.elements.has(e))return;o.add(e);for(const[,e]of s.wt.entries()){const s=e.ft;this.Ss(t,s,e,o,!1)}const i=t.Dt.qe.get(e)??[];for(const e of i){const s=F(t.Dt.De,e);null===s&&n({code:"UPD-004",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.recursiveCollectMaybeUpdates",Cs:e},t:"./docs/error-codes.md#upd"}),this.Ss(t,e,s,o,!1)}}xs(t,e,s,o){const r=F(t.Dt.De,e);null===r&&n({code:"UPD-003",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.collectMaybeUpdates",path:e},t:"./docs/error-codes.md#upd"});let i=this.us.get(e);void 0===i&&(i=new Set,this.Ss(t,e,r,i,!0));const c={version:this.version,zt:o};for(const t of i)s.set(t,c);this.us.set(e,i)}Me(t){const e=mt(this.xe,this,null);return t(pt(this.xe.state,e),e)}}function Pt(t,e){return e(new It(t))}class Tt extends I{get value(){return this.node.value}get V(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&n({code:"BIND-201",message:"Checkbox binding has multiple decorators",context:{l:"BindingNodeCheckbox.constructor",name:this.name,vs:i.length},t:"./docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Ft;this.node.addEventListener(c,(e=>{const s=this.binding.Ps.Is;Pt(d,(e=>{e.update(s,((e,s)=>{t.Ts(e,s,this.V)}))}))}))}U(t){Array.isArray(t)||n({code:"BIND-201",message:"Checkbox value is not array",context:{l:"BindingNodeCheckbox.update",Bs:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.checked=t.includes(this.V)}}class Bt extends I{U(t){Array.isArray(t)||n({code:"BIND-201",message:"ClassList value is not array",context:{l:"BindingNodeClassList.update",Bs:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class Ut extends I{U(t){"boolean"!=typeof t&&n({code:"BIND-201",message:"ClassName value is not boolean",context:{l:"BindingNodeClassName.update",Bs:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.I,t)}}const Nt={};class $t extends I{constructor(t,e,s,n,o,r){super(t,e,s,n,o,r);e.addEventListener(this.I,(t=>this.Us(t)))}update(){}Us(t){const e=this.binding.Ft,s=this.binding.Ps.Is,o=s?.Ns().map((t=>t.Ct.index))??[],r=this.P;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation();const i=Pt(e,(e=>e.update(s,((e,s)=>{const r=this.binding.M.$s(e,s);if("function"==typeof r)return Reflect.apply(r,e,[t,...o]);n({code:"BIND-201",message:"Binding value is not a function",context:{l:"BindingNodeEvent.handler",_s:this.name,Ls:this.I,Bs:typeof r},t:"./docs/error-codes.md#bind",o:"error"})}))));i instanceof Promise&&i.catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"BIND-202",message:"Event handler rejected",context:{l:"BindingNodeEvent.handler",_s:this.name,Ls:this.I},t:"./docs/error-codes.md#bind",o:"error",i:e})}))}_(t){}}const _t={},Lt=(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=_t[t]??(_t[t]=t.slice(2));return new $t(n,o,t,c,i,s)};class Mt extends I{Ms;get id(){return this.Ms}get B(){return!0}constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);const c=this.node.textContent?.slice(3)??n({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"./docs/error-codes.md#bind",o:"error"}),[d]=c.split(" ",2),a=Number(d);(a.toString()!==d||isNaN(a)||!isFinite(a)||!Number.isInteger(a)||a<0)&&n({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent},t:"./docs/error-codes.md#bind",o:"error"}),this.Ms=a}}class Et extends Mt{Es;Rs;ks=[];As;constructor(t,e,s,n,o,r){super(t,e,s,n,o,r);const i=tt(k(""),null);this.Es=Oe(this.binding,this.id,this.binding.Ft,i),this.Rs=[this.Es],this.As=this.ks}get T(){return this.As}U(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeIf.assignValue",_s:this.name},t:"./docs/error-codes.md#bind"})}_(t){const e={l:"BindingNodeIf.applyChange",_s:this.name},s=this.binding.M.L(t.R,t.k);"boolean"!=typeof s&&n({code:"BIND-201",message:"If binding value is not boolean",context:{...e,Bs:typeof s},t:"./docs/error-codes.md#bind"});const o=this.node.parentNode;null===o&&n({code:"BIND-201",message:"Parent node not found",context:{...e,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),s?(this.Es.A(),this.Es.Ds(o,this.node),this.Es._(t),this.As=this.Rs):(this.Es.unmount(),this.Es.D(),this.As=this.ks)}D(){this.Es.unmount(),this.Es.D(),this.As=this.ks}}const Rt=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class kt extends Mt{As=[];Fs=new WeakMap;Vs=[];Os=0;Ws=void 0;Hs=void 0;qs=[];js=new Set;get T(){return this.As}get zs(){return this.Os}set zs(t){this.Os=t}get Gs(){return this.Vs.length}set Gs(t){t<0&&n({code:"BIND-202",message:"BindContent pool length is negative",context:{l:"BindingNodeFor.setPoolLength",_s:this.name,Zs:t},t:"./docs/error-codes.md#bind"}),this.Vs.length=t}get Qs(){if(void 0===this.Ws){const t=`${this.binding.M.pattern}.*`;this.Ws=k(t)}return this.Ws}Js(t,e){let s;if(this.Os>=0)s=this.Vs[this.Os],this.Os--,s.Ks(e);else{const t=tt(this.Qs,e);s=Oe(this.binding,this.id,this.binding.Ft,t)}return this.Fs.set(e,s),s.A(),s}Xs(t){t.unmount(),t.D()}U(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeFor.assignValue"},hint:"Call applyChange to update loop bindings",t:"./docs/error-codes.md#bind"})}_(t){let e=[];const s={l:"BindingNodeFor.applyChange",_s:this.name,Ys:this.binding.M.pattern},o=t.R[W](this.binding.M.pe);Array.isArray(o)||n({code:"BIND-201",message:"Loop value is not array",context:{...s,Bs:null===o?"null":typeof o},t:"./docs/error-codes.md#bind"});const r=t.R[G](this.binding.M.pe)??[],i=new Set(r),c=void 0===this.Hs?[]:this.Hs;Array.isArray(c)||n({code:"BIND-201",message:"Previous loop value is not array",context:{...s,Bs:null===c?"null":typeof c},t:"./docs/error-codes.md#bind"});const d=c.length??0,a=0===i.size?this.js:this.js.difference(i),l=0===this.js.size?i:i.difference(this.js),h=o?.length??0,u=new Set,f=new Set,m=`${this.binding.M.info.pattern}.*`;for(let e=0;e<t.Ue.length;e++){const o=t.Ue[e];if(o.info.pattern!==m)continue;if(t.ye.has(o))continue;const r=o.Ct;null===r&&n({code:"BIND-201",message:"ListIndex is null",context:{...s,tn:o.info.pattern},t:"./docs/error-codes.md#bind"}),this.js.has(r)?u.add(r):f.add(r),t.ye.add(o)}const p=this.node.parentNode??n({code:"BIND-201",message:"Parent node not found",context:{...s,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),g=new Set,w=d===a.size&&d>0;let y=!1;if(w){const t=Array.from(p.childNodes),e=this.As.at(-1)??n({code:"BIND-201",message:"Last BindContent not found",context:{...s,en:this.As.length},t:"./docs/error-codes.md#bind"});let o=t[0];for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.nextSibling;let r=t.at(-1)??null;for(;r&&r.nodeType===Node.TEXT_NODE&&""===r.textContent?.trim();)r=r.previousSibling;o===this.node&&r===e.sn(p)&&(y=!0)}if(w&&y){p.textContent="",p.append(this.node);for(let t=0;t<this.As.length;t++)this.As[t].D();this.Vs.push(...this.As)}else if(a.size>0){for(const t of a){const e=this.Fs.get(t);void 0===e&&n({code:"BIND-201",message:"BindContent not found",context:{...s,nn:"removes",Ct:t.index},t:"./docs/error-codes.md#bind"}),this.Xs(e),g.add(e)}this.Vs.push(...g)}let x=null;const b=this.node;this.zs=this.Gs-1;const S=Rt&&h===l.size&&h>0;if(0===l.size&&0===a.size&&(u.size>0||f.size>0)){if(u.size>0){const t=Array.from(this.As),o=Array.from(u);o.sort(((t,e)=>t.index-e.index));for(const e of o){const o=this.Fs.get(e);void 0===o&&n({code:"BIND-201",message:"BindContent not found",context:{...s,nn:"reorder",Ct:e.index},t:"./docs/error-codes.md#bind"}),t[e.index]=o;const r=t[e.index-1]?.sn(p)??b;o.Ds(p,r)}e=t}if(f.size>0)for(const e of f){const o=this.Fs.get(e);void 0===o&&n({code:"BIND-201",message:"BindContent not found",context:{...s,nn:"overwrites",Ct:e.index},t:"./docs/error-codes.md#bind"}),o._(t)}}else{const o=new Map;for(let t=0;t<this.qs.length;t++)o.set(this.qs[t],t);const i=S?document.createDocumentFragment():p,c=S?null:b,d=[];for(let a=0;a<r.length;a++){const h=r[a],u=x?.sn(i)??c;let f;if(l.has(h))f=this.Js(t,h),f.Ds(i,u),f._(t);else{f=this.Fs.get(h),void 0===f&&n({code:"BIND-201",message:"BindContent not found",context:{...s,nn:"reuse",Ct:h.index},t:"./docs/error-codes.md#bind"}),u?.nextSibling!==f.rn&&f.Ds(i,u);const t=o.get(h);void 0!==t&&t!==a&&d.push(h)}e.push(f),x=f}if(S){const t=b.nextSibling;p.insertBefore(i,t)}for(const e of d){const s=this.binding.cn.get(e)??[];for(const e of s)t.we.has(e)||e._(t)}}this.Gs=this.zs+1,this.As=e,this.Hs=[...o],this.qs=[...r],this.js=i}D(){for(let t=0;t<this.As.length;t++){const e=this.As[t];e.unmount(),e.D()}this.Vs.push(...this.As),this.As=[],this.Fs=new WeakMap,this.Os=0,this.Hs=void 0,this.qs=[],this.js=new Set}}const At=(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new kt(n,o,t,"",i,s)};const Dt={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},Ft={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Vt=new Set(["value","valueAsNumber","valueAsDate"]),Ot=new Set;class Wt extends I{constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);if(!(this.node instanceof HTMLElement))return;if(!((c=this.node)instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement))return;var c;const d=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Vt:t instanceof HTMLInputElement?Ft[t.type]??Vt:Ot)(this.node);if(!d.has(this.name))return;i.length>1&&n({code:"BIND-201",message:"Property binding has multiple decorators",context:{l:"BindingNodeProperty.constructor",_s:this.name,vs:i.length},t:"./docs/error-codes.md#bind"});const a=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Dt[this.name]??"readonly";if("readonly"===a||"ro"===a)return;const l=this.binding.Ft;this.node.addEventListener(a,(e=>{const s=this.binding.Ps.Is;Pt(l,(e=>{e.update(s,((e,s)=>{t.Ts(e,s,this.V)}))}))}))}get value(){return this.node[this.name]}get V(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}U(t){let e;e=null==t||Number.isNaN(t)?"":t,this.name in this.node?this.node[this.name]=e:n({code:"BIND-201",message:`Property not found on node: ${this.name}`,context:{l:"BindingNodeProperty.assignValue",_s:this.name,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"})}}const Ht=(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Wt(n,o,t,"",i,s)};class qt extends I{constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&n({code:"BIND-201",message:"Radio binding has multiple decorators",context:{l:"BindingNodeRadio.constructor",_s:this.name,vs:i.length},t:"./docs/error-codes.md#bind"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Ft;this.node.addEventListener(c,(e=>{const s=this.binding.Ps.Is;Pt(d,(e=>{e.update(s,((e,s)=>{t.Ts(e,s,this.V)}))}))}))}get value(){return this.node.value}get V(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}U(t){let e;e=null==t?"":t;this.node.checked=e===this.V}}class jt extends I{U(t){const e=this.node,s=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.style.setProperty(this.I,s.toString())}}const zt={},Gt="component-state-input",Zt=Symbol.for(`${Gt}.AssignState`),Qt=Symbol.for(`${Gt}.NotifyRedraw`),Jt=new WeakMap;function Kt(t){if(t.tagName.includes("-"))return t.tagName.toLowerCase();const e=t.getAttribute("is");if(e?.includes("-"))return e.toLowerCase();n({code:"COMP-401",message:"Custom element tag name not found",context:{l:"WebComponents.getCustomTagName",tagName:t.tagName,dn:e??null},t:"./docs/error-codes.md#comp"})}class Xt extends I{tagName;constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);const c=this.node;c.tagName.includes("-")?this.tagName=c.tagName.toLowerCase():c.getAttribute("is")?.includes("-")?this.tagName=c.getAttribute("is").toLowerCase():n({code:"COMP-401",message:"Custom element tag name not found",context:{l:"BindingNodeComponent.constructor"},t:"./docs/error-codes.md#comp"})}an(t){const e=this.node,s=Kt(e);customElements.whenDefined(s).then((()=>{e.state[Qt](t)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"COMP-402",message:`Custom element definition failed: ${s}`,context:{l:"BindingNodeComponent._notifyRedraw",tagName:s},t:"./docs/error-codes.md#comp",i:e})}))}$(t){const e=[],s=this.binding.M.pe,n=s.Ct,o=(n?.length??0)-1;for(const r of t)r.info.pattern!==s.info.pattern&&r.info.j.has(s.info.pattern)&&(o>=0&&r.Ct?.at(o)!==n||e.push(r));0!==e.length&&this.an(e)}_(t){this.an([this.binding.M.pe])}A(){const t=this.binding.Ft,e=t.de,s=this.node,o=Kt(s);customElements.whenDefined(o).then((()=>{e.ln(s),s.un.hn(this.binding)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"COMP-402",message:`Custom element definition failed: ${o}`,context:{l:"BindingNodeComponent.activate",tagName:o},t:"./docs/error-codes.md#comp",i:e})})),function(t,e){Jt.set(e,t)}(e,s);let r=t.Oe.get(s);void 0===r&&t.Oe.set(s,r=new Set),r.add(this.binding)}D(){const t=this.binding.Ft;var e;e=this.node,Jt.delete(e);const s=t.Oe.get(this.node);void 0!==s&&s.delete(this.binding)}}const Yt={},te={0:{class:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Bt(n,o,t,"",i,s)},checkbox:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Tt(n,o,t,"",i,s)},radio:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new qt(n,o,t,"",i,s)}},1:{if:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Et(n,o,t,"",i,s)}}},ee={class:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=Nt[t]??(Nt[t]=t.split(".")[1]);return new Ut(n,o,t,c,i,s)},attr:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=T[t]??(T[t]=t.split(".")[1]);return new P(n,o,t,c,i,s)},style:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=zt[t]??(zt[t]=t.split(".")[1]);return new jt(n,o,t,c,i,s)},state:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=Yt[t]??(Yt[t]=t.split(".")[1]);return new Xt(n,o,t,c,i,s)}};const se={};function ne(t,e,s,o){const r=t instanceof Comment,i=t instanceof Element,c=`${r}\t${i}\t${e}`,d=se[c]??(se[c]=function(t,e,s){const o=te[t?1:0][s];if(void 0!==o)return o;if(t&&"for"===s)return At;t&&n({code:"BIND-106",message:`Comment binding property not supported: ${s}`,context:{l:"BindingBuilder.getBindingNodeCreator",propertyName:s,nodeType:"Comment"},t:"./docs/error-codes.md#bind"});const r=s.split("."),i=ee[r[0]];return void 0!==i?i:e&&s.startsWith("on")?Lt:Ht}(r,i,e));return d(e,s,o)}class oe{pattern;info;fn;constructor(t){this.pattern=t,this.info=k(t),this.fn=0===this.info.ht?tt(this.info,null):null}}const re={};class ie{filters;mn=!1;pn;u;gn=null;wn=null;constructor(t,e,s){this.pn=re[e]??(re[e]=new oe(e)),this.u=t,this.filters=s}get pattern(){return this.pn.pattern}get info(){return this.pn.info}get Ct(){return this.pe.Ct}get pe(){return null===this.pn.fn?(null===this.wn&&n({code:"BIND-201",message:"LoopContext is null",context:{l:"BindingState.ref",pattern:this.pattern,ht:this.info.ht},t:"./docs/error-codes.md#bind"}),null===this.gn&&(this.gn=tt(this.info,this.wn.Ct)),this.gn):this.pn.fn}$s(t,e){return dt(this.u.Ft.state,this.pe,t,e)}L(t,e){let s=dt(this.u.Ft.state,this.pe,t,e);for(let t=0;t<this.filters.length;t++)s=this.filters[t](s);return s}U(t,e,s){at(this.u.Ft.state,this.pe,s,t,e)}A(){if(this.info.ht>0){const t={l:"BindingState.activate",pattern:this.pattern},e=this.info.rt??n({code:"BIND-201",message:"Wildcard last parentPath is null",context:t,t:"./docs/error-codes.md#bind"});this.wn=this.u.Ps.Is?.find(e)??n({code:"BIND-201",message:"LoopContext is null",context:{...t,rt:e},t:"./docs/error-codes.md#bind"})}this.u.Ft.yn(this.pe,this.u)}D(){this.u.Ft.xn(this.pe,this.u),this.gn=null,this.wn=null}}class ce{pattern;bn;constructor(t){this.pattern=t;const e=Number(t.slice(1));isNaN(e)&&n({code:"BIND-202",message:"Pattern is not a number",context:{l:"BindingStateIndex.constructor",pattern:t},t:"./docs/error-codes.md#bind"}),this.bn=e}}const de={};class ae{filters;pn;u;wn=null;constructor(t,e,s){this.u=t,this.pn=de[e]??(de[e]=new ce(e)),this.filters=s}Sn(t,e={}){return{l:t,pattern:this.pn.pattern,bn:this.pn.bn,...e}}get pattern(){return n({code:"BIND-301",message:"Binding pattern not implemented",context:this.Sn("BindingStateIndex.pattern"),t:"./docs/error-codes.md#bind"})}get info(){return n({code:"BIND-301",message:"Binding info not implemented",context:this.Sn("BindingStateIndex.info"),t:"./docs/error-codes.md#bind"})}get Ct(){return this.wn?.Ct??n({code:"LIST-201",message:"listIndex is null",context:this.Sn("BindingStateIndex.listIndex"),t:"./docs/error-codes.md#list"})}get pe(){return this.wn?.pe??n({code:"STATE-202",message:"ref is null",context:this.Sn("BindingStateIndex.ref"),t:"./docs/error-codes.md#state"})}get mn(){return!0}$s(t,e){return this.Ct?.index??n({code:"LIST-201",message:"listIndex is null",context:this.Sn("BindingStateIndex.getValue"),t:"./docs/error-codes.md#list"})}L(t,e){let s=this.Ct?.index??n({code:"LIST-201",message:"listIndex is null",context:this.Sn("BindingStateIndex.getFilteredValue"),t:"./docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)s=this.filters[t](s);return s}U(t,e,s){n({code:"BIND-301",message:"Binding assignValue not implemented",context:this.Sn("BindingStateIndex.assignValue"),t:"./docs/error-codes.md#bind"})}A(){const t=this.Sn("BindingStateIndex.activate"),e=(this.u.Ps.Is??n({code:"BIND-201",message:"LoopContext is null",context:t,t:"./docs/error-codes.md#bind"})).Ns();this.wn=e[this.pn.bn-1]??n({code:"BIND-201",message:"Current loopContext is null",context:this.Sn("BindingStateIndex.activate",{Cn:this.pn.bn-1,vn:e.length}),t:"./docs/error-codes.md#bind"});const s=this.wn.Pn?.In??null;null===s&&n({code:"BIND-201",message:"Binding for list is null",context:t,t:"./docs/error-codes.md#bind"});const o=s.cn.get(this.Ct);void 0===o?s.cn.set(this.Ct,new Set([this.u])):o.add(this.u)}D(){this.wn=null}}const le=new RegExp(/^\$\d+$/);function he(t,e){return le.test(t)?((t,e)=>(s,n)=>{const o=v(n,e);return new ae(s,t,o)})(t,e):((t,e)=>(s,n)=>{const o=v(n,e);return new ie(s,t,o)})(t,e)}const ue={};function fe(t,e=(t=>`${t.constructor.name}\t${t instanceof Comment?t.textContent?.[2]??"":""}`)(t)){return ue[e]??(ue[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":n({code:"BIND-105",message:`Node type not supported: ${t.nodeType}`,context:{l:"BindingBuilder.getNodeType",nodeType:t.nodeType,nodeName:t.nodeName,Tn:t.constructor.name},t:"./docs/error-codes.md#bind"}))(t))}const me=t=>t.trim(),pe=t=>t.length>0,ge=new RegExp(/^#(.*)#$/),we=t=>{const e=ge.exec(t);return e?decodeURIComponent(e[1]):t},ye=t=>{const[e,...s]=t.split(",").map(me);return{name:e,options:s.map(we)}},xe=t=>{const[e,...s]=t.split("|").map(me);return{Bn:e,filters:s.map(ye)}},be=t=>t.split(";").map(me).filter(pe).map((t=>(t=>{const[e,s=null]=t.split("@").map(me),n=s?s.split(",").map(me):[],[o,r]=e.split(":").map(me),{Bn:i,filters:c}=xe(o),{Bn:d,filters:a}=xe(r);return{Un:i,Nn:d,$n:c,_n:a,P:n}})(t))),Se={};const Ce=t=>{t.removeAttribute("data-bind")},ve={HTMLElement:Ce,SVGElement:Ce,Text:void 0,Ln:void 0};const Ie={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,Ln:void 0,SVGElement:void 0};class Pe{nodeType;Mn;En;Rn=new Map;constructor(t){this.nodeType=fe(t);const e=function(t,e){switch(t){case"Text":return`textContent:${e.textContent?.slice(3).trim()??""}`;case"HTMLElement":case"SVGElement":return e.getAttribute(B)??"";case"Template":{const t=e.textContent?.slice(3).trim(),[s]=t?.split(" ",2)??[];return Ee(Number(s)).getAttribute(B)??""}default:return""}}(this.nodeType,t),s=function(t,e){return Ie[e]?.(t)??t}(t,this.nodeType);!function(t,e){ve[e]?.(t)}(s,this.nodeType),this.Mn=function(t){let e=[],s=t;for(;null!==s.parentNode;)e=[Array.from(s.parentNode.childNodes).indexOf(s),...e],s=s.parentNode;return e}(s),this.En=function(t){return""===t.trim()?[]:Se[t]??(Se[t]=be(t))}(e);for(let t=0;t<this.En.length;t++){const e=this.En[t],n={kn:ne(s,e.Un,e.$n,e.P),An:he(e.Nn,e._n)};this.Rn.set(e,n)}}}function Te(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(B)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(U)||0===t.textContent?.indexOf(N))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;s.nextNode();)e.push(s.currentNode);return e}const Be={},Ue={},Ne={},$e={};function _e(t){return Te(t).map((t=>function(t){return new Pe(t)}(t)))}const Le={};function Me(t,e,s){var n;return n=e.content,Array.from(n.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||n.removeChild(t)})),function(t,e,s=t){const n=_e(e),o=Ne[s]??(Ne[s]=new Set),r=Ue[s]??(Ue[s]=new Set),i=$e[s]??($e[s]=new Set);for(let t=0;t<n.length;t++){const e=n[t];for(let t=0;t<e.En.length;t++){const s=e.En[t];o.add(s.Nn),"for"===s.Un&&r.add(s.Nn),"if"!==s.Un&&"for"!==s.Un||i.add(s.Nn)}}Be[t]=n}(t,e.content,s),Le[t]=e,t}function Ee(t){return Le[t]??n({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"Template.getTemplateById",Dn:t},t:"./docs/error-codes.md#tmp"})}class Re{Ps;Ft;node;Fn;M;cn=new WeakMap;Vn=!1;constructor(t,e,s,n,o){this.Ps=t,this.node=e,this.Ft=s,this.Fn=n(this,e,s.On),this.M=o(this,s.Wn)}get T(){return this.Fn.T}get isActive(){return this.Vn}Ts(t,e,s){this.M.U(t,e,s)}$(t){this.Fn.$(t)}_(t){if(t.we.has(this))return;if("build"===t.Le&&!this.Fn.B)return void(this.Fn.F?t._e.push(this):t.$e.push(this));if("apply"===t.Le&&(this.Fn.B||this.Fn.F))return;if("applySelect"===t.Le&&(this.Fn.B||!this.Fn.F))return;if("direct"===t.Le){if(this.Fn.F)return void t._e.push(this);this.Fn.B&&n({code:"BIND-101",message:"Direct render phase cannot process buildable bindings",context:{l:"Binding.applyChange",name:this.Fn.name},t:"./docs/error-codes.md#bind"})}t.we.add(this),this.Fn._(t);const e=this.M.pe;if(!this.M.mn&&!this.Ft.Dt.qe.has(e.info.pattern)){1===this.Ft.ke(e).length&&t.ye.add(e)}}A(){this.Vn=!0,this.M.A(),this.Fn.A()}D(){this.isActive&&(this.Fn.D(),this.M.D(),this.Vn=!1)}}function ke(t,e,s,n,o){return new Re(t,e,s,n,o)}class Ae{info;Pn;gn;Hn;qn={};constructor(t,e){this.gn=t,this.info=t.info,this.Pn=e}get pe(){return this.gn??n({code:"STATE-202",message:"ref is null",context:{l:"LoopContext.ref",path:this.info.pattern},t:"./docs/error-codes.md#state"})}get path(){return this.pe.info.pattern}get Ct(){return this.pe.Ct??n({code:"LIST-201",message:"listIndex is required",context:{l:"LoopContext.listIndex",path:this.info.pattern},t:"./docs/error-codes.md#list"})}Ks(t){this.gn=tt(this.info,t)}jn(){this.gn=null}get zn(){if(void 0===this.Hn){let t=this.Pn;for(;null!==t;){if(null!==t.ue&&t.ue!==this){this.Hn=t.ue;break}t=t.In?.Ps??null}void 0===this.Hn&&(this.Hn=null)}return this.Hn}find(t){let e=this.qn[t];if(void 0===e)if(this.path===t)e=this.qn[t]=this;else{let s=this.zn;for(;null!==s&&s.path!==t;)s=s.zn;e=this.qn[t]=s}return e}Gn(t){t(this);let e=this.zn;for(;null!==e;)t(e),e=e.zn}Ns(){const t=[];return this.Gn((e=>{t.unshift(e)})),t}}function De(t){const e=Ee(t)??n({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"BindContent.createContent",Dn:t},t:"./docs/error-codes.md#tmp"}),s=document.importNode(e.content,!0);if(Object.keys(fs).length>0){const t=s.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){ps(t[e].tagName.toLowerCase())}}return s}function Fe(t,e,s,o){const r=(t=>Be[t])(e)??n({code:"BIND-101",message:"Data-bind not registered",context:{l:"BindContent.createBindings",Dn:e},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],a=x(o,d.Mn)??n({code:"BIND-102",message:`Node not found by nodePath: ${String(d.Mn)}`,context:{l:"BindContent.createBindings",Dn:e,Mn:d.Mn},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.En.length;o++){const r=d.En[o],c=d.Rn.get(r)??n({code:"BIND-103",message:`Creator not found for bindText: ${String(r)}`,context:{l:"BindContent.createBindings",Dn:e,Zn:r},t:"./docs/error-codes.md#bind"}),l=ke(t,a,s,c.kn,c.An);i.push(l)}}return i}class Ve{In;ue;id;rn;Qn;fragment;childNodes;Jn=[];xe;Vn=!1;Kn;sn(t){const e=this.Jn[this.Jn.length-1],s=this.Qn;if(void 0!==e&&e.node===s&&e.T.length>0){const s=(e.T.at(-1)??n({code:"BIND-104",message:"Child bindContent not found",context:{l:"BindContent.getLastNode",Dn:this.id},t:"./docs/error-codes.md#bind"})).sn(t);if(null!==s)return s}return t!==s?.parentNode?null:s}get Is(){if(void 0===this.Kn){if(null!==this.ue)return this.Kn=this.ue,this.Kn;let t=this.In?.Ps??null;for(;null!==t&&null===t.ue;)t=t.In?.Ps??null;this.Kn=t?.ue??null}return this.Kn}constructor(t,e,s,n){this.In=t,this.id=e,this.fragment=De(e),this.childNodes=Array.from(this.fragment.childNodes),this.rn=this.childNodes[0]??null,this.Qn=this.childNodes[this.childNodes.length-1]??null,this.xe=s,this.ue=null!==n.Ct?new Ae(n,this):null;const o=Fe(this,e,s,this.fragment);this.Jn=o}get isActive(){return this.Vn}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}Xn(t,e){for(let s=0;s<this.childNodes.length;s++)t.insertBefore(this.childNodes[s],e)}Ds(t,e){const s=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],s)}unmount(){this.Kn=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}Ks(t){null===this.ue&&n({code:"BIND-201",message:"LoopContext is null",context:{l:"BindContent.assignListIndex",Dn:this.id},t:"./docs/error-codes.md#bind"}),this.ue.Ks(t)}_(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.Jn.length;e++){const s=this.Jn[e];t.we.has(s)||s._(t)}}A(){this.Vn=!0;for(let t=0;t<this.Jn.length;t++)this.Jn[t].A()}D(){this.Vn=!1,this.ue?.jn();for(let t=0;t<this.Jn.length;t++)this.Jn[t].D()}}function Oe(t,e,s,n){return new Ve(t,e,s,n)}function We(t,e){const s=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,n=s.adoptedStyleSheets;n.includes(e)||(s.adoptedStyleSheets=[...n,e])}function He(t,e){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}function qe(t,e,s){"none"===e.shadowDomMode?We(t,s):"force"===e.shadowDomMode||null===e.Yn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.Yn)?He(t,s):We(t,s)}class je{eo=new Set;so=new Set;no=new Map;oo=new Map;ro=new Map;io=new Map;co=new WeakSet;hn(t){if(this.co.has(t))return;const e=t.M.pattern,s=t.Fn.I;this.ro.has(e)&&n({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{l:"ComponentStateBinding.addBinding",ct:e,do:this.ro.get(e)},t:"./docs/error-codes.md#state"}),this.io.has(s)&&n({code:"STATE-303",message:`Child path "${s}" already has a parent path`,context:{l:"ComponentStateBinding.addBinding",ao:s,lo:this.io.get(s)},t:"./docs/error-codes.md#state"}),this.ro.set(e,s),this.io.set(s,e),this.so.add(e),this.eo.add(s),this.no.set(e,t),this.oo.set(s,t),this.co.add(t)}ho(t){return this.ro.get(t)}uo(t){return this.io.get(t)}fo(t){const e=k(t).j.intersection(this.eo);0===e.size&&n({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",ao:t},t:"./docs/error-codes.md#state"});const s=Array.from(e),o=s[s.length-1],r=t.slice(o.length),i=this.io.get(o);return void 0===i&&n({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",ao:t,mo:o},t:"./docs/error-codes.md#state"}),i+r}po(t){const e=k(t).j.intersection(this.so);0===e.size&&n({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",ct:t},t:"./docs/error-codes.md#state"});const s=Array.from(e),o=s[s.length-1],r=t.slice(o.length),i=this.ro.get(o);return void 0===i&&n({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",ct:t,mo:o},t:"./docs/error-codes.md#state"}),i+r}wo(t){if(0===this.eo.size)return null;const e=t.j.intersection(this.eo);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const s=t.yo(e);for(const t of s??[])this.hn(t)}}class ze{xo;xe;constructor(t,e){this.xo=e,this.xe=t}bo(t){Pt(this.xe,(e=>{e.update(null,(e=>{for(const[s,n]of Object.entries(t)){const t=tt(k(s),null);e[H](t,n)}}))}))}$(t){Pt(this.xe,(e=>{for(const s of t){let t;try{t=this.xo.po(s.info.pattern)}catch(t){continue}const o=k(t),r=o.ht-1,i=r>=0?s.Ct?.at(r)??null:null;r>=0&&null===i&&n({code:"LIST-201",message:`ListIndex not found for parent ref: ${s.info.pattern}`,context:{l:"ComponentStateInput.notifyRedraw",So:s.info.pattern,Co:o.pattern},t:"./docs/error-codes.md#list"});const c=tt(o,i);e.ee(c)}}))}get(t,e,s){if(e===Zt)return this.bo.bind(this);if(e===Qt)return this.$.bind(this);if("string"==typeof e){const t=tt(k(e),null);return this.xe.getPropertyValue(t)}n({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.get",ce:String(e)},t:"./docs/error-codes.md#state"})}set(t,e,s,o){if("string"==typeof e){const t=tt(k(e),null);return this.xe.vo(t,s),!0}n({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.set",ce:String(e)},t:"./docs/error-codes.md#state"})}}class Ge{u;Io;Po=new Set;constructor(t,e){this.u=t,this.Io=e}get(t){const e=this.u.wo(t.info);null===e&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.get",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.u.oo.get(e);void 0===s&&n({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.get",ao:e},t:"./docs/error-codes.md#cso"});const o=tt(k(this.u.fo(t.info.pattern)),t.Ct??s.M.Ct);if(!this.Po.has(o.info.pattern)){const e=this.Io.Dt.Ot.has(t.info.pattern);s.Ft.Dt.addPath(o.info.pattern,e),this.Po.add(o.info.pattern)}return s.Ft.getPropertyValue(o)}set(t,e){const s=this.u.wo(t.info);null===s&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.set",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const o=this.u.oo.get(s);void 0===o&&n({code:"CSO-102",message:`Child binding not registered: ${s}`,context:{l:"ComponentStateOutput.set",ao:s},t:"./docs/error-codes.md#cso"});const r=tt(k(this.u.fo(t.info.pattern)),t.Ct??o.M.Ct);if(!this.Po.has(r.info.pattern)){const e=this.Io.Dt.Ot.has(t.info.pattern);o.Ft.Dt.addPath(r.info.pattern,e),this.Po.add(r.info.pattern)}return o.Ft.vo(r,e),!0}startsWith(t){return null!==this.u.wo(t)}he(t){const e=this.u.wo(t.info);null===e&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.getListIndexes",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.u.oo.get(e);void 0===s&&n({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.getListIndexes",ao:e},t:"./docs/error-codes.md#cso"});const o=tt(k(this.u.fo(t.info.pattern)),t.Ct);if(!this.Po.has(o.info.pattern)){const e=this.Io.Dt.Ot.has(t.info.pattern);s.Ft.Dt.addPath(o.info.pattern,e),this.Po.add(o.info.pattern)}return s.Ft.he(o)}}class Ze{cs=[];To=!1;get Bo(){return this.cs.length>0?this.cs[0]:null}get Uo(){return this.Bo?this.Bo.No.promise:null}async $o(t){const e=this.Bo??n({code:"UPD-301",message:"No item in update complete queue to process",context:{l:"CompleteQueue.processNext"},t:"./docs/error-codes.md#upd"});let s=!1;try{s=await e._o}finally{this.cs.shift(),e.No.resolve(s),t.resolve()}}async Lo(){if(!this.To){this.To=!0;try{for(;this.cs.length>0;){const t=Promise.withResolvers();queueMicrotask((()=>{this.$o(t)})),await t.promise}}finally{this.To=!1}}}enqueue(t){this.cs.push({_o:t,No:Promise.withResolvers()}),this.To||this.Lo()}}class Qe{type="autonomous";config;Mo;styleSheet;Eo;state;On;Wn;Ro=HTMLElement;de;Dt;ko=Promise.withResolvers();Ao;Gt;un;Oe=new WeakMap;Ve=new Set;qt=new Map;ws=function(){return new Ze}();Es=null;Do=null;Fo=null;Vo=!1;Oo=0;Wo=new WeakMap;constructor(t,e){this.config=t,this.config.Yn&&(this.type="builtin");const s=e.constructor;var n;this.Mo=s.Mo,this.styleSheet=s.styleSheet,this.Eo=s.Eo,this.state=new this.Eo,this.On=s.On,this.Wn=s.Wn,this.de=e,this.un=new je,this.Ao=function(t,e){const s=new ze(t,e);return new Proxy({},s)}(this,this.un),this.Gt=(n=this.un,new Ge(n,this)),this.Dt=s.Dt}get Pn(){return null===this.Es&&n({code:"BIND-201",message:"BindContent not initialized yet",context:{l:"ComponentEngine.bindContent.get",Ho:this.de.constructor.id},t:"./docs/error-codes.md#bind"}),this.Es}get qo(){return this.Oo}gs(){return++this.Oo}jo(){for(const t in this.state)$.has(t)||this.Dt.zo.has(t)||(this.Dt.zo.add(t),V(this.Dt.De,t));const t=this.de.constructor,e=tt(k(""),null);this.Es=Oe(null,t.id,this,e)}connectedCallback(){if(this.config.Go)qe(this.de,this.config,this.styleSheet);else{this.Fo=this.de.parentNode,this.Do=document.createComment("Structive block placeholder"),this.Vo=!0;try{this.de.replaceWith(this.Do)}finally{this.Vo=!1}}if(this.config.Go)this.Pn.mount(this.de.shadowRoot??this.de);else{const t=this.Fo??n({code:"BIND-201",message:"Block parent node not set",context:{l:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.Pn.Ds(t,this.Do)}if(this.de.dataset.state)try{const t=JSON.parse(this.de.dataset.state);this.Ao[Zt](t)}catch(t){n({code:"STATE-202",message:"Failed to parse state from dataset",context:{l:"ComponentEngine.connectedCallback",Zo:this.de.dataset.state},t:"./docs/error-codes.md#state",i:t})}if(this.Pn.A(),Pt(this,(t=>{t.je(this.Pn)})),this.Dt.Qo){const t=Pt(this,(t=>t.update(null,(t=>t[q]()))));t instanceof Promise?t.finally((()=>{this.ko.resolve()})).catch((()=>{n({code:"COMP-301",message:"Connected callback failed",context:{l:"ComponentEngine.connectedCallback"},t:"./docs/error-codes.md#comp"})})):this.ko.resolve()}else this.ko.resolve()}disconnectedCallback(){if(!this.Vo)try{this.Dt.Jo&&Pt(this,(t=>{t.update(null,(t=>{t[j]()}))}))}catch(t){n({code:"COMP-302",message:"Disconnected callback failed",context:{l:"ComponentEngine.disconnectedCallback"},t:"./docs/error-codes.md#comp",i:t})}finally{this.de.Xo?.Ko(this.de),this.config.Go||(this.Do?.remove(),this.Do=null,this.Fo=null),this.Pn.D()}}he(t){if(this.Gt.startsWith(t.info))return this.Gt.he(t);let e=null;return Pt(this,(s=>e=s.Me((e=>e[G](t))))),e}getPropertyValue(t){let e;return Pt(this,(s=>{e=s.Me((e=>e[W](t)))})),e}vo(t,e){Pt(this,(s=>{s.update(null,(s=>{s[H](t,e)}))}))}ln(t){this.Ve.add(t)}Ko(t){this.Ve.delete(t)}Ht(t){return this.Wo.get(t)?.Yo??null}Kt(t,e){const s=this.Wo.get(t);void 0===s?this.Wo.set(t,{Jn:[],Yo:e}):s.Yo=e}ke(t){return this.Wo.get(t)?.Jn??[]}yn(t,e){const s=this.Wo.get(t);void 0===s?this.Wo.set(t,{Jn:[e],Yo:null}):s.Jn.push(e)}xn(t,e){const s=this.Wo.get(t);if(void 0!==s){const t=s.Jn.indexOf(e);t>=0&&s.Jn.splice(t,1)}}}const Je=/\{\{([^}]+)\}\}/g;const Ke="http://www.w3.org/2000/svg";function Xe(t,e,n=t){let o=e;const r=o.getAttribute(B),i=s.debug?r??"":"";if(o.parentNode?.replaceChild(document.createComment(`${N}${t} ${i}`),o),o.namespaceURI===Ke){const t=document.createElement("template"),e=Array.from(o.childNodes);for(let s=0;s<e.length;s++){const n=e[s];t.content.appendChild(n)}t.setAttribute(B,r??""),o=t}return o.content.querySelectorAll("template").forEach((t=>{Xe(p(),t,n)})),Me(t,o,n),t}function Ye(t,e){const s=document.createElement("template");s.dataset.id=t.toString(),s.innerHTML=function(t){const e=[];return t.replaceAll(Je,((t,s)=>{const o=s.trim(),[r]=o.split(":");if("if"!==r&&"for"!==r&&"endif"!==r&&"endfor"!==r&&"elseif"!==r&&"else"!==r)return`\x3c!--${U}${o}--\x3e`;const i=o.slice(r.length+1).trim(),c={type:r,tr:o,er:i};if("if"===r||"for"===r)return e.push(c),`<template data-bind="${o}">`;if("endif"===r){const t=[];for(0===e.length&&n({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",tr:o,sr:e.length},t:"./docs/error-codes.md#tmp"});e.length>0;){const s=e.pop();if("if"===s.type){t.push("</template>");break}"elseif"===s.type?t.push("</template>"):n({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",nr:s.type,tr:o},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===r){const t=e.pop()??n({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",tr:o,sr:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";n({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",nr:t.type,tr:o},t:"./docs/error-codes.md#tmp"})}else if("elseif"===r){const t=e.at(-1)??n({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",tr:o,sr:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(c),`</template><template data-bind="if:${t.er}|not"><template data-bind="if:${i}">`;n({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",nr:t.type,tr:o},t:"./docs/error-codes.md#tmp"})}else if("else"===r){const t=e.at(-1)??n({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",tr:o,sr:e.length},t:"./docs/error-codes.md#tmp"});return"if"===t.type?`</template><template data-bind="if:${t.er}|not">`:n({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",nr:t.type,tr:o},t:"./docs/error-codes.md#tmp"})}return n({code:"TMP-102",message:"Unreachable: All Mustache types should be handled by preceding branches",context:{l:"Template.replaceMustacheWithTemplateTag",tr:o,sr:e.length},t:"./docs/error-codes.md#tmp"})}))}(e),Xe(t,s)}const ts=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,es=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function ss(t,e){const s={l:"StateProperty.createAccessorFunctions",pattern:t.pattern},o=new Set(t.q).intersection(e);let r=-1,i="";for(const t of o){const e=t.split(".");1!==e.length&&(e.length>r&&(r=e.length,i=t))}if(i.length>0){es.test(i)||n({code:"STATE-202",message:`Invalid path: ${i}`,context:{...s,rr:i},t:"./docs/error-codes.md#state"});const e=k(i),o=[];let r=e.ht;for(let c=e.W.length;c<t.W.length;c++){const e=t.W[c];"*"===e?(o.push(`[this.$${r+1}]`),r++):(ts.test(e)||n({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{...s,ir:e,rr:i},t:"./docs/error-codes.md#state"}),o.push(`.${e}`))}const c=o.join(""),d=`this["${i}"]${c} = value;`;return{get:new Function("",`return this["${i}"]${c};`),set:new Function("value",d)}}{const e=[];let o=0;for(let r=0;r<t.W.length;r++){const i=t.W[r];"*"===i?(e.push(`[this.$${o+1}]`),o++):(ts.test(i)||n({code:"STATE-202",message:`Invalid segment name: ${i}`,context:{...s,ir:i},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+i))}const r=e.join(""),i=`this.${r} = value;`;return{get:new Function("",`return this.${r};`),set:new Function("value",i)}}}class ns{zo=new Set;Ot=new Set;Ae=new Set;elements=new Set;cr=new Set;Wt=new Set;At=new Set;te=new Set;dr=new Set;ar=new Set;lr=new Map;qe=new Map;De=function(){return new A("","",0)}();Qo=!1;Jo=!1;bs=!1;Ms;hr;ur=new Set;constructor(t){this.Ms=t.id,this.hr=t.Eo;const e=(t=>Ne[t]??new Set)(this.Ms),s=new Set;for(const t of e){const e=k(t);this.zo=this.zo.union(e.j);for(const t of e.j){const e=k(t);"*"===e.H&&s.add(e.ct)}}const n=(t=>Ue[t]??new Set)(this.Ms);this.Ot=this.Ot.union(n).union(s);for(const t of this.Ot){const e=`${t}.*`;this.elements.add(e)}const o=(t=>$e[t]??new Set)(this.Ms);this.Ae=this.Ae.union(o);let r=this.hr.prototype;for(;r&&r!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(r);if(t)for(const[e,s]of Object.entries(t)){if($.has(e))continue;if("function"==typeof s.value){this.cr.add(e),e===_&&(this.Qo=!0),e===L&&(this.Jo=!0),e===M&&(this.bs=!0);continue}const t=void 0!==s.get,n=void 0!==s.set,o=k(e);this.zo=this.zo.union(o.j),t&&this.Wt.add(e),n&&this.te.add(e),t&&!n&&this.At.add(e),t&&n&&this.dr.add(e)}r=Object.getPrototypeOf(r)}for(const t of this.zo){if(this.Wt.has(t))continue;if(this.te.has(t))continue;const e=k(t);if(1===e.W.length)continue;const s=ss(e,this.Wt);Object.defineProperty(this.hr.prototype,t,{get:s.get,set:s.set,enumerable:!0,configurable:!0}),this.ar.add(t)}for(const t of this.zo){V(this.De,t);const e=k(t);if(e.ct){const s=this.lr.get(e.ct);void 0!==s?s.add(t):this.lr.set(e.ct,new Set([t]))}}}addPath(t,e=!1){const s=k(t);if(e&&!this.Ot.has(t)){this.Ot.add(t);const e=`${t}.*`;this.elements.add(e)}else"*"===s.H&&(this.elements.add(t),this.Ot.add(s.ct));for(const t of s.j){if(this.zo.has(t))continue;this.zo.add(t),V(this.De,t);const e=k(t);if("*"===e.H&&(this.elements.add(t),this.Ot.add(e.ct)),e.W.length>1){const s=ss(e,this.Wt);Object.defineProperty(this.hr.prototype,t,{get:s.get,set:s.set,enumerable:!0,configurable:!0}),this.ar.add(t)}if(e.ct){const s=this.lr.get(e.ct);void 0!==s?s.add(t):this.lr.set(e.ct,new Set([t]))}}}Vt(t,e){const s=`${e}=>${t}`;if(this.ur.has(s))return;this.zo.has(e)||this.addPath(e),this.ur.add(s);const n=this.qe.get(e);void 0!==n?n.add(t):this.qe.set(e,new Set([t]))}}function os(t){const s=function(t){const s=e();return{Go:void 0===t.Go||t.Go,shadowDomMode:t.shadowDomMode??s.shadowDomMode,Yn:t.Yn??null}}(t.Eo.mr??{}),o=p(),{pr:r,gr:i,Eo:c}=t,d=Object.assign({},f),a=Object.assign({},u);c.wr=!0,Ye(o,r),y(o,i),function(t,e){g[t]=e}(o,c);const l=function(t){return t?document.createElement(t).constructor:HTMLElement}(s.Yn),h=s.Yn;return class extends l{static define(t){h?customElements.define(t,this,{Yn:h}):customElements.define(t,this)}static get id(){return o}static yr=r;static get pr(){return this.yr}static set pr(t){this.yr=t,Ye(this.id,t),this.br=null,this.Sr=null}static Cr=i;static get gr(){return this.Cr}static set gr(t){this.Cr=t,y(this.id,t),this.vr=null}static br=null;static get Mo(){return this.br||(this.br=Ee(this.id)),this.br}static vr=null;static get styleSheet(){return this.vr||(this.vr=function(t){return w[t]??n({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{l:"StyleSheet.getStyleSheetById",Ir:t},t:"./docs/error-codes.md#css"})}(this.id)),this.vr}static hr=null;static get Eo(){return this.hr||(this.hr=function(t){return g[t]??n({code:"STATE-101",message:`StateClass not found: ${t}`,context:{l:"StateClass.getStateClassById",Pr:t},t:"./docs/error-codes.md#state"})}(this.id)),this.hr}static Tr=d;static get On(){return this.Tr}static Br=a;static get Wn(){return this.Br}static Sr=null;static get Dt(){return this.Sr||(this.Sr=new ns(this)),this.Sr}xe;Ur;constructor(){super(),this.xe=function(t,e){return new Qe(t,e)}(s,this),this.xe.jo()}connectedCallback(){this.xe.connectedCallback()}disconnectedCallback(){this.xe.disconnectedCallback()}get Xo(){var t;return void 0===this.Ur&&(this.Ur=(t=this,Jt.get(t)??null)),this.Ur}get state(){return this.xe.Ao}get un(){return this.xe.un}get Nr(){return this.xe.Eo.wr??!1}get ko(){return this.xe.ko}get ae(){return this.xe.ws.Uo}yo(t){return this.xe.Oe.get(t)??null}ln(t){this.xe.ln(t)}Ko(t){this.xe.Ko(t)}}}function rs(t){return t.replaceAll(/<!--\{\{([^}]+)}}-->/g,((t,e)=>`{{${e}}}`))}function is(t,e,n){if(!s.debug)return;const o=n?` (${n})`:"";console.warn(`[Structive][SFC] Missing <${t}> section in ${e}${o}`)}let cs=0;async function ds(t){const e=import.meta.resolve?import.meta.resolve(t):t,s="./docs/error-codes.md#imp-202-component-load-failed";let o="";try{const r=await fetch(e);r.ok||n({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,$r:e,status:r.status,statusText:r.statusText,url:r.url},hint:"Make sure the import map entry points to a reachable SFC and the server returns a 2xx status.",t:s}),o=await r.text()}catch(o){n({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,$r:e},hint:"Confirm the SFC path is correct and accessible before bootstrapping.",t:s,i:o})}return async function(t,e){const s=document.createElement("template");s.innerHTML=function(t){return t.replaceAll(/\{\{([^}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(e);const n=s.content.querySelector("template");n||is("template",t),n?.remove();const o=s.content.querySelector("script[type=module]");let r={};if(o){const e=`\n// uniq id: ${cs++}\n//# sourceURL=${t}\n`;if("function"==typeof URL.createObjectURL){const t=new Blob([o.text+e],{type:"application/javascript"}),s=URL.createObjectURL(t);try{r=await import(s)}finally{URL.revokeObjectURL(s)}}else{const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(o.text+e)));r=await import(`data:application/javascript;base64,${t}`)}}else is("script",t,'expects <script type="module">');o?.remove();const i=s.content.querySelector("style");i||is("style",t),i?.remove();const c=r.default??class{};return{text:e,pr:rs(n?.innerHTML??"").trim(),gr:i?.textContent??"",Eo:c}}(t,o)}function as(t,e){e.define(t)}const ls="@routes/",hs="@components/",us="#lazy",fs={};async function ms(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const s=JSON.parse(e.innerHTML);s.imports&&(t.imports=Object.assign(t.imports||{},s.imports))})),t}();if(t.imports){const e=new Map;for(const[s,n]of Object.entries(t.imports)){let t,n;if(s.startsWith(ls)){n=s.endsWith(us);const e=s.slice(7,n?-5:void 0);t=`routes${e.replace(/:[^\s/]+/g,"").replace(/\//g,"-")}`,bs(t,"/root"===e?"/":e)}s.startsWith(hs)&&(n=s.endsWith(us),t=s.slice(12,n?-5:void 0)),t&&(n?fs[t]=s:e.set(t,s))}for(const[t,s]of e.entries()){as(t,os(await ds(s)))}}}function ps(t){const e=fs[t];if(e)delete fs[t],queueMicrotask((()=>{ds(e).then((e=>{const s=os(e);as(t,s)})).catch((s=>{n({code:"IMP-202",message:`Failed to load lazy component for tagName: ${t}`,context:{l:"WebComponents.loadFromImportMap.loadLazyLoadComponent",tagName:t,_r:e,Lr:s instanceof Error?s.message:String(s)},t:"./docs/error-codes.md#imp",o:"error"})}))}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{l:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const gs="routes:",ws=[];let ys=null;class xs extends HTMLElement{Mr=window.location.pathname.split("/").pop()||"";Er=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Rr;constructor(){super(),this.Rr=this.kr.bind(this)}connectedCallback(){ys=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Rr),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Rr),ys=null}kr(t){t.preventDefault(),this.Ee()}navigate(t){const e="/"===t[0]?this.Er+t.slice(1):t;history.pushState({},"",e),this.Ee()}Ee(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Mr&&(t[t.length-1]="");const e=t.join("/").replace(this.Er,""),s="/"!==e[0]?`/${e}`:e;let n;const o={};for(const[t,e]of ws){const r=new RegExp(`^${t.replace(/:[^\s/]+/g,"([^/]+)")}$`);if(r.test(s)){n=e;const i=s.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(n){const t=document.createElement(n);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return t in fs}(n)&&ps(n)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function bs(t,e){let s;s=e.startsWith(gs)?e.substring(gs.length):e,ws.push([s,t])}const Ss="router",Cs=`<slot name="${Ss}"></slot>`;class vs extends HTMLElement{constructor(){super(),"none"!==s.shadowDomMode&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Ar(),this.Ee()}get root(){return this.shadowRoot??this}async Ar(){if(s.layoutPath){const t=await fetch(s.layoutPath);if(t.ok){const e=await t.text(),s=document.createElement("template");s.innerHTML=e;const n=s.content.querySelector("template"),o=s.content.querySelector("style");if(this.root.appendChild(n?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else n({code:"TMP-101",message:`Failed to load layout from ${s.layoutPath}`,context:{l:"MainWrapper.loadLayout",layoutPath:s.layoutPath},t:"./docs/error-codes.md#tmp"})}else this.root.innerHTML=Cs}Ee(){if(s.enableRouter){const t=document.createElement(s.routerTagName);t.setAttribute("slot",Ss),this.root.appendChild(t)}}}const Is=s;let Ps=!1;async function Ts(t){await async function(t){for(const[e,n]of Object.entries(t)){let t=null;if(s.enableRouter){const t=n.startsWith("@routes")?n.slice(7):n;bs(e,"/root"===t?"/":t)}t=await ds(n),as(e,os(t))}}(t),Is.autoInit&&await Bs()}async function Bs(){Ps||(await async function(){if(s.autoLoadFromImportMap&&await ms(),s.enableRouter&&customElements.define(s.routerTagName,xs),s.enableMainWrapper&&(customElements.define(s.mainTagName,vs),s.autoInsertMainWrapper)){const t=document.createElement(s.mainTagName);document.body.appendChild(t)}}(),Ps=!0)}export{Bs as bootstrapStructive,Is as config,Ts as defineComponents};
//# sourceMappingURL=structive.min.mjs.map
