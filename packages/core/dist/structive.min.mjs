const t={debug:!1,locale:"en-US",shadowDomMode:"auto",enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:s,context:o,hint:r,t:i,o:c,i:d}=t;n.debug&&(console.group(`[Structive Error] ${s}: ${e}`),o&&console.log("Context:",o),r&&console.log("Hint:",r),i&&console.log("Docs:",i),d&&console.error("Cause:",d),console.groupEnd());const a=new Error(e);throw a.code=s,o&&(a.context=o),r&&(a.hint=r),i&&(a.t=i),c&&(a.o=c),d&&(a.i=d),a}const o=(t,e)=>({l:t,h:e});function r(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:o("Filter.optionsRequired",t),t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:o("Filter.optionMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a number value`,context:o("Filter.valueMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function d(t){s({code:"FLT-202",message:`${t} requires a date value`,context:o("Filter.valueMustBeDate",t),t:"./docs/error-codes.md#flt"})}const a=e();function l(t){return!(!t||isNaN(Number(t)))}const h={eq:t=>{const e=t?.[0]??r("eq");return t=>"number"==typeof t?(l(e)||i("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??r("ne");return t=>"number"==typeof t?(l(e)||i("ne"),t!==Number(e)):t!==e},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:o("Filter.valueMustBeBoolean",e),t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??r("lt");return l(e)||i("lt"),t=>("number"!=typeof t&&c("lt"),t<Number(e))},le:t=>{const e=t?.[0]??r("le");return l(e)||i("le"),t=>("number"!=typeof t&&c("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??r("gt");return l(e)||i("gt"),t=>("number"!=typeof t&&c("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??r("ge");return l(e)||i("ge"),t=>("number"!=typeof t&&c("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??r("inc");return l(e)||i("inc"),t=>("number"!=typeof t&&c("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??r("dec");return l(e)||i("dec"),t=>("number"!=typeof t&&c("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??r("mul");return l(e)||i("mul"),t=>("number"!=typeof t&&c("mul"),t*Number(e))},div:t=>{const e=t?.[0]??r("div");return l(e)||i("div"),t=>("number"!=typeof t&&c("div"),t/Number(e))},mod:t=>{const e=t?.[0]??r("mod");return l(e)||i("mod"),t=>("number"!=typeof t&&c("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return l(e)||i("fix"),t=>("number"!=typeof t&&c("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a.locale;return t=>("number"!=typeof t&&c("locale"),t.toLocaleString(e))},uc:t=>t=>String(t).toUpperCase(),lc:t=>t=>String(t).toLowerCase(),cap:t=>t=>{const e=String(t);return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>String(t).trim(),slice:t=>{const e=t?.[0]??r("slice");return l(e)||i("slice"),t=>String(t).slice(Number(e))},substr:t=>{const e=t?.[0]??r("substr");l(e)||i("substr");const n=t?.[1]??r("substr");return l(n)||i("substr"),t=>String(t).substr(Number(e),Number(n))},pad:t=>{const e=t?.[0]??r("pad");l(e)||i("pad");const n=t?.[1]??"0";return t=>String(t).padStart(Number(e),n)},rep:t=>{const e=t?.[0]??r("rep");return l(e)||i("rep"),t=>String(t).repeat(Number(e))},rev:t=>t=>String(t).split("").reverse().join(""),int:t=>t=>parseInt(String(t),10),float:t=>t=>parseFloat(String(t)),round:t=>{const e=t?.[0]??"0";return l(e)||i("round"),t=>{"number"!=typeof t&&c("round");const n=Math.pow(10,Number(e));return Math.round(t*n)/n}},floor:t=>{const e=t?.[0]??"0";return l(e)||i("floor"),t=>{"number"!=typeof t&&c("floor");const n=Math.pow(10,Number(e));return Math.floor(t*n)/n}},ceil:t=>{const e=t?.[0]??"0";return l(e)||i("ceil"),t=>{"number"!=typeof t&&c("ceil");const n=Math.pow(10,Number(e));return Math.ceil(t*n)/n}},percent:t=>{const e=t?.[0]??"0";return l(e)||i("percent"),t=>("number"!=typeof t&&c("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||d("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??r("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},u=h,f=h;let m=0;function p(){return++m}const g={};const w={};function x(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){w[t]=e}(t,n)}function y(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function S(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{l:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const b=new Map;const C=new Map;function v(t,e){let n=C.get(t);n||(n=new Map,C.set(t,n));let s=n.get(e);return s||(s=function(t,e){let n=b.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(S(t,e[s]));b.set(e,n)}return n}(t,e),n.set(e,s)),s}class I{u;m;p;S;C;v;get node(){return this.m}get name(){return this.p}get I(){return this.S}get binding(){return this.u}get T(){return this.v}get filters(){return this.C}get N(){return[]}constructor(t,e,n,s,o,r){this.u=t,this.m=e,this.p=n,this.S=s,this.C=o,this.v=r}P(t){s({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNode.assignValue",name:this.name},t:"./docs/error-codes.md#bind"})}B(t,e){s({code:"BIND-301",message:"Binding updateElements not implemented",context:{l:"BindingNode.updateElements",name:this.name},t:"./docs/error-codes.md#bind"})}U(t){}$(t){const e=this.binding.M.L(t._,t.R);this.P(e)}k(){}A(){}get D(){return this.node instanceof HTMLSelectElement}get value(){return null}get F(){return null}}class T extends I{P(t){const e=this.node,n=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.setAttribute(this.I,n)}}const N={},P="data-bind",B="@@:",U="@@|",$=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),L="$connectedCallback",M="$disconnectedCallback",E="$updatedCallback",_={};class R{static id=0;id=++R.id;V=this.id.toString();pattern;O;W;H;q;j;G;Z;J;K;X;Y;tt;et;nt;st;ot;rt;it;ct;dt;constructor(t){const e=e=>t===e?this:k(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<n.length;t++)l+=n[t],"*"===n[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),s.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.O=n,this.W=n[n.length-1],this.H=s,this.q=new Set(s),this.j=o,this.G=new Set(o),this.Z=r,this.J=new Set(r),this.X=i,this.K=c,this.Y=new Set(c),this.tt=d,this.et=new Set(d),this.nt=a,this.st=new Set(a),this.ot=f,this.rt=f?e(f):null,this.it=m,this.ct=m?e(m):null,this.dt=u}}function k(t){$.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{l:"StateProperty.getStructuredPathInfo",ht:t},t:"./docs/error-codes.md#state"});const e=_[t];return void 0!==e?e:_[t]=new R(t)}class A{it;ut;name;ft;level;constructor(t,e,n){this.it=t,this.ut=t?`${t}.${e}`:e,this.name=e,this.level=n,this.ft=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.ft.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.ft.get(t);if(!e){const n=this.it?`${this.it}.${this.name}`:this.name;e=new A(n,t,this.level+1),this.ft.set(t,e)}return e}}const D=new Map;function F(t,e){let n=D.get(t);n||(n=new Map,D.set(t,n));let s=n.get(e)??null;if(s)return s;const o=k(e);return s=t.find(o.O),n.set(e,s),s}function V(t,e){const n=k(e);if(null===n.it)return t.appendChild(e);{let e=F(t,n.it);return null===e&&(e=V(t,n.it)),e.appendChild(n.W)}}const O="state",W=Symbol.for(`${O}.GetByRef`),H=Symbol.for(`${O}.SetByRef`),q=Symbol.for(`${O}.ConnectedCallback`),j=Symbol.for(`${O}.DisconnectedCallback`),z=Symbol.for(`${O}.UpdatedCallback`),G=Symbol.for(`${O}.GetListIndexesByRef`),Z=new Map;class Q{static id=0;id=++Q.id;name;elements;wt;dt;xt;yt;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none";const a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",a.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const l=k(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.wt=s,this.dt=c,this.xt=d,this.yt=a,this.info=l}}function J(t){let e;return Z.get(t)??(Z.set(t,e=new Q(t)),e)}class K{info;St;get bt(){return null===this.St?null:this.St.deref()??s({code:"LIST-201",message:"listIndex is null",context:{l:"StatePropertyRef.get listIndex",V:this.info.V,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.St=null!==e?new WeakRef(e):null,this.key=null===e?t.V:`${t.V}#${e.V}`}get Ct(){const t=this.info.ct;if(!t)return null;return tt(t,(this.info.dt>t.dt?this.bt?.at(-2):this.bt)??null)}}const X=new WeakMap,Y={};function tt(t,e){let n=null;if(null!==e){let s;if(void 0===(s=X.get(e)))n=new K(t,e),X.set(e,{[t.pattern]:n});else if(void 0===(n=s[t.pattern]))return s[t.pattern]=new K(t,e)}else if(void 0===(n=Y[t.pattern]))return Y[t.pattern]=new K(t,null);return n}function et(t,e){const n=t.vt;if(null===n)return null;if(null===n.bt)return null;const s=n.info.X[e];return void 0!==s?n.bt.at(s):null}function nt(t,e,n){switch(t.xt){case"none":return null;case"context":return et(n,t.info.ot??s({code:"STATE-202",message:"lastWildcardPath is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#list"});case"all":{let n=null;for(let o=0;o<t.info.dt;o++){const r=t.info.nt[o]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"}),i=tt(r,n),c=e[G](i)??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",It:r.pattern},t:"./docs/error-codes.md#list"}),d=t.yt[o]??s({code:"STATE-202",message:"wildcardIndex is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"});n=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",It:r.pattern,Tt:d},t:"./docs/error-codes.md#list"})}return n}case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"})}}const st={};for(let t=0;t<32;t++)st[`$${t+1}`]=t;let ot=0,rt=0;class it{id=++rt;V=rt.toString();Nt;position;length;Pt;Bt;Ut;$t;constructor(t,e){this.Nt=t,this.position=t?t.position+1:0,this.length=this.position+1,this.Pt=e,this.Bt=ot}get index(){return this.Pt}set index(t){this.Pt=t,this.Bt=++ot,this.Lt[this.position]=t}get version(){return this.Bt}get Mt(){return null!==this.Nt&&(this.Nt.Mt||this.Nt.version>this.Bt)}get Lt(){return null===this.Nt?void 0===this.Ut&&(this.Ut=[this.Pt]):(void 0===this.Ut||this.Mt)&&(this.Ut=[...this.Nt.Lt,this.Pt],this.Bt=ot),this.Ut}get Et(){return null===this.Nt?void 0===this.$t&&(this.$t=[new WeakRef(this)]):void 0===this.$t&&(this.$t=[...this.Nt.Et,new WeakRef(this)]),this.$t}get _t(){return`$${this.position+1}`}at(t){return t>=0?this.Et[t]?.deref()||null:this.Et[this.Et.length+t]?.deref()||null}}function ct(t,e){return new it(t,e)}function dt(t,e,n,o){let r;!function(t,e){if(t.Rt>=0){const n=t.vt?.info??null;null!==n&&t.Dt.At.kt.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Dt.At.Ft(n.pattern,e.info.pattern)}}(o,e);const i=o.Dt.At.Vt.has(e.info.pattern),c=e.info.dt>0||o.Dt.At.Ot.has(e.info.pattern);let d=null;if(c||i){d=o.Dt.Wt(e);const t=o.Dt.Ht.get(e.info.pattern);if(null!==d){if(void 0===t)return d.value;if(d.version>o.qt.version)return d.value;if(!(d.version<t.version||d.jt<t.jt))return d.value}}if(o.Dt.zt.startsWith(e.info)&&0===o.Dt.At.Ot.intersection(e.info.q).size)return o.Dt.zt.get(e);if(e.info.pattern in t){0===o.Gt.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef",context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o.Rt++,o.Rt>=o.Gt.length&&o.Gt.push(null),o.Gt[o.Rt]=o.vt=e;try{return r=Reflect.get(t,e.info.pattern,n)}finally{if(o.Gt[o.Rt]=null,o.Rt--,o.vt=o.Rt>=0?o.Gt[o.Rt]:null,c||i){let t=null;if(i){if(null!==o.Zt&&!o.Zt.Qt.has(e))if(d){const t=d.Et??[],n=d.value;Array.isArray(n)||s({code:"STC-001",message:`Property "${e.info.pattern}" is expected to be an array for list management.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o.Zt.Qt.set(e,{Et:t,value:n})}else o.Zt.Qt.set(e,{Et:[],value:[]});t=function(t,e,n,s){const o=Array.isArray(e)?e:[],r=Array.isArray(n)?n:[],i=[];if(0===r.length)return[];if(0===o.length){for(let e=0;e<r.length;e++){const n=ct(t,e);i.push(n)}return i}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(o,r))return s;const c=new Map;for(let t=0;t<o.length;t++)c.set(o[t],t);for(let e=0;e<r.length;e++){const n=r[e],o=c.get(n);if(void 0===o){const n=ct(t,e);i.push(n)}else{const t=s[o];t.index!==e&&(t.index=e),i.push(t)}}return i}(e.bt,d?.value,r,d?.Et??[])}const n=d??{value:null,Et:null,version:0,jt:0};n.value=r,n.Et=t,n.version=o.qt.version,n.jt=o.qt.jt,o.Dt.Jt(e,n)}}}else s({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"})}function at(t,e,n,o,r){const i=r.Dt.At.elements.has(e.info.pattern);let c=null,d=null;if(i&&(c=e.Ct??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",scope:"element",Kt:e.info.pattern},t:"./docs/error-codes.md#state"}),d=r.qt.Xt.get(c)||null,null===d)){const t=o[W](c)??[];Array.isArray(t)||s({code:"STATE-202",message:"Expected array value for list elements",context:{l:"StateClass.setByRef",scope:"element",Kt:c.info.pattern},t:"./docs/error-codes.md#state"}),d={value:[...t],Et:[...o[G](c)??[]]},r.qt.Xt.set(c,d)}try{if(r.Dt.zt.startsWith(e.info)&&0===r.Dt.At.Yt.intersection(e.info.q).size)return r.Dt.zt.set(e,n);if(!(e.info.pattern in t)){const i=e.info.ct??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",Kt:e.info.pattern},t:"./docs/error-codes.md#state"}),c=tt(i,i.dt<e.info.dt?e.bt?.Nt??null:e.bt),d=dt(t,c,o,r);null!==d&&"object"==typeof d||s({code:"STATE-202",message:"Parent value is not an object",context:{l:"StateClass.setByRef",Kt:c.info.pattern},t:"./docs/error-codes.md#state"});const a=e.info.W;if("*"===a){const t=e.bt?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{l:"StateClass.setByRef",Kt:e.info.pattern},t:"./docs/error-codes.md#state"});return Reflect.set(d,t,n)}return Reflect.set(d,a,n)}r.Rt++,r.Rt>=r.Gt.length&&r.Gt.push(null),r.Gt[r.Rt]=r.vt=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{r.Gt[r.Rt]=null,r.Rt--,r.vt=r.Rt>=0?r.Gt[r.Rt]:null}}finally{if(r.qt.te(e),i){const t=d.value.indexOf(n),i=o[G](c)??[],a=e.bt.index,l=-1!==t?d.Et[t]:ct(c.bt,-1);i[a]=l;const h=o[W](c)??[];null!==h&&Array.isArray(h)||s({code:"STATE-202",message:"Parent value is not an array during swap check",context:{l:"StateClass.setByRef",scope:"element swap",Kt:c.info.pattern},t:"./docs/error-codes.md#state"});if(new Set(h).size===d.value.length){for(let t=0;t<i.length;t++)i[t].index=t;r.qt.Xt.delete(c)}}}}function lt(t,e,n,o){return(e,r,i)=>{const c=k(e),d=o.vt?.info??null;null!==d&&d.pattern!==c.pattern&&o.Dt.At.kt.has(d.pattern)&&o.Dt.At.Ft(d.pattern,c.pattern),c.nt.length>r.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{l:"StateClass.resolve",path:e,ee:c.nt.length,se:r.length},t:"./docs/error-codes.md#state"});let a=null;for(let e=0;e<c.nt.length;e++){const i=c.nt[e],d=tt(i,a);dt(t,d,n,o);const l=n[G](d);null===l&&s({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern},t:"./docs/error-codes.md#list"});const h=r[e];a=l[h]??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern,index:h},t:"./docs/error-codes.md#list"})}const l=tt(c,a),h=void 0!==i;if(H in n){if(!h)return dt(t,l,n,o);at(t,l,i,n,o)}else{if(!h)return dt(t,l,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{l:"StateClass.resolve",path:e},t:"./docs/error-codes.md#state"})}}}function ht(t,e,n,o){return t=>{const e=Ct(o.Dt,(e=>e.update(null,((e,n)=>{if("function"==typeof t)return Reflect.apply(t,e,[]);s({code:"STATE-203",message:"Callback is not a function",context:{l:"StateClass.invoke",oe:t},t:"./docs/error-codes.md#state"})}))));return e instanceof Promise&&e.catch((t=>{s({code:"STATE-204",message:"Invoke callback rejected",context:{l:"StateClass.invoke"},t:"./docs/error-codes.md#state",o:"error",i:t instanceof Error?t:new Error(String(t))})})),e}}function ut(t,e,n,o){const r=st[e];if(void 0!==r){const t=o.vt?.bt;return t?.Lt[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{re:String(e),Lt:t?.Lt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return lt(t,0,n,o);case"$getAll":return function(t,e,n,o){const r=lt(t,0,n,o);return(e,i)=>{let c=i;const d=k(e),a=o.vt?.info??null;if(null!==a&&a.pattern!==d.pattern&&o.Dt.At.kt.has(a.pattern)&&o.Dt.At.Ft(a.pattern,d.pattern),void 0===c){for(let t=0;t<d.K.length;t++){const e=d.K[t]??s({code:"BIND-201",message:"Wildcard info is missing",context:{l:"StateClass.getAll",Tt:t,pattern:d.pattern},t:"./docs/error-codes.md#bind"}),n=et(o,e.pattern);if(n){c=n.Lt;break}}void 0===c&&(c=[])}const l=(e,r,i,c,d,a,h)=>{const u=e[r]??null;if(null===u)return void h.push(a);const f=tt(u,i);dt(t,f,n,o);const m=n[G](f);null===m&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern},t:"./docs/error-codes.md#list"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const n=m[t];l(e,r+1,n,c,d+1,a.concat(n.index),h)}else{const t=m[p]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern,index:p},t:"./docs/error-codes.md#list"});r+1<e.length?l(e,r+1,t,c,d+1,a.concat(t.index),h):h.push(a.concat(t.index))}},h=[];l(d.nt,0,null,c,0,[],h);const u=[];for(let t=0;t<h.length;t++)u.push(r(d.pattern,h[t]));return u}}(t,0,n,o);case"$trackDependency":return function(t,e,n,o){return t=>{const e=o.vt?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{l:"StateClass.trackDependency",path:t},t:"./docs/error-codes.md#state"});o.Dt.At.Ot.has(e.pattern)&&e.pattern!==t&&o.Dt.At.Ft(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>pn?.navigate(t);case"$component":return o.Dt.ie;case"$invoke":return ht(0,0,0,o);case"$wrap":return t=>{const e=ht(0,0,0,o);return()=>e(t)};case"$updateComplete":return o.qt.ce}const r=J(e),i=nt(r,n,o),c=tt(r.info,i);return dt(t,c,n,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,n);switch(e){case W:return e=>dt(t,e,n,o);case H:return(e,s)=>at(t,e,s,n,o);case G:return e=>function(t,e,n,o){if(o.Dt.At.Vt.has(e.info.pattern)||s({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),o.Dt.zt.startsWith(e.info)&&0===o.Dt.At.Ot.intersection(e.info.q).size)return o.Dt.zt.de(e)??[];dt(t,e,n,o);const r=o.Dt.Wt(e);null===r&&s({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"});const i=r.Et;return null===i&&s({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),i}(t,e,n,o);case q:return()=>function(t,e,n){const s=Reflect.get(t,L);if("function"==typeof s)return s.call(n)}(t,0,n);case j:return()=>function(t,e,n){const s=Reflect.get(t,M);if("function"==typeof s)return s.call(n)}(t,0,n);case z:return e=>function(t,e,n){const s=Reflect.get(t,E);if("function"==typeof s){const t=new Set,o={};for(const n of e){const e=n.info.pattern;if(t.add(e),n.info.dt>0){const t=n.bt.index,s=o[e];void 0===s?o[e]=[t]:s.push(t)}}return s.call(n,Array.from(t),o)}}(t,e,n)}}}let ft=class{Dt;qt;Zt;Gt=Array(32).fill(null);Rt=-1;vt=null;ae=void 0;symbols=new Set([W,G]);he=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,n){this.Dt=t,this.qt=e,this.Zt=n}get(t,e,n){return ut(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{l:"createReadonlyStateProxy.set",re:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.he.has(e)}};function mt(t,e,n){return new ft(t,e,n)}function pt(t,e){return new Proxy(t,e)}class gt{Dt;qt;Zt=null;Gt=Array(32).fill(null);Rt=-1;vt=null;ae=void 0;symbols=new Set([W,H,G,q,j,z]);he=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component","$invoke","$wrap","$updateComplete"]);constructor(t,e){this.Dt=t,this.qt=e}get(t,e,n){return ut(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const r=J(e),i=nt(r,s,o);return at(t,tt(r.info,i),n,s,o),!0}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.he.has(e)}}function wt(t,e,n,o,r){const i=new gt(t,e),c=new Proxy(n,i);return function(t,e,n){let o;if(void 0!==t.ae&&s({code:"STATE-301",message:"already in loop context",context:{l:"setLoopContext",ue:!0},t:"/docs/error-codes.md#state",hint:"Ensure handler.loopContext is cleared before invoking setLoopContext again.",o:"error"}),e){t.ae=e,t.Rt++,t.Rt>=t.Gt.length&&t.Gt.push(null),t.Gt[t.Rt]=t.vt=e.fe;try{o=n()}catch(e){throw t.Gt[t.Rt]=null,t.Rt--,t.vt=t.Rt>=0?t.Gt[t.Rt]:null,t.ae=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.Gt[t.Rt]=null,t.Rt--,t.vt=t.Rt>=0?t.Gt[t.Rt]:null,t.ae=void 0}));t.Gt[t.Rt]=null,t.Rt--,t.vt=t.Rt>=0?t.Gt[t.Rt]:null,t.ae=void 0}else{t.ae=e;try{o=n()}catch(e){throw t.ae=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.ae=void 0}));t.ae=void 0}return o}(i,o,(()=>r(c,i)))}class xt{me=new Set;pe=new Set;Qt=new Map;we;xe;ye=[];Se=new Set;be=null;Ce=null;ve;constructor(t,e,n){this.we=t,this.xe=e,this.ve=n}get Ie(){return this.ye}get Te(){return this.Se}get _(){return this.be||s({code:"UPD-002",message:"ReadonlyState not initialized",context:{l:"Updater.Renderer.readonlyState"},t:"./docs/error-codes.md#upd"}),this.be}get R(){return this.Ce||s({code:"UPD-002",message:"ReadonlyHandler not initialized",context:{l:"Updater.Renderer.readonlyHandler"},t:"./docs/error-codes.md#upd"}),this.Ce}Ne(t){const e=mt(this.we,this.xe,this),n=pt(this.we.state,e);this.be=n,this.Ce=e;try{return t(n,e)}finally{this.be=null,this.Ce=null}}Pe(t){this.pe.clear(),this.me.clear(),this.ye=[...t],this.Se=new Set(t),this.Ne((()=>{const e=[],n=new Map,o=new Set;for(let r=0;r<t.length;r++){const i=t[r];if(o.add(i),!this.we.At.elements.has(i.info.pattern)){e.push(i);continue}const c=i.Ct??s({code:"UPD-004",message:`ParentInfo is null for ref: ${i.key}`,context:{l:"Updater.Renderer.render",Be:i.key,pattern:i.info.pattern},t:"./docs/error-codes.md#upd"});n.has(c)||n.set(c,new Set),n.get(c).add(i)}for(const[t,e]of n){if(o.has(t)){for(const t of e)this.pe.add(t);continue}const n=this.we.Ue(t);for(let t=0;t<n.length;t++)this.me.has(n[t])||n[t].$(this);this.pe.add(t)}for(let t=0;t<e.length;t++){const n=e[t],o=F(this.we.At.$e,n.info.pattern);null===o&&s({code:"PATH-101",message:`PathNode not found: ${n.info.pattern}`,context:{l:"Updater.Renderer.render",pattern:n.info.pattern},t:"./docs/error-codes.md#path"}),this.pe.has(n)||this.Le(n,o)}if(this.we.Me.size>0)for(const t of this.we.Me){const n=this.we.Ee.get(t)??new Set;for(const t of n)t.U(e)}}))}Le(t,e){this.pe.add(t);const n=this.we.Ue(t);for(let t=0;t<n.length;t++)this.me.has(n[t])||n[t].$(this);let o=new Set;if(this.we.At.Vt.has(t.info.pattern)){const e=new Set(this._[G](t)??[]),{Et:n}=this.Qt.get(t)??{},s=new Set(n??[]);o=e.difference(s)}for(const[n,s]of e.ft){const e=k(s.ut);if("*"===n)for(const t of o){const n=tt(e,t);this.pe.has(n)||this.Le(n,s)}else{const n=tt(e,t.bt);this.pe.has(n)||this.Le(n,s)}}const r=this.we.At._e.get(t.info.pattern);if(r)for(const t of r){const e=k(t),n=F(this.we.At.$e,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{l:"Updater.Renderer.renderItem",pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.dt>0){const t=e.nt,s=(o,r,i)=>{const c=this._[G](o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const n=tt(i,c[e]);s(n,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const s=tt(e,c[t]);this.pe.has(s)||this.Le(s,n)}},o=tt(e.nt[0],null);s(o,0,e.nt[1]||null)}else{const t=tt(e,null);this.pe.has(t)||this.Le(t,n)}}}}function yt(t,e,n,s){const o=new xt(e,n,s);try{o.Pe(t)}finally{s.resolve()}}class St{we;xe;Re=Promise.withResolvers();ke;constructor(t,e,n){this.we=t,this.xe=e,this.ke=n,queueMicrotask((()=>{this.Ae()}))}async Ae(){const t=[];let e=null,n=!0;for(;null===e;){e=await this.Re.promise??null;const n=this.xe.De();if(0===n.length)continue;const s=Promise.withResolvers();t.push(s.promise);try{yt(n,this.we,this.xe,s)}catch(t){console.error("Rendering error:",t),s.reject()}}try{await Promise.all(t)}catch(t){n=!1}finally{e.resolve(n)}}Fe(){this.Re.resolve(),this.Re=Promise.withResolvers()}terminate(){this.Re.resolve(this.ke)}}class bt{Xt=new Map;Ve=[];Oe=!1;we;Bt;We=0;He=[];qe=new Map;ke=Promise.withResolvers();je;constructor(t){this.we=t,this.Bt=t.ze(),this.je=function(t,e,n){return new St(t,e,n)}(t,this,this.ke),t.Ge.enqueue(this.ke.promise)}get version(){return this.Bt}get jt(){return this.We}get ce(){return this.ke.promise}te(t){this.We++,this.Ve.push(t),this.He.push(t),this.Ze(this.we,t.info.pattern,this.we.Ht,this.We),this.je.Fe()}update(t,e){const n=wt(this.we,this,this.we.state,t,((t,n)=>e(t,n))),o=()=>{if(this.we.At.Qe&&this.He.length>0){const t=this.He;this.He=[],queueMicrotask((()=>{const e=this.update(null,(e=>e[z](t)));e instanceof Promise&&e.catch((()=>{s({code:"UPD-005",message:"An error occurred during asynchronous state update.",context:{l:"Updater.update.updatedCallback"},t:"./docs/error-codes.md#upd"})}))}))}else this.je.terminate()};return n instanceof Promise?n.finally((()=>{o()})):(o(),n)}De(){const t=this.Ve;return this.Ve=[],t}Je(t){const e=Promise.withResolvers(),n=function(t,e,n){return new xt(t,e,n)}(this.we,this,e);try{t(n)}finally{this.je.terminate()}}Ke(t,e,n,o,r){if(o.has(e))return;if(r&&t.At.elements.has(e))return;o.add(e);for(const[,e]of n.ft.entries()){const n=e.ut;this.Ke(t,n,e,o,!1)}const i=t.At._e.get(e)??[];for(const e of i){const n=F(t.At.$e,e);null===n&&s({code:"UPD-004",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.recursiveCollectMaybeUpdates",Xe:e},t:"./docs/error-codes.md#upd"}),this.Ke(t,e,n,o,!1)}}Ze(t,e,n,o){const r=F(t.At.$e,e);null===r&&s({code:"UPD-003",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.collectMaybeUpdates",path:e},t:"./docs/error-codes.md#upd"});let i=this.qe.get(e);void 0===i&&(i=new Set,this.Ke(t,e,r,i,!0));const c={version:this.version,jt:o};for(const t of i)n.set(t,c);this.qe.set(e,i)}Ne(t){const e=mt(this.we,this,null);return t(pt(this.we.state,e),e)}}function Ct(t,e){return e(new bt(t))}class vt extends I{get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Checkbox binding has multiple decorators",context:{l:"BindingNodeCheckbox.constructor",name:this.name,Ye:i.length},t:"./docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Dt;this.node.addEventListener(c,(e=>{const n=this.binding.en.tn;Ct(d,(e=>{e.update(n,((e,n)=>{t.nn(e,n,this.F)}))}))}))}P(t){Array.isArray(t)||s({code:"BIND-201",message:"Checkbox value is not array",context:{l:"BindingNodeCheckbox.update",sn:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.checked=t.includes(this.F)}}class It extends I{P(t){Array.isArray(t)||s({code:"BIND-201",message:"ClassList value is not array",context:{l:"BindingNodeClassList.update",sn:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class Tt extends I{P(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"ClassName value is not boolean",context:{l:"BindingNodeClassName.update",sn:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.I,t)}}const Nt={};class Pt extends I{constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);e.addEventListener(this.I,(t=>this.rn(t)))}update(){}rn(t){const e=this.binding.Dt,n=this.binding.en.tn,o=n?.cn().map((t=>t.bt.index))??[],r=this.T;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation();const i=Ct(e,(e=>e.update(n,((e,n)=>{const r=this.binding.M.dn(e,n);if("function"==typeof r)return Reflect.apply(r,e,[t,...o]);s({code:"BIND-201",message:"Binding value is not a function",context:{l:"BindingNodeEvent.handler",an:this.name,ln:this.I,sn:typeof r},t:"./docs/error-codes.md#bind",o:"error"})}))));i instanceof Promise&&i.catch((t=>{const e=t instanceof Error?t:new Error(String(t));s({code:"BIND-202",message:"Event handler rejected",context:{l:"BindingNodeEvent.handler",an:this.name,ln:this.I},t:"./docs/error-codes.md#bind",o:"error",i:e})}))}$(t){}}const Bt={},Ut=(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=Bt[t]??(Bt[t]=t.slice(2));return new Pt(s,o,t,c,i,n)};class $t extends I{hn;get id(){return this.hn}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);const c=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"./docs/error-codes.md#bind",o:"error"}),[d]=c.split(" ",2),a=Number(d);(a.toString()!==d||isNaN(a)||!isFinite(a)||!Number.isInteger(a)||a<0)&&s({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent},t:"./docs/error-codes.md#bind",o:"error"}),this.hn=a}}class Lt extends $t{un;fn;mn=[];pn;constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);const i=tt(k(""),null);this.un=Ae(this.binding,this.id,this.binding.Dt,i),this.fn=[this.un],this.pn=this.mn}get N(){return this.pn}P(t){s({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeIf.assignValue",an:this.name},t:"./docs/error-codes.md#bind"})}$(t){const e={l:"BindingNodeIf.applyChange",an:this.name},n=this.binding.M.L(t._,t.R);"boolean"!=typeof n&&s({code:"BIND-201",message:"If binding value is not boolean",context:{...e,sn:typeof n},t:"./docs/error-codes.md#bind"});const o=this.node.parentNode;null===o&&s({code:"BIND-201",message:"Parent node not found",context:{...e,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),n?(this.un.k(),this.un.gn(o,this.node),this.un.$(t),this.pn=this.fn):(this.un.unmount(),this.un.A(),this.pn=this.mn)}A(){this.un.unmount(),this.un.A(),this.pn=this.mn}}const Mt=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class Et extends $t{pn=[];wn=new WeakMap;xn=[];yn=0;Sn=void 0;bn=void 0;Cn=[];vn=new Set;get N(){return this.pn}get In(){return this.yn}set In(t){this.yn=t}get Tn(){return this.xn.length}set Tn(t){t<0&&s({code:"BIND-202",message:"BindContent pool length is negative",context:{l:"BindingNodeFor.setPoolLength",an:this.name,Nn:t},t:"./docs/error-codes.md#bind"}),this.xn.length=t}get Pn(){if(void 0===this.Sn){const t=`${this.binding.M.pattern}.*`;this.Sn=k(t)}return this.Sn}Bn(t,e){let n;if(this.yn>=0)n=this.xn[this.yn],this.yn--,n.Un(e);else{const t=tt(this.Pn,e);n=Ae(this.binding,this.id,this.binding.Dt,t)}return this.wn.set(e,n),n.k(),n}$n(t){t.unmount(),t.A()}P(t){s({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeFor.assignValue"},hint:"Call applyChange to update loop bindings",t:"./docs/error-codes.md#bind"})}$(t){let e=[];const n={l:"BindingNodeFor.applyChange",an:this.name,Ln:this.binding.M.pattern},o=t._[W](this.binding.M.fe);Array.isArray(o)||s({code:"BIND-201",message:"Loop value is not array",context:{...n,sn:null===o?"null":typeof o},t:"./docs/error-codes.md#bind"});const r=t._[G](this.binding.M.fe)??[],i=new Set(r),c=void 0===this.bn?[]:this.bn;Array.isArray(c)||s({code:"BIND-201",message:"Previous loop value is not array",context:{...n,sn:null===c?"null":typeof c},t:"./docs/error-codes.md#bind"});const d=c.length??0,a=0===i.size?this.vn:this.vn.difference(i),l=0===this.vn.size?i:i.difference(this.vn),h=o?.length??0,u=new Set,f=new Set,m=`${this.binding.M.info.pattern}.*`;for(let e=0;e<t.Ie.length;e++){const o=t.Ie[e];if(o.info.pattern!==m)continue;if(t.pe.has(o))continue;const r=o.bt;null===r&&s({code:"BIND-201",message:"ListIndex is null",context:{...n,Mn:o.info.pattern},t:"./docs/error-codes.md#bind"}),this.vn.has(r)?u.add(r):f.add(r),t.pe.add(o)}const p=this.node.parentNode??s({code:"BIND-201",message:"Parent node not found",context:{...n,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),g=new Set,w=d===a.size&&d>0;let x=!1;if(w){const t=Array.from(p.childNodes),e=this.pn.at(-1)??s({code:"BIND-201",message:"Last BindContent not found",context:{...n,En:this.pn.length},t:"./docs/error-codes.md#bind"});let o=t[0];for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.nextSibling;let r=t.at(-1)??null;for(;r&&r.nodeType===Node.TEXT_NODE&&""===r.textContent?.trim();)r=r.previousSibling;o===this.node&&r===e._n(p)&&(x=!0)}if(w&&x){p.textContent="",p.append(this.node);for(let t=0;t<this.pn.length;t++)this.pn[t].A();this.xn.push(...this.pn)}else if(a.size>0){for(const t of a){const e=this.wn.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{...n,Rn:"removes",bt:t.index},t:"./docs/error-codes.md#bind"}),this.$n(e),g.add(e)}this.xn.push(...g)}let y=null;const S=this.node;this.In=this.Tn-1;const b=Mt&&h===l.size&&h>0;if(0===l.size&&0===a.size&&(u.size>0||f.size>0)){if(u.size>0){const t=Array.from(this.pn),o=Array.from(u);o.sort(((t,e)=>t.index-e.index));for(const e of o){const o=this.wn.get(e);void 0===o&&s({code:"BIND-201",message:"BindContent not found",context:{...n,Rn:"reorder",bt:e.index},t:"./docs/error-codes.md#bind"}),t[e.index]=o;const r=t[e.index-1]?._n(p)??S;o.gn(p,r)}e=t}if(f.size>0)for(const e of f){const o=this.wn.get(e);void 0===o&&s({code:"BIND-201",message:"BindContent not found",context:{...n,Rn:"overwrites",bt:e.index},t:"./docs/error-codes.md#bind"}),o.$(t)}}else{const o=new Map;for(let t=0;t<this.Cn.length;t++)o.set(this.Cn[t],t);const i=b?document.createDocumentFragment():p,c=b?null:S,d=[];for(let a=0;a<r.length;a++){const h=r[a],u=y?._n(i)??c;let f;if(l.has(h))f=this.Bn(t,h),f.gn(i,u),f.$(t);else{f=this.wn.get(h),void 0===f&&s({code:"BIND-201",message:"BindContent not found",context:{...n,Rn:"reuse",bt:h.index},t:"./docs/error-codes.md#bind"}),u?.nextSibling!==f.kn&&f.gn(i,u);const t=o.get(h);void 0!==t&&t!==a&&d.push(h)}e.push(f),y=f}if(b){const t=S.nextSibling;p.insertBefore(i,t)}for(const e of d){const n=this.binding.An.get(e)??[];for(const e of n)t.me.has(e)||e.$(t)}}this.Tn=this.In+1,this.pn=e,this.bn=[...o],this.Cn=[...r],this.vn=i}A(){for(let t=0;t<this.pn.length;t++){const e=this.pn[t];e.unmount(),e.A()}this.xn.push(...this.pn),this.pn=[],this.wn=new WeakMap,this.yn=0,this.bn=void 0,this.Cn=[],this.vn=new Set}}const _t=(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Et(s,o,t,"",i,n)};const Rt={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},kt={radio:new Set(["checked"]),checkbox:new Set(["checked"])},At=new Set(["value","valueAsNumber","valueAsDate"]),Dt=new Set;class Ft extends I{constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLElement))return;if(!((c=this.node)instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement))return;var c;const d=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?At:t instanceof HTMLInputElement?kt[t.type]??At:Dt)(this.node);if(!d.has(this.name))return;i.length>1&&s({code:"BIND-201",message:"Property binding has multiple decorators",context:{l:"BindingNodeProperty.constructor",an:this.name,Ye:i.length},t:"./docs/error-codes.md#bind"});const a=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Rt[this.name]??"readonly";if("readonly"===a||"ro"===a)return;const l=this.binding.Dt;this.node.addEventListener(a,(e=>{const n=this.binding.en.tn;Ct(l,(e=>{e.update(n,((e,n)=>{t.nn(e,n,this.F)}))}))}))}get value(){return this.node[this.name]}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}P(t){let e;e=null==t||Number.isNaN(t)?"":t,this.name in this.node?this.node[this.name]=e:s({code:"BIND-201",message:`Property not found on node: ${this.name}`,context:{l:"BindingNodeProperty.assignValue",an:this.name,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"})}}const Vt=(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Ft(s,o,t,"",i,n)};class Ot extends I{constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Radio binding has multiple decorators",context:{l:"BindingNodeRadio.constructor",an:this.name,Ye:i.length},t:"./docs/error-codes.md#bind"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Dt;this.node.addEventListener(c,(e=>{const n=this.binding.en.tn;Ct(d,(e=>{e.update(n,((e,n)=>{t.nn(e,n,this.F)}))}))}))}get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}P(t){let e;e=null==t?"":t;this.node.checked=e===this.F}}class Wt extends I{P(t){const e=this.node,n=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.style.setProperty(this.I,n.toString())}}const Ht={},qt="component-state-input",jt=Symbol.for(`${qt}.AssignState`),zt=Symbol.for(`${qt}.NotifyRedraw`),Gt=new WeakMap;function Zt(t){if(t.tagName.includes("-"))return t.tagName.toLowerCase();const e=t.getAttribute("is");if(e?.includes("-"))return e.toLowerCase();s({code:"COMP-401",message:"Custom element tag name not found",context:{l:"WebComponents.getCustomTagName",tagName:t.tagName,Dn:e??null},t:"./docs/error-codes.md#comp"})}class Qt extends I{tagName;constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);const c=this.node;c.tagName.includes("-")?this.tagName=c.tagName.toLowerCase():c.getAttribute("is")?.includes("-")?this.tagName=c.getAttribute("is").toLowerCase():s({code:"COMP-401",message:"Custom element tag name not found",context:{l:"BindingNodeComponent.constructor"},t:"./docs/error-codes.md#comp"})}Fn(t){const e=this.node,n=Zt(e);customElements.whenDefined(n).then((()=>{e.state[zt](t)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));s({code:"COMP-402",message:`Custom element definition failed: ${n}`,context:{l:"BindingNodeComponent._notifyRedraw",tagName:n},t:"./docs/error-codes.md#comp",i:e})}))}U(t){const e=[],n=this.binding.M.fe,s=n.bt,o=(s?.length??0)-1;for(const r of t)r.info.pattern!==n.info.pattern&&r.info.q.has(n.info.pattern)&&(o>=0&&r.bt?.at(o)!==s||e.push(r));0!==e.length&&this.Fn(e)}$(t){this.Fn([this.binding.M.fe])}k(){const t=this.binding.Dt,e=t.ie,n=this.node,o=Zt(n);customElements.whenDefined(o).then((()=>{e.Vn(n),n.Wn.On(this.binding)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));s({code:"COMP-402",message:`Custom element definition failed: ${o}`,context:{l:"BindingNodeComponent.activate",tagName:o},t:"./docs/error-codes.md#comp",i:e})})),function(t,e){Gt.set(e,t)}(e,n);let r=t.Ee.get(n);void 0===r&&t.Ee.set(n,r=new Set),r.add(this.binding)}A(){const t=this.binding.Dt;var e;e=this.node,Gt.delete(e);const n=t.Ee.get(this.node);void 0!==n&&n.delete(this.binding)}}const Jt={},Kt={0:{class:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new It(s,o,t,"",i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new vt(s,o,t,"",i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Ot(s,o,t,"",i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Lt(s,o,t,"",i,n)}}},Xt={class:(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=Nt[t]??(Nt[t]=t.split(".")[1]);return new Tt(s,o,t,c,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=N[t]??(N[t]=t.split(".")[1]);return new T(s,o,t,c,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=Ht[t]??(Ht[t]=t.split(".")[1]);return new Wt(s,o,t,c,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=Jt[t]??(Jt[t]=t.split(".")[1]);return new Qt(s,o,t,c,i,n)}};const Yt={};function te(t,e,n,o){const r=t instanceof Comment,i=t instanceof Element,c=`${r}\t${i}\t${e}`,d=Yt[c]??(Yt[c]=function(t,e,n){const o=Kt[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return _t;t&&s({code:"BIND-106",message:`Comment binding property not supported: ${n}`,context:{l:"BindingBuilder.getBindingNodeCreator",propertyName:n,nodeType:"Comment"},t:"./docs/error-codes.md#bind"});const r=n.split("."),i=Xt[r[0]];return void 0!==i?i:e&&n.startsWith("on")?Ut:Vt}(r,i,e));return d(e,n,o)}class ee{pattern;info;Hn;constructor(t){this.pattern=t,this.info=k(t),this.Hn=0===this.info.dt?tt(this.info,null):null}}const ne={};class se{filters;qn=!1;jn;u;zn=null;Gn=null;constructor(t,e,n){this.jn=ne[e]??(ne[e]=new ee(e)),this.u=t,this.filters=n}get pattern(){return this.jn.pattern}get info(){return this.jn.info}get bt(){return this.fe.bt}get fe(){return null===this.jn.Hn?(null===this.Gn&&s({code:"BIND-201",message:"LoopContext is null",context:{l:"BindingState.ref",pattern:this.pattern,dt:this.info.dt},t:"./docs/error-codes.md#bind"}),null===this.zn&&(this.zn=tt(this.info,this.Gn.bt)),this.zn):this.jn.Hn}dn(t,e){return dt(this.u.Dt.state,this.fe,t,e)}L(t,e){let n=dt(this.u.Dt.state,this.fe,t,e);for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}P(t,e,n){at(this.u.Dt.state,this.fe,n,t,e)}k(){if(this.info.dt>0){const t={l:"BindingState.activate",pattern:this.pattern},e=this.info.ot??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:t,t:"./docs/error-codes.md#bind"});this.Gn=this.u.en.tn?.find(e)??s({code:"BIND-201",message:"LoopContext is null",context:{...t,ot:e},t:"./docs/error-codes.md#bind"})}this.u.Dt.Zn(this.fe,this.u)}A(){this.u.Dt.Qn(this.fe,this.u),this.zn=null,this.Gn=null}}class oe{pattern;Jn;constructor(t){this.pattern=t;const e=Number(t.slice(1));isNaN(e)&&s({code:"BIND-202",message:"Pattern is not a number",context:{l:"BindingStateIndex.constructor",pattern:t},t:"./docs/error-codes.md#bind"}),this.Jn=e}}const re={};class ie{filters;jn;u;Gn=null;constructor(t,e,n){this.u=t,this.jn=re[e]??(re[e]=new oe(e)),this.filters=n}Kn(t,e={}){return{l:t,pattern:this.jn.pattern,Jn:this.jn.Jn,...e}}get pattern(){return s({code:"BIND-301",message:"Binding pattern not implemented",context:this.Kn("BindingStateIndex.pattern"),t:"./docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Binding info not implemented",context:this.Kn("BindingStateIndex.info"),t:"./docs/error-codes.md#bind"})}get bt(){return this.Gn?.bt??s({code:"LIST-201",message:"listIndex is null",context:this.Kn("BindingStateIndex.listIndex"),t:"./docs/error-codes.md#list"})}get fe(){return this.Gn?.fe??s({code:"STATE-202",message:"ref is null",context:this.Kn("BindingStateIndex.ref"),t:"./docs/error-codes.md#state"})}get qn(){return!0}dn(t,e){return this.bt?.index??s({code:"LIST-201",message:"listIndex is null",context:this.Kn("BindingStateIndex.getValue"),t:"./docs/error-codes.md#list"})}L(t,e){let n=this.bt?.index??s({code:"LIST-201",message:"listIndex is null",context:this.Kn("BindingStateIndex.getFilteredValue"),t:"./docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}P(t,e,n){s({code:"BIND-301",message:"Binding assignValue not implemented",context:this.Kn("BindingStateIndex.assignValue"),t:"./docs/error-codes.md#bind"})}k(){const t=this.Kn("BindingStateIndex.activate"),e=(this.u.en.tn??s({code:"BIND-201",message:"LoopContext is null",context:t,t:"./docs/error-codes.md#bind"})).cn();this.Gn=e[this.jn.Jn-1]??s({code:"BIND-201",message:"Current loopContext is null",context:this.Kn("BindingStateIndex.activate",{Xn:this.jn.Jn-1,Yn:e.length}),t:"./docs/error-codes.md#bind"});const n=this.Gn.es?.ts??null;null===n&&s({code:"BIND-201",message:"Binding for list is null",context:t,t:"./docs/error-codes.md#bind"});const o=n.An.get(this.bt);void 0===o?n.An.set(this.bt,new Set([this.u])):o.add(this.u)}A(){this.Gn=null}}const ce=new RegExp(/^\$\d+$/);function de(t,e){return ce.test(t)?((t,e)=>(n,s)=>{const o=v(s,e);return new ie(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=v(s,e);return new se(n,t,o)})(t,e)}const ae={};function le(t,e=(t=>`${t.constructor.name}\t${t instanceof Comment?t.textContent?.[2]??"":""}`)(t)){return ae[e]??(ae[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s({code:"BIND-105",message:`Node type not supported: ${t.nodeType}`,context:{l:"BindingBuilder.getNodeType",nodeType:t.nodeType,nodeName:t.nodeName,ns:t.constructor.name},t:"./docs/error-codes.md#bind"}))(t))}const he=t=>t.trim(),ue=t=>t.length>0,fe=new RegExp(/^#(.*)#$/),me=t=>{const e=fe.exec(t);return e?decodeURIComponent(e[1]):t},pe=t=>{const[e,...n]=t.split(",").map(he);return{name:e,options:n.map(me)}},ge=t=>{const[e,...n]=t.split("|").map(he);return{ss:e,filters:n.map(pe)}},we=t=>t.split(";").map(he).filter(ue).map((t=>(t=>{const[e,n=null]=t.split("@").map(he),s=n?n.split(",").map(he):[],[o,r]=e.split(":").map(he),{ss:i,filters:c}=ge(o),{ss:d,filters:a}=ge(r);return{rs:i,cs:d,ds:c,ls:a,T:s}})(t))),xe={};const ye=t=>{t.removeAttribute("data-bind")},Se={HTMLElement:ye,SVGElement:ye,Text:void 0,hs:void 0};const be={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,hs:void 0,SVGElement:void 0};class Ce{nodeType;us;fs;ps=new Map;constructor(t){this.nodeType=le(t);const e=function(t,e){switch(t){case"Text":return`textContent:${e.textContent?.slice(3).trim()??""}`;case"HTMLElement":case"SVGElement":return e.getAttribute(P)??"";case"Template":{const t=e.textContent?.slice(3).trim(),[n]=t?.split(" ",2)??[];return $e(Number(n)).getAttribute(P)??""}default:return""}}(this.nodeType,t),n=function(t,e){return be[e]?.(t)??t}(t,this.nodeType);!function(t,e){Se[e]?.(t)}(n,this.nodeType),this.us=function(t){let e=[],n=t;for(;null!==n.parentNode;)e=[Array.from(n.parentNode.childNodes).indexOf(n),...e],n=n.parentNode;return e}(n),this.fs=function(t){return""===t.trim()?[]:xe[t]??(xe[t]=we(t))}(e);for(let t=0;t<this.fs.length;t++){const e=this.fs[t],s={gs:te(n,e.rs,e.ds,e.T),ws:de(e.cs,e.ls)};this.ps.set(e,s)}}}function ve(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(P)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(B)||0===t.textContent?.indexOf(U))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const Ie={},Te={},Ne={};function Pe(t){return ve(t).map((t=>function(t){return new Ce(t)}(t)))}const Be={};function Ue(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=Pe(e),o=Ne[n]??(Ne[n]=new Set),r=Te[n]??(Te[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.fs.length;t++){const n=e.fs[t];o.add(n.cs),"for"===n.rs&&r.add(n.cs)}}Ie[t]=s}(t,e.content,n),Be[t]=e,t}function $e(t){return Be[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"Template.getTemplateById",xs:t},t:"./docs/error-codes.md#tmp"})}class Le{en;Dt;node;ys;M;An=new WeakMap;Ss=!1;constructor(t,e,n,s,o){this.en=t,this.node=e,this.Dt=n,this.ys=s(this,e,n.bs),this.M=o(this,n.Cs)}get N(){return this.ys.N}get isActive(){return this.Ss}nn(t,e,n){this.M.P(t,e,n)}U(t){this.ys.U(t)}$(t){if(t.me.has(this))return;t.me.add(this),this.ys.$(t);const e=this.M.fe;if(!this.M.qn&&!this.Dt.At._e.has(e.info.pattern)){1===this.Dt.Ue(e).length&&t.pe.add(e)}}k(){this.Ss=!0,this.M.k(),this.ys.k()}A(){this.isActive&&(this.ys.A(),this.M.A(),this.Ss=!1)}}function Me(t,e,n,s,o){return new Le(t,e,n,s,o)}class Ee{info;es;zn;vs;Is={};constructor(t,e){this.zn=t,this.info=t.info,this.es=e}get fe(){return this.zn??s({code:"STATE-202",message:"ref is null",context:{l:"LoopContext.ref",path:this.info.pattern},t:"./docs/error-codes.md#state"})}get path(){return this.fe.info.pattern}get bt(){return this.fe.bt??s({code:"LIST-201",message:"listIndex is required",context:{l:"LoopContext.listIndex",path:this.info.pattern},t:"./docs/error-codes.md#list"})}Un(t){this.zn=tt(this.info,t)}Ts(){this.zn=null}get Ns(){if(void 0===this.vs){let t=this.es;for(;null!==t;){if(null!==t.ae&&t.ae!==this){this.vs=t.ae;break}t=t.ts?.en??null}void 0===this.vs&&(this.vs=null)}return this.vs}find(t){let e=this.Is[t];if(void 0===e)if(this.path===t)e=this.Is[t]=this;else{let n=this.Ns;for(;null!==n&&n.path!==t;)n=n.Ns;e=this.Is[t]=n}return e}Ps(t){t(this);let e=this.Ns;for(;null!==e;)t(e),e=e.Ns}cn(){const t=[];return this.Ps((e=>{t.unshift(e)})),t}}function _e(t){const e=$e(t)??s({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"BindContent.createContent",xs:t},t:"./docs/error-codes.md#tmp"}),n=document.importNode(e.content,!0);if(Object.keys(ln).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){un(t[e].tagName.toLowerCase())}}return n}function Re(t,e,n,o){const r=(t=>Ie[t])(e)??s({code:"BIND-101",message:"Data-bind not registered",context:{l:"BindContent.createBindings",xs:e},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],a=y(o,d.us)??s({code:"BIND-102",message:`Node not found by nodePath: ${String(d.us)}`,context:{l:"BindContent.createBindings",xs:e,us:d.us},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.fs.length;o++){const r=d.fs[o],c=d.ps.get(r)??s({code:"BIND-103",message:`Creator not found for bindText: ${String(r)}`,context:{l:"BindContent.createBindings",xs:e,Bs:r},t:"./docs/error-codes.md#bind"}),l=Me(t,a,n,c.gs,c.ws);i.push(l)}}return i}class ke{ts;ae;id;kn;Us;fragment;childNodes;$s=[];we;Ss=!1;Ls;_n(t){const e=this.$s[this.$s.length-1],n=this.Us;if(void 0!==e&&e.node===n&&e.N.length>0){const n=(e.N.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{l:"BindContent.getLastNode",xs:this.id},t:"./docs/error-codes.md#bind"}))._n(t);if(null!==n)return n}return t!==n?.parentNode?null:n}get tn(){if(void 0===this.Ls){if(null!==this.ae)return this.Ls=this.ae,this.Ls;let t=this.ts?.en??null;for(;null!==t&&null===t.ae;)t=t.ts?.en??null;this.Ls=t?.ae??null}return this.Ls}constructor(t,e,n,s){this.ts=t,this.id=e,this.fragment=_e(e),this.childNodes=Array.from(this.fragment.childNodes),this.kn=this.childNodes[0]??null,this.Us=this.childNodes[this.childNodes.length-1]??null,this.we=n,this.ae=null!==s.bt?new Ee(s,this):null;const o=Re(this,e,n,this.fragment);this.$s=o}get isActive(){return this.Ss}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}Ms(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}gn(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){this.Ls=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}Un(t){null===this.ae&&s({code:"BIND-201",message:"LoopContext is null",context:{l:"BindContent.assignListIndex",xs:this.id},t:"./docs/error-codes.md#bind"}),this.ae.Un(t)}$(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.$s.length;e++){const n=this.$s[e];t.me.has(n)||n.$(t)}}k(){this.Ss=!0;for(let t=0;t<this.$s.length;t++)this.$s[t].k()}A(){this.Ss=!1,this.ae?.Ts();for(let t=0;t<this.$s.length;t++)this.$s[t].A()}}function Ae(t,e,n,s){return new ke(t,e,n,s)}function De(t,e){const n=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=n.adoptedStyleSheets;s.includes(e)||(n.adoptedStyleSheets=[...s,e])}function Fe(t,e){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}function Ve(t,e,n){"none"===e.shadowDomMode?De(t,n):"force"===e.shadowDomMode||null===e.Es||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.Es)?Fe(t,n):De(t,n)}class Oe{_s=new Set;Rs=new Set;ks=new Map;As=new Map;Ds=new Map;Fs=new Map;Vs=new WeakSet;On(t){if(this.Vs.has(t))return;const e=t.M.pattern,n=t.ys.I;this.Ds.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{l:"ComponentStateBinding.addBinding",it:e,Os:this.Ds.get(e)},t:"./docs/error-codes.md#state"}),this.Fs.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{l:"ComponentStateBinding.addBinding",Ws:n,Hs:this.Fs.get(n)},t:"./docs/error-codes.md#state"}),this.Ds.set(e,n),this.Fs.set(n,e),this.Rs.add(e),this._s.add(n),this.ks.set(e,t),this.As.set(n,t),this.Vs.add(t)}qs(t){return this.Ds.get(t)}js(t){return this.Fs.get(t)}zs(t){const e=k(t).q.intersection(this._s);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",Ws:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Fs.get(o);return void 0===i&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",Ws:t,Gs:o},t:"./docs/error-codes.md#state"}),i+r}Zs(t){const e=k(t).q.intersection(this.Rs);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",it:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Ds.get(o);return void 0===i&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",it:t,Gs:o},t:"./docs/error-codes.md#state"}),i+r}Qs(t){if(0===this._s.size)return null;const e=t.q.intersection(this._s);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.Js(e);for(const t of n??[])this.On(t)}}class We{Ks;we;constructor(t,e){this.Ks=e,this.we=t}Xs(t){Ct(this.we,(e=>{e.update(null,(e=>{for(const[n,s]of Object.entries(t)){const t=tt(k(n),null);e[H](t,s)}}))}))}U(t){Ct(this.we,(e=>{for(const n of t){let t;try{t=this.Ks.Zs(n.info.pattern)}catch(t){continue}const o=k(t),r=o.dt-1,i=r>=0?n.bt?.at(r)??null:null;r>=0&&null===i&&s({code:"LIST-201",message:`ListIndex not found for parent ref: ${n.info.pattern}`,context:{l:"ComponentStateInput.notifyRedraw",Ys:n.info.pattern,eo:o.pattern},t:"./docs/error-codes.md#list"});const c=tt(o,i);e.te(c)}}))}get(t,e,n){if(e===jt)return this.Xs.bind(this);if(e===zt)return this.U.bind(this);if("string"==typeof e){const t=tt(k(e),null);return this.we.getPropertyValue(t)}s({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.get",re:String(e)},t:"./docs/error-codes.md#state"})}set(t,e,n,o){if("string"==typeof e){const t=tt(k(e),null);return this.we.no(t,n),!0}s({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.set",re:String(e)},t:"./docs/error-codes.md#state"})}}class He{u;so;oo=new Set;constructor(t,e){this.u=t,this.so=e}get(t){const e=this.u.Qs(t.info);null===e&&s({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.get",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const n=this.u.As.get(e);void 0===n&&s({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.get",Ws:e},t:"./docs/error-codes.md#cso"});const o=tt(k(this.u.zs(t.info.pattern)),t.bt??n.M.bt);if(!this.oo.has(o.info.pattern)){const e=this.so.At.Vt.has(t.info.pattern);n.Dt.At.addPath(o.info.pattern,e),this.oo.add(o.info.pattern)}return n.Dt.getPropertyValue(o)}set(t,e){const n=this.u.Qs(t.info);null===n&&s({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.set",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const o=this.u.As.get(n);void 0===o&&s({code:"CSO-102",message:`Child binding not registered: ${n}`,context:{l:"ComponentStateOutput.set",Ws:n},t:"./docs/error-codes.md#cso"});const r=tt(k(this.u.zs(t.info.pattern)),t.bt??o.M.bt);if(!this.oo.has(r.info.pattern)){const e=this.so.At.Vt.has(t.info.pattern);o.Dt.At.addPath(r.info.pattern,e),this.oo.add(r.info.pattern)}return o.Dt.no(r,e),!0}startsWith(t){return null!==this.u.Qs(t)}de(t){const e=this.u.Qs(t.info);null===e&&s({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.getListIndexes",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const n=this.u.As.get(e);void 0===n&&s({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.getListIndexes",Ws:e},t:"./docs/error-codes.md#cso"});const o=tt(k(this.u.zs(t.info.pattern)),t.bt);if(!this.oo.has(o.info.pattern)){const e=this.so.At.Vt.has(t.info.pattern);n.Dt.At.addPath(o.info.pattern,e),this.oo.add(o.info.pattern)}return n.Dt.de(o)}}class qe{Ve=[];ro=!1;get io(){return this.Ve.length>0?this.Ve[0]:null}get co(){return this.io?this.io.do.promise:null}async ao(t){const e=this.io??s({code:"UPD-301",message:"No item in update complete queue to process",context:{l:"CompleteQueue.processNext"},t:"./docs/error-codes.md#upd"});let n=!1;try{n=await e.lo}finally{this.Ve.shift(),e.do.resolve(n),t.resolve()}}async ho(){if(!this.ro){this.ro=!0;try{for(;this.Ve.length>0;){const t=Promise.withResolvers();queueMicrotask((async()=>{this.ao(t)})),await t.promise}}finally{this.ro=!1}}}enqueue(t){this.Ve.push({lo:t,do:Promise.withResolvers()}),this.ro||this.ho()}}class je{type="autonomous";config;uo;styleSheet;fo;state;bs;Cs;mo=HTMLElement;ie;At;po=Promise.withResolvers();wo;zt;Wn;Ee=new WeakMap;Me=new Set;Ht=new Map;Ge=function(){return new qe}();un=null;xo=null;yo=null;So=!1;bo=0;Co=new WeakMap;constructor(t,e){this.config=t,this.config.Es&&(this.type="builtin");const n=e.constructor;var s;this.uo=n.uo,this.styleSheet=n.styleSheet,this.fo=n.fo,this.state=new this.fo,this.bs=n.bs,this.Cs=n.Cs,this.ie=e,this.Wn=new Oe,this.wo=function(t,e){const n=new We(t,e);return new Proxy({},n)}(this,this.Wn),this.zt=(s=this.Wn,new He(s,this)),this.At=n.At}get es(){return null===this.un&&s({code:"BIND-201",message:"BindContent not initialized yet",context:{l:"ComponentEngine.bindContent.get",vo:this.ie.constructor.id},t:"./docs/error-codes.md#bind"}),this.un}get Io(){return this.bo}ze(){return++this.bo}To(){for(const t in this.state)$.has(t)||this.At.No.has(t)||(this.At.No.add(t),V(this.At.$e,t));const t=this.ie.constructor,e=tt(k(""),null);this.un=Ae(null,t.id,this,e)}connectedCallback(){if(this.config.Po)Ve(this.ie,this.config,this.styleSheet);else{this.yo=this.ie.parentNode,this.xo=document.createComment("Structive block placeholder"),this.So=!0;try{this.ie.replaceWith(this.xo)}finally{this.So=!1}}if(this.config.Po)this.es.mount(this.ie.shadowRoot??this.ie);else{const t=this.yo??s({code:"BIND-201",message:"Block parent node not set",context:{l:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.es.gn(t,this.xo)}if(this.ie.dataset.state)try{const t=JSON.parse(this.ie.dataset.state);this.wo[jt](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{l:"ComponentEngine.connectedCallback",Bo:this.ie.dataset.state},t:"./docs/error-codes.md#state",i:t})}if(this.es.k(),Ct(this,(t=>{t.Je((t=>{t.Ne((()=>{this.es.$(t)}))}))})),this.At.Uo){const t=Ct(this,(t=>t.update(null,(t=>t[q]()))));t instanceof Promise?t.finally((()=>{this.po.resolve()})).catch((()=>{s({code:"COMP-301",message:"Connected callback failed",context:{l:"ComponentEngine.connectedCallback"},t:"./docs/error-codes.md#comp"})})):this.po.resolve()}else this.po.resolve()}disconnectedCallback(){if(!this.So)try{this.At.$o&&Ct(this,(t=>{t.update(null,(t=>{t[j]()}))}))}catch(t){s({code:"COMP-302",message:"Disconnected callback failed",context:{l:"ComponentEngine.disconnectedCallback"},t:"./docs/error-codes.md#comp",i:t})}finally{this.ie.Mo?.Lo(this.ie),this.config.Po||(this.xo?.remove(),this.xo=null,this.yo=null),this.es.A()}}de(t){if(this.zt.startsWith(t.info))return this.zt.de(t);let e=null;return Ct(this,(n=>e=n.Ne((e=>e[G](t))))),e}getPropertyValue(t){let e;return Ct(this,(n=>{e=n.Ne((e=>e[W](t)))})),e}no(t,e){Ct(this,(n=>{n.update(null,(n=>{n[H](t,e)}))}))}Vn(t){this.Me.add(t)}Lo(t){this.Me.delete(t)}Wt(t){return this.Co.get(t)?.Eo??null}Jt(t,e){const n=this.Co.get(t);void 0===n?this.Co.set(t,{$s:[],Eo:e}):n.Eo=e}Ue(t){return this.Co.get(t)?.$s??[]}Zn(t,e){const n=this.Co.get(t);void 0===n?this.Co.set(t,{$s:[e],Eo:null}):n.$s.push(e)}Qn(t,e){const n=this.Co.get(t);if(void 0!==n){const t=n.$s.indexOf(e);t>=0&&n.$s.splice(t,1)}}}const ze=/\{\{([^}]+)\}\}/g;const Ge="http://www.w3.org/2000/svg";function Ze(t,e,s=t){let o=e;const r=o.getAttribute(P),i=n.debug?r??"":"";if(o.parentNode?.replaceChild(document.createComment(`${U}${t} ${i}`),o),o.namespaceURI===Ge){const t=document.createElement("template"),e=Array.from(o.childNodes);for(let n=0;n<e.length;n++){const s=e[n];t.content.appendChild(s)}t.setAttribute(P,r??""),o=t}return o.content.querySelectorAll("template").forEach((t=>{Ze(p(),t,s)})),Ue(t,o,s),t}function Qe(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(ze,((t,n)=>{const o=n.trim(),[r]=o.split(":");if("if"!==r&&"for"!==r&&"endif"!==r&&"endfor"!==r&&"elseif"!==r&&"else"!==r)return`\x3c!--${B}${o}--\x3e`;const i=o.slice(r.length+1).trim(),c={type:r,_o:o,Ro:i};if("if"===r||"for"===r)return e.push(c),`<template data-bind="${o}">`;if("endif"===r){const t=[];for(0===e.length&&s({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",_o:o,ko:e.length},t:"./docs/error-codes.md#tmp"});e.length>0;){const n=e.pop();if("if"===n.type){t.push("</template>");break}"elseif"===n.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",Ao:n.type,_o:o},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===r){const t=e.pop()??s({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",_o:o,ko:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",Ao:t.type,_o:o},t:"./docs/error-codes.md#tmp"})}else if("elseif"===r){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",_o:o,ko:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(c),`</template><template data-bind="if:${t.Ro}|not"><template data-bind="if:${i}">`;s({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",Ao:t.type,_o:o},t:"./docs/error-codes.md#tmp"})}else if("else"===r){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",_o:o,ko:e.length},t:"./docs/error-codes.md#tmp"});return"if"===t.type?`</template><template data-bind="if:${t.Ro}|not">`:s({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",Ao:t.type,_o:o},t:"./docs/error-codes.md#tmp"})}return s({code:"TMP-102",message:"Unreachable: All Mustache types should be handled by preceding branches",context:{l:"Template.replaceMustacheWithTemplateTag",_o:o,ko:e.length},t:"./docs/error-codes.md#tmp"})}))}(e),Ze(t,n)}const Je=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Ke=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function Xe(t,e){const n={l:"StateProperty.createAccessorFunctions",pattern:t.pattern},o=new Set(t.H).intersection(e);let r=-1,i="";for(const t of o){const e=t.split(".");1!==e.length&&(e.length>r&&(r=e.length,i=t))}if(i.length>0){Ke.test(i)||s({code:"STATE-202",message:`Invalid path: ${i}`,context:{...n,Do:i},t:"./docs/error-codes.md#state"});const e=k(i),o=[];let r=e.dt;for(let c=e.O.length;c<t.O.length;c++){const e=t.O[c];"*"===e?(o.push(`[this.$${r+1}]`),r++):(Je.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{...n,Fo:e,Do:i},t:"./docs/error-codes.md#state"}),o.push(`.${e}`))}const c=o.join(""),d=`this["${i}"]${c} = value;`;return{get:new Function("",`return this["${i}"]${c};`),set:new Function("value",d)}}{const e=[];let o=0;for(let r=0;r<t.O.length;r++){const i=t.O[r];"*"===i?(e.push(`[this.$${o+1}]`),o++):(Je.test(i)||s({code:"STATE-202",message:`Invalid segment name: ${i}`,context:{...n,Fo:i},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+i))}const r=e.join(""),i=`this.${r} = value;`;return{get:new Function("",`return this.${r};`),set:new Function("value",i)}}}class Ye{No=new Set;Vt=new Set;elements=new Set;Vo=new Set;Ot=new Set;kt=new Set;Yt=new Set;Oo=new Set;Wo=new Set;Ho=new Map;_e=new Map;$e=function(){return new A("","",0)}();Uo=!1;$o=!1;Qe=!1;hn;qo;jo=new Set;constructor(t){this.hn=t.id,this.qo=t.fo;const e=(t=>Ne[t]??[])(this.hn),n=new Set;for(const t of e){const e=k(t);this.No=this.No.union(e.q);for(const t of e.q){const e=k(t);"*"===e.W&&n.add(e.it)}}const s=(t=>Te[t]??[])(this.hn);this.Vt=this.Vt.union(s).union(n);for(const t of this.Vt){const e=`${t}.*`;this.elements.add(e)}let o=this.qo.prototype;for(;o&&o!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(o);if(t)for(const[e,n]of Object.entries(t)){if($.has(e))continue;if("function"==typeof n.value){this.Vo.add(e),e===L&&(this.Uo=!0),e===M&&(this.$o=!0),e===E&&(this.Qe=!0);continue}const t=void 0!==n.get,s=void 0!==n.set,o=k(e);this.No=this.No.union(o.q),t&&this.Ot.add(e),s&&this.Yt.add(e),t&&!s&&this.kt.add(e),t&&s&&this.Oo.add(e)}o=Object.getPrototypeOf(o)}for(const t of this.No){if(this.Ot.has(t))continue;if(this.Yt.has(t))continue;const e=k(t);if(1===e.O.length)continue;const n=Xe(e,this.Ot);Object.defineProperty(this.qo.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.Wo.add(t)}for(const t of this.No){V(this.$e,t);const e=k(t);if(e.it){const n=this.Ho.get(e.it);void 0!==n?n.add(t):this.Ho.set(e.it,new Set([t]))}}}addPath(t,e=!1){const n=k(t);if(e&&!this.Vt.has(t)){this.Vt.add(t);const e=`${t}.*`;this.elements.add(e)}else"*"===n.W&&(this.elements.add(t),this.Vt.add(n.it));for(const t of n.q){if(this.No.has(t))continue;this.No.add(t),V(this.$e,t);const e=k(t);if("*"===e.W&&(this.elements.add(t),this.Vt.add(e.it)),e.O.length>1){const n=Xe(e,this.Ot);Object.defineProperty(this.qo.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.Wo.add(t)}if(e.it){const n=this.Ho.get(e.it);void 0!==n?n.add(t):this.Ho.set(e.it,new Set([t]))}}}Ft(t,e){const n=`${e}=>${t}`;if(this.jo.has(n))return;this.No.has(e)||this.addPath(e),this.jo.add(n);const s=this._e.get(e);void 0!==s?s.add(t):this._e.set(e,new Set([t]))}}function tn(t){const n=function(t){const n=e();return{Po:void 0===t.Po||t.Po,shadowDomMode:t.shadowDomMode??n.shadowDomMode,Es:t.Es??null}}(t.fo.zo??{}),o=p(),{Go:r,Zo:i,fo:c}=t,d=Object.assign({},f),a=Object.assign({},u);c.Qo=!0,Qe(o,r),x(o,i),function(t,e){g[t]=e}(o,c);const l=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.Es),h=n.Es;return class extends l{static define(t){h?customElements.define(t,this,{Es:h}):customElements.define(t,this)}static get id(){return o}static Jo=r;static get Go(){return this.Jo}static set Go(t){this.Jo=t,Qe(this.id,t),this.Ko=null,this.Xo=null}static Yo=i;static get Zo(){return this.Yo}static set Zo(t){this.Yo=t,x(this.id,t),this.tr=null}static Ko=null;static get uo(){return this.Ko||(this.Ko=$e(this.id)),this.Ko}static tr=null;static get styleSheet(){return this.tr||(this.tr=function(t){return w[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{l:"StyleSheet.getStyleSheetById",er:t},t:"./docs/error-codes.md#css"})}(this.id)),this.tr}static qo=null;static get fo(){return this.qo||(this.qo=function(t){return g[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{l:"StateClass.getStateClassById",nr:t},t:"./docs/error-codes.md#state"})}(this.id)),this.qo}static sr=d;static get bs(){return this.sr}static rr=a;static get Cs(){return this.rr}static Xo=null;static get At(){return this.Xo||(this.Xo=new Ye(this)),this.Xo}we;ir;constructor(){super(),this.we=function(t,e){return new je(t,e)}(n,this),this.we.To()}connectedCallback(){this.we.connectedCallback()}disconnectedCallback(){this.we.disconnectedCallback()}get Mo(){var t;return void 0===this.ir&&(this.ir=(t=this,Gt.get(t)??null)),this.ir}get state(){return this.we.wo}get Wn(){return this.we.Wn}get cr(){return this.we.fo.Qo??!1}get po(){return this.we.po}get ce(){return this.we.Ge.co}Js(t){return this.we.Ee.get(t)??null}Vn(t){this.we.Vn(t)}Lo(t){this.we.Lo(t)}}}function en(t){return t.replaceAll(/<!--\{\{([^}]+)}}-->/g,((t,e)=>`{{${e}}}`))}function nn(t,e,s){if(!n.debug)return;const o=s?` (${s})`:"";console.warn(`[Structive][SFC] Missing <${t}> section in ${e}${o}`)}let sn=0;async function on(t){const e=import.meta.resolve?import.meta.resolve(t):t,n="./docs/error-codes.md#imp-202-component-load-failed";let o="";try{const r=await fetch(e);r.ok||s({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,dr:e,status:r.status,statusText:r.statusText,url:r.url},hint:"Make sure the import map entry points to a reachable SFC and the server returns a 2xx status.",t:n}),o=await r.text()}catch(o){s({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,dr:e},hint:"Confirm the SFC path is correct and accessible before bootstrapping.",t:n,i:o})}return async function(t,e){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(e);const s=n.content.querySelector("template");s||nn("template",t),s?.remove();const o=n.content.querySelector("script[type=module]");let r={};if(o){const e=`\n// uniq id: ${sn++}\n//# sourceURL=${t}\n`;if("function"==typeof URL.createObjectURL){const t=new Blob([o.text+e],{type:"application/javascript"}),n=URL.createObjectURL(t);try{r=await import(n)}finally{URL.revokeObjectURL(n)}}else{const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(o.text+e)));r=await import(`data:application/javascript;base64,${t}`)}}else nn("script",t,'expects <script type="module">');o?.remove();const i=n.content.querySelector("style");i||nn("style",t),i?.remove();const c=r.default??class{};return{text:e,Go:en(s?.innerHTML??"").trim(),Zo:i?.textContent??"",fo:c}}(t,o)}function rn(t,e){e.define(t)}const cn="@routes/",dn="@components/",an="#lazy",ln={};async function hn(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(cn)){s=n.endsWith(an);const e=n.slice(7,s?-5:void 0);t=`routes${e.replace(/:[^\s/]+/g,"").replace(/\//g,"-")}`,wn(t,"/root"===e?"/":e)}n.startsWith(dn)&&(s=n.endsWith(an),t=n.slice(12,s?-5:void 0)),t&&(s?ln[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){rn(t,tn(await on(n)))}}}function un(t){const e=ln[t];if(e)delete ln[t],queueMicrotask((()=>{on(e).then((e=>{const n=tn(e);rn(t,n)})).catch((n=>{s({code:"IMP-202",message:`Failed to load lazy component for tagName: ${t}`,context:{l:"WebComponents.loadFromImportMap.loadLazyLoadComponent",tagName:t,ar:e,lr:n instanceof Error?n.message:String(n)},t:"./docs/error-codes.md#imp",o:"error"})}))}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{l:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const fn="routes:",mn=[];let pn=null;class gn extends HTMLElement{hr=window.location.pathname.split("/").pop()||"";ur=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";mr;constructor(){super(),this.mr=this.pr.bind(this)}connectedCallback(){pn=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.mr),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.mr),pn=null}pr(t){t.preventDefault(),this.Pe()}navigate(t){const e="/"===t[0]?this.ur+t.slice(1):t;history.pushState({},"",e),this.Pe()}Pe(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.hr&&(t[t.length-1]="");const e=t.join("/").replace(this.ur,""),n="/"!==e[0]?`/${e}`:e;let s;const o={};for(const[t,e]of mn){const r=new RegExp(`^${t.replace(/:[^\s/]+/g,"([^/]+)")}$`);if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return t in ln}(s)&&un(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function wn(t,e){let n;n=e.startsWith(fn)?e.substring(fn.length):e,mn.push([n,t])}const xn="router",yn=`<slot name="${xn}"></slot>`;class Sn extends HTMLElement{constructor(){super(),"none"!==n.shadowDomMode&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.gr(),this.Pe()}get root(){return this.shadowRoot??this}async gr(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{l:"MainWrapper.loadLayout",layoutPath:n.layoutPath},t:"./docs/error-codes.md#tmp"})}else this.root.innerHTML=yn}Pe(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",xn),this.root.appendChild(t)}}}const bn=n;let Cn=!1;async function vn(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;wn(e,"/root"===t?"/":t)}t=await on(s),rn(e,tn(t))}}(t),bn.autoInit&&await In()}async function In(){Cn||(await async function(){if(n.autoLoadFromImportMap&&await hn(),n.enableRouter&&customElements.define(n.routerTagName,gn),n.enableMainWrapper&&(customElements.define(n.mainTagName,Sn),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),Cn=!0)}export{In as bootstrapStructive,bn as config,vn as defineComponents};
//# sourceMappingURL=structive.min.mjs.map
