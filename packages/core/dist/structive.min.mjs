const t={debug:!1,debugReports:[],locale:"en-US",shadowDomMode:"auto",enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1};function e(){return t}const s=e();function n(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:o,hint:r,t:i,o:c,i:d}=t;s.debug&&(console.group(`[Structive Error] ${n}: ${e}`),o&&console.log("Context:",o),r&&console.log("Hint:",r),i&&console.log("Docs:",i),d&&console.error("Cause:",d),console.groupEnd());const a=new Error(e);throw a.code=n,o&&(a.context=o),r&&(a.hint=r),i&&(a.t=i),c&&(a.o=c),d&&(a.i=d),a}const o=(t,e)=>({l:t,h:e});function r(t){n({code:"FLT-202",message:`${t} requires at least one option`,context:o("Filter.optionsRequired",t),t:"./docs/error-codes.md#flt"})}function i(t){n({code:"FLT-202",message:`${t} requires a number as option`,context:o("Filter.optionMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function c(t){n({code:"FLT-202",message:`${t} requires a number value`,context:o("Filter.valueMustBeNumber",t),t:"./docs/error-codes.md#flt"})}function d(t){n({code:"FLT-202",message:`${t} requires a date value`,context:o("Filter.valueMustBeDate",t),t:"./docs/error-codes.md#flt"})}const a=e();function l(t){return!(!t||isNaN(Number(t)))}const h={eq:t=>{const e=t?.[0]??r("eq");return t=>"number"==typeof t?(l(e)||i("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??r("ne");return t=>"number"==typeof t?(l(e)||i("ne"),t!==Number(e)):t!==e},not:t=>t=>{var e;return"boolean"!=typeof t&&n({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:o("Filter.valueMustBeBoolean",e),t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??r("lt");return l(e)||i("lt"),t=>("number"!=typeof t&&c("lt"),t<Number(e))},le:t=>{const e=t?.[0]??r("le");return l(e)||i("le"),t=>("number"!=typeof t&&c("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??r("gt");return l(e)||i("gt"),t=>("number"!=typeof t&&c("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??r("ge");return l(e)||i("ge"),t=>("number"!=typeof t&&c("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??r("inc");return l(e)||i("inc"),t=>("number"!=typeof t&&c("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??r("dec");return l(e)||i("dec"),t=>("number"!=typeof t&&c("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??r("mul");return l(e)||i("mul"),t=>("number"!=typeof t&&c("mul"),t*Number(e))},div:t=>{const e=t?.[0]??r("div");return l(e)||i("div"),t=>("number"!=typeof t&&c("div"),t/Number(e))},mod:t=>{const e=t?.[0]??r("mod");return l(e)||i("mod"),t=>("number"!=typeof t&&c("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return l(e)||i("fix"),t=>("number"!=typeof t&&c("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a.locale;return t=>("number"!=typeof t&&c("locale"),t.toLocaleString(e))},uc:t=>t=>String(t).toUpperCase(),lc:t=>t=>String(t).toLowerCase(),cap:t=>t=>{const e=String(t);return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>String(t).trim(),slice:t=>{const e=t?.[0]??r("slice");return l(e)||i("slice"),t=>String(t).slice(Number(e))},substr:t=>{const e=t?.[0]??r("substr");l(e)||i("substr");const s=t?.[1]??r("substr");return l(s)||i("substr"),t=>String(t).substr(Number(e),Number(s))},pad:t=>{const e=t?.[0]??r("pad");l(e)||i("pad");const s=t?.[1]??"0";return t=>String(t).padStart(Number(e),s)},rep:t=>{const e=t?.[0]??r("rep");return l(e)||i("rep"),t=>String(t).repeat(Number(e))},rev:t=>t=>String(t).split("").reverse().join(""),int:t=>t=>parseInt(String(t),10),float:t=>t=>parseFloat(String(t)),round:t=>{const e=t?.[0]??"0";return l(e)||i("round"),t=>{"number"!=typeof t&&c("round");const s=Math.pow(10,Number(e));return Math.round(t*s)/s}},floor:t=>{const e=t?.[0]??"0";return l(e)||i("floor"),t=>{"number"!=typeof t&&c("floor");const s=Math.pow(10,Number(e));return Math.floor(t*s)/s}},ceil:t=>{const e=t?.[0]??"0";return l(e)||i("ceil"),t=>{"number"!=typeof t&&c("ceil");const s=Math.pow(10,Number(e));return Math.ceil(t*s)/s}},percent:t=>{const e=t?.[0]??"0";return l(e)||i("percent"),t=>("number"!=typeof t&&c("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||d("ymd");const s=t.getFullYear().toString(),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${s}${e}${n}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??r("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},u=h,f=h;let m=0;function p(){return++m}const g={};const w={};function x(t,e){const s=new CSSStyleSheet;s.replaceSync(e),function(t,e){w[t]=e}(t,s)}function y(t,e){let s=t;if(0===e.length)return s;for(let t=0;t<e.length&&(s=s?.childNodes[e[t]]??null,null!==s);t++);return s}function b(t,e){const s=t[e.name];return s||n({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{l:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),s(e.options)}const S=new Map;const C=new Map;function v(t,e){let s=C.get(t);s||(s=new Map,C.set(t,s));let n=s.get(e);return n||(n=function(t,e){let s=S.get(e);if(void 0===s){s=[];for(let n=0;n<e.length;n++)s.push(b(t,e[n]));S.set(e,s)}return s}(t,e),s.set(e,n)),n}class I{u;node;name;m;binding;p;filters;S=!0;C=!1;get v(){return[]}constructor(t,e,s,n,o,r){this.u=e instanceof HTMLSelectElement,this.node=e,this.name=s,this.m=n,this.binding=t,this.filters=o,this.p=r}I(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNode.assignValue",name:this.name},t:"./docs/error-codes.md#bind"})}P(t,e){n({code:"BIND-301",message:"Binding updateElements not implemented",context:{l:"BindingNode.updateElements",name:this.name},t:"./docs/error-codes.md#bind"})}T(t){}B(t){const e=this.binding.N.U(t.$,t._);this.I(e)}R(){}M(){}get value(){return null}get L(){return null}}class P extends I{I(t){const e=this.node,s=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.setAttribute(this.m,s)}}const T={},B="data-bind",U="@@:",N="@@|",$=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),_="$connectedCallback",R="$disconnectedCallback",M="$updatedCallback",L={};class E{static id=0;id=++E.id;A=this.id.toString();pattern;k;D;F;V;O;W;H;j;q;G;Z;J;K;X;Y;tt;et;st;nt;ot;constructor(t){const e=e=>t===e?this:A(e),s=t.split("."),n=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<s.length;t++)l+=s[t],"*"===s[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),n.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=n.length>1?n[n.length-2]:null;this.pattern=t,this.k=s,this.D=s[s.length-1],this.F=n,this.V=new Set(n),this.O=o,this.W=new Set(o),this.H=r,this.j=new Set(r),this.G=i,this.q=c,this.Z=new Set(c),this.J=d,this.K=new Set(d),this.X=a,this.Y=new Set(a),this.tt=f,this.et=f?e(f):null,this.st=m,this.nt=m?e(m):null,this.ot=u}}function A(t){$.has(t)&&n({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{l:"StateProperty.getStructuredPathInfo",rt:t},t:"./docs/error-codes.md#state"});const e=L[t];return void 0!==e?e:L[t]=new E(t)}class k{st;it;name;ct;level;constructor(t,e,s){this.st=t,this.it=t?`${t}.${e}`:e,this.name=e,this.level=s,this.ct=new Map}find(t,e=0){if(e>=t.length)return null;const s=t[e],n=this.ct.get(s);return n?e===t.length-1?n:n.find(t,e+1):null}appendChild(t){let e=this.ct.get(t);if(!e){const s=this.st?`${this.st}.${this.name}`:this.name;e=new k(s,t,this.level+1),this.ct.set(t,e)}return e}}const D=new Map;function F(t,e){let s=D.get(t);s||(s=new Map,D.set(t,s));let n=s.get(e)??null;return n||(n=t.find(e.k),s.set(e,n),n)}function V(t,e){return F(t,A(e))}function O(t,e){const s=A(e);if(null===s.st)return t.appendChild(e);{let e=V(t,s.st);return null===e&&(e=O(t,s.st)),e.appendChild(s.D)}}const W="state",H=Symbol.for(`${W}.GetByRef`),j=Symbol.for(`${W}.SetByRef`),q=Symbol.for(`${W}.ConnectedCallback`),z=Symbol.for(`${W}.DisconnectedCallback`),G=Symbol.for(`${W}.UpdatedCallback`),Z=Symbol.for(`${W}.GetListIndexesByRef`),Q=new Map;class J{static id=0;id=++J.id;name;elements;dt;ot;ht;ut;info;constructor(t){const e=t.split("."),s=e.slice(),n=[];let o=0,r=0,i="",c=0,d="none";const a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)s[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(s[t]="*",a.push(e),r++,c++)}i+=d,n.push(i),i+=t<e.length-1?".":""}const l=A(s.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.dt=n,this.ot=c,this.ht=d,this.ut=a,this.info=l}}function K(t){let e;return Q.get(t)??(Q.set(t,e=new J(t)),e)}class X{info;ft;get wt(){return null===this.ft?null:this.ft.deref()??n({code:"LIST-201",message:"listIndex is null",context:{l:"StatePropertyRef.get listIndex",A:this.info.A,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.ft=null!==e?new WeakRef(e):null,this.key=null===e?t.A:`${t.A}#${e.A}`}get xt(){const t=this.info.nt;if(!t)return null;return et(t,(this.info.ot>t.ot?this.wt?.at(-2):this.wt)??null)}}const Y=new WeakMap,tt={};function et(t,e){let s=null;if(null!==e){let n;if(void 0===(n=Y.get(e)))s=new X(t,e),Y.set(e,{[t.pattern]:s});else if(void 0===(s=n[t.pattern]))return n[t.pattern]=new X(t,e)}else if(void 0===(s=tt[t.pattern]))return tt[t.pattern]=new X(t,null);return s}function st(t,e){const s=t.yt;if(null===s)return null;if(null===s.wt)return null;const n=s.info.G[e];return void 0!==n?s.wt.at(n):null}function nt(t,e,s){switch(t.ht){case"none":return null;case"context":return st(s,t.info.tt??n({code:"STATE-202",message:"lastWildcardPath is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"}))??n({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#list"});case"all":{let s=null;for(let o=0;o<t.info.ot;o++){const r=t.info.X[o]??n({code:"STATE-202",message:"wildcardParentPattern is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"}),i=et(r,s),c=e[Z](i)??n({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",bt:r.pattern},t:"./docs/error-codes.md#list"}),d=t.ut[o]??n({code:"STATE-202",message:"wildcardIndex is null",context:{l:"StateClass.getListIndex",pattern:t.info.pattern,index:o},t:"./docs/error-codes.md#state"});s=c[d]??n({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{l:"StateClass.getListIndex",bt:r.pattern,St:d},t:"./docs/error-codes.md#list"})}return s}case"partial":n({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{l:"StateClass.getListIndex",pattern:t.info.pattern},t:"./docs/error-codes.md#state"})}}const ot={};for(let t=0;t<32;t++)ot[`$${t+1}`]=t;let rt=0,it=0;class ct{id=++it;A=it.toString();Ct;position;length;vt;It;Pt;Tt;constructor(t,e){this.Ct=t,this.position=t?t.position+1:0,this.length=this.position+1,this.vt=e,this.It=rt}get index(){return this.vt}set index(t){this.vt=t,this.It=++rt,this.Bt[this.position]=t}get version(){return this.It}get Ut(){return null!==this.Ct&&(this.Ct.Ut||this.Ct.version>this.It)}get Bt(){return null===this.Ct?void 0===this.Pt&&(this.Pt=[this.vt]):(void 0===this.Pt||this.Ut)&&(this.Pt=[...this.Ct.Bt,this.vt],this.It=rt),this.Pt}get Nt(){return null===this.Ct?void 0===this.Tt&&(this.Tt=[new WeakRef(this)]):void 0===this.Tt&&(this.Tt=[...this.Ct.Nt,new WeakRef(this)]),this.Tt}get $t(){return`$${this.position+1}`}at(t){return t>=0?this.Nt[t]?.deref()||null:this.Nt[this.Nt.length+t]?.deref()||null}}function dt(t,e){return new ct(t,e)}function at(t,e,s,o){let r;!function(t,e){if(t._t>=0){const s=t.yt?.info??null;null!==s&&t.Lt.Mt.Rt.has(s.pattern)&&s.pattern!==e.info.pattern&&t.Lt.Mt.Et(s.pattern,e.info.pattern)}}(o,e);const i=o.Lt.Mt.At.has(e.info.pattern),c=e.info.ot>0||o.Lt.Mt.kt.has(e.info.pattern);let d=null;if(c||i){d=o.Lt.Dt(e);const t=o.Lt.Ft.get(e.info.pattern);if(null!==d){if(void 0===t)return d.value;if(d.version>o.Vt.version)return d.value;if(!(d.version<t.version||d.Ot<t.Ot))return d.value}}if(o.Lt.Wt.startsWith(e.info)&&0===o.Lt.Mt.kt.intersection(e.info.V).size)return o.Lt.Wt.get(e);if(e.info.pattern in t){0===o.Ht.length&&n({code:"STC-002",message:"handler.refStack is empty in getByRef",context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o._t++,o._t>=o.Ht.length&&o.Ht.push(null),o.Ht[o._t]=o.yt=e;try{return r=Reflect.get(t,e.info.pattern,s)}finally{if(o.Ht[o._t]=null,o._t--,o.yt=o._t>=0?o.Ht[o._t]:null,c||i){let t=null;if(i){if(null!==o.jt&&!o.jt.qt.has(e))if(d){const t=d.Nt??[],s=d.value;Array.isArray(s)||n({code:"STC-001",message:`Property "${e.info.pattern}" is expected to be an array for list management.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"}),o.jt.qt.set(e,{Nt:t,value:s})}else o.jt.qt.set(e,{Nt:[],value:[]});t=function(t,e,s,n){const o=Array.isArray(e)?e:[],r=Array.isArray(s)?s:[],i=[];if(0===r.length)return[];if(0===o.length){for(let e=0;e<r.length;e++){const s=dt(t,e);i.push(s)}return i}if(function(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}(o,r))return n;const c=new Map;for(let t=0;t<o.length;t++)c.set(o[t],t);for(let e=0;e<r.length;e++){const s=r[e],o=c.get(s);if(void 0===o){const s=dt(t,e);i.push(s)}else{const t=n[o];t.index!==e&&(t.index=e),i.push(t)}}return i}(e.wt,d?.value,r,d?.Nt??[])}const s=d??{value:null,Nt:null,version:0,Ot:0};s.value=r,s.Nt=t,s.version=o.Vt.version,s.Ot=o.Vt.Ot,o.Lt.zt(e,s)}}}else n({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,context:{l:"StateClass.getByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#stc"})}function lt(t,e,s,o,r){const i=r.Lt.Mt.elements.has(e.info.pattern);let c=null,d=null;if(i&&(c=e.xt??n({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",scope:"element",Gt:e.info.pattern},t:"./docs/error-codes.md#state"}),d=r.Vt.Zt.get(c)||null,null===d)){const t=o[H](c)??[];Array.isArray(t)||n({code:"STATE-202",message:"Expected array value for list elements",context:{l:"StateClass.setByRef",scope:"element",Gt:c.info.pattern},t:"./docs/error-codes.md#state"}),d={value:[...t],Nt:[...o[Z](c)??[]]},r.Vt.Zt.set(c,d)}try{if(r.Lt.Wt.startsWith(e.info)&&0===r.Lt.Mt.Qt.intersection(e.info.V).size)return r.Lt.Wt.set(e,s);if(!(e.info.pattern in t)){const i=e.info.nt??n({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{l:"StateClass.setByRef",Gt:e.info.pattern},t:"./docs/error-codes.md#state"}),c=et(i,i.ot<e.info.ot?e.wt?.Ct??null:e.wt),d=at(t,c,o,r);null!==d&&"object"==typeof d||n({code:"STATE-202",message:"Parent value is not an object",context:{l:"StateClass.setByRef",Gt:c.info.pattern},t:"./docs/error-codes.md#state"});const a=e.info.D;if("*"===a){const t=e.wt?.index??n({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{l:"StateClass.setByRef",Gt:e.info.pattern},t:"./docs/error-codes.md#state"});return Reflect.set(d,t,s)}return Reflect.set(d,a,s)}r._t++,r._t>=r.Ht.length&&r.Ht.push(null),r.Ht[r._t]=r.yt=e;try{return Reflect.set(t,e.info.pattern,s,o)}finally{r.Ht[r._t]=null,r._t--,r.yt=r._t>=0?r.Ht[r._t]:null}}finally{if(r.Vt.Jt(e),i){const t=d.value.indexOf(s),i=o[Z](c)??[],a=e.wt.index,l=-1!==t?d.Nt[t]:dt(c.wt,-1);i[a]=l;const h=o[H](c)??[];null!==h&&Array.isArray(h)||n({code:"STATE-202",message:"Parent value is not an array during swap check",context:{l:"StateClass.setByRef",scope:"element swap",Gt:c.info.pattern},t:"./docs/error-codes.md#state"});if(new Set(h).size===d.value.length){for(let t=0;t<i.length;t++)i[t].index=t;r.Vt.Zt.delete(c)}}}}function ht(t,e,s,o){return(e,r,i)=>{const c=A(e),d=o.yt?.info??null;null!==d&&d.pattern!==c.pattern&&o.Lt.Mt.Rt.has(d.pattern)&&o.Lt.Mt.Et(d.pattern,c.pattern),c.X.length>r.length&&n({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{l:"StateClass.resolve",path:e,Kt:c.X.length,Xt:r.length},t:"./docs/error-codes.md#state"});let a=null;for(let e=0;e<c.X.length;e++){const i=c.X[e],d=et(i,a);at(t,d,s,o);const l=s[Z](d);null===l&&n({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern},t:"./docs/error-codes.md#list"});const h=r[e];a=l[h]??n({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{l:"StateClass.resolve",pattern:i.pattern,index:h},t:"./docs/error-codes.md#list"})}const l=et(c,a),h=void 0!==i;if(j in s){if(!h)return at(t,l,s,o);lt(t,l,i,s,o)}else{if(!h)return at(t,l,s,o);n({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{l:"StateClass.resolve",path:e},t:"./docs/error-codes.md#state"})}}}function ut(t,e,s,o){return t=>{"function"!=typeof t&&n({code:"STATE-203",message:"Callback is not a function",context:{l:"StateClass.invoke",Yt:t},t:"./docs/error-codes.md#state"});const e=o.Vt.te((()=>Reflect.apply(t,s,[])));return e instanceof Promise&&e.catch((t=>{n({code:"STATE-204",message:"Invoke callback rejected",context:{l:"StateClass.invoke"},t:"./docs/error-codes.md#state",o:"error",i:t instanceof Error?t:new Error(String(t))})})),e}}function ft(t,e,s,o){const r=ot[e];if(void 0!==r){const t=o.yt?.wt;return t?.Bt[r]??n({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{ee:String(e),Bt:t?.Bt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return ht(t,0,s,o);case"$getAll":return function(t,e,s,o){const r=ht(t,0,s,o);return(e,i)=>{let c=i;const d=A(e),a=o.yt?.info??null;if(null!==a&&a.pattern!==d.pattern&&o.Lt.Mt.Rt.has(a.pattern)&&o.Lt.Mt.Et(a.pattern,d.pattern),void 0===c){for(let t=0;t<d.q.length;t++){const e=d.q[t]??n({code:"BIND-201",message:"Wildcard info is missing",context:{l:"StateClass.getAll",St:t,pattern:d.pattern},t:"./docs/error-codes.md#bind"}),s=st(o,e.pattern);if(s){c=s.Bt;break}}void 0===c&&(c=[])}const l=(e,r,i,c,d,a,h)=>{const u=e[r]??null;if(null===u)return void h.push(a);const f=et(u,i);at(t,f,s,o);const m=s[Z](f);null===m&&n({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern},t:"./docs/error-codes.md#list"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const s=m[t];l(e,r+1,s,c,d+1,a.concat(s.index),h)}else{const t=m[p]??n({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{l:"StateClass.getAll",pattern:u.pattern,index:p},t:"./docs/error-codes.md#list"});r+1<e.length?l(e,r+1,t,c,d+1,a.concat(t.index),h):h.push(a.concat(t.index))}},h=[];l(d.X,0,null,c,0,[],h);const u=[];for(let t=0;t<h.length;t++)u.push(r(d.pattern,h[t]));return u}}(t,0,s,o);case"$trackDependency":return function(t,e,s,o){return t=>{const e=o.yt?.info??n({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{l:"StateClass.trackDependency",path:t},t:"./docs/error-codes.md#state"});o.Lt.Mt.kt.has(e.pattern)&&e.pattern!==t&&o.Lt.Mt.Et(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>Ss?.navigate(t);case"$component":return o.Lt.se;case"$invoke":return ut(0,0,s,o);case"$wrap":return t=>{const e=ut(0,0,s,o);return()=>e(t)};case"$updateComplete":return o.Vt.oe}const r=K(e),i=nt(r,s,o),c=et(r.info,i);return at(t,c,s,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,s);switch(e){case H:return e=>at(t,e,s,o);case j:return(e,n)=>lt(t,e,n,s,o);case Z:return e=>function(t,e,s,o){if(o.Lt.Mt.At.has(e.info.pattern)||n({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),o.Lt.Wt.startsWith(e.info)&&0===o.Lt.Mt.kt.intersection(e.info.V).size)return o.Lt.Wt.re(e)??[];at(t,e,s,o);const r=o.Lt.Dt(e);null===r&&n({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"});const i=r.Nt;return null===i&&n({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{l:"StateClass.getListIndexesByRef",pattern:e.info.pattern},t:"./docs/error-codes.md#list"}),i}(t,e,s,o);case q:return()=>function(t,e,s){const n=Reflect.get(t,_);if("function"==typeof n)return n.call(s)}(t,0,s);case z:return()=>function(t,e,s){const n=Reflect.get(t,R);if("function"==typeof n)return n.call(s)}(t,0,s);case G:return e=>function(t,e,s){const n=Reflect.get(t,M);if("function"==typeof n){const t=new Set,o={};for(const s of e){const e=s.info.pattern;if(t.add(e),s.info.ot>0){const t=s.wt.index,n=o[e];void 0===n?o[e]=[t]:n.push(t)}}return n.call(s,Array.from(t),o)}}(t,e,s)}}}let mt=class{Lt;Vt;jt;Ht=Array(32).fill(null);_t=-1;yt=null;ie=void 0;symbols=new Set([H,Z]);ce=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,s){this.Lt=t,this.Vt=e,this.jt=s}get(t,e,s){return ft(t,e,s,this)}set(t,e,s,o){n({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{l:"createReadonlyStateProxy.set",ee:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.ce.has(e)}};function pt(t,e,s){return new mt(t,e,s)}function gt(t,e){return new Proxy(t,e)}class wt{Lt;Vt;jt=null;Ht=Array(32).fill(null);_t=-1;yt=null;ie=void 0;symbols=new Set([H,j,Z,q,z,G]);ce=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component","$invoke","$wrap","$updateComplete"]);constructor(t,e){this.Lt=t,this.Vt=e}get(t,e,s){return ft(t,e,s,this)}set(t,e,s,n){return function(t,e,s,n,o){if("string"==typeof e){const r=K(e),i=nt(r,n,o);return lt(t,et(r.info,i),s,n,o),!0}return Reflect.set(t,e,s,n)}(t,e,s,n,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.ce.has(e)}}function xt(t,e,s,o,r){const i=new wt(t,e),c=new Proxy(s,i);return function(t,e,s){let o;if(void 0!==t.ie&&n({code:"STATE-301",message:"already in loop context",context:{l:"setLoopContext",de:!0},t:"/docs/error-codes.md#state",hint:"Ensure handler.loopContext is cleared before invoking setLoopContext again.",o:"error"}),e){t.ie=e,t._t++,t._t>=t.Ht.length&&t.Ht.push(null),t.Ht[t._t]=t.yt=e.ae;try{o=s()}catch(e){throw t.Ht[t._t]=null,t._t--,t.yt=t._t>=0?t.Ht[t._t]:null,t.ie=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.Ht[t._t]=null,t._t--,t.yt=t._t>=0?t.Ht[t._t]:null,t.ie=void 0}));t.Ht[t._t]=null,t._t--,t.yt=t._t>=0?t.Ht[t._t]:null,t.ie=void 0}else{t.ie=e;try{o=s()}catch(e){throw t.ie=void 0,e}if(o instanceof Promise)return o.finally((()=>{t.ie=void 0}));t.ie=void 0}return o}(i,o,(()=>r(c,i)))}const yt=new Set;class bt{he=new Set;ue=new Set;qt=new Map;fe;me;pe=new Set;we=null;xe=null;ye="build";be=[];Se=[];constructor(t,e){this.fe=t,this.me=e}get Ce(){return this.pe}get ve(){return this.be}get Ie(){return this.Se}get $(){return this.we||n({code:"UPD-002",message:"ReadonlyState not initialized",context:{l:"Updater.Renderer.readonlyState"},t:"./docs/error-codes.md#upd"}),this.we}get _(){return this.xe||n({code:"UPD-002",message:"ReadonlyHandler not initialized",context:{l:"Updater.Renderer.readonlyHandler"},t:"./docs/error-codes.md#upd"}),this.xe}get Pe(){return this.ye}Te(t){const e=pt(this.fe,this.me,this),s=gt(this.fe.state,e);this.we=s,this.xe=e;try{return t(s,e)}finally{this.we=null,this.xe=null}}Be(t){this.ue.clear(),this.he.clear(),this.pe=new Set(t),this.Te((()=>{const e=[],s=new Set,o=new Map,r=new Set;for(let i=0;i<t.length;i++){const c=t[i];if(r.add(c),!this.fe.Mt.elements.has(c.info.pattern)){e.push(c),s.add(c.info.pattern);continue}const d=c.xt??n({code:"UPD-004",message:`ParentInfo is null for ref: ${c.key}`,context:{l:"Updater.Renderer.render",Ue:c.key,pattern:c.info.pattern},t:"./docs/error-codes.md#upd"});o.has(d)||o.set(d,new Set),o.get(d).add(c)}for(const[t,e]of o){if(r.has(t)){for(const t of e)this.ue.add(t);continue}const s=this.fe.Ne(t);for(let t=0;t<s.length;t++)this.he.has(s[t])||s[t].B(this);this.ue.add(t)}0===s.intersection(this.fe.Mt.$e).size&&(this.ye="direct");for(let t=0;t<e.length;t++){const s=e[t],o=F(this.fe.Mt._e,s.info);null===o&&n({code:"PATH-101",message:`PathNode not found: ${s.info.pattern}`,context:{l:"Updater.Renderer.render",pattern:s.info.pattern},t:"./docs/error-codes.md#path"}),this.ue.has(s)||this.Re(s,o)}if(this.fe.Me.size>0)for(const t of this.fe.Me){const s=this.fe.Le.get(t)??new Set;for(const t of s)t.T(e)}"direct"!==this.ye&&this.Ee(),this.Ae()}))}Ee(){this.ye="apply";for(let t=0;t<this.be.length;t++)this.be[t].ke.S&&this.be[t].B(this)}Ae(){this.ye="applySelect";for(let t=0;t<this.Se.length;t++)this.Se[t].ke.S&&this.Se[t].B(this)}De(t){const e=s.debug&&s.debugReports.includes("render"),n=e?performance.now():0;if(this.Be(t),e){const t=performance.now(),e={Fe:Array.from(this.pe),Ve:Array.from(this.he),Oe:"update",version:this.me.version,Ot:this.me.Ot,duration:t-n};console.warn("[DebugReport][Render]",e)}}Re(t,e){this.ue.add(t);const s=this.fe.Ne(t);for(let t=0;t<s.length;t++)this.he.has(s[t])||s[t].B(this);let o=yt;if(this.fe.Mt.At.has(t.info.pattern)){const e=new Set(this.$[Z](t)??[]),{Nt:s}=this.qt.get(t)??{},n=new Set(s??[]);o=e.difference(n)}for(const[s,n]of e.ct){const e=A(n.it);if("*"===s)for(const t of o){const s=et(e,t);this.ue.has(s)||this.Re(s,n)}else{const s=et(e,t.wt);this.ue.has(s)||this.Re(s,n)}}const r=this.fe.Mt.We.get(t.info.pattern);if(r)for(const t of r){const e=A(t),s=F(this.fe.Mt._e,e);if(null===s&&n({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{l:"Updater.Renderer.renderItem",pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.ot>0){const t=e.X,n=(o,r,i)=>{const c=this.$[Z](o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const s=et(i,c[e]);n(s,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const n=et(e,c[t]);this.ue.has(n)||this.Re(n,s)}},o=et(e.X[0],null);n(o,0,e.X[1]||null)}else{const t=et(e,null);this.ue.has(t)||this.Re(t,s)}}}He(t){const e=s.debug&&s.debugReports.includes("render"),n=e?performance.now():0;if(this.Te((()=>{t.B(this),this.Ee(),this.Ae()})),e){const t=performance.now(),e={Fe:Array.from(this.pe),Ve:Array.from(this.he),Oe:"initial",version:this.me.version,Ot:this.me.Ot,duration:t-n};console.warn("[DebugReport][Render]",e)}}}function St(t,e,s,n){const o=new bt(e,s);try{o.De(t)}finally{n.resolve()}}class Ct{fe;me;je=Promise.withResolvers();qe;constructor(t,e,s){this.fe=t,this.me=e,this.qe=s,this.ze()}async ze(){const t=[];let e=null,s=!0;for(;null===e;){e=await this.je.promise??null;const s=this.me.Ge();if(0===s.length)continue;const n=Promise.withResolvers();t.push(n.promise);try{St(s,this.fe,this.me,n)}catch(t){console.error("Rendering error:",t),n.reject()}}try{await Promise.all(t)}catch(t){s=!1}finally{e.resolve(s)}}Ze(){this.je.resolve(),this.je=Promise.withResolvers()}terminate(){this.je.resolve(this.qe)}}function vt(t,e,s){return new Ct(t,e,s)}class It{It=0;Qe=[];Je=[];je=null;Ke=null;Xe;constructor(t){this.Xe=t}Ye(){const t=Promise.withResolvers();return this.Qe.push(t),null===this.je?null===this.Ke?this.ze():this.Ke.promise.then((()=>{this.ze()})):this.je.reject(),t}ts(){return this.It++,this.It}es(){const t=this.ts();this.je=Promise.withResolvers(),this.Je=this.Je.concat(...this.Qe),this.Qe=[];const e=[...this.Je],s=this.Je.map((t=>t.promise));return Promise.allSettled(s).then((()=>{this.It===t?(null===this.je&&n({code:"UPD-007",message:"UpdateActivityTracker waitResolver is null.",context:{l:"UpdateActivityTracker.nextWaitPromise"},t:"./docs/error-codes.md#upd"}),this.Je=[],this.je.resolve()):this.Je=this.Je.filter((t=>!e.includes(t)))})),this.je.promise}async ze(){if(null===this.Ke){this.Ke=Promise.withResolvers();try{for(;;){const t=this.es();try{if(await t,this.je=null,0===this.Qe.length&&0===this.Je.length){this.Xe.terminate();break}}catch(t){continue}}}finally{null!==this.Ke&&this.Ke.resolve(),this.Ke=null}}}get ss(){return null!==this.Ke}}function Pt(t){return new It(t)}class Tt{Zt=new Map;ns=[];rs=!1;fe;It;cs=0;ds=[];ls=new Map;qe=Promise.withResolvers();Xe;hs=!0;us;constructor(t){this.fe=t,this.It=t.fs(),this.Xe=vt(t,this,this.qe),this.us=Pt(this.Xe),t.ps.enqueue(this.qe.promise),this.qe.promise.finally((()=>{this.hs=!1}))}get version(){return this.It}get Ot(){return this.cs}get oe(){return this.qe.promise}gs(){this.hs&&n({code:"UPD-006",message:"Updater has already been used. Create a new Updater instance for rebuild.",context:{l:"Updater._rebuild"},t:"./docs/error-codes.md#upd"}),this.hs=!0,this.qe=Promise.withResolvers(),this.It=this.fe.fs(),this.Xe=vt(this.fe,this,this.qe),this.us=Pt(this.Xe),this.fe.ps.enqueue(this.qe.promise),this.qe.promise.finally((()=>{this.hs=!1}))}Jt(t){this.cs++,this.ns.push(t),this.ds.push(t),this.ws(this.fe,t.info.pattern,this.fe.Ft,this.cs),this.Xe.Ze()}xs(t,e,s){const o=xt(this.fe,this,this.fe.state,t,((t,s)=>e(t,s))),r=()=>{if(this.fe.Mt.ys&&this.ds.length>0){const t=this.ds;this.ds=[],queueMicrotask((()=>{const e=this.update(null,(e=>e[G](t)));e instanceof Promise&&e.catch((()=>{n({code:"UPD-005",message:"An error occurred during asynchronous state update.",context:{l:"Updater.update.updatedCallback"},t:"./docs/error-codes.md#upd"})}))}))}else s.resolve()};return o instanceof Promise?o.finally((()=>{r()})):(r(),o)}update(t,e){const n=s.debug&&s.debugReports.includes("update"),o=n?performance.now():0,r=this.us.Ye();return n&&r.promise.finally((()=>{const t={duration:performance.now()-o,version:this.It,Ot:this.cs};console.warn("[DebugReport][update]",t)})),this.xs(t,e,r)}Ge(){const t=this.ns;return this.ns=[],t}He(t){const e=s.debug&&s.debugReports.includes("update"),n=e?performance.now():0,o=this.us.Ye();e&&o.promise.finally((()=>{const t={duration:performance.now()-n,version:this.It,Ot:this.cs};console.warn("[DebugReport][update]",t)}));const r=(i=this.fe,new bt(i,this));var i;try{r.He(t)}finally{o.resolve()}}te(t){this.hs||this.gs();const e=this.us.Ye();try{return t()}finally{e.resolve()}}bs(t,e,s,o,r){if(o.has(e))return;if(r&&t.Mt.elements.has(e))return;o.add(e);for(const[,e]of s.ct.entries()){const s=e.it;this.bs(t,s,e,o,!1)}const i=t.Mt.We.get(e)??[];for(const e of i){const s=V(t.Mt._e,e);null===s&&n({code:"UPD-004",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.recursiveCollectMaybeUpdates",Ss:e},t:"./docs/error-codes.md#upd"}),this.bs(t,e,s,o,!1)}}ws(t,e,s,o){const r=V(t.Mt._e,e);null===r&&n({code:"UPD-003",message:`Path node not found for pattern: ${e}`,context:{l:"Updater.collectMaybeUpdates",path:e},t:"./docs/error-codes.md#upd"});let i=this.ls.get(e);void 0===i&&(i=new Set,this.bs(t,e,r,i,!0));const c={version:this.version,Ot:o};for(const t of i)s.set(t,c);this.ls.set(e,i)}Te(t){const e=pt(this.fe,this,null);return t(gt(this.fe.state,e),e)}}function Bt(t,e){return e(new Tt(t))}class Ut extends I{get value(){return this.node.value}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&n({code:"BIND-201",message:"Checkbox binding has multiple decorators",context:{l:"BindingNodeCheckbox.constructor",name:this.name,Cs:i.length},t:"./docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Lt;this.node.addEventListener(c,(e=>{const s=this.binding.Is.vs;Bt(d,(e=>{e.update(s,((e,s)=>{t.Ps(e,s,this.L)}))}))}))}I(t){Array.isArray(t)||n({code:"BIND-201",message:"Checkbox value is not array",context:{l:"BindingNodeCheckbox.update",Ts:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.checked=t.includes(this.L)}}class Nt extends I{I(t){Array.isArray(t)||n({code:"BIND-201",message:"ClassList value is not array",context:{l:"BindingNodeClassList.update",Ts:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class $t extends I{I(t){"boolean"!=typeof t&&n({code:"BIND-201",message:"ClassName value is not boolean",context:{l:"BindingNodeClassName.update",Ts:typeof t},t:"./docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.m,t)}}const _t={};class Rt extends I{S;constructor(t,e,s,n,o,r){super(t,e,s,n,o,r),this.S=!1;e.addEventListener(this.m,(t=>this.Bs(t)))}update(){}Bs(t){const e=this.binding.Lt,s=this.binding.Is.vs,o=s?.Us().map((t=>t.wt.index))??[],r=this.p;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation();const i=Bt(e,(e=>e.update(s,((e,s)=>{const r=this.binding.N.Ns(e,s);if("function"==typeof r)return Reflect.apply(r,e,[t,...o]);n({code:"BIND-201",message:"Binding value is not a function",context:{l:"BindingNodeEvent.handler",$s:this.name,_s:this.m,Ts:typeof r},t:"./docs/error-codes.md#bind",o:"error"})}))));i instanceof Promise&&i.catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"BIND-202",message:"Event handler rejected",context:{l:"BindingNodeEvent.handler",$s:this.name,_s:this.m},t:"./docs/error-codes.md#bind",o:"error",i:e})}))}B(t){}}const Mt={},Lt=(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=Mt[t]??(Mt[t]=t.slice(2));return new Rt(n,o,t,c,i,s)};class Et extends I{Rs;C;get id(){return this.Rs}constructor(t,e,s,o,r,i){super(t,e,s,o,r,i),this.C=!0;const c=this.node.textContent?.slice(3)??n({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"./docs/error-codes.md#bind",o:"error"}),[d]=c.split(" ",2),a=Number(d);(a.toString()!==d||isNaN(a)||!isFinite(a)||!Number.isInteger(a)||a<0)&&n({code:"BIND-201",message:"Invalid node",context:{l:"BindingNodeBlock.id",textContent:this.node.textContent},t:"./docs/error-codes.md#bind",o:"error"}),this.Rs=a}}class At extends Et{Ms;Ls;Es=[];As;constructor(t,e,s,n,o,r){super(t,e,s,n,o,r);const i=et(A(""),null);this.Ms=je(this.binding,this.id,this.binding.Lt,i),this.Ls=[this.Ms],this.As=this.Es}get v(){return this.As}I(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeIf.assignValue",$s:this.name},t:"./docs/error-codes.md#bind"})}B(t){const e={l:"BindingNodeIf.applyChange",$s:this.name},s=this.binding.N.U(t.$,t._);"boolean"!=typeof s&&n({code:"BIND-201",message:"If binding value is not boolean",context:{...e,Ts:typeof s},t:"./docs/error-codes.md#bind"});const o=this.node.parentNode;null===o&&n({code:"BIND-201",message:"Parent node not found",context:{...e,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),s?(this.Ms.R(),this.Ms.ks(o,this.node),this.Ms.B(t),this.As=this.Ls):(this.Ms.unmount(),this.Ms.M(),this.As=this.Es)}M(){this.Ms.unmount(),this.Ms.M(),this.As=this.Es}}const kt=document.createDocumentFragment();class Dt extends Et{As=[];Ds=new WeakMap;Fs=[];Vs=-1;Os=void 0;Ws=[];Hs=new Set;js=new Map;get v(){return this.As}get qs(){return void 0===this.Os&&(this.Os=A(this.zs)),this.Os}get zs(){return`${this.binding.N.info.pattern}.*`}Gs(){if(this.Vs>=0){const t=this.Fs[this.Vs];return this.Fs[this.Vs]=null,this.Vs--,t}return null}Zs(t){let e=this.Gs();if(null!==e)e.Qs(t);else{const s=et(this.qs,t);e=je(this.binding,this.id,this.binding.Lt,s)}return this.Ds.set(t,e),e.R(),e}Js(t){t.unmount(),t.M()}I(t){n({code:"BIND-301",message:"Binding assignValue not implemented",context:{l:"BindingNodeFor.assignValue"},hint:"Call applyChange to update loop bindings",t:"./docs/error-codes.md#bind"})}Ks(t,e){let s=t.firstChild;for(;s&&s.nodeType===Node.TEXT_NODE&&""===s.textContent?.trim();)s=s.nextSibling;let n=t.lastChild;for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.previousSibling;return s===this.node&&n===e.Xs&&(t.textContent="",t.append(this.node),!0)}Ys(t,e,s,o){const r=[];for(const i of e)if(!t.has(i)){const t=s.get(i);void 0===t&&n({code:"BIND-201",message:"BindContent not found",context:{...o,tn:"initial removes",wt:i.index},t:"./docs/error-codes.md#bind"}),this.Js(t),r.push(t)}return r}en(t){if(-1===this.Vs)return this.Fs=t,void(this.Vs=t.length-1);if(this.Fs.length===this.Vs+1)return t.length>1e3?this.Fs=this.Fs.concat(t):this.Fs.push(...t),void(this.Vs+=t.length);const e=this.Fs.length-(this.Vs+1);if(t.length<=e)for(let e=0;e<t.length;e++)this.Vs++,this.Fs[this.Vs]=t[e];else for(let e=0;e<t.length;e++)this.Vs++,this.Vs>=this.Fs.length?this.Fs.push(t[e]):this.Fs[this.Vs]=t[e]}sn(){for(let t=0;t<this.As.length;t++)this.As[t].M();this.en(this.As),this.As=[]}nn(t,e){const s=e.size,n=t.size;if(0===s&&0===n)return{rn:!1,cn:!1,dn:!1,an:!1};if(0===s)return{rn:!1,cn:!1,dn:!0,an:!0};if(0===n)return{rn:!0,cn:!0,dn:!1,an:!1};let o=0,r=0;for(const s of e)if(t.has(s)?r++:o++,o>0&&r>0)break;const i=o>0,c=0===r;let d=0;for(const s of t)if(!e.has(s)){d++;break}return{rn:i,cn:c,dn:d>0,an:c&&n>0}}ln(t,e,s,o){const r=[],i=[];for(const c of t.Ce){if(c.info.pattern!==e)continue;if(t.ue.has(c))continue;const d=c.wt;null===d&&n({code:"BIND-201",message:"ListIndex is null",context:{...o,hn:c.info.pattern},t:"./docs/error-codes.md#bind"}),s.has(d)?r.push(d):i.push(d),t.ue.add(c)}return{un:r,fn:i}}mn(t,e,s,o,r,i,c,d,a){const l=[];let h=null;this.js.clear();for(let t=0;t<o.length;t++)this.js.set(o[t],t);const u=[];for(let o=0;o<i.length;o++){const d=i[o],f=h?.Xs??s;let m;if(r.has(d)){m=c.get(d),void 0===m&&n({code:"BIND-201",message:"BindContent not found",context:{...a,tn:"reuse",wt:d.index},t:"./docs/error-codes.md#bind"}),f?.nextSibling!==m.pn&&m.ks(e,f);const t=this.js.get(d);void 0!==t&&t!==o&&u.push(d)}else m=this.Zs(d),m.ks(e,f),m.B(t);l.push(m),h=m}for(const e of u){const s=d.get(e)??[];for(const e of s)e.ke.S&&(t.he.has(e)||e.B(t))}return l}gn(t,e,s,o,r,i){const c=s;c.sort(((t,e)=>t.index-e.index));for(const s of c){const c=r.get(s);void 0===c&&n({code:"BIND-201",message:"BindContent not found",context:{...i,tn:"reorder",wt:s.index},t:"./docs/error-codes.md#bind"}),o[s.index]=c;const d=o[s.index-1]?.Xs??e;c.ks(t,d)}}wn(t,e,s,o){for(let r=0;r<e.length;r++){const i=e[r],c=s.get(i);void 0===c&&n({code:"BIND-201",message:"BindContent not found",context:{...o,tn:"overwrites",wt:i.index},t:"./docs/error-codes.md#bind"}),c.B(t)}}xn(t,e,s,o,r,i,c,d){const a=[];if(o.length>r.length){for(let t=r.length;t<o.length;t++){const e=o[t],s=i.get(e);void 0===s&&n({code:"BIND-201",message:"BindContent not found",context:{...d,tn:"optimized replace",wt:e.index},t:"./docs/error-codes.md#bind"}),this.Js(s),a.push(s)}c.length=r.length}const l=Math.min(o.length,r.length);for(let t=0;t<l;t++){const e=r[t],n=c[t];n.Qs(e),n.R(),n.B(s),i.set(e,n)}if(o.length<r.length){let n=t;const i=0===o.length&&t.isConnected;i&&(kt.textContent="",n=kt,n.append(e));let d=null;for(let t=o.length;t<r.length;t++){const o=r[t],i=d?.Xs??e,a=this.Zs(o);a.ks(n,i),a.B(s),c.push(a),d=a}i&&t.append(n)}return a}B(t){const e={l:"BindingNodeFor.applyChange",$s:this.name,yn:this.binding.N.pattern},s=this.node.parentNode??n({code:"BIND-201",message:"Parent node not found",context:{...e,nodeType:this.node.nodeType},t:"./docs/error-codes.md#bind"}),o=t.$[H](this.binding.N.ae);Array.isArray(o)||n({code:"BIND-201",message:"Loop value is not array",context:{...e,Ts:null===o?"null":typeof o},t:"./docs/error-codes.md#bind"});const r=t.$[Z](this.binding.N.ae)??[],i=new Set(r),c=this.nn(i,this.Hs),d=this.ln(t,this.zs,this.Hs,e);let a=!1;if(c.an){const n=this.xn(s,this.node,t,this.Ws,r,this.Ds,this.As,e);n.length>0&&this.en(n),a=!0}let l=!1;if(!a&&c.cn){const t=this.v[this.v.length-1]??n({code:"BIND-201",message:"Last BindContent not found",context:{...e,bn:this.v.length},t:"./docs/error-codes.md#bind"});l=this.Ks(s,t),l&&this.sn()}if(!a&&!l&&c.rn){const t=this.Ys(i,this.Hs,this.Ds,e);if(t.length>0&&(this.en(t),!c.dn)){const e=new Set(t);this.As=this.As.filter((t=>!e.has(t)))}}const h=!c.dn&&!c.rn&&(d.un.length>0||d.fn.length>0);!a&&c.dn?this.As=this.mn(t,s,this.node,this.Ws,this.Hs,r,this.Ds,this.binding.Sn,e):!a&&h&&(d.un.length>0&&this.gn(s,this.node,d.un,this.As,this.Ds,e),d.fn.length>0&&this.wn(t,d.fn,this.Ds,e)),this.Ws=[...r],this.Hs=i}M(){for(let t=0;t<this.As.length;t++){const e=this.As[t];e.unmount(),e.M()}this.en(this.As),this.As=[],this.Ds=new WeakMap,this.Ws=[],this.Hs=new Set}}const Ft=(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Dt(n,o,t,"",i,s)};const Vt={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},Ot={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Wt=new Set(["value","valueAsNumber","valueAsDate"]),Ht=new Set;class jt extends I{constructor(t,e,s,o,r,i){if(super(t,e,s,o,r,i),!(s in e))return void n({code:"BIND-201",message:`Property not found on node: ${s}`,context:{l:"BindingNodeProperty.assignValue",$s:s,nodeType:e.nodeType},t:"./docs/error-codes.md#bind"});if(!(this.node instanceof HTMLElement))return;if(!((c=this.node)instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement))return;var c;const d=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Wt:t instanceof HTMLInputElement?Ot[t.type]??Wt:Ht)(this.node);if(!d.has(this.name))return;i.length>1&&n({code:"BIND-201",message:"Property binding has multiple decorators",context:{l:"BindingNodeProperty.constructor",$s:this.name,Cs:i.length},t:"./docs/error-codes.md#bind"});const a=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Vt[this.name]??"readonly";if("readonly"===a||"ro"===a)return;const l=this.binding.Lt;this.node.addEventListener(a,(e=>{const s=this.binding.Is.vs;Bt(l,(e=>{e.update(s,((e,s)=>{t.Ps(e,s,this.L)}))}))}))}get value(){return this.node[this.name]}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}I(t){let e;e=null==t||Number.isNaN(t)?"":t,this.node[this.name]=e}}const qt=(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new jt(n,o,t,"",i,s)};class zt extends I{constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&n({code:"BIND-201",message:"Radio binding has multiple decorators",context:{l:"BindingNodeRadio.constructor",$s:this.name,Cs:i.length},t:"./docs/error-codes.md#bind"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Lt;this.node.addEventListener(c,(e=>{const s=this.binding.Is.vs;Bt(d,(e=>{e.update(s,((e,s)=>{t.Ps(e,s,this.L)}))}))}))}get value(){return this.node.value}get L(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}I(t){let e;e=null==t?"":t;this.node.checked=e===this.L}}class Gt extends I{I(t){const e=this.node,s=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.style.setProperty(this.m,s.toString())}}const Zt={},Qt="component-state-input",Jt=Symbol.for(`${Qt}.AssignState`),Kt=Symbol.for(`${Qt}.NotifyRedraw`),Xt=new WeakMap;function Yt(t){if(t.tagName.includes("-"))return t.tagName.toLowerCase();const e=t.getAttribute("is");if(e?.includes("-"))return e.toLowerCase();n({code:"COMP-401",message:"Custom element tag name not found",context:{l:"WebComponents.getCustomTagName",tagName:t.tagName,Cn:e??null},t:"./docs/error-codes.md#comp"})}class te extends I{tagName;constructor(t,e,s,o,r,i){super(t,e,s,o,r,i);const c=this.node;c.tagName.includes("-")?this.tagName=c.tagName.toLowerCase():c.getAttribute("is")?.includes("-")?this.tagName=c.getAttribute("is").toLowerCase():n({code:"COMP-401",message:"Custom element tag name not found",context:{l:"BindingNodeComponent.constructor"},t:"./docs/error-codes.md#comp"})}vn(t){const e=this.node,s=Yt(e);customElements.whenDefined(s).then((()=>{e.state[Kt](t)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"COMP-402",message:`Custom element definition failed: ${s}`,context:{l:"BindingNodeComponent._notifyRedraw",tagName:s},t:"./docs/error-codes.md#comp",i:e})}))}T(t){const e=[],s=this.binding.N.ae,n=s.wt,o=(n?.length??0)-1;for(const r of t)r.info.pattern!==s.info.pattern&&r.info.V.has(s.info.pattern)&&(o>=0&&r.wt?.at(o)!==n||e.push(r));0!==e.length&&this.vn(e)}B(t){this.vn([this.binding.N.ae])}R(){const t=this.binding.Lt,e=t.se,s=this.node,o=Yt(s);customElements.whenDefined(o).then((()=>{e.In(s),s.Tn.Pn(this.binding)})).catch((t=>{const e=t instanceof Error?t:new Error(String(t));n({code:"COMP-402",message:`Custom element definition failed: ${o}`,context:{l:"BindingNodeComponent.activate",tagName:o},t:"./docs/error-codes.md#comp",i:e})})),function(t,e){Xt.set(e,t)}(e,s);let r=t.Le.get(s);void 0===r&&t.Le.set(s,r=new Set),r.add(this.binding)}M(){const t=this.binding.Lt;var e;e=this.node,Xt.delete(e);const s=t.Le.get(this.node);void 0!==s&&s.delete(this.binding)}}const ee={},se={0:{class:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Nt(n,o,t,"",i,s)},checkbox:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new Ut(n,o,t,"",i,s)},radio:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new zt(n,o,t,"",i,s)}},1:{if:(t,e,s)=>(n,o,r)=>{const i=v(r,e);return new At(n,o,t,"",i,s)}}},ne={class:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=_t[t]??(_t[t]=t.split(".")[1]);return new $t(n,o,t,c,i,s)},attr:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=T[t]??(T[t]=t.split(".")[1]);return new P(n,o,t,c,i,s)},style:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=Zt[t]??(Zt[t]=t.split(".")[1]);return new Gt(n,o,t,c,i,s)},state:(t,e,s)=>(n,o,r)=>{const i=v(r,e),c=ee[t]??(ee[t]=t.split(".")[1]);return new te(n,o,t,c,i,s)}};const oe={};function re(t,e,s,o){const r=t instanceof Comment,i=t instanceof Element,c=`${r}\t${i}\t${e}`,d=oe[c]??(oe[c]=function(t,e,s){const o=se[t?1:0][s];if(void 0!==o)return o;if(t&&"for"===s)return Ft;t&&n({code:"BIND-106",message:`Comment binding property not supported: ${s}`,context:{l:"BindingBuilder.getBindingNodeCreator",propertyName:s,nodeType:"Comment"},t:"./docs/error-codes.md#bind"});const r=s.split("."),i=ne[r[0]];return void 0!==i?i:e&&s.startsWith("on")?Lt:qt}(r,i,e));return d(e,s,o)}class ie{pattern;info;Bn;constructor(t){this.pattern=t,this.info=A(t),this.Bn=0===this.info.ot?et(this.info,null):null}}const ce={};class de{filters;Un=!1;pattern;info;Nn;$n;_n=null;Rn=null;constructor(t,e,s){this.Nn=ce[e]??(ce[e]=new ie(e)),this.$n=t,this.filters=s,this.pattern=e,this.info=this.Nn.info,this._n=this.Nn.Bn}get wt(){return this.ae.wt}get ae(){return null===this._n&&n({code:"BIND-201",message:"ref is null",context:{l:"BindingState.ref",pattern:this.pattern,ot:this.info.ot},t:"./docs/error-codes.md#bind"}),this._n}Ns(t,e){return at(this.$n.Lt.state,this.ae,t,e)}U(t,e){let s=at(this.$n.Lt.state,this.ae,t,e);for(let t=0;t<this.filters.length;t++)s=this.filters[t](s);return s}I(t,e,s){lt(this.$n.Lt.state,this.ae,s,t,e)}R(){if(this.info.ot>0){const t={l:"BindingState.activate",pattern:this.pattern},e=this.info.tt??n({code:"BIND-201",message:"Wildcard last parentPath is null",context:t,t:"./docs/error-codes.md#bind"});this.Rn=this.$n.Is.vs?.find(e)??n({code:"BIND-201",message:"LoopContext is null",context:{...t,tt:e},t:"./docs/error-codes.md#bind"}),this._n=et(this.info,this.Rn.wt)}this.$n.ke.S&&this.$n.Lt.Mn(this.ae,this.$n)}M(){this.$n.Lt.Ln(this.ae,this.$n),this._n=this.Nn.Bn,this.Rn=null}}class ae{pattern;En;constructor(t){this.pattern=t;const e=Number(t.slice(1));isNaN(e)&&n({code:"BIND-202",message:"Pattern is not a number",context:{l:"BindingStateIndex.constructor",pattern:t},t:"./docs/error-codes.md#bind"}),this.En=e}}const le={};class he{filters;Nn;$n;Rn=null;constructor(t,e,s){this.$n=t,this.Nn=le[e]??(le[e]=new ae(e)),this.filters=s}An(t,e={}){return{l:t,pattern:this.Nn.pattern,En:this.Nn.En,...e}}get pattern(){return n({code:"BIND-301",message:"Binding pattern not implemented",context:this.An("BindingStateIndex.pattern"),t:"./docs/error-codes.md#bind"})}get info(){return n({code:"BIND-301",message:"Binding info not implemented",context:this.An("BindingStateIndex.info"),t:"./docs/error-codes.md#bind"})}get wt(){return this.Rn?.wt??n({code:"LIST-201",message:"listIndex is null",context:this.An("BindingStateIndex.listIndex"),t:"./docs/error-codes.md#list"})}get ae(){return this.Rn?.ae??n({code:"STATE-202",message:"ref is null",context:this.An("BindingStateIndex.ref"),t:"./docs/error-codes.md#state"})}get Un(){return!0}Ns(t,e){return this.wt?.index??n({code:"LIST-201",message:"listIndex is null",context:this.An("BindingStateIndex.getValue"),t:"./docs/error-codes.md#list"})}U(t,e){let s=this.wt?.index??n({code:"LIST-201",message:"listIndex is null",context:this.An("BindingStateIndex.getFilteredValue"),t:"./docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)s=this.filters[t](s);return s}I(t,e,s){n({code:"BIND-301",message:"Binding assignValue not implemented",context:this.An("BindingStateIndex.assignValue"),t:"./docs/error-codes.md#bind"})}R(){const t=this.An("BindingStateIndex.activate"),e=(this.$n.Is.vs??n({code:"BIND-201",message:"LoopContext is null",context:t,t:"./docs/error-codes.md#bind"})).Us();this.Rn=e[this.Nn.En-1]??n({code:"BIND-201",message:"Current loopContext is null",context:this.An("BindingStateIndex.activate",{kn:this.Nn.En-1,Dn:e.length}),t:"./docs/error-codes.md#bind"});const s=this.Rn.Vn?.Fn??null;null===s&&n({code:"BIND-201",message:"Binding for list is null",context:t,t:"./docs/error-codes.md#bind"});const o=s.Sn.get(this.wt);void 0===o?s.Sn.set(this.wt,new Set([this.$n])):o.add(this.$n)}M(){this.Rn=null}}const ue=new RegExp(/^\$\d+$/);function fe(t,e){return ue.test(t)?((t,e)=>(s,n)=>{const o=v(n,e);return new he(s,t,o)})(t,e):((t,e)=>(s,n)=>{const o=v(n,e);return new de(s,t,o)})(t,e)}const me={};function pe(t,e=(t=>`${t.constructor.name}\t${t instanceof Comment?t.textContent?.[2]??"":""}`)(t)){return me[e]??(me[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":n({code:"BIND-105",message:`Node type not supported: ${t.nodeType}`,context:{l:"BindingBuilder.getNodeType",nodeType:t.nodeType,nodeName:t.nodeName,On:t.constructor.name},t:"./docs/error-codes.md#bind"}))(t))}const ge=t=>t.trim(),we=t=>t.length>0,xe=new RegExp(/^#(.*)#$/),ye=t=>{const e=xe.exec(t);return e?decodeURIComponent(e[1]):t},be=t=>{const[e,...s]=t.split(",").map(ge);return{name:e,options:s.map(ye)}},Se=t=>{const[e,...s]=t.split("|").map(ge);return{Wn:e,filters:s.map(be)}},Ce=t=>t.split(";").map(ge).filter(we).map((t=>(t=>{const[e,s=null]=t.split("@").map(ge),n=s?s.split(",").map(ge):[],[o,r]=e.split(":").map(ge),{Wn:i,filters:c}=Se(o),{Wn:d,filters:a}=Se(r);return{Hn:i,jn:d,qn:c,zn:a,p:n}})(t))),ve={};const Ie=t=>{t.removeAttribute("data-bind")},Pe={HTMLElement:Ie,SVGElement:Ie,Text:void 0,Gn:void 0};const Te={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,Gn:void 0,SVGElement:void 0};class Be{nodeType;Zn;Qn;Jn=new Map;constructor(t){this.nodeType=pe(t);const e=function(t,e){switch(t){case"Text":return`textContent:${e.textContent?.slice(3).trim()??""}`;case"HTMLElement":case"SVGElement":return e.getAttribute(B)??"";case"Template":{const t=e.textContent?.slice(3).trim(),[s]=t?.split(" ",2)??[];return Ae(Number(s)).getAttribute(B)??""}default:return""}}(this.nodeType,t),s=function(t,e){return Te[e]?.(t)??t}(t,this.nodeType);!function(t,e){Pe[e]?.(t)}(s,this.nodeType),this.Zn=function(t){let e=[],s=t;for(;null!==s.parentNode;)e=[Array.from(s.parentNode.childNodes).indexOf(s),...e],s=s.parentNode;return e}(s),this.Qn=function(t){return""===t.trim()?[]:ve[t]??(ve[t]=Ce(t))}(e);for(let t=0;t<this.Qn.length;t++){const e=this.Qn[t],n={Kn:re(s,e.Hn,e.qn,e.p),Xn:fe(e.jn,e.zn)};this.Jn.set(e,n)}}}function Ue(t){const e=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(B)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(U)||0===t.textContent?.indexOf(N))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;s.nextNode();)e.push(s.currentNode);return e}const Ne={},$e={},_e={},Re={};function Me(t){return Ue(t).map((t=>function(t){return new Be(t)}(t)))}const Le={};function Ee(t,e,s){var n;return n=e.content,Array.from(n.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||n.removeChild(t)})),function(t,e,s=t){const n=Me(e),o=_e[s]??(_e[s]=new Set),r=$e[s]??($e[s]=new Set),i=Re[s]??(Re[s]=new Set);for(let t=0;t<n.length;t++){const e=n[t];for(let t=0;t<e.Qn.length;t++){const s=e.Qn[t];o.add(s.jn),"for"===s.Hn&&r.add(s.jn),"if"!==s.Hn&&"for"!==s.Hn||i.add(s.jn)}}Ne[t]=n}(t,e.content,s),Le[t]=e,t}function Ae(t){return Le[t]??n({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"Template.getTemplateById",Yn:t},t:"./docs/error-codes.md#tmp"})}class ke{Is;Lt;node;ke;N;Sn=new WeakMap;eo=!1;constructor(t,e,s,n,o){this.Is=t,this.node=e,this.Lt=s,this.ke=n(this,e,s.so),this.N=o(this,s.no)}get v(){return this.ke.v}get isActive(){return this.eo}Ps(t,e,s){this.N.I(t,e,s)}T(t){this.ke.T(t)}B(t){if(!this.ke.S)return;if(t.he.has(this))return;if("build"===t.Pe&&!this.ke.C)return void(this.ke.u?t.Ie.push(this):t.ve.push(this));if("apply"===t.Pe&&(this.ke.C||this.ke.u))return;if("applySelect"===t.Pe&&(this.ke.C||!this.ke.u))return;if("direct"===t.Pe){if(this.ke.u)return void t.Ie.push(this);this.ke.C&&n({code:"BIND-101",message:"Direct render phase cannot process buildable bindings",context:{l:"Binding.applyChange",name:this.ke.name},t:"./docs/error-codes.md#bind"})}t.he.add(this),this.ke.B(t);const e=this.N.ae;if(!this.N.Un&&!this.Lt.Mt.We.has(e.info.pattern)){1===this.Lt.Ne(e).length&&t.ue.add(e)}}R(){this.eo=!0,this.N.R(),this.ke.R()}M(){this.isActive&&(this.ke.M(),this.N.M(),this.eo=!1)}}function De(t,e,s,n,o){return new ke(t,e,s,n,o)}class Fe{info;Vn;_n;oo;ro={};constructor(t,e){this._n=t,this.info=t.info,this.Vn=e}get ae(){return this._n??n({code:"STATE-202",message:"ref is null",context:{l:"LoopContext.ref",path:this.info.pattern},t:"./docs/error-codes.md#state"})}get path(){return this.ae.info.pattern}get wt(){return this.ae.wt??n({code:"LIST-201",message:"listIndex is required",context:{l:"LoopContext.listIndex",path:this.info.pattern},t:"./docs/error-codes.md#list"})}Qs(t){this._n=et(this.info,t)}io(){this._n=null}get co(){if(void 0===this.oo){let t=this.Vn;for(;null!==t;){if(null!==t.ie&&t.ie!==this){this.oo=t.ie;break}t=t.Fn?.Is??null}void 0===this.oo&&(this.oo=null)}return this.oo}find(t){let e=this.ro[t];if(void 0===e)if(this.path===t)e=this.ro[t]=this;else{let s=this.co;for(;null!==s&&s.path!==t;)s=s.co;e=this.ro[t]=s}return e}do(t){t(this);let e=this.co;for(;null!==e;)t(e),e=e.co}Us(){const t=[];return this.do((e=>{t.unshift(e)})),t}}const Ve=document.createDocumentFragment();function Oe(t){const e=Ae(t)??n({code:"TMP-001",message:`Template not found: ${t}`,context:{l:"BindContent.createContent",Yn:t},t:"./docs/error-codes.md#tmp"}),s=document.importNode(e.content,!0);if(Object.keys(gs).length>0){const t=s.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){xs(t[e].tagName.toLowerCase())}}return s}function We(t,e,s,o){const r=(t=>Ne[t])(e)??n({code:"BIND-101",message:"Data-bind not registered",context:{l:"BindContent.createBindings",Yn:e},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],a=y(o,d.Zn)??n({code:"BIND-102",message:`Node not found by nodePath: ${String(d.Zn)}`,context:{l:"BindContent.createBindings",Yn:e,Zn:d.Zn},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.Qn.length;o++){const r=d.Qn[o],c=d.Jn.get(r)??n({code:"BIND-103",message:`Creator not found for bindText: ${String(r)}`,context:{l:"BindContent.createBindings",Yn:e,ao:r},t:"./docs/error-codes.md#bind"}),l=De(t,a,s,c.Kn,c.Xn);i.push(l)}}return i}class He{Fn;ie;id;pn;lo;fragment;childNodes;ho=[];uo=null;eo=!1;fo;constructor(t,e,s,n){this.Fn=t,this.id=e,this.fragment=Oe(e),this.childNodes=Array.from(this.fragment.childNodes),this.pn=this.childNodes[0]??null,this.lo=this.childNodes[this.childNodes.length-1]??null,this.ie=null!==n.wt?new Fe(n,this):null,this.ho=We(this,e,s,this.fragment),this.uo=this.ho.length>0?this.ho[this.ho.length-1]:null}get isActive(){return this.eo}get vs(){if(void 0===this.fo){if(null!==this.ie)return this.fo=this.ie,this.fo;let t=this.Fn?.Is??null;for(;null!==t&&null===t.ie;)t=t.Fn?.Is??null;this.fo=t?.ie??null}return this.fo}get Xs(){if(null!==this.uo&&this.uo.node===this.lo&&this.uo.v.length>0){const t=this.uo.v[this.uo.v.length-1].Xs;if(null!==t)return t}return this.lo}mount(t){let e=t;const s=t.isConnected&&this.childNodes.length>1;s&&(Ve.textContent="",e=Ve);for(let t=0;t<this.childNodes.length;t++)e.appendChild(this.childNodes[t]);s&&t.appendChild(e)}mo(t,e){if(t.isConnected&&this.childNodes.length>1){Ve.textContent="";for(let t=0;t<this.childNodes.length;t++)Ve.appendChild(this.childNodes[t]);t.insertBefore(Ve,e)}else for(let s=0;s<this.childNodes.length;s++)t.insertBefore(this.childNodes[s],e)}ks(t,e){const s=t.isConnected&&this.childNodes.length>1,n=e?.nextSibling??null;if(s){Ve.textContent="";for(let t=0;t<this.childNodes.length;t++)Ve.appendChild(this.childNodes[t]);t.insertBefore(Ve,n)}else for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){this.fo=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}Qs(t){null===this.ie&&n({code:"BIND-201",message:"LoopContext is null",context:{l:"BindContent.assignListIndex",Yn:this.id},t:"./docs/error-codes.md#bind"}),this.ie.Qs(t)}B(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.ho.length;e++){const s=this.ho[e];s.ke.S&&(t.he.has(s)||s.B(t))}}R(){this.eo=!0;for(let t=0;t<this.ho.length;t++)this.ho[t].R()}M(){this.eo=!1,this.ie?.io();for(let t=0;t<this.ho.length;t++)this.ho[t].M()}}function je(t,e,s,n){return new He(t,e,s,n)}function qe(t,e){const s=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,n=s.adoptedStyleSheets;n.includes(e)||(s.adoptedStyleSheets=[...n,e])}function ze(t,e){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}function Ge(t,e,s){"none"===e.shadowDomMode?qe(t,s):"force"===e.shadowDomMode||null===e.po||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.po)?ze(t,s):qe(t,s)}class Ze{wo=new Set;xo=new Set;yo=new Map;bo=new Map;So=new Map;Co=new Map;vo=new WeakSet;Pn(t){if(this.vo.has(t))return;const e=t.N.pattern,s=t.ke.m;this.So.has(e)&&n({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{l:"ComponentStateBinding.addBinding",st:e,Io:this.So.get(e)},t:"./docs/error-codes.md#state"}),this.Co.has(s)&&n({code:"STATE-303",message:`Child path "${s}" already has a parent path`,context:{l:"ComponentStateBinding.addBinding",Po:s,To:this.Co.get(s)},t:"./docs/error-codes.md#state"}),this.So.set(e,s),this.Co.set(s,e),this.xo.add(e),this.wo.add(s),this.yo.set(e,t),this.bo.set(s,t),this.vo.add(t)}Bo(t){return this.So.get(t)}Uo(t){return this.Co.get(t)}No(t){const e=A(t).V.intersection(this.wo);0===e.size&&n({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",Po:t},t:"./docs/error-codes.md#state"});const s=Array.from(e),o=s[s.length-1],r=t.slice(o.length),i=this.Co.get(o);return void 0===i&&n({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{l:"ComponentStateBinding.toParentPathFromChildPath",Po:t,$o:o},t:"./docs/error-codes.md#state"}),i+r}_o(t){const e=A(t).V.intersection(this.xo);0===e.size&&n({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",st:t},t:"./docs/error-codes.md#state"});const s=Array.from(e),o=s[s.length-1],r=t.slice(o.length),i=this.So.get(o);return void 0===i&&n({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{l:"ComponentStateBinding.toChildPathFromParentPath",st:t,$o:o},t:"./docs/error-codes.md#state"}),i+r}Ro(t){if(0===this.wo.size)return null;const e=t.V.intersection(this.wo);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const s=t.Mo(e);for(const t of s??[])this.Pn(t)}}class Qe{Lo;fe;constructor(t,e){this.Lo=e,this.fe=t}Eo(t){Bt(this.fe,(e=>{e.update(null,(e=>{for(const[s,n]of Object.entries(t)){const t=et(A(s),null);e[j](t,n)}}))}))}T(t){Bt(this.fe,(e=>{for(const s of t){let t;try{t=this.Lo._o(s.info.pattern)}catch(t){continue}const o=A(t),r=o.ot-1,i=r>=0?s.wt?.at(r)??null:null;r>=0&&null===i&&n({code:"LIST-201",message:`ListIndex not found for parent ref: ${s.info.pattern}`,context:{l:"ComponentStateInput.notifyRedraw",Ao:s.info.pattern,ko:o.pattern},t:"./docs/error-codes.md#list"});const c=et(o,i);e.Jt(c)}}))}get(t,e,s){if(e===Jt)return this.Eo.bind(this);if(e===Kt)return this.T.bind(this);if("string"==typeof e){const t=et(A(e),null);return this.fe.getPropertyValue(t)}n({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.get",ee:String(e)},t:"./docs/error-codes.md#state"})}set(t,e,s,o){if("string"==typeof e){const t=et(A(e),null);return this.fe.Do(t,s),!0}n({code:"STATE-204",message:`ComponentStateInput property not supported: ${String(e)}`,context:{l:"ComponentStateInput.set",ee:String(e)},t:"./docs/error-codes.md#state"})}}class Je{$n;Fo;Vo=new Set;constructor(t,e){this.$n=t,this.Fo=e}get(t){const e=this.$n.Ro(t.info);null===e&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.get",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.$n.bo.get(e);void 0===s&&n({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.get",Po:e},t:"./docs/error-codes.md#cso"});const o=et(A(this.$n.No(t.info.pattern)),t.wt??s.N.wt);if(!this.Vo.has(o.info.pattern)){const e=this.Fo.Mt.At.has(t.info.pattern);s.Lt.Mt.addPath(o.info.pattern,e),this.Vo.add(o.info.pattern)}return s.Lt.getPropertyValue(o)}set(t,e){const s=this.$n.Ro(t.info);null===s&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.set",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const o=this.$n.bo.get(s);void 0===o&&n({code:"CSO-102",message:`Child binding not registered: ${s}`,context:{l:"ComponentStateOutput.set",Po:s},t:"./docs/error-codes.md#cso"});const r=et(A(this.$n.No(t.info.pattern)),t.wt??o.N.wt);if(!this.Vo.has(r.info.pattern)){const e=this.Fo.Mt.At.has(t.info.pattern);o.Lt.Mt.addPath(r.info.pattern,e),this.Vo.add(r.info.pattern)}return o.Lt.Do(r,e),!0}startsWith(t){return null!==this.$n.Ro(t)}re(t){const e=this.$n.Ro(t.info);null===e&&n({code:"CSO-101",message:`Child path not found: ${t.info.pattern}`,context:{l:"ComponentStateOutput.getListIndexes",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.$n.bo.get(e);void 0===s&&n({code:"CSO-102",message:`Child binding not registered: ${e}`,context:{l:"ComponentStateOutput.getListIndexes",Po:e},t:"./docs/error-codes.md#cso"});const o=et(A(this.$n.No(t.info.pattern)),t.wt);if(!this.Vo.has(o.info.pattern)){const e=this.Fo.Mt.At.has(t.info.pattern);s.Lt.Mt.addPath(o.info.pattern,e),this.Vo.add(o.info.pattern)}return s.Lt.re(o)}}class Ke{ns=[];Oo=!1;get Wo(){return this.ns.length>0?this.ns[0]:null}get Ho(){return this.Wo?this.Wo.jo.promise:null}async qo(t){const e=this.Wo??n({code:"UPD-301",message:"No item in update complete queue to process",context:{l:"CompleteQueue.processNext"},t:"./docs/error-codes.md#upd"});let s=!1;try{s=await e.zo}finally{this.ns.shift(),e.jo.resolve(s),t.resolve()}}async Go(){if(!this.Oo){this.Oo=!0;try{for(;this.ns.length>0;){const t=Promise.withResolvers();queueMicrotask((()=>{this.qo(t)})),await t.promise}}finally{this.Oo=!1}}}enqueue(t){this.ns.push({zo:t,jo:Promise.withResolvers()}),this.Oo||this.Go()}}class Xe{type="autonomous";config;Zo;styleSheet;Qo;state;so;no;Jo=HTMLElement;se;Mt;Ko=Promise.withResolvers();Xo;Wt;Tn;Le=new WeakMap;Me=new Set;Ft=new Map;ps=function(){return new Ke}();Ms=null;Yo=null;tr=null;er=!1;sr=0;nr=new WeakMap;constructor(t,e){this.config=t,this.config.po&&(this.type="builtin");const s=e.constructor;var n;this.Zo=s.Zo,this.styleSheet=s.styleSheet,this.Qo=s.Qo,this.state=new this.Qo,this.so=s.so,this.no=s.no,this.se=e,this.Tn=new Ze,this.Xo=function(t,e){const s=new Qe(t,e);return new Proxy({},s)}(this,this.Tn),this.Wt=(n=this.Tn,new Je(n,this)),this.Mt=s.Mt}get Vn(){return null===this.Ms&&n({code:"BIND-201",message:"BindContent not initialized yet",context:{l:"ComponentEngine.bindContent.get",rr:this.se.constructor.id},t:"./docs/error-codes.md#bind"}),this.Ms}get ir(){return this.sr}fs(){return++this.sr}cr(){for(const t in this.state)$.has(t)||this.Mt.dr.has(t)||(this.Mt.dr.add(t),O(this.Mt._e,t));const t=this.se.constructor,e=et(A(""),null);this.Ms=je(null,t.id,this,e)}connectedCallback(){if(this.config.ar)Ge(this.se,this.config,this.styleSheet);else{this.tr=this.se.parentNode,this.Yo=document.createComment("Structive block placeholder"),this.er=!0;try{this.se.replaceWith(this.Yo)}finally{this.er=!1}}if(this.config.ar)this.Vn.mount(this.se.shadowRoot??this.se);else{const t=this.tr??n({code:"BIND-201",message:"Block parent node not set",context:{l:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.Vn.ks(t,this.Yo)}if(this.se.dataset.state)try{const t=JSON.parse(this.se.dataset.state);this.Xo[Jt](t)}catch(t){n({code:"STATE-202",message:"Failed to parse state from dataset",context:{l:"ComponentEngine.connectedCallback",lr:this.se.dataset.state},t:"./docs/error-codes.md#state",i:t})}if(this.Vn.R(),Bt(this,(t=>{t.He(this.Vn)})),this.Mt.hr){const t=Bt(this,(t=>t.update(null,(t=>t[q]()))));t instanceof Promise?t.finally((()=>{this.Ko.resolve()})).catch((()=>{n({code:"COMP-301",message:"Connected callback failed",context:{l:"ComponentEngine.connectedCallback"},t:"./docs/error-codes.md#comp"})})):this.Ko.resolve()}else this.Ko.resolve()}disconnectedCallback(){if(!this.er)try{this.Mt.ur&&Bt(this,(t=>{t.update(null,(t=>{t[z]()}))}))}catch(t){n({code:"COMP-302",message:"Disconnected callback failed",context:{l:"ComponentEngine.disconnectedCallback"},t:"./docs/error-codes.md#comp",i:t})}finally{this.se.pr?.mr(this.se),this.config.ar||(this.Yo?.remove(),this.Yo=null,this.tr=null),this.Vn.M()}}re(t){if(this.Wt.startsWith(t.info))return this.Wt.re(t);let e=null;return Bt(this,(s=>e=s.Te((e=>e[Z](t))))),e}getPropertyValue(t){let e;return Bt(this,(s=>{e=s.Te((e=>e[H](t)))})),e}Do(t,e){Bt(this,(s=>{s.update(null,(s=>{s[j](t,e)}))}))}In(t){this.Me.add(t)}mr(t){this.Me.delete(t)}Dt(t){return this.nr.get(t)?.gr??null}zt(t,e){const s=this.nr.get(t);void 0===s?this.nr.set(t,{ho:[],gr:e}):s.gr=e}Ne(t){return this.nr.get(t)?.ho??[]}Mn(t,e){const s=this.nr.get(t);void 0===s?this.nr.set(t,{ho:[e],gr:null}):s.ho.push(e)}Ln(t,e){const s=this.nr.get(t);if(void 0!==s){const t=s.ho.indexOf(e);t>=0&&s.ho.splice(t,1)}}}const Ye=/\{\{([^}]+)\}\}/g;const ts="http://www.w3.org/2000/svg";function es(t,e,n=t){let o=e;const r=o.getAttribute(B),i=s.debug?r??"":"";if(o.parentNode?.replaceChild(document.createComment(`${N}${t} ${i}`),o),o.namespaceURI===ts){const t=document.createElement("template"),e=Array.from(o.childNodes);for(let s=0;s<e.length;s++){const n=e[s];t.content.appendChild(n)}t.setAttribute(B,r??""),o=t}return o.content.querySelectorAll("template").forEach((t=>{es(p(),t,n)})),Ee(t,o,n),t}function ss(t,e){const s=document.createElement("template");s.dataset.id=t.toString(),s.innerHTML=function(t){const e=[];return t.replaceAll(Ye,((t,s)=>{const o=s.trim(),[r]=o.split(":");if("if"!==r&&"for"!==r&&"endif"!==r&&"endfor"!==r&&"elseif"!==r&&"else"!==r)return`\x3c!--${U}${o}--\x3e`;const i=o.slice(r.length+1).trim(),c={type:r,wr:o,yr:i};if("if"===r||"for"===r)return e.push(c),`<template data-bind="${o}">`;if("endif"===r){const t=[];for(0===e.length&&n({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",wr:o,br:e.length},t:"./docs/error-codes.md#tmp"});e.length>0;){const s=e.pop();if("if"===s.type){t.push("</template>");break}"elseif"===s.type?t.push("</template>"):n({code:"TMP-102",message:"Endif without if",context:{l:"Template.replaceMustacheWithTemplateTag",Sr:s.type,wr:o},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===r){const t=e.pop()??n({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",wr:o,br:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";n({code:"TMP-102",message:"Endfor without for",context:{l:"Template.replaceMustacheWithTemplateTag",Sr:t.type,wr:o},t:"./docs/error-codes.md#tmp"})}else if("elseif"===r){const t=e.at(-1)??n({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",wr:o,br:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(c),`</template><template data-bind="if:${t.yr}|not"><template data-bind="if:${i}">`;n({code:"TMP-102",message:"Elseif without if",context:{l:"Template.replaceMustacheWithTemplateTag",Sr:t.type,wr:o},t:"./docs/error-codes.md#tmp"})}else if("else"===r){const t=e.at(-1)??n({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",wr:o,br:e.length},t:"./docs/error-codes.md#tmp"});return"if"===t.type?`</template><template data-bind="if:${t.yr}|not">`:n({code:"TMP-102",message:"Else without if",context:{l:"Template.replaceMustacheWithTemplateTag",Sr:t.type,wr:o},t:"./docs/error-codes.md#tmp"})}return n({code:"TMP-102",message:"Unreachable: All Mustache types should be handled by preceding branches",context:{l:"Template.replaceMustacheWithTemplateTag",wr:o,br:e.length},t:"./docs/error-codes.md#tmp"})}))}(e),es(t,s)}const ns=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,os=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function rs(t,e){const s={l:"StateProperty.createAccessorFunctions",pattern:t.pattern},o=new Set(t.F).intersection(e);let r=-1,i="";for(const t of o){const e=t.split(".");1!==e.length&&(e.length>r&&(r=e.length,i=t))}if(i.length>0){os.test(i)||n({code:"STATE-202",message:`Invalid path: ${i}`,context:{...s,Cr:i},t:"./docs/error-codes.md#state"});const e=A(i),o=[];let r=e.ot;for(let c=e.k.length;c<t.k.length;c++){const e=t.k[c];"*"===e?(o.push(`[this.$${r+1}]`),r++):(ns.test(e)||n({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{...s,vr:e,Cr:i},t:"./docs/error-codes.md#state"}),o.push(`.${e}`))}const c=o.join(""),d=`this["${i}"]${c} = value;`;return{get:new Function("",`return this["${i}"]${c};`),set:new Function("value",d)}}{const e=[];let o=0;for(let r=0;r<t.k.length;r++){const i=t.k[r];"*"===i?(e.push(`[this.$${o+1}]`),o++):(ns.test(i)||n({code:"STATE-202",message:`Invalid segment name: ${i}`,context:{...s,vr:i},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+i))}const r=e.join(""),i=`this.${r} = value;`;return{get:new Function("",`return this.${r};`),set:new Function("value",i)}}}class is{dr=new Set;At=new Set;$e=new Set;elements=new Set;Ir=new Set;kt=new Set;Rt=new Set;Qt=new Set;Pr=new Set;Tr=new Set;Br=new Map;We=new Map;_e=function(){return new k("","",0)}();hr=!1;ur=!1;ys=!1;Rs;Ur;Nr=new Set;constructor(t){this.Rs=t.id,this.Ur=t.Qo;const e=(t=>_e[t]??new Set)(this.Rs),s=new Set;for(const t of e){const e=A(t);this.dr=this.dr.union(e.V);for(const t of e.V){const e=A(t);"*"===e.D&&s.add(e.st)}}const n=(t=>$e[t]??new Set)(this.Rs);this.At=this.At.union(n).union(s);for(const t of this.At){const e=`${t}.*`;this.elements.add(e)}const o=(t=>Re[t]??new Set)(this.Rs);this.$e=this.$e.union(o);let r=this.Ur.prototype;for(;r&&r!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(r);if(t)for(const[e,s]of Object.entries(t)){if($.has(e))continue;if("function"==typeof s.value){this.Ir.add(e),e===_&&(this.hr=!0),e===R&&(this.ur=!0),e===M&&(this.ys=!0);continue}const t=void 0!==s.get,n=void 0!==s.set,o=A(e);this.dr=this.dr.union(o.V),t&&this.kt.add(e),n&&this.Qt.add(e),t&&!n&&this.Rt.add(e),t&&n&&this.Pr.add(e)}r=Object.getPrototypeOf(r)}for(const t of this.dr){if(this.kt.has(t))continue;if(this.Qt.has(t))continue;const e=A(t);if(1===e.k.length)continue;const s=rs(e,this.kt);Object.defineProperty(this.Ur.prototype,t,{get:s.get,set:s.set,enumerable:!0,configurable:!0}),this.Tr.add(t)}for(const t of this.dr){O(this._e,t);const e=A(t);if(e.st){const s=this.Br.get(e.st);void 0!==s?s.add(t):this.Br.set(e.st,new Set([t]))}}}addPath(t,e=!1){const s=A(t);if(e&&!this.At.has(t)){this.At.add(t);const e=`${t}.*`;this.elements.add(e)}else"*"===s.D&&(this.elements.add(t),this.At.add(s.st));for(const t of s.V){if(this.dr.has(t))continue;this.dr.add(t),O(this._e,t);const e=A(t);if("*"===e.D&&(this.elements.add(t),this.At.add(e.st)),e.k.length>1){const s=rs(e,this.kt);Object.defineProperty(this.Ur.prototype,t,{get:s.get,set:s.set,enumerable:!0,configurable:!0}),this.Tr.add(t)}if(e.st){const s=this.Br.get(e.st);void 0!==s?s.add(t):this.Br.set(e.st,new Set([t]))}}}Et(t,e){const s=`${e}=>${t}`;if(this.Nr.has(s))return;this.dr.has(e)||this.addPath(e),this.Nr.add(s);const n=this.We.get(e);void 0!==n?n.add(t):this.We.set(e,new Set([t]))}}function cs(t){const s=function(t){const s=e();return{ar:void 0===t.ar||t.ar,shadowDomMode:t.shadowDomMode??s.shadowDomMode,po:t.po??null}}(t.Qo.$r??{}),o=p(),{_r:r,Rr:i,Qo:c}=t,d=Object.assign({},f),a=Object.assign({},u);c.Mr=!0,ss(o,r),x(o,i),function(t,e){g[t]=e}(o,c);const l=function(t){return t?document.createElement(t).constructor:HTMLElement}(s.po),h=s.po;return class extends l{static define(t){h?customElements.define(t,this,{po:h}):customElements.define(t,this)}static get id(){return o}static Lr=r;static get _r(){return this.Lr}static set _r(t){this.Lr=t,ss(this.id,t),this.Er=null,this.Ar=null}static kr=i;static get Rr(){return this.kr}static set Rr(t){this.kr=t,x(this.id,t),this.Dr=null}static Er=null;static get Zo(){return this.Er||(this.Er=Ae(this.id)),this.Er}static Dr=null;static get styleSheet(){return this.Dr||(this.Dr=function(t){return w[t]??n({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{l:"StyleSheet.getStyleSheetById",Fr:t},t:"./docs/error-codes.md#css"})}(this.id)),this.Dr}static Ur=null;static get Qo(){return this.Ur||(this.Ur=function(t){return g[t]??n({code:"STATE-101",message:`StateClass not found: ${t}`,context:{l:"StateClass.getStateClassById",Vr:t},t:"./docs/error-codes.md#state"})}(this.id)),this.Ur}static Or=d;static get so(){return this.Or}static Wr=a;static get no(){return this.Wr}static Ar=null;static get Mt(){return this.Ar||(this.Ar=new is(this)),this.Ar}fe;Hr;constructor(){super(),this.fe=function(t,e){return new Xe(t,e)}(s,this),this.fe.cr()}connectedCallback(){this.fe.connectedCallback()}disconnectedCallback(){this.fe.disconnectedCallback()}get pr(){var t;return void 0===this.Hr&&(this.Hr=(t=this,Xt.get(t)??null)),this.Hr}get state(){return this.fe.Xo}get Tn(){return this.fe.Tn}get jr(){return this.fe.Qo.Mr??!1}get Ko(){return this.fe.Ko}get oe(){return this.fe.ps.Ho}Mo(t){return this.fe.Le.get(t)??null}In(t){this.fe.In(t)}mr(t){this.fe.mr(t)}}}function ds(t){return t.replaceAll(/<!--\{\{([^}]+)}}-->/g,((t,e)=>`{{${e}}}`))}function as(t,e,n){if(!s.debug)return;const o=n?` (${n})`:"";console.warn(`[Structive][SFC] Missing <${t}> section in ${e}${o}`)}let ls=0;async function hs(t){const e=import.meta.resolve?import.meta.resolve(t):t,s="./docs/error-codes.md#imp-202-component-load-failed";let o="";try{const r=await fetch(e);r.ok||n({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,qr:e,status:r.status,statusText:r.statusText,url:r.url},hint:"Make sure the import map entry points to a reachable SFC and the server returns a 2xx status.",t:s}),o=await r.text()}catch(o){n({code:"IMP-202",message:`Failed to load component from ${t}`,context:{l:"WebComponents.loadSingleFileComponent",path:t,qr:e},hint:"Confirm the SFC path is correct and accessible before bootstrapping.",t:s,i:o})}return async function(t,e){const s=document.createElement("template");s.innerHTML=function(t){return t.replaceAll(/\{\{([^}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(e);const n=s.content.querySelector("template");n||as("template",t),n?.remove();const o=s.content.querySelector("script[type=module]");let r={};if(o){const e=`\n// uniq id: ${ls++}\n//# sourceURL=${t}\n`;if("function"==typeof URL.createObjectURL){const t=new Blob([o.text+e],{type:"application/javascript"}),s=URL.createObjectURL(t);try{r=await import(s)}finally{URL.revokeObjectURL(s)}}else{const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(o.text+e)));r=await import(`data:application/javascript;base64,${t}`)}}else as("script",t,'expects <script type="module">');o?.remove();const i=s.content.querySelector("style");i||as("style",t),i?.remove();const c=r.default??class{};return{text:e,_r:ds(n?.innerHTML??"").trim(),Rr:i?.textContent??"",Qo:c}}(t,o)}function us(t,e){e.define(t)}const fs="@routes/",ms="@components/",ps="#lazy",gs={};async function ws(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const s=JSON.parse(e.innerHTML);s.imports&&(t.imports=Object.assign(t.imports||{},s.imports))})),t}();if(t.imports){const e=new Map;for(const[s,n]of Object.entries(t.imports)){let t,n;if(s.startsWith(fs)){n=s.endsWith(ps);const e=s.slice(7,n?-5:void 0);t=`routes${e.replace(/:[^\s/]+/g,"").replace(/\//g,"-")}`,vs(t,"/root"===e?"/":e)}s.startsWith(ms)&&(n=s.endsWith(ps),t=s.slice(12,n?-5:void 0)),t&&(n?gs[t]=s:e.set(t,s))}for(const[t,s]of e.entries()){us(t,cs(await hs(s)))}}}function xs(t){const e=gs[t];if(e)delete gs[t],queueMicrotask((()=>{hs(e).then((e=>{const s=cs(e);us(t,s)})).catch((s=>{n({code:"IMP-202",message:`Failed to load lazy component for tagName: ${t}`,context:{l:"WebComponents.loadFromImportMap.loadLazyLoadComponent",tagName:t,zr:e,Gr:s instanceof Error?s.message:String(s)},t:"./docs/error-codes.md#imp",o:"error"})}))}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{l:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const ys="routes:",bs=[];let Ss=null;class Cs extends HTMLElement{Zr=window.location.pathname.split("/").pop()||"";Qr=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Jr;constructor(){super(),this.Jr=this.Kr.bind(this)}connectedCallback(){Ss=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Jr),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Jr),Ss=null}Kr(t){t.preventDefault(),this.De()}navigate(t){const e="/"===t[0]?this.Qr+t.slice(1):t;history.pushState({},"",e),this.De()}De(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Zr&&(t[t.length-1]="");const e=t.join("/").replace(this.Qr,""),s="/"!==e[0]?`/${e}`:e;let n;const o={};for(const[t,e]of bs){const r=new RegExp(`^${t.replace(/:[^\s/]+/g,"([^/]+)")}$`);if(r.test(s)){n=e;const i=s.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(n){const t=document.createElement(n);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return t in gs}(n)&&xs(n)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function vs(t,e){let s;s=e.startsWith(ys)?e.substring(ys.length):e,bs.push([s,t])}const Is="router",Ps=`<slot name="${Is}"></slot>`;class Ts extends HTMLElement{constructor(){super(),"none"!==s.shadowDomMode&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Xr(),this.De()}get root(){return this.shadowRoot??this}async Xr(){if(s.layoutPath){const t=await fetch(s.layoutPath);if(t.ok){const e=await t.text(),s=document.createElement("template");s.innerHTML=e;const n=s.content.querySelector("template"),o=s.content.querySelector("style");if(this.root.appendChild(n?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else n({code:"TMP-101",message:`Failed to load layout from ${s.layoutPath}`,context:{l:"MainWrapper.loadLayout",layoutPath:s.layoutPath},t:"./docs/error-codes.md#tmp"})}else this.root.innerHTML=Ps}De(){if(s.enableRouter){const t=document.createElement(s.routerTagName);t.setAttribute("slot",Is),this.root.appendChild(t)}}}const Bs=s;let Us=!1;async function Ns(t){await async function(t){for(const[e,n]of Object.entries(t)){let t=null;if(s.enableRouter){const t=n.startsWith("@routes")?n.slice(7):n;vs(e,"/root"===t?"/":t)}t=await hs(n),us(e,cs(t))}}(t),Bs.autoInit&&await $s()}async function $s(){Us||(await async function(){if(s.autoLoadFromImportMap&&await ws(),s.enableRouter&&customElements.define(s.routerTagName,Cs),s.enableMainWrapper&&(customElements.define(s.mainTagName,Ts),s.autoInsertMainWrapper)){const t=document.createElement(s.mainTagName);document.body.appendChild(t)}}(),Us=!0)}export{$s as bootstrapStructive,Bs as config,Ns as defineComponents};
//# sourceMappingURL=structive.min.mjs.map
