const t={debug:!1,locale:"en-US",shadowDomMode:"auto",enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:r,o:i,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),r&&(d.t=r),i&&(d.o=i),c&&(d.i=c),d}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const d=e(),l={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&r("ne"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&r("lt"),t=>("number"!=typeof t&&i("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&r("le"),t=>("number"!=typeof t&&i("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&r("gt"),t=>("number"!=typeof t&&i("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&r("ge"),t=>("number"!=typeof t&&i("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&r("inc"),t=>("number"!=typeof t&&i("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&r("dec"),t=>("number"!=typeof t&&i("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&r("mul"),t=>("number"!=typeof t&&i("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&r("div"),t=>("number"!=typeof t&&i("div"),t/n)},mod:t=>{const e=t?.[0]??o("mod"),n=Number(e);return isNaN(n)&&r("mod"),t=>("number"!=typeof t&&i("mod"),t%n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("fix"),t=>("number"!=typeof t&&i("fix"),t.toFixed(e))},locale:t=>{const e=t?.[0]??d.locale;return t=>("number"!=typeof t&&i("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&r("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&r("substr");const s=t?.[1]??o("substr"),i=Number(s);return isNaN(i)&&r("substr"),t=>t.toString().substr(n,i)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&r("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&r("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("round"),t=>("number"!=typeof t&&i("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("floor"),t=>("number"!=typeof t&&i("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&r("ceil"),t=>("number"!=typeof t&&i("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&r("percent"),t=>("number"!=typeof t&&i("percent"),(100*t).toFixed(e)+"%")},date:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??d.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},a=l,h=l;let u=0;function f(){return++u}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function y(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{h:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const x=new Map;function b(t,e){let n=x.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(y(t,e[s]));x.set(e,n)}return n}class N{u;m;p;N;S;v;get node(){return this.m}get name(){return this.p}get I(){return this.N}get binding(){return this.u}get C(){return this.v}get filters(){return this.S}get T(){return[]}constructor(t,e,n,s,o,r){this.u=t,this.m=e,this.p=n,this.N=s,this.S=o,this.v=r}B(t){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}U(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}P(t){}$(t){const e=this.binding.M.L(t.D,t.R);this.B(e)}k(){}A(){}get _(){return this.node instanceof HTMLSelectElement}get value(){return null}get F(){return null}}class S extends N{B(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.I,t.toString())}}const v="data-bind",I="@@:",C="@@|",T=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),B="$connectedCallback",U="$disconnectedCallback",P="$updatedCallback",$={};class L{static id=0;id=++L.id;V=this.id.toString();pattern;O;W;H;j;q;G;Z;J;K;X;Y;tt;et;nt;st;ot;rt;it;ct;dt;children={};constructor(t){const e=e=>t===e?this:M(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],l=[];let a="",h="",u=0;for(let t=0;t<n.length;t++)a+=n[t],"*"===n[t]&&(r.push(a),i[a]=u,c.push(e(a)),d.push(h),l.push(e(h)),u++),s.push(a),o.push(e(a)),h=a,a+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.O=n,this.W=n[n.length-1],this.H=s,this.j=new Set(s),this.q=o,this.G=new Set(o),this.Z=r,this.J=new Set(r),this.X=i,this.K=c,this.Y=new Set(c),this.tt=d,this.et=new Set(d),this.nt=l,this.st=new Set(l),this.ot=f,this.rt=f?e(f):null,this.it=m,this.ct=m?e(m):null,this.dt=u,this.ct&&(this.ct.children[this.W]=this)}}function M(t){T.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{h:"getStructuredPathInfo",ht:t},t:"./docs/error-codes.md#state"});const e=$[t];return void 0!==e?e:$[t]=new L(t)}class E{it;ut;name;ft;level;constructor(t,e,n){this.it=t,this.ut=t?t+"."+e:e,this.name=e,this.level=n,this.ft=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.ft.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.ft.get(t);if(!e){const n=this.it?this.it+"."+this.name:this.name;e=new E(n,t,this.level+1),this.ft.set(t,e)}return e}}const D=new Map;function R(t,e){let n=D.get(t);n||(n=new Map,D.set(t,n));let s=n.get(e)??null;if(s)return s;const o=M(e);return s=t.find(o.O),n.set(e,s),s}function k(t,e){const n=M(e);if(null===n.it)return t.appendChild(e);{let e=R(t,n.it);return null===e&&(e=k(t,n.it)),e.appendChild(n.W)}}const A="state",_=Symbol.for(`${A}.GetByRef`),F=Symbol.for(`${A}.SetByRef`),V=Symbol.for(`${A}.ConnectedCallback`),O=Symbol.for(`${A}.DisconnectedCallback`),W=Symbol.for(`${A}.UpdatedCallback`),H=Symbol.for(`${A}.GetListIndexesByRef`),j=new Map;class q{static id=0;id=++q.id;name;elements;wt;dt;yt;xt;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none",l=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",l.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",l.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const a=M(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.wt=s,this.dt=c,this.yt=d,this.xt=l,this.info=a}}function z(t){let e;return j.get(t)??(j.set(t,e=new q(t)),e)}class G{info;#t;get bt(){return null===this.#t?null:this.#t.deref()??s({code:"LIST-201",message:"listIndex is null",context:{V:this.info.V,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#t=null!==e?new WeakRef(e):null,this.key=null==e?t.V:t.V+"#"+e.V}get Nt(){const t=this.info.ct;if(!t)return null;return K(t,(this.info.dt>t.dt?this.bt?.at(-2):this.bt)??null)}}const Z=new WeakMap,J={};function K(t,e){let n=null;if(null!==e){let s;if(void 0===(s=Z.get(e)))n=new G(t,e),Z.set(e,{[t.pattern]:n});else if(void 0===(n=s[t.pattern]))return s[t.pattern]=new G(t,e)}else if(void 0===(n=J[t.pattern]))return J[t.pattern]=new G(t,null);return n}function Q(t,e){const n=t.St;if(null==n)return null;if(null==n.info)return null;if(null==n.bt)return null;const s=n.info.X[e];return void 0!==s?n.bt.at(s):null}function X(t,e,n){switch(t.yt){case"none":return null;case"context":return Q(n,t.info.ot??s({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let o=null;for(let n=0;n<t.info.dt;n++){const r=t.info.nt[n]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"}),i=K(r,o),c=e[H](i)??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",vt:r.pattern},t:"/docs/error-codes.md#list"}),d=t.xt[n]??s({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"});o=c[d]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",vt:r.pattern,It:d},t:"/docs/error-codes.md#list"})}return o;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const Y={};for(let t=0;t<32;t++)Y[`$${t+1}`]=t;let tt=0,et=0;class nt{#e=null;#n=0;#s=0;#o;#r=++et;#i=this.#r.toString();constructor(t,e){this.#e=t,this.#n=t?t.position+1:0,this.#s=e,this.#o=tt}get Ct(){return this.#e}get id(){return this.#r}get V(){return this.#i}get position(){return this.#n}get length(){return this.#n+1}get index(){return this.#s}set index(t){this.#s=t,this.#o=++tt,this.Tt[this.#n]=t}get version(){return this.#o}get Bt(){return null!==this.#e&&(this.#e.Bt||this.#e.version>this.#o)}#c;get Tt(){return null===this.#e?void 0===this.#c&&(this.#c=[this.#s]):(void 0===this.#c||this.Bt)&&(this.#c=[...this.#e.Tt,this.#s],this.#o=tt),this.#c}#d;get Ut(){return null===this.#e?void 0===this.#d&&(this.#d=[new WeakRef(this)]):void 0===this.#d&&(this.#d=[...this.#e.Ut,new WeakRef(this)]),this.#d}get Pt(){return`${this.position+1}`}at(t){return t>=0?this.Ut[t]?.deref()||null:this.Ut[this.Ut.length+t]?.deref()||null}}function st(t,e){return new nt(t,e)}function ot(t,e,n,o){let r;!function(t,e){if(t.$t>=0){const n=t.St?.info??null;null!==n&&t.Et.Mt.Lt.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Et.Mt.Dt(n.pattern,e.info.pattern)}}(o,e);const i=o.Et.Mt.Rt.has(e.info.pattern),c=e.info.dt>0||o.Et.Mt.kt.has(e.info.pattern);let d=null;if(c||i){d=o.Et.At(e);const t=o.Et._t.get(e.info.pattern);if(null!==d){if(void 0===t)return d.value;if(d.version>o.Ft.version)return d.value;if(!(d.version<t.version||d.Vt<t.Vt))return d.value}}if(o.Et.Ot.startsWith(e.info)&&0===o.Et.Mt.kt.intersection(e.info.j).size)return o.Et.Ot.get(e);if(e.info.pattern in t){0===o.Wt.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),o.$t++,o.$t>=o.Wt.length&&o.Wt.push(null),o.Wt[o.$t]=o.St=e;try{return r=Reflect.get(t,e.info.pattern,n)}finally{if(o.Wt[o.$t]=null,o.$t--,o.St=o.$t>=0?o.Wt[o.$t]:null,c||i){let t=null;if(i){if(null!==o.Ht&&!o.Ht.jt.has(e)){const t={Ut:d?.Ut??[],value:d?.value};o.Ht.jt.set(e,t)}t=function(t,e,n,s){e=Array.isArray(e)?e:[];const o=[];if(0===(n=Array.isArray(n)?n:[]).length)return[];if(0===e.length){for(let e=0;e<n.length;e++){const n=st(t,e);o.push(n)}return o}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,n))return s;const r=new Map;for(let t=0;t<e.length;t++)r.set(e[t],t);for(let e=0;e<n.length;e++){const i=n[e],c=r.get(i);if(void 0===c){const n=st(t,e);o.push(n)}else{const t=s[c];t.index!==e&&(t.index=e),o.push(t)}}return o}(e.bt,d?.value,r,d?.Ut??[])}let n=d??{value:null,Ut:null,version:0,Vt:0};n.value=r,n.Ut=t,n.version=o.Ft.version,n.Vt=o.Ft.Vt,o.Et.qt(e,n)}}}else s({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,t:"./docs/error-codes.md#stc"})}function rt(t,e,n,o,r){const i=r.Et.Mt.elements.has(e.info.pattern);let c=null,d=null;i&&(c=e.Nt??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef (element)",zt:e.info.pattern},t:"/docs/error-codes.md#state"}),d=r.Ft.Gt.get(c)||null,null===d&&(d={value:[...o[_](c)??[]],Ut:[...o[H](c)??[]]},r.Ft.Gt.set(c,d)));try{if(r.Et.Ot.startsWith(e.info)&&0===r.Et.Mt.Zt.intersection(e.info.j).size)return r.Et.Ot.set(e,n);if(!(e.info.pattern in t)){const i=e.info.ct??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef",zt:e.info.pattern},t:"/docs/error-codes.md#state"}),c=i.dt<e.info.dt?e.bt?.Ct??null:e.bt,d=ot(t,K(i,c),o,r),l=e.info.W;if("*"===l){const t=e.bt?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",zt:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(d,t,n)}return Reflect.set(d,l,n)}r.$t++,r.$t>=r.Wt.length&&r.Wt.push(null),r.Wt[r.$t]=r.St=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{r.Wt[r.$t]=null,r.$t--,r.St=r.$t>=0?r.Wt[r.$t]:null}}finally{if(r.Ft.Jt(e),i){const t=d.value.indexOf(n),s=o[H](c)??[],i=e.bt.index,l=-1!==t?d.Ut[t]:st(c.bt,-1);s[i]=l;if(new Set(o[_](c)??[]).size===d.value.length){for(let t=0;t<s.length;t++)s[t].index=t;r.Ft.Gt.delete(c)}}}}function it(t,e,n,o){return(e,r,i)=>{const c=M(e),d=o.St?.info??null;null!==d&&d.pattern!==c.pattern&&o.Et.Mt.Lt.has(d.pattern)&&o.Et.Mt.Dt(d.pattern,c.pattern),c.nt.length>r.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{path:e,Kt:c.nt.length,Qt:r.length},t:"/docs/error-codes.md#state",o:"error"});let l=null;for(let e=0;e<c.nt.length;e++){const i=c.nt[e],d=K(i,l);ot(t,d,n,o);const a=n[H](d);null==a&&s({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{pattern:i.pattern},t:"/docs/error-codes.md#list",o:"error"});const h=r[e];l=a[h]??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{pattern:i.pattern,index:h},t:"/docs/error-codes.md#list",o:"error"})}const a=K(c,l),h=void 0!==i;if(F in n){if(!h)return ot(t,a,n,o);rt(t,a,i,n,o)}else{if(!h)return ot(t,a,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{path:e},t:"/docs/error-codes.md#state",o:"error"})}}}function ct(t,e,n,o){const r=Y[e];if(void 0!==r){const t=o.St?.bt;return t?.Tt[r]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{Xt:String(e),Tt:t?.Tt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return it(t,0,n,o);case"$getAll":return function(t,e,n,o){const r=it(t,0,n,o);return(e,i)=>{const c=M(e),d=o.St?.info??null;if(null!==d&&d.pattern!==c.pattern&&o.Et.Mt.Lt.has(d.pattern)&&o.Et.Mt.Dt(d.pattern,c.pattern),void 0===i){for(let t=0;t<c.K.length;t++){const e=c.K[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Yt:c.pattern},t:"/docs/error-codes.md#bind",o:"error"}),n=Q(o,e.pattern);if(n){i=n.Tt;break}}void 0===i&&(i=[])}const l=(e,r,i,c,d,a,h)=>{const u=e[r]??null;if(null===u)return void h.push(a);const f=K(u,i);ot(t,f,n,o);const m=n[H](f);null===m&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const n=m[t];l(e,r+1,n,c,d+1,a.concat(n.index),h)}else{const t=m[p]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:p},t:"/docs/error-codes.md#list",o:"error"});r+1<e.length?l(e,r+1,t,c,d+1,a.concat(t.index),h):h.push(a.concat(t.index))}},a=[];l(c.nt,0,null,i,0,[],a);const h=[];for(let t=0;t<a.length;t++)h.push(r(c.pattern,a[t]));return h}}(t,0,n,o);case"$trackDependency":return function(t,e,n,o){return t=>{const e=o.St?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.Et.Mt.kt.has(e.pattern)&&e.pattern!==t&&o.Et.Mt.Dt(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>Ye?.navigate(t);case"$component":return o.Et.te}const r=z(e),i=X(r,n,o),c=K(r.info,i);return ot(t,c,n,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,n);switch(e){case _:return e=>ot(t,e,n,o);case F:return(e,s)=>rt(t,e,s,n,o);case H:return e=>function(t,e,n,o){if(o.Et.Mt.Rt.has(e.info.pattern)||s({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),o.Et.Ot.startsWith(e.info)&&0===o.Et.Mt.kt.intersection(e.info.j).size)return o.Et.Ot.ee(e)??[];ot(t,e,n,o);const r=o.Et.At(e);null===r&&s({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"});const i=r.Ut;return null==i&&s({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),i}(t,e,n,o);case V:return()=>function(t,e,n){const s=Reflect.get(t,B);if("function"==typeof s)return s.call(n)}(t,0,n);case O:return()=>function(t,e,n){const s=Reflect.get(t,U);"function"==typeof s&&s.call(n)}(t,0,n);case W:return e=>function(t,e,n){const s=Reflect.get(t,P);if("function"==typeof s){const t=new Set,o={};for(const n of e){const e=n.info.pattern;if(t.add(e),n.info.dt>0){const t=n.bt.index;let s=o[e];void 0===s?o[e]=[t]:s.push(t)}}return s.call(n,Array.from(t),o)}}(t,e,n)}}}let dt=class{Et;Ft;Ht;Wt=Array(32).fill(null);$t=-1;St=null;se=null;symbols=new Set([_,H]);oe=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,n){this.Et=t,this.Ft=e,this.Ht=n}get(t,e,n){return ct(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{h:"createReadonlyStateProxy.set",Xt:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.oe.has(e)}};function lt(t,e,n){return new dt(t,e,n)}function at(t,e){return new Proxy(t,e)}class ht{Et;Wt=Array(32).fill(null);$t=-1;St=null;se=null;Ft;Ht=null;symbols=new Set([_,F,H,V,O,W]);oe=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Et=t,this.Ft=e}get(t,e,n){return ct(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const r=z(e),i=X(r,s,o);return rt(t,K(r.info,i),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.oe.has(e)}}function ut(t,e,n,o,r){const i=new ht(t,e),c=new Proxy(n,i);return function(t,e,n){let o;t.se&&s({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.se=e;try{if(e){0===t.Wt.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),t.$t++,t.$t>=t.Wt.length&&t.Wt.push(null),t.Wt[t.$t]=t.St=e.re;try{o=n()}finally{t.Wt[t.$t]=null,t.$t--,t.St=t.$t>=0?t.Wt[t.$t]:null}}else o=n()}finally{if(o instanceof Promise)return o.finally((()=>{t.se=null}));t.se=null}return o}(i,o,(()=>r(c,i)))}class ft{#l=[];#a=new Set;#h=new Set;#u=new Set;#f;#m=null;#p=null;#g=new Map;#w=new Map;#y;constructor(t,e){this.#f=t,this.#y=e}get ie(){return this.#l}get ce(){return this.#a}get de(){return this.#h}get ae(){return this.#u}get D(){return this.#m||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#m}get R(){return this.#p||s({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.#p}get Et(){return this.#f||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),this.#f}get jt(){return this.#w}he(t){const e=lt(this.#f,this.#y,this),n=at(this.#f.state,e);this.#m=n,this.#p=e;try{return t(n,e)}finally{this.#m=null,this.#p=null}}ue(t){this.#g.clear(),this.#u.clear(),this.#h.clear(),this.#l=[...t],this.#a=new Set(t),this.he(((e,n)=>{const o=[],r=new Map,i=new Set;for(let e=0;e<t.length;e++){const n=t[e];if(i.add(n),!this.#f.Mt.elements.has(n.info.pattern)){o.push(n);continue}const c=n.Nt??s({code:"UPD-004",message:`ParentInfo is null for ref: ${n.key}`,context:{fe:n.key,pattern:n.info.pattern},t:"./docs/error-codes.md#upd"});r.has(c)||r.set(c,new Set),r.get(c).add(n)}for(const[t,e]of r){if(i.has(t)){for(const t of e)this.#u.add(t);continue}const n=this.#f.me(t);for(let t=0;t<n.length;t++)this.#h.has(n[t])||n[t].$(this);this.ae.add(t)}for(let t=0;t<o.length;t++){const e=o[t],n=R(this.#f.Mt.pe,e.info.pattern);null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.info.pattern}`,context:{pattern:e.info.pattern},t:"./docs/error-codes.md#path"}),this.ae.has(e)||this.we(e,n)}if(this.#f.ye.size>0)for(const t of this.#f.ye){const e=this.#f.xe.get(t)??new Set;for(const t of e)t.P(o)}}))}we(t,e){this.ae.add(t);const n=this.#f.me(t);for(let t=0;t<n.length;t++)this.#h.has(n[t])||n[t].$(this);let o=new Set;if(this.#f.Mt.Rt.has(t.info.pattern)){const e=new Set(this.D[H](t)??[]),{Ut:n}=this.jt.get(t)??{},s=new Set(n??[]);o=e.difference(s)}for(const[n,s]of e.ft){const e=M(s.ut);if("*"===n)for(const t of o){const n=K(e,t);this.ae.has(n)||this.we(n,s)}else{const n=K(e,t.bt);this.ae.has(n)||this.we(n,s)}}const r=this.#f.Mt.be.get(t.info.pattern);if(r)for(const t of r){const e=M(t),n=R(this.#f.Mt.pe,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.dt>0){const t=e.nt,s=(o,r,i)=>{const c=this.D[H](o)||[];if(r+1<t.length)for(let e=0;e<c.length;e++){const n=K(i,c[e]);s(n,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const s=K(e,c[t]);this.ae.has(s)||this.we(s,n)}},o=K(e.nt[0],null);s(o,0,e.nt[1]||null)}else{const t=K(e,null);this.ae.has(t)||this.we(t,n)}}}}class mt{queue=[];#x=!1;#f;#o;#b=0;#N=new Map;#S=[];constructor(t){this.#f=t,this.#o=t.Ne()}get version(){return this.#o}get Vt(){return this.#b}get Gt(){return this.#N}Jt(t){this.#b++,this.queue.push(t),this.#S.push(t),this.Se(this.#f,t.info.pattern,this.#f._t,this.#b),this.#x||(this.#x=!0,queueMicrotask((()=>{this.ve()})))}update(t,e){let n;n=ut(this.#f,this,this.#f.state,t,((t,n)=>e(t,n)));const s=()=>{if(this.#f.Mt.Ie&&this.#S.length>0){const t=this.#S;this.#S=[],queueMicrotask((()=>{this.update(null,((e,n)=>{e[W](t)}))}))}};return n instanceof Promise?n.finally((()=>{s()})):s(),n}ve(){try{for(;this.queue.length>0;){const n=this.queue;this.queue=[],t=n,e=this.#f,new ft(e,this).ue(t)}}finally{this.#x=!1}var t,e}Ce(t){var e;t((e=this.#f,new ft(e,this)))}Te(t,e,n,o,r){if(o.has(e))return;if(r&&t.Mt.elements.has(e))return;o.add(e);for(const[e,s]of n.ft.entries()){const e=s.ut;this.Te(t,e,s,o,!1)}const i=t.Mt.be.get(e)??[];for(const e of i){const n=R(t.Mt.pe,e);null===n&&s({code:"UPD-004",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"}),this.Te(t,e,n,o,!1)}}#v=new Map;Se(t,e,n,o){const r=R(t.Mt.pe,e);null===r&&s({code:"UPD-003",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"});let i=this.#v.get(e);void 0===i&&(i=new Set,this.Te(t,e,r,i,!0));const c={version:this.version,Vt:o};for(const t of i)n.set(t,c);this.#v.set(e,i)}he(t){const e=lt(this.#f,this,null);return t(at(this.#f.state,e),e)}}function pt(t,e){return e(new mt(t))}class gt extends N{get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeCheckbox.constructor",name:this.name,Be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Et;this.node.addEventListener(c,(async e=>{const n=this.binding.Pe.Ue,s=this.F;pt(d,(e=>{e.update(n,((e,n)=>{t.$e(e,n,s)}))}))}))}B(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",Le:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.F;this.node.checked=t.includes(e)}}class wt extends N{B(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",Le:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class yt extends N{B(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",Le:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.I,t)}}class xt extends N{constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);e.addEventListener(this.I,(t=>this.Me(t)))}update(){}async Me(t){const e=this.binding.Et,n=this.binding.Pe.Ue,o=n?.Ee().map((t=>t.bt.index))??[],r=this.C;r.includes("preventDefault")&&t.preventDefault(),r.includes("stopPropagation")&&t.stopPropagation();const i=pt(e,(e=>e.update(n,((e,n)=>{const r=this.binding.M.De(e,n);return"function"!=typeof r&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,Le:typeof r},t:"/docs/error-codes.md#bind",o:"error"}),Reflect.apply(r,e,[t,...o])}))));i instanceof Promise&&await i}$(t){}}const bt=(t,e,n)=>(s,o,r)=>{const i=b(r,e),c=t.slice(2);return new xt(s,o,t,c,i,n)};class Nt extends N{#r;get id(){return this.#r}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);const c=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"}),[d]=c.split(" ",2),l=Number(d);(l.toString()!==d||isNaN(l)||!isFinite(l)||!Number.isInteger(l)||l<0)&&s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent},t:"/docs/error-codes.md#bind",o:"error"}),this.#r=l}}class St extends Nt{Re;ke;Ae=[];_e;constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);const i=K(M(""),null);this.Re=ve(this.binding,this.id,this.binding.Et,i),this.ke=[this.Re],this._e=this.Ae}get T(){return this._e}B(t){s({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}$(t){const e=this.binding.M.L(t.D,t.R);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.applyChange",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.applyChange",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.Re.k(),this.Re.Fe(n,this.node),this.Re.$(t),this._e=this.ke):(this.Re.unmount(),this.Re.A(),this._e=this.Ae)}A(){this.Re.unmount(),this.Re.A(),this._e=this.Ae}}const vt=new Set,It=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class Ct extends Nt{_e=[];Ve=new WeakMap;Oe=[];We=0;He=void 0;je=void 0;qe=[];ze=new Set;get T(){return this._e}get Ge(){return this.We}set Ge(t){this.We=t}get Ze(){return this.Oe.length}set Ze(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.Oe.length=t}get Je(){if(void 0===this.He){const t=this.binding.M.pattern+".*";this.He=M(t)}return this.He}Ke(t,e){let n;if(this.We>=0)n=this.Oe[this.We],this.We--,n.Qe(e);else{const t=K(this.Je,e);n=ve(this.binding,this.id,this.binding.Et,t)}return this.Ve.set(e,n),n.k(),n}Xe(t){t.unmount(),t.A()}B(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}$(t){let e=[];const n=t.D[_](this.binding.M.re),o=t.D[H](this.binding.M.re)??[],r=new Set(o);new Set(this.je??vt);const i=this.je?.length??0,c=0===r.size?this.ze:this.ze.difference(r),d=0===this.ze.size?r:r.difference(this.ze),l=n?.length??0,a=new Set,h=new Set,u=this.binding.M.info.pattern+".*";for(let e=0;e<t.ie.length;e++){const n=t.ie[e];if(n.info.pattern!==u)continue;if(t.ae.has(n))continue;const o=n.bt;null===o&&s({code:"BIND-201",message:"ListIndex is null",context:{h:"BindingNodeFor.applyChange",re:n},t:"./docs/error-codes.md#bind"}),this.ze.has(o)?a.add(o):h.add(o),t.ae.add(n)}const f=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),m=new Set,p=i===c.size&&i>0;let g=!1;if(p){const t=Array.from(f.childNodes),e=this._e.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.Ye(f)&&(g=!0)}if(p&&g){f.textContent="",f.append(this.node);for(let t=0;t<this._e.length;t++)this._e[t].A();this.Oe.push(...this._e)}else if(c.size>0){for(const t of c){const e=this.Ve.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",tn:"removes"},t:"./docs/error-codes.md#bind"}),this.Xe(e),m.add(e)}this.Oe.push(...m)}let w=null;const y=this.node;this.Ge=this.Ze-1;const x=It&&l===d.size&&l>0;if(0===d.size&&0===c.size&&(a.size>0||h.size>0)){if(a.size>0){const t=Array.from(this._e),n=Array.from(a);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.Ve.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",tn:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.Ye(f)??y;n.Fe(f,o)}e=t}if(h.size>0)for(const e of h){const n=this.Ve.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",tn:"overwrites"},t:"./docs/error-codes.md#bind"}),n.$(t)}}else{const n=new Map;for(let t=0;t<this.qe.length;t++)n.set(this.qe[t],t);const r=x?document.createDocumentFragment():f,i=x?null:y,c=[];for(let l=0;l<o.length;l++){const a=o[l],h=w?.Ye(r)??i;let u;if(d.has(a))u=this.Ke(t,a),u.Fe(r,h),u.$(t);else{u=this.Ve.get(a),void 0===u&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",tn:"reuse"},t:"./docs/error-codes.md#bind"}),h?.nextSibling!==u.en&&u.Fe(r,h);const t=n.get(a);void 0!==t&&t!==l&&c.push(a)}e.push(u),w=u}if(x){const t=y.nextSibling;f.insertBefore(r,t)}for(const e of c){const n=this.binding.nn.get(e)??[];for(const e of n)t.de.has(e)||e.$(t)}}this.Ze=this.Ge+1,this._e=e,this.je=[...n],this.qe=[...o],this.ze=r}A(){for(let t=0;t<this._e.length;t++){const e=this._e[t];e.unmount(),e.A()}this.Oe.push(...this._e),this._e=[],this.Ve=new WeakMap,this.We=0,this.je=void 0,this.qe=[],this.ze=new Set}}const Tt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Ct(s,o,t,"",i,n)};const Bt={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},Ut={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Pt=new Set(["value","valueAsNumber","valueAsDate"]),$t=new Set;class Lt extends N{get value(){return this.node[this.name]}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLElement))return;if(!((c=this.node)instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement))return;var c;const d=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Pt:t instanceof HTMLInputElement?Ut[t.type]??Pt:$t)(this.node);if(!d.has(this.name))return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,Be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const l=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Bt[this.name]??"readonly";if("readonly"===l||"ro"===l)return;const a=this.binding.Et;this.node.addEventListener(l,(async()=>{const e=this.binding.Pe.Ue,n=this.F;pt(a,(s=>{s.update(e,((e,s)=>{t.$e(e,s,n)}))}))}))}B(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const Mt=(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Lt(s,o,t,"",i,n)};class Et extends N{get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeRadio.constructor",name:this.name,Be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Et;this.node.addEventListener(c,(async e=>{const n=this.binding.Pe.Ue,s=this.F;pt(d,(e=>{e.update(n,((e,n)=>{t.$e(e,n,s)}))}))}))}B(t){null==t&&(t="");this.node.checked=t===this.F}}class Dt extends N{B(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.I,t.toString())}}const Rt="component-state-input",kt=Symbol.for(`${Rt}.AssignState`),At=Symbol.for(`${Rt}.NotifyRedraw`),_t=new WeakMap;function Ft(t){return t.tagName.includes("-")?t.tagName.toLowerCase():t.getAttribute("is")?.includes("-")?t.getAttribute("is").toLowerCase():void s({code:"CE-001",message:"Custom tag name not found",context:{h:"ComponentEngine.customTagName.get"},t:"./docs/error-codes.md#ce"})}class Vt extends N{tagName;constructor(t,e,n,o,r,i){super(t,e,n,o,r,i);const c=this.node;c.tagName.includes("-")?this.tagName=c.tagName.toLowerCase():c.getAttribute("is")?.includes("-")?this.tagName=c.getAttribute("is").toLowerCase():s({code:"COMP-401",message:"Cannot determine custom element tag name",context:{h:"BindingNodeComponent.constructor"},t:"/docs/error-codes.md#comp"})}sn(t){const e=this.node,n=Ft(e);customElements.whenDefined(n).then((()=>{e.state[At](t)}))}P(t){const e=[],n=this.binding.M.re,s=n.bt,o=(s?.length??0)-1;for(const r of t)r.info.pattern!==n.info.pattern&&r.info.j.has(n.info.pattern)&&(o>=0&&r.bt?.at(o)!==s||e.push(r));0!==e.length&&this.sn(e)}$(t){this.sn([this.binding.M.re])}k(){const t=this.binding.Et,e=t.te,n=this.node,s=Ft(n);customElements.whenDefined(s).then((()=>{e.rn(n),n.dn.cn(this.binding)})),function(t,e){_t.set(e,t)}(e,n);let o=t.xe.get(n);void 0===o&&t.xe.set(n,o=new Set),o.add(this.binding)}A(){const t=this.binding.Et;var e;e=this.node,_t.delete(e);let n=t.xe.get(this.node);void 0!==n&&n.delete(this.binding)}}const Ot={0:{class:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new wt(s,o,t,"",i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new gt(s,o,t,"",i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new Et(s,o,t,"",i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=b(r,e);return new St(s,o,t,"",i,n)}}},Wt={class:(t,e,n)=>(s,o,r)=>{const i=b(r,e),[,c]=t.split(".");return new yt(s,o,t,c,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=b(r,e),[,c]=t.split(".");return new S(s,o,t,c,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=b(r,e),[,c]=t.split(".");return new Dt(s,o,t,c,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=b(r,e),[,c]=t.split(".");return new Vt(s,o,t,c,i,n)}};const Ht={};function jt(t,e,n,o){const r=t instanceof Comment,i=t instanceof Element,c=r+"\t"+i+"\t"+e,d=Ht[c]??(Ht[c]=function(t,e,n){const o=Ot[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return Tt;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const r=n.split("."),i=Wt[r[0]];return void 0!==i?i:e&&n.startsWith("on")?bt:Mt}(r,i,e));return d(e,n,o)}class qt{pattern;info;filters;ln=!1;u;an=null;hn=null;un=null;constructor(t,e,n){this.u=t,this.pattern=e,this.info=M(e),this.filters=n,this.an=0===this.info.dt?K(this.info,null):null}get bt(){return this.re.bt}get re(){return null===this.an?(null===this.un&&s({code:"BIND-201",message:"LoopContext is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"}),null===this.hn&&(this.hn=K(this.info,this.un.bt)),this.hn):this.an??s({code:"BIND-201",message:"ref is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"})}De(t,e){return ot(this.u.Et.state,this.re,t,e)}L(t,e){let n=ot(this.u.Et.state,this.re,t,e);for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}B(t,e,n){rt(this.u.Et.state,this.re,n,t,e)}k(){if(this.info.dt>0){const t=this.info.ot??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"});this.un=this.u.Pe.Ue?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",ot:t},t:"/docs/error-codes.md#bind",o:"error"})}this.u.Et.fn(this.re,this.u)}A(){this.u.Et.mn(this.re,this.u),this.hn=null,this.un=null}}class zt{filters;u;pn;un=null;constructor(t,e,n){this.u=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this.pn=o,this.filters=n}get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get bt(){return this.un?.bt??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get re(){return this.un?.re??s({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get ln(){return!0}De(t,e){return this.bt?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}L(t,e){let n=this.bt?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}B(t,e,n){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}k(){const t=(this.u.Pe.Ue??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).Ee();this.un=t[this.pn-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",gn:this.pn},t:"/docs/error-codes.md#bind"});const e=this.un.yn.wn;null==e&&s({code:"BIND-201",message:"Binding for list is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"});const n=e.nn.get(this.bt);void 0===n?e.nn.set(this.bt,new Set([this.u])):n.add(this.u)}A(){this.un=null}}const Gt=new RegExp(/^\$\d+$/);function Zt(t,e){return Gt.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new zt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new qt(n,t,o)})(t,e)}const Jt={};function Kt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return Jt[e]??(Jt[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s({code:"BND-001",message:`Unknown NodeType: ${t.nodeType}`,context:{h:"getNodeType.getNodeTypeByNode",nodeType:t.nodeType,nodeName:t.nodeName,xn:t.constructor.name},t:"./docs/error-codes.md#bnd"}))(t))}const Qt=t=>t.trim(),Xt=t=>t.length>0,Yt=new RegExp(/^#(.*)#$/),te=t=>{const e=Yt.exec(t);return e?decodeURIComponent(e[1]):t},ee=t=>{const[e,...n]=t.split(",").map(Qt);return{name:e,options:n.map(te)}},ne=t=>{const[e,...n]=t.split("|").map(Qt);return{bn:e,filters:n.map(ee)}},se=t=>t.split(";").map(Qt).filter(Xt).map((t=>(t=>{const[e,n=null]=t.split("@").map(Qt),s=n?n.split(",").map(Qt):[],[o,r]=e.split(":").map(Qt),{bn:i,filters:c}=ne(o),{bn:d,filters:l}=ne(r);return{Nn:i,Sn:d,vn:c,In:l,C:s}})(t))),oe={};const re=t=>{t.removeAttribute("data-bind")},ie={HTMLElement:re,SVGElement:re,Text:void 0,Cn:void 0};const ce={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,Cn:void 0,SVGElement:void 0};class de{nodeType;Tn;Bn;Un=new Map;constructor(t){this.nodeType=Kt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(v)??"";case"Template":{const t=e.textContent?.slice(3).trim(),[n]=t?.split(" ",2)??[];return ge(Number(n)).getAttribute(v)??""}default:return""}}(this.nodeType,t);(function(t,e){ie[e]?.(t)})(t=function(t,e){return ce[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.Tn=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.Bn=function(t){return""===t.trim()?[]:oe[t]??(oe[t]=se(t))}(e);for(let e=0;e<this.Bn.length;e++){const n=this.Bn[e],s={Pn:jt(t,n.Nn,n.vn,n.C),$n:Zt(n.Sn,n.In)};this.Un.set(n,s)}}}function le(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(v)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(I)||0===t.textContent?.indexOf(C))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const ae={},he={},ue={};function fe(t){return le(t).map((t=>function(t){return new de(t)}(t)))}const me={};function pe(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=fe(e),o=ue[n]??(ue[n]=new Set),r=he[n]??(he[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.Bn.length;t++){const n=e.Bn[t];o.add(n.Sn),"for"===n.Nn&&r.add(n.Sn)}}ae[t]=s}(t,e.content,n),me[t]=e,t}function ge(t){return me[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{h:"registerTemplate.getTemplateById",Ln:t},t:"./docs/error-codes.md#tmp"})}class we{Pe;Et;node;Mn;M;nn=new WeakMap;En=!1;constructor(t,e,n,s,o){this.Pe=t,this.node=e,this.Et=n,this.Mn=s(this,e,n.Dn),this.M=o(this,n.Rn)}get T(){return this.Mn.T}get isActive(){return this.En}$e(t,e,n){return this.M.B(t,e,n)}P(t){this.Mn.P(t)}$(t){if(t.de.has(this))return;t.de.add(this),this.Mn.$(t);const e=this.M.re;if(!this.M.ln&&!this.Et.Mt.be.has(e.info.pattern)){1===this.Et.me(e).length&&t.ae.add(e)}}k(){this.En=!0,this.M.k(),this.Mn.k()}A(){this.isActive&&(this.Mn.A(),this.M.A(),this.En=!1)}}function ye(t,e,n,s,o){return new we(t,e,n,s,o)}class xe{#I;#C;#T;constructor(t,e){this.#I=t,this.#C=t.info,this.#T=e}get re(){return this.#I??s({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.#C.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.re.info.pattern}get info(){return this.re.info}get bt(){return this.re.bt??s({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.#C.pattern},t:"/docs/error-codes.md#list"})}Qe(t){this.#I=K(this.#C,t)}kn(){this.#I=null}get yn(){return this.#T}#B;get An(){if(void 0===this.#B){let t=this.yn;for(;null!==t;){if(null!==t.se&&t.se!==this){this.#B=t.se;break}t=t.wn?.Pe??null}void 0===this.#B&&(this.#B=null)}return this.#B}#U={};find(t){let e=this.#U[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.An;e=this.#U[t]=n}return e}_n(t){let e=this;for(;null!==e;)t(e),e=e.An}Ee(){const t=[];return this._n((e=>{t.unshift(e)})),t}}function be(t){const e=ge(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{h:"BindContent.createContent",Ln:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(Ze).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){Ke(t[e].tagName.toLowerCase())}}return n}function Ne(t,e,n,o){const r=(t=>ae[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",Ln:e},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],l=w(o,d.Tn)??s({code:"BIND-102",message:`Node not found: ${d.Tn}`,context:{h:"BindContent.createBindings",Ln:e,Tn:d.Tn},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.Bn.length;o++){const r=d.Bn[o],c=d.Un.get(r)??s({code:"BIND-103",message:`Creator not found: ${r}`,context:{h:"BindContent.createBindings",Ln:e,Fn:r},t:"./docs/error-codes.md#bind"}),a=ye(t,l,n,c.Pn,c.$n);i.push(a)}}return i}class Se{wn;se;id;en;Vn;fragment;childNodes;On=[];Wn;En=!1;Hn;Ye(t){const e=this.On[this.On.length-1],n=this.Vn;if(void 0!==e&&e.node===n&&e.T.length>0){const n=(e.T.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",Ln:this.id},t:"./docs/error-codes.md#bind"})).Ye(t);if(null!==n)return n}return t!==n?.parentNode?null:n}get Ue(){if(void 0===this.Hn){let t=this;for(;null!==t&&null===t.se;)t=t.wn?.Pe??null;this.Hn=t?.se??null}return this.Hn}constructor(t,e,n,s){this.wn=t,this.id=e,this.fragment=be(e),this.childNodes=Array.from(this.fragment.childNodes),this.en=this.childNodes[0]??null,this.Vn=this.childNodes[this.childNodes.length-1]??null,this.Wn=n,this.se=null!==s.bt?new xe(s,this):null;const o=Ne(this,e,n,this.fragment);this.On=o}get isActive(){return this.En}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}jn(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}Fe(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){this.Hn=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}Qe(t){null==this.se&&s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",Ln:this.id},t:"./docs/error-codes.md#bind"}),this.se.Qe(t)}$(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.On.length;e++){const n=this.On[e];t.de.has(n)||n.$(t)}}k(){this.En=!0;for(let t=0;t<this.On.length;t++)this.On[t].k()}A(){this.En=!1,this.se?.kn();for(let t=0;t<this.On.length;t++)this.On[t].A()}}function ve(t,e,n,s){return new Se(t,e,n,s)}function Ie(t,e){const n=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=n.adoptedStyleSheets;s.includes(e)||(n.adoptedStyleSheets=[...s,e])}function Ce(t,e){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}function Te(t,e,n){"none"===e.shadowDomMode?Ie(t,n):"force"===e.shadowDomMode||null===e.qn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.qn)?Ce(t,n):Ie(t,n)}class Be{zn=new Set;Gn=new Set;Zn=new Map;Jn=new Map;Kn=new Map;Qn=new Map;Xn=new WeakSet;cn(t){if(this.Xn.has(t))return;const e=t.M.pattern,n=t.Mn.I;this.Kn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{it:e,Yn:this.Kn.get(e)},t:"./docs/error-codes.md#state"}),this.Qn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{ts:n,es:this.Qn.get(n)},t:"./docs/error-codes.md#state"}),this.Kn.set(e,n),this.Qn.set(n,e),this.Gn.add(e),this.zn.add(n),this.Zn.set(e,t),this.Jn.set(n,t),this.Xn.add(t)}ns(t){return this.Kn.get(t)}ss(t){return this.Qn.get(t)}rs(t){const e=M(t).j.intersection(this.zn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{ts:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Qn.get(o);return void 0===i&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{ts:t,cs:o},t:"./docs/error-codes.md#state"}),i+r}ds(t){const e=M(t).j.intersection(this.Gn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{it:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],r=t.slice(o.length),i=this.Kn.get(o);return void 0===i&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{it:t,cs:o},t:"./docs/error-codes.md#state"}),i+r}ls(t){if(0===this.zn.size)return null;const e=t.j.intersection(this.zn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.hs(e);for(const t of n??[])this.cn(t)}}class Ue{us;Wn;constructor(t,e){this.us=e,this.Wn=t}fs(t){pt(this.Wn,(e=>{e.update(null,((e,n)=>{for(const[n,s]of Object.entries(t)){const t=K(M(n),null);e[F](t,s)}}))}))}P(t){pt(this.Wn,(e=>{for(const n of t){let t;try{t=this.us.ds(n.info.pattern)}catch(t){continue}const o=M(t),r=o.dt-1,i=r>=0?n.bt?.at(r)??null:null;r>=0&&null===i&&s({code:"LIST-201",message:`ListIndex not found for parent ref: ${n.info.pattern}`,context:{h:"ComponentStateInput.notifyRedraw",ps:n.info.pattern,gs:o.pattern},t:"/docs/error-codes.md#list"});const c=K(o,i);this.Wn.getPropertyValue(c),e.Jt(c)}}))}get(t,e,n){if(e===kt)return this.fs.bind(this);if(e===At)return this.P.bind(this);if("string"==typeof e){const t=K(M(e),null);return this.Wn.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=K(M(e),null);return this.Wn.ws(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class Pe{u;ys;xs=new Set;constructor(t,e){this.u=t,this.ys=e}get(t){const e=this.u.ls(t.info);null===e&&s({code:"CSO-101",message:`No child path found for path "${t.info.toString()}".`,context:{h:"ComponentStateOutput.get",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const n=this.u.Jn.get(e);void 0===n&&s({code:"CSO-102",message:`No binding found for child path "${e}".`,context:{h:"ComponentStateOutput.get",ts:e},t:"./docs/error-codes.md#cso"});const o=K(M(this.u.rs(t.info.pattern)),t.bt??n.M.bt);if(!this.xs.has(o.info.pattern)){const e=this.ys.Mt.Rt.has(t.info.pattern);n.Et.Mt.addPath(o.info.pattern,e),this.xs.add(o.info.pattern)}return n.Et.getPropertyValue(o)}set(t,e){const n=this.u.ls(t.info);null===n&&s({code:"CSO-101",message:`No child path found for path "${t.info.toString()}".`,context:{h:"ComponentStateOutput.set",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const o=this.u.Jn.get(n);void 0===o&&s({code:"CSO-102",message:`No binding found for child path "${n}".`,context:{h:"ComponentStateOutput.set",ts:n},t:"./docs/error-codes.md#cso"});const r=K(M(this.u.rs(t.info.pattern)),t.bt??o.M.bt);if(!this.xs.has(r.info.pattern)){const e=this.ys.Mt.Rt.has(t.info.pattern);o.Et.Mt.addPath(r.info.pattern,e),this.xs.add(r.info.pattern)}return o.Et.ws(r,e),!0}startsWith(t){return null!==this.u.ls(t)}ee(t){const e=this.u.ls(t.info);null===e&&s({code:"CSO-101",message:`No child path found for path "${t.info.toString()}".`,context:{h:"ComponentStateOutput.getListIndexes",path:t.info.pattern},t:"./docs/error-codes.md#cso"});const n=this.u.Jn.get(e);void 0===n&&s({code:"CSO-102",message:`No binding found for child path "${e}".`,context:{h:"ComponentStateOutput.getListIndexes",ts:e},t:"./docs/error-codes.md#cso"});const o=K(M(this.u.rs(t.info.pattern)),t.bt);if(!this.xs.has(o.info.pattern)){const e=this.ys.Mt.Rt.has(t.info.pattern);n.Et.Mt.addPath(o.info.pattern,e),this.xs.add(o.info.pattern)}return n.Et.ee(o)}}class $e{type="autonomous";config;bs;styleSheet;Ns;state;Dn;Rn;Ss=HTMLElement;te;Mt;vs=Promise.withResolvers();Is;Ot;dn;xe=new WeakMap;ye=new Set;_t=new Map;Re=null;Cs=null;Ts=null;Bs=!1;Us=0;Ps=new WeakMap;constructor(t,e){this.config=t,this.config.qn&&(this.type="builtin");const n=e.constructor;var s;this.bs=n.bs,this.styleSheet=n.styleSheet,this.Ns=n.Ns,this.state=new this.Ns,this.Dn=n.Dn,this.Rn=n.Rn,this.te=e,this.dn=new Be,this.Is=function(t,e){const n=new Ue(t,e);return new Proxy({},n)}(this,this.dn),this.Ot=(s=this.dn,new Pe(s,this)),this.Mt=n.Mt}get yn(){return null===this.Re&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",$s:this.te.constructor.id},t:"./docs/error-codes.md#bind"}),this.Re}get Ls(){return this.Us}Ne(){return++this.Us}Ms(){for(const t in this.state)T.has(t)||this.Mt.Es.has(t)||(this.Mt.Es.add(t),k(this.Mt.pe,t));const t=this.te.constructor,e=K(M(""),null);this.Re=ve(null,t.id,this,e)}async connectedCallback(){if(this.config.Ds)Te(this.te,this.config,this.styleSheet);else{this.Ts=this.te.parentNode,this.Cs=document.createComment("Structive block placeholder");try{this.Bs=!0,this.te.replaceWith(this.Cs)}finally{this.Bs=!1}}if(this.config.Ds)this.yn.mount(this.te.shadowRoot??this.te);else{const t=this.Ts??s({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.yn.Fe(t,this.Cs)}if(this.te.dataset.state)try{const t=JSON.parse(this.te.dataset.state);this.Is[kt](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",Rs:this.te.dataset.state},t:"./docs/error-codes.md#state",i:t})}if(pt(this,(t=>{t.Ce((t=>{this.yn.k(),t.he(((e,n)=>{this.yn.$(t)}))}))})),this.Mt.ks){const t=pt(this,(async t=>t.update(null,(async(t,e)=>{t[V]()}))));t instanceof Promise&&await t}this.vs.resolve()}async disconnectedCallback(){if(!this.Bs)try{this.Mt.As&&pt(this,(t=>{t.update(null,((t,e)=>{t[O]()}))}))}finally{this.te.Fs?._s(this.te),this.config.Ds||(this.Cs?.remove(),this.Cs=null,this.Ts=null),pt(this,(t=>{t.Ce((t=>{this.yn.A()}))}))}}ee(t){if(this.Ot.startsWith(t.info))return this.Ot.ee(t);let e=null;return pt(this,(n=>{e=n.he(((e,n)=>e[H](t)))})),e}getPropertyValue(t){let e;return pt(this,(n=>{e=n.he(((e,n)=>e[_](t)))})),e}ws(t,e){pt(this,(n=>{n.update(null,((n,s)=>{n[F](t,e)}))}))}rn(t){this.ye.add(t)}_s(t){this.ye.delete(t)}At(t){return this.Ps.get(t)?.Vs??null}qt(t,e){let n=this.Ps.get(t);void 0===n?this.Ps.set(t,{On:[],Vs:e}):n.Vs=e}me(t){return this.Ps.get(t)?.On??[]}fn(t,e){const n=this.Ps.get(t);void 0===n?this.Ps.set(t,{On:[e],Vs:null}):n.On.push(e)}mn(t,e){const n=this.Ps.get(t);if(void 0!==n){const t=n.On.indexOf(e);t>=0&&n.On.splice(t,1)}}}const Le=/\{\{([^\}]+)\}\}/g,Me=new Set(["if","for","endif","endfor","elseif","else"]);const Ee="http://www.w3.org/2000/svg";function De(t,e,s=t){const o=e.getAttribute(v),r=n.debug?o??"":"";if(e.parentNode?.replaceChild(document.createComment(`${C}${t} ${r}`),e),e.namespaceURI===Ee){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}t.setAttribute(v,o??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{De(f(),t,s)})),pe(t,e,s),t}function Re(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(Le,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!Me.has(o))return`\x3c!--${I}${n}--\x3e`;const r=n.slice(o.length+1).trim(),i={type:o,Os:n,Ws:r};if("if"===o||"for"===o)return e.push(i),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",Os:n,Hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",js:o.type,Os:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",Os:n,Hs:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",js:t.type,Os:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",Os:n,Hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(i),`</template><template data-bind="if:${t.Ws}|not"><template data-bind="if:${r}">`;s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",js:t.type,Os:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",Os:n,Hs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.Ws}|not">`;s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",js:t.type,Os:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:o,Os:n},t:"./docs/error-codes.md#tmp"})}))}(e),De(t,n)}const ke=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Ae=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function _e(t,e){const n=new Set(t.H).intersection(e);let o=-1,r="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,r=t))}if(r.length>0){Ae.test(r)||s({code:"STATE-202",message:`Invalid path: ${r}`,context:{qs:r},t:"./docs/error-codes.md#state"});const e=M(r),n=[];let o=e.dt;for(let i=e.O.length;i<t.O.length;i++){const e=t.O[i];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(ke.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{zs:e,qs:r},t:"./docs/error-codes.md#state"}),n.push("."+e))}const i=n.join(""),c=`this["${r}"]${i} = value;`;return{get:new Function("",`return this["${r}"]${i};`),set:new Function("value",c)}}{const e=[];let n=0;for(let o=0;o<t.O.length;o++){const r=t.O[o];"*"===r?(e.push("[this.$"+(n+1)+"]"),n++):(ke.test(r)||s({code:"STATE-202",message:`Invalid segment name: ${r}`,context:{zs:r},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+r))}const o=e.join(""),r=`this.${o} = value;`;return{get:new Function("",`return this.${o};`),set:new Function("value",r)}}}class Fe{Es=new Set;Rt=new Set;elements=new Set;Gs=new Set;kt=new Set;Lt=new Set;Zt=new Set;Zs=new Set;Js=new Set;Ks=new Map;be=new Map;pe=function(){return new E("","",0)}();ks=!1;As=!1;Ie=!1;#r;#P;constructor(t){this.#r=t.id,this.#P=t.Ns;const e=(t=>ue[t]??[])(this.#r),n=new Set;for(const t of e){const e=M(t);this.Es=this.Es.union(e.j);for(const t of e.j){const e=M(t);"*"===e.W&&n.add(e.it)}}const s=(t=>he[t]??[])(this.#r);this.Rt=this.Rt.union(s).union(n);for(const t of this.Rt){const e=t+".*";this.elements.add(e)}let o=this.#P.prototype;for(;o&&o!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(o);if(t)for(const[e,n]of Object.entries(t)){if(T.has(e))continue;if("function"==typeof n.value){this.Gs.add(e),e===B&&(this.ks=!0),e===U&&(this.As=!0),e===P&&(this.Ie=!0);continue}const t=void 0!==n.get,s=void 0!==n.set,o=M(e);this.Es=this.Es.union(o.j),t&&this.kt.add(e),s&&this.Zt.add(e),t&&!s&&this.Lt.add(e),t&&s&&this.Zs.add(e)}o=Object.getPrototypeOf(o)}for(const t of this.Es){if(this.kt.has(t))continue;if(this.Zt.has(t))continue;const e=M(t);if(1===e.O.length)continue;const n=_e(e,this.kt);Object.defineProperty(this.#P.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.Js.add(t)}for(const t of this.Es){k(this.pe,t);const e=M(t);e.it&&(this.Ks.get(e.it)?.add(t)??this.Ks.set(e.it,new Set([t])))}}addPath(t,e=!1){const n=M(t);if(e&&!this.Rt.has(t)){this.Rt.add(t);const e=t+".*";this.elements.add(e)}else"*"===n.W&&(this.elements.add(t),this.Rt.add(n.it));for(const t of n.j){if(this.Es.has(t))continue;this.Es.add(t),k(this.pe,t);const e=M(t);if("*"===e.W&&(this.elements.add(t),this.Rt.add(e.it)),e.O.length>1){const n=_e(e,this.kt);Object.defineProperty(this.#P.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.Js.add(t)}e.it&&(this.Ks.get(e.it)?.add(t)??this.Ks.set(e.it,new Set([t])))}}#$=new Set;Dt(t,e){const n=e+"=>"+t;this.#$.has(n)||(this.Es.has(e)||this.addPath(e),this.#$.add(n),this.be.get(e)?.add(t)??this.be.set(e,new Set([t])))}}function Ve(t){const n=function(t){const n=e();return{Ds:void 0===t.Ds||t.Ds,shadowDomMode:t.shadowDomMode??n.shadowDomMode,qn:t.qn??null}}(t.Ns.Qs??{}),o=f(),{Xs:r,Ys:i,Ns:c}=t,d=Object.assign({},h),l=Object.assign({},a);c.eo=!0,Re(o,r),g(o,i),function(t,e){m[t]=e}(o,c);const u=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.qn),w=n.qn;return class extends u{#f;constructor(){super(),this.#f=function(t,e){return new $e(t,e)}(n,this),this.#f.Ms()}connectedCallback(){this.#f.connectedCallback()}disconnectedCallback(){this.#f.disconnectedCallback()}#L;get Fs(){var t;return void 0===this.#L&&(this.#L=(t=this,_t.get(t)??null)),this.#L}get state(){return this.#f.Is}get dn(){return this.#f.dn}get no(){return this.#f.Ns.eo??!1}get vs(){return this.#f.vs}hs(t){return this.#f.xe.get(t)??null}rn(t){this.#f.rn(t)}_s(t){this.#f._s(t)}static define(t){w?customElements.define(t,this,{qn:w}):customElements.define(t,this)}static get id(){return o}static#M=r;static get Xs(){return this.#M}static set Xs(t){this.#M=t,Re(this.id,t),this.#E=null,this.#D=null}static#R=i;static get Ys(){return this.#R}static set Ys(t){this.#R=t,g(this.id,t),this.#k=null}static#E=null;static get bs(){return this.#E||(this.#E=ge(this.id)),this.#E}static#k=null;static get styleSheet(){return this.#k||(this.#k=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{h:"registerStyleSheet.getStyleSheetById",so:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#k}static#P=null;static get Ns(){return this.#P||(this.#P=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{h:"registerStateClass.getStateClassById",oo:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#P}static#A=d;static get Dn(){return this.#A}static#_=l;static get Rn(){return this.#_}static#D=null;static get Mt(){return this.#D||(this.#D=new Fe(this)),this.#D}}}function Oe(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}let We=0;async function He(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t,e){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(e);const s=n.content.querySelector("template");s?.remove();const o=n.content.querySelector("script[type=module]");let r={};if(o){const e=`\n// uniq id: ${We++}\n//# sourceURL=${t}\n`;if("function"==typeof URL.createObjectURL){const t=new Blob([o.text+e],{type:"application/javascript"}),n=URL.createObjectURL(t);try{r=await import(n)}finally{URL.revokeObjectURL(n)}}else{const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(o.text+e)));r=await import("data:application/javascript;base64,"+t)}}o?.remove();const i=n.content.querySelector("style");i?.remove();const c=r.default??class{};return{text:e,Xs:Oe(s?.innerHTML??"").trim(),Ys:i?.textContent??"",Ns:c}}(t,await n.text())}function je(t,e){e.define(t)}const qe="@routes/",ze="@components/",Ge="#lazy",Ze={};async function Je(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(qe)){s=n.endsWith(Ge);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),en(t,"/root"===e?"/":e)}n.startsWith(ze)&&(s=n.endsWith(Ge),t=n.slice(12,s?-5:void 0)),t&&(s?Ze[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){je(t,Ve(await He(n)))}}}function Ke(t){const e=Ze[t];if(e)delete Ze[t],queueMicrotask((async()=>{const n=Ve(await He(e));je(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const Qe="routes:",Xe=[];let Ye=null;class tn extends HTMLElement{ro=window.location.pathname;io=window.location.pathname.split("/").pop()||"";co=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";do;constructor(){super(),this.do=this.lo.bind(this)}connectedCallback(){Ye=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.do),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.do),Ye=null}lo(t){t.preventDefault(),this.ue()}navigate(t){const e="/"===t[0]?this.co+t.slice(1):t;history.pushState({},"",e),this.ue()}ue(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.io&&(t[t.length-1]="");const e=t.join("/").replace(this.co,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of Xe){const r=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return Ze.hasOwnProperty(t)}(s)&&Ke(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function en(t,e){e.startsWith(Qe)&&(e=e.substring(Qe.length)),Xe.push([e,t])}const nn="router",sn=`<slot name="${nn}"></slot>`;class on extends HTMLElement{constructor(){super(),"none"!==n.shadowDomMode&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.ao(),this.ue()}get root(){return this.shadowRoot??this}async ao(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=sn}ue(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",nn),this.root.appendChild(t)}}}const rn=n;let cn=!1;async function dn(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;en(e,"/root"===t?"/":t)}t=await He(s),je(e,Ve(t))}}(t),rn.autoInit&&await ln()}async function ln(){cn||(await async function(){if(n.autoLoadFromImportMap&&await Je(),n.enableRouter&&customElements.define(n.routerTagName,tn),n.enableMainWrapper&&(customElements.define(n.mainTagName,on),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),cn=!0)}export{ln as bootstrapStructive,rn as config,dn as defineComponents};
//# sourceMappingURL=structive.min.js.map
