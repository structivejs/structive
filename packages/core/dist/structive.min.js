const t={debug:!1,locale:"en-US",enableShadowDom:!0,enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1,optimizeList:!0,optimizeListElements:!0,optimizeAccessor:!0};function e(){return t}const n=e();function s(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:i,o:r,i:c}=t,a=new Error(e);throw a.code=n,s&&(a.context=s),o&&(a.hint=o),i&&(a.t=i),r&&(a.o=r),c&&(a.i=c),a}function o(t){s({code:"FLT-202",message:`${t} requires at least one option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function i(t){s({code:"FLT-202",message:`${t} requires a number as option`,context:{l:t},t:"./docs/error-codes.md#flt"})}function r(t){s({code:"FLT-202",message:`${t} requires a number value`,context:{l:t},t:"./docs/error-codes.md#flt"})}function c(t){s({code:"FLT-202",message:`${t} requires a date value`,context:{l:t},t:"./docs/error-codes.md#flt"})}const a=e(),d={eq:t=>{const e=t?.[0]??o("eq");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&i("eq"),t===n}return t===e}},ne:t=>{const e=t?.[0]??o("ne");return t=>{if("number"==typeof t){const n=Number(e);return isNaN(n)&&i("ne"),t!==n}return t!==e}},not:t=>t=>{var e;return"boolean"!=typeof t&&s({code:"FLT-202",message:`${e="not"} requires a boolean value`,context:{l:e},t:"./docs/error-codes.md#flt"}),!t},lt:t=>{const e=t?.[0]??o("lt"),n=Number(e);return isNaN(n)&&i("lt"),t=>("number"!=typeof t&&r("lt"),t<n)},le:t=>{const e=t?.[0]??o("le"),n=Number(e);return isNaN(n)&&i("le"),t=>("number"!=typeof t&&r("le"),t<=n)},gt:t=>{const e=t?.[0]??o("gt"),n=Number(e);return isNaN(n)&&i("gt"),t=>("number"!=typeof t&&r("gt"),t>n)},ge:t=>{const e=t?.[0]??o("ge"),n=Number(e);return isNaN(n)&&i("ge"),t=>("number"!=typeof t&&r("ge"),t>=n)},inc:t=>{const e=t?.[0]??o("inc"),n=Number(e);return isNaN(n)&&i("inc"),t=>("number"!=typeof t&&r("inc"),t+n)},dec:t=>{const e=t?.[0]??o("dec"),n=Number(e);return isNaN(n)&&i("dec"),t=>("number"!=typeof t&&r("dec"),t-n)},mul:t=>{const e=t?.[0]??o("mul"),n=Number(e);return isNaN(n)&&i("mul"),t=>("number"!=typeof t&&r("mul"),t*n)},div:t=>{const e=t?.[0]??o("div"),n=Number(e);return isNaN(n)&&i("div"),t=>("number"!=typeof t&&r("div"),t/n)},fix:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&i("fix"),t=>("number"!=typeof t&&r("fix"),t.toFixed(e))},locale:t=>{const e=t?.[0]??a.locale;return t=>("number"!=typeof t&&r("locale"),t.toLocaleString(e))},uc:t=>t=>t.toString().toUpperCase(),lc:t=>t=>t.toString().toLowerCase(),cap:t=>t=>{const e=t.toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>t.toString().trim(),slice:t=>{const e=t?.[0]??o("slice"),n=Number(e);return isNaN(n)&&i("slice"),t=>t.toString().slice(n)},substr:t=>{const e=t?.[0]??o("substr"),n=Number(e);isNaN(n)&&i("substr");const s=t?.[1]??o("substr"),r=Number(s);return isNaN(r)&&i("substr"),t=>t.toString().substr(n,r)},pad:t=>{const e=t?.[0]??o("pad"),n=Number(e);isNaN(n)&&i("pad");const s=t?.[1]??"0";return t=>t.toString().padStart(n,s)},rep:t=>{const e=t?.[0]??o("rep"),n=Number(e);return isNaN(n)&&i("rep"),t=>t.toString().repeat(n)},rev:t=>t=>t.toString().split("").reverse().join(""),int:t=>t=>parseInt(t,10),float:t=>t=>parseFloat(t),round:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("round"),t=>("number"!=typeof t&&r("round"),Math.round(t*n)/n)},floor:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("floor"),t=>("number"!=typeof t&&r("floor"),Math.floor(t*n)/n)},ceil:t=>{const e=t?.[0]??0,n=Math.pow(10,Number(e));return isNaN(n)&&i("ceil"),t=>("number"!=typeof t&&r("ceil"),Math.ceil(t*n)/n)},percent:t=>{const e=Number(t?.[0]??0);return isNaN(e)&&i("percent"),t=>("number"!=typeof t&&r("percent"),(100*t).toFixed(e)+"%")},date:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||c("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||c("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||c("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||c("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},l=d,h=d;let u=0;function f(){return++u}const m={};const p={};function g(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){p[t]=e}(t,n)}function w(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function y(t,e){const n=t[e.name];return n||s({code:"FLT-201",message:`Filter not found: ${e.name}`,context:{h:"createFilters.textToFilter",name:e.name},t:"./docs/error-codes.md#flt"}),n(e.options)}const x=new Map;function b(t,e){let n=x.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(y(t,e[s]));x.set(e,n)}return n}class N{#t;#e;#n;#s;#o;#i=[];get node(){return this.#e}get name(){return this.#n}get u(){return this.#n}get binding(){return this.#t}get m(){return this.#o}get filters(){return this.#s}get p(){return this.#i}constructor(t,e,n,s,o){this.#t=t,this.#e=e,this.#n=n,this.#s=s,this.#o=o}init(){}N(t){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}S(t,e){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}I(t){}v(t){const e=this.binding.T.C(t.B,t.U);this.N(e)}P(){}$(){}get L(){return this.node instanceof HTMLSelectElement}get value(){return null}get M(){return null}}class S extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.setAttribute(this.u,t.toString())}}const I="data-bind",v="@@:",C="@@|",T=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),B={};class U{static id=0;id=++U.id;D=this.id.toString();pattern;k;R;A;F;V;H;W;O;_;q;j;G;Z;J;K;X;Y;tt;et;nt;children={};constructor(t){const e=e=>t===e?this:P(e),n=t.split("."),s=[],o=[],i=[],r={},c=[],a=[],d=[];let l="",h="",u=0;for(let t=0;t<n.length;t++)l+=n[t],"*"===n[t]&&(i.push(l),r[l]=u,c.push(e(l)),a.push(h),d.push(e(h)),u++),s.push(l),o.push(e(l)),h=l,l+=".";const f=i.length>0?i[i.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.k=n,this.R=n[n.length-1],this.A=s,this.F=new Set(s),this.V=o,this.H=new Set(o),this.W=i,this.O=new Set(i),this.q=r,this._=c,this.j=new Set(c),this.G=a,this.Z=new Set(a),this.J=d,this.K=new Set(d),this.X=f,this.Y=f?e(f):null,this.tt=m,this.et=m?e(m):null,this.nt=u,this.et&&(this.et.children[this.R]=this)}}function P(t){T.has(t)&&s({code:"STATE-202",message:`Pattern is reserved word: ${t}`,context:{h:"getStructuredPathInfo",st:t},t:"./docs/error-codes.md#state"});const e=B[t];return void 0!==e?e:B[t]=new U(t)}class ${tt;ot;name;it;level;constructor(t,e,n){this.tt=t,this.ot=t?t+"."+e:e,this.name=e,this.level=n,this.it=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.it.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.it.get(t);if(!e){const n=this.tt?this.tt+"."+this.name:this.name;e=new $(n,t,this.level+1),this.it.set(t,e)}return e}}const L=new Map;function M(t,e){let n=L.get(t);n||(n=new Map,L.set(t,n));let s=n.get(e)??null;if(s)return s;const o=P(e);return s=t.find(o.k),n.set(e,s),s}function E(t,e){const n=P(e);if(null===n.tt)return t.appendChild(e);{let e=M(t,n.tt);return null===e&&(e=E(t,n.tt)),e.appendChild(n.R)}}const D="state",k=Symbol.for(`${D}.GetByRef`),R=Symbol.for(`${D}.SetByRef`),A=Symbol.for(`${D}.ConnectedCallback`),F=Symbol.for(`${D}.DisconnectedCallback`),V=Symbol.for(`${D}.UpdatedCallback`),H=Symbol.for(`${D}.HasUpdatedCallback`),W=Symbol.for(`${D}.GetListIndexesByRef`),O=new Map;class z{static id=0;id=++z.id;name;elements;rt;nt;ct;dt;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,i=0,r="",c=0,a="none",d=[];for(let t=0;t<e.length;t++){const a=e[t];if("*"===a)n[t]="*",d.push(null),o++,c++;else{const e=Number(a);Number.isNaN(e)||(n[t]="*",d.push(e),i++,c++)}r+=a,s.push(r),r+=t<e.length-1?".":""}const l=P(n.join("."));(o>0||i>0)&&(a=o===c?"context":i===c?"all":"partial"),this.name=t,this.elements=e,this.rt=s,this.nt=c,this.ct=a,this.dt=d,this.info=l}}function _(t){let e;return O.get(t)??(O.set(t,e=new z(t)),e)}class q{info;#c;get ht(){return null===this.#c?null:this.#c.deref()??s({code:"LIST-201",message:"listIndex is null",context:{D:this.info.D,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.#c=null!==e?new WeakRef(e):null,this.key=null==e?t.D:t.D+"#"+e.D}get ut(){const t=this.info.et;if(!t)return null;return Z(t,(this.info.nt>t.nt?this.ht?.at(-2):this.ht)??null)}}const j=new WeakMap,G={};function Z(t,e){let n=null;if(null!==e){let s;if(void 0===(s=j.get(e)))n=new q(t,e),j.set(e,{[t.pattern]:n});else if(void 0===(n=s[t.pattern]))return s[t.pattern]=new q(t,e)}else if(void 0===(n=G[t.pattern]))return G[t.pattern]=new q(t,null);return n}function J(t,e){const n=t.ft;if(null==n)return null;if(null==n.info)return null;if(null==n.ht)return null;const s=n.info.q[e];return void 0!==s?n.ht.at(s):null}function K(t,e,n){switch(t.ct){case"none":return null;case"context":return J(n,t.info.X??s({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"}))??s({code:"LIST-201",message:`ListIndex not found: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#list"});case"all":let o=null;for(let n=0;n<t.info.nt;n++){const i=t.info.J[n]??s({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"}),r=Z(i,o),c=e[W](r)??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{h:"getListIndex",wt:i.pattern},t:"/docs/error-codes.md#list"}),a=t.dt[n]??s({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:t.info.pattern,index:n},t:"/docs/error-codes.md#state"});o=c[a]??s({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{h:"getListIndex",wt:i.pattern,yt:a},t:"/docs/error-codes.md#list"})}return o;case"partial":s({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${t.info.pattern}`,context:{h:"getListIndex",pattern:t.info.pattern},t:"/docs/error-codes.md#state"})}}const Q={};for(let t=0;t<32;t++)Q[`$${t+1}`]=t;let X=0,Y=0;class tt{#a=null;#d=0;#l=0;#h;#u=++Y;#f=this.#u.toString();constructor(t,e){this.#a=t,this.#d=t?t.position+1:0,this.#l=e,this.#h=X}get xt(){return this.#a}get id(){return this.#u}get D(){return this.#f}get position(){return this.#d}get length(){return this.#d+1}get index(){return this.#l}set index(t){this.#l=t,this.#h=++X,this.bt[this.#d]=t}get version(){return this.#h}get Nt(){return null!==this.#a&&(this.#a.Nt||this.#a.version>this.#h)}#m;get bt(){return null===this.#a?void 0===this.#m&&(this.#m=[this.#l]):(void 0===this.#m||this.Nt)&&(this.#m=[...this.#a.bt,this.#l],this.#h=X),this.#m}#p;get St(){return null===this.#a?void 0===this.#p&&(this.#p=[new WeakRef(this)]):void 0===this.#p&&(this.#p=[...this.#a.St,new WeakRef(this)]),this.#p}get It(){return`${this.position+1}`}at(t){return t>=0?this.St[t]?.deref()||null:this.St[this.St.length+t]?.deref()||null}}function et(t,e){return new tt(t,e)}function nt(t,e,n,o){let i;!function(t,e){if(t.vt>=0){const n=t.ft?.info??null;null!==n&&t.Bt.Tt.Ct.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Bt.Tt.Ut(n.pattern,e.info.pattern)}}(o,e);const r=o.Bt.Tt.Pt.has(e.info.pattern),c=e.info.nt>0||o.Bt.Tt.$t.has(e.info.pattern);let a=null;if(c||r){a=o.Bt.Lt(e);const t=o.Bt.Mt.get(e.info.pattern);if(null!==a){if(void 0===t)return a.value;if(a.version>o.Et.version)return a.value;if(!(a.version<t.version||a.Dt<t.Dt))return a.value}}if(o.Bt.kt.startsWith(e.info)&&0===o.Bt.Tt.$t.intersection(e.info.F).size)return o.Bt.kt.get(e);if(e.info.pattern in t){0===o.Rt.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),o.vt++,o.vt>=o.Rt.length&&o.Rt.push(null),o.Rt[o.vt]=o.ft=e;try{return i=Reflect.get(t,e.info.pattern,n)}finally{if(o.Rt[o.vt]=null,o.vt--,o.ft=o.vt>=0?o.Rt[o.vt]:null,c||r){let t=null;if(r){if(null!==o.At&&!o.At.Ft.has(e)){const t={St:a?.St??[],value:a?.value};o.At.Ft.set(e,t)}t=function(t,e,n,s){e=Array.isArray(e)?e:[];const o=[];if(0===(n=Array.isArray(n)?n:[]).length)return[];if(0===e.length){for(let e=0;e<n.length;e++){const n=et(t,e);o.push(n)}return o}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(e,n))return s;const i=new Map;for(let t=0;t<e.length;t++)i.set(e[t],t);for(let e=0;e<n.length;e++){const r=n[e],c=i.get(r);if(void 0===c){const n=et(t,e);o.push(n)}else{const t=s[c];t.index!==e&&(t.index=e),o.push(t)}}return o}(e.ht,a?.value,i,a?.St??[])}let n=a??{value:null,St:null,version:0,Dt:0};n.value=i,n.St=t,n.version=o.Et.version,n.Dt=o.Et.Dt,o.Bt.Vt(e,n)}}}else s({code:"STC-001",message:`Property "${e.info.pattern}" does not exist in state.`,t:"./docs/error-codes.md#stc"})}function st(t,e,n,o,i){const r=i.Bt.Tt.elements.has(e.info.pattern);let c=null,a=null;r&&(c=e.ut??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef (element)",Ht:e.info.pattern},t:"/docs/error-codes.md#state"}),a=i.Et.Wt.get(c)||null,null===a&&(a={value:[...o[k](c)??[]],St:[...o[W](c)??[]]},i.Et.Wt.set(c,a)));try{if(i.Bt.kt.startsWith(e.info)&&0===i.Bt.Tt.Ot.intersection(e.info.F).size)return i.Bt.kt.set(e,n);if(!(e.info.pattern in t)){const r=e.info.et??s({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef",Ht:e.info.pattern},t:"/docs/error-codes.md#state"}),c=r.nt<e.info.nt?e.ht?.xt??null:e.ht,a=nt(t,Z(r,c),o,i),d=e.info.R;if("*"===d){const t=e.ht?.index??s({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",Ht:e.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(a,t,n)}return Reflect.set(a,d,n)}i.vt++,i.vt>=i.Rt.length&&i.Rt.push(null),i.Rt[i.vt]=i.ft=e;try{return Reflect.set(t,e.info.pattern,n,o)}finally{i.Rt[i.vt]=null,i.vt--,i.ft=i.vt>=0?i.Rt[i.vt]:null}}finally{if(i.Et.zt(e),r){const t=a.value.indexOf(n),s=o[W](c)??[],r=e.ht.index,d=-1!==t?a.St[t]:et(c.ht,-1);s[r]=d;if(new Set(o[k](c)??[]).size===a.value.length){for(let t=0;t<s.length;t++)s[t].index=t;i.Et.Wt.delete(c)}}}}function ot(t,e,n,o){return(e,i,r)=>{const c=P(e),a=o.ft?.info??null;null!==a&&a.pattern!==c.pattern&&o.Bt.Tt.Ct.has(a.pattern)&&o.Bt.Tt.Ut(a.pattern,c.pattern),c.J.length>i.length&&s({code:"STATE-202",message:`indexes length is insufficient: ${e}`,context:{path:e,_t:c.J.length,qt:i.length},t:"/docs/error-codes.md#state",o:"error"});let d=null;for(let e=0;e<c.J.length;e++){const r=c.J[e],a=Z(r,d);nt(t,a,n,o);const l=n[W](a);null==l&&s({code:"LIST-201",message:`ListIndexes not found: ${r.pattern}`,context:{pattern:r.pattern},t:"/docs/error-codes.md#list",o:"error"});const h=i[e];d=l[h]??s({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{pattern:r.pattern,index:h},t:"/docs/error-codes.md#list",o:"error"})}const l=Z(c,d),h=void 0!==r;if(R in n){if(!h)return nt(t,l,n,o);st(t,l,r,n,o)}else{if(!h)return nt(t,l,n,o);s({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${e}`,context:{path:e},t:"/docs/error-codes.md#state",o:"error"})}}}function it(t,e,n,o){const i=Q[e];if(void 0!==i){const t=o.ft?.ht;return t?.bt[i]??s({code:"LIST-201",message:`ListIndex not found: ${e.toString()}`,context:{jt:String(e),bt:t?.bt??null,index:i},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof e){if("$"===e[0])switch(e){case"$resolve":return ot(t,0,n,o);case"$getAll":return function(t,e,n,o){const i=ot(t,0,n,o);return(e,r)=>{const c=P(e),a=o.ft?.info??null;if(null!==a&&a.pattern!==c.pattern&&o.Bt.Tt.Ct.has(a.pattern)&&o.Bt.Tt.Ut(a.pattern,c.pattern),void 0===r){for(let t=0;t<c._.length;t++){const e=c._[t]??s({code:"BIND-201",message:"wildcardPattern is null",context:{index:t,Gt:c.pattern},t:"/docs/error-codes.md#bind",o:"error"}),n=J(o,e.pattern);if(n){r=n.bt;break}}void 0===r&&(r=[])}const d=(e,i,r,c,a,l,h)=>{const u=e[i]??null;if(null===u)return void h.push(l);const f=Z(u,r);nt(t,f,n,o);const m=n[W](f);null===m&&s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"});const p=c[a]??null;if(null===p)for(let t=0;t<m.length;t++){const n=m[t];d(e,i+1,n,c,a+1,l.concat(n.index),h)}else{const t=m[p]??s({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:p},t:"/docs/error-codes.md#list",o:"error"});i+1<e.length?d(e,i+1,t,c,a+1,l.concat(t.index),h):h.push(l.concat(t.index))}},l=[];d(c.J,0,null,r,0,[],l);const h=[];for(let t=0;t<l.length;t++)h.push(i(c.pattern,l[t]));return h}}(t,0,n,o);case"$trackDependency":return function(t,e,n,o){return t=>{const e=o.ft?.info??s({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:t},t:"/docs/error-codes.md#state"});o.Bt.Tt.$t.has(e.pattern)&&e.pattern!==t&&o.Bt.Tt.Ut(e.pattern,t)}}(0,0,0,o);case"$navigate":return t=>Ze?.navigate(t);case"$component":return o.Bt.Zt}const i=_(e),r=K(i,n,o),c=Z(i.info,r);return nt(t,c,n,o)}if("symbol"==typeof e){if(!o.symbols.has(e))return Reflect.get(t,e,n);switch(e){case k:return e=>nt(t,e,n,o);case R:return(e,s)=>st(t,e,s,n,o);case W:return e=>function(t,e,n,o){if(o.Bt.Tt.Pt.has(e.info.pattern)||s({code:"LIST-201",message:`path is not a list: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),o.Bt.kt.startsWith(e.info)&&0===o.Bt.Tt.$t.intersection(e.info.F).size)return o.Bt.kt.Jt(e)??[];nt(t,e,n,o);const i=o.Bt.Lt(e);null===i&&s({code:"LIST-202",message:`List cache entry not found: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"});const r=i.St;return null==r&&s({code:"LIST-203",message:`List indexes not found in cache entry: ${e.info.pattern}`,context:{h:"getListIndexesByRef",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}),r}(t,e,n,o);case A:return()=>async function(t,e,n){const s=Reflect.get(t,"$connectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case F:return()=>async function(t,e,n){const s=Reflect.get(t,"$disconnectedCallback");"function"==typeof s&&await s.call(n)}(t,0,n);case V:return e=>async function(t,e,n){const s=Reflect.get(t,"$updatedCallback");if("function"==typeof s){const t=new Set,o={};for(const n of e){const e=n.info.pattern;if(t.add(e),n.info.nt>0){const t=n.ht.index;let s=o[e];void 0===s?o[e]=[t]:s.push(t)}}await s.call(n,Array.from(t),o)}}(t,e,n);case H:return()=>function(t){return"function"==typeof Reflect.get(t,"$updatedCallback")}(t)}}}let rt=class{Bt;Et;At;Rt=Array(32).fill(null);vt=-1;ft=null;Kt=null;symbols=new Set([k,W]);Qt=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,n){this.Bt=t,this.Et=e,this.At=n}get(t,e,n){return it(t,e,n,this)}set(t,e,n,o){s({code:"STATE-202",message:`Cannot set property ${String(e)} of readonly state`,context:{h:"createReadonlyStateProxy.set",jt:String(e)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.Qt.has(e)}};function ct(t,e,n){return new rt(t,e,n)}function at(t,e){return new Proxy(t,e)}class dt{Bt;Rt=Array(32).fill(null);vt=-1;ft=null;Kt=null;Et;At=null;symbols=new Set([k,R,W,A,F,V,H]);Qt=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Bt=t,this.Et=e}get(t,e,n){return it(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const i=_(e),r=K(i,s,o);return st(t,Z(i.info,r),n,s,o)}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.Qt.has(e)}}async function lt(t,e,n,o,i){const r=new dt(t,e),c=new Proxy(n,r);return async function(t,e,n){t.Kt&&s({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext"},t:"/docs/error-codes.md#state"}),t.Kt=e;try{if(e){0===t.Rt.length&&s({code:"STC-002",message:"handler.refStack is empty in getByRef"}),t.vt++,t.vt>=t.Rt.length&&t.Rt.push(null),t.Rt[t.vt]=t.ft=e.Xt;try{await n()}finally{t.Rt[t.vt]=null,t.vt--,t.ft=t.vt>=0?t.Rt[t.vt]:null}}else await n()}finally{t.Kt=null}}(r,o,(async()=>{await i(c,r)}))}class ht{#g=[];#w=new Set;#y=new Set;#x=new Set;#b;#N=null;#S=null;#I=new Map;#v=new Map;#C;constructor(t,e){this.#b=t,this.#C=e}get Yt(){return this.#g}get te(){return this.#w}get ee(){return this.#y}get se(){return this.#x}get B(){return this.#N||s({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.#N}get U(){return this.#S||s({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.#S}get Bt(){return this.#b||s({code:"UPD-001",message:"Engine not initialized",t:"./docs/error-codes.md#upd"}),this.#b}get Ft(){return this.#v}oe(t){const e=ct(this.#b,this.#C,this),n=at(this.#b.state,e);this.#N=n,this.#S=e;try{return t(n,e)}finally{this.#N=null,this.#S=null}}ie(t){this.#I.clear(),this.#x.clear(),this.#y.clear(),this.#g=[...t],this.#w=new Set(t),this.oe(((e,n)=>{const o=[],i=new Map,r=new Set;for(let e=0;e<t.length;e++){const n=t[e];if(r.add(n),!this.#b.Tt.elements.has(n.info.pattern)){o.push(n);continue}const c=n.ut??s({code:"UPD-004",message:`ParentInfo is null for ref: ${n.key}`,context:{re:n.key,pattern:n.info.pattern},t:"./docs/error-codes.md#upd"});i.has(c)||i.set(c,new Set),i.get(c).add(n)}for(const[t,e]of i){if(r.has(t)){for(const t of e)this.#x.add(t);continue}const n=this.#b.ce(t);for(let t=0;t<n.length;t++)this.#y.has(n[t])||n[t].v(this);this.se.add(t)}for(let t=0;t<o.length;t++){const e=o[t],n=M(this.#b.Tt.ae,e.info.pattern);null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.info.pattern}`,context:{pattern:e.info.pattern},t:"./docs/error-codes.md#path"}),this.se.has(e)||this.de(e,n)}if(this.#b.he.size>0)for(const t of this.#b.he){const e=this.#b.ue.get(t)??new Set;for(const t of e)t.I(o)}}))}de(t,e){this.se.add(t);const n=this.#b.ce(t);for(let t=0;t<n.length;t++)this.#y.has(n[t])||n[t].v(this);let o=new Set;if(this.#b.Tt.Pt.has(t.info.pattern)){const e=new Set(this.B[W](t)??[]),{St:n}=this.Ft.get(t)??{},s=new Set(n??[]);o=e.difference(s)}for(const[n,s]of e.it){const e=P(s.ot);if("*"===n)for(const t of o){const n=Z(e,t);this.se.has(n)||this.de(n,s)}else{const n=Z(e,t.ht);this.se.has(n)||this.de(n,s)}}const i=this.#b.Tt.fe.get(t.info.pattern);if(i)for(const t of i){const e=P(t),n=M(this.#b.Tt.ae,e.pattern);if(null===n&&s({code:"PATH-101",message:`PathNode not found: ${e.pattern}`,context:{pattern:e.pattern},t:"./docs/error-codes.md#path"}),e.nt>0){const t=e.J,s=(o,i,r)=>{const c=this.B[W](o)||[];if(i+1<t.length)for(let e=0;e<c.length;e++){const n=Z(r,c[e]);s(n,i+1,t[i+1])}else for(let t=0;t<c.length;t++){const s=Z(e,c[t]);this.se.has(s)||this.de(s,n)}},o=Z(e.J[0],null);s(o,0,e.J[1]||null)}else{const t=Z(e,null);this.se.has(t)||this.de(t,n)}}}}class ut{queue=[];#T=!1;#b;#h;#B=0;#U=new Map;#P=[];constructor(t){this.#b=t,this.#h=t.me()}get version(){return this.#h}get Dt(){return this.#B}get Wt(){return this.#U}zt(t){this.#B++,this.queue.push(t),this.#P.push(t),this.pe(this.#b,t.info.pattern,this.#b.Mt,this.#B),this.#T||(this.#T=!0,queueMicrotask((()=>{this.we()})))}async update(t,e){let n=!1;if(await lt(this.#b,this,this.#b.state,t,(async(t,s)=>{await e(t,s),n=t[H]()})),n&&this.#P.length>0){const t=this.#P;this.#P=[],queueMicrotask((()=>{this.update(null,((e,n)=>{e[V](t)}))}))}}we(){try{for(;this.queue.length>0;){const n=this.queue;this.queue=[],t=n,e=this.#b,new ht(e,this).ie(t)}}finally{this.#T=!1}var t,e}ye(t){var e;t((e=this.#b,new ht(e,this)))}xe(t,e,n,o,i){if(o.has(e))return;if(i&&t.Tt.elements.has(e))return;o.add(e);for(const[e,s]of n.it.entries()){const e=s.ot;this.xe(t,e,s,o,!1)}const r=t.Tt.fe.get(e)??[];for(const e of r){const n=M(t.Tt.ae,e);null===n&&s({code:"UPD-004",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"}),this.xe(t,e,n,o,!1)}}#$=new Map;pe(t,e,n,o){const i=M(t.Tt.ae,e);null===i&&s({code:"UPD-003",message:`Path node not found for pattern: ${e}`,t:"./docs/error-codes.md#upd"});let r=this.#$.get(e);void 0===r&&(r=new Set,this.xe(t,e,i,r,!0));const c={version:this.version,Dt:o};for(const t of r)n.set(t,c);this.#$.set(e,r)}oe(t){const e=ct(this.#b,this,null);return t(at(this.#b.state,e),e)}}function ft(t,e){return e(new ut(t))}class mt extends N{get value(){return this.node.value}get M(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,i){super(t,e,n,o,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeCheckbox.constructor",name:this.name,be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const r=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===r||"ro"===r)return;const c=this.binding.Bt;this.node.addEventListener(r,(async e=>{const n=this.binding.Se.Ne,s=this.M;await ft(c,(async e=>{await e.update(n,(async(e,n)=>{t.T.Ie,t.ve(e,n,s)}))}))}))}N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",Ce:typeof t},t:"/docs/error-codes.md#bind",o:"error"});const e=this.M;this.node.checked=t.includes(e)}}class pt extends N{N(t){Array.isArray(t)||s({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",Ce:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=t.join(" ")}}class gt extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){"boolean"!=typeof t&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",Ce:typeof t},t:"/docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.u,t)}}class wt extends N{#r;constructor(t,e,n,s,o){super(t,e,n,s,o),this.#r=this.name.slice(2);e.addEventListener(this.u,(t=>this.Te(t)))}get u(){return this.#r}update(){}async Te(t){const e=this.binding.Bt,n=this.binding.Se.Ne,o=n?.Be().map((t=>t.ht.index))??[],i=this.m;i.includes("preventDefault")&&t.preventDefault(),i.includes("stopPropagation")&&t.stopPropagation(),await ft(e,(async e=>{await e.update(n,(async(e,n)=>{const i=this.binding.T.Ie(e,n);"function"!=typeof i&&s({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,Ce:typeof i},t:"/docs/error-codes.md#bind",o:"error"}),await Reflect.apply(i,e,[t,...o])}))}))}v(t){}}const yt=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new wt(s,o,t,r,n)};class xt extends N{#u;get id(){return this.#u}constructor(t,e,n,o,i){super(t,e,n,o,i);const r=this.node.textContent?.slice(3)??s({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"});this.#u=Number(r)}}class bt extends xt{#L;#M;#E=[];#i;get p(){return this.#i}constructor(t,e,n,s,o){super(t,e,n,s,o);const i=Z(P(""),null);this.#L=be(this.binding,this.id,this.binding.Bt,i),this.#M=this.#i=[this.#L]}N(t){s({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}v(t){const e=this.binding.T.C(t.B,t.U);"boolean"!=typeof e&&s({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.update",valueType:typeof e},t:"/docs/error-codes.md#bind",o:"error"});const n=this.node.parentNode;null==n&&s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.update",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),e?(this.#L.P(),this.#L.Ue(n,this.node),this.#L.v(t),this.#i=this.#M):(this.#L.unmount(),this.#L.$(),this.#i=this.#E)}}const Nt=new Set,St=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class It extends xt{#i=[];#D=new WeakMap;#k=[];#R=0;#A=void 0;#F=void 0;#V=[];#H=new Set;get p(){return this.#i}init(){}Pe(t,e){let n;if(this.#R>=0)n=this.#k[this.#R],this.#R--,n.$e(e);else{const t=Z(this.Le,e);n=be(this.binding,this.id,this.binding.Bt,t)}return this.#D.set(e,n),n.P(),n}Me(t){t.unmount(),t.$()}get Ee(){return this.#R}set Ee(t){this.#R=t}get De(){return this.#k.length}set De(t){t<0&&s({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:t},t:"./docs/error-codes.md#bind"}),this.#k.length=t}get Le(){if(void 0===this.#A){const t=this.binding.T.pattern+".*";this.#A=P(t)}return this.#A}N(t){s({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}v(t){let e=[];const n=t.B[k](this.binding.T.Xt),o=t.B[W](this.binding.T.Xt)??[],i=new Set(o);new Set(this.#F??Nt);const r=this.#F?.length??0,c=0===i.size?this.#H:this.#H.difference(i),a=0===this.#H.size?i:i.difference(this.#H),d=n?.length??0,l=new Set,h=new Set,u=this.binding.T.info.pattern+".*";for(let e=0;e<t.Yt.length;e++){const n=t.Yt[e];if(n.info.pattern!==u)continue;if(t.se.has(n))continue;const o=n.ht;null===o&&s({code:"BIND-201",message:"ListIndex is null",context:{h:"BindingNodeFor.applyChange",Xt:n},t:"./docs/error-codes.md#bind"}),this.#H.has(o)?l.add(o):h.add(o),t.se.add(n)}const f=this.node.parentNode??s({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),m=new Set,p=r===c.size&&r>0;let g=!1;if(p){const t=Array.from(f.childNodes),e=this.#i.at(-1)??s({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let n=t[0];for(;n&&n.nodeType===Node.TEXT_NODE&&""===n.textContent?.trim();)n=n.nextSibling;let o=t.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;n===this.node&&o===e.ke(f)&&(g=!0)}if(p&&g){f.textContent="",f.append(this.node);for(let t=0;t<this.#i.length;t++)this.#i[t].$();this.#k.push(...this.#i)}else if(c.size>0){for(const t of c){const e=this.#D.get(t);void 0===e&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",Re:"removes"},t:"./docs/error-codes.md#bind"}),this.Me(e),m.add(e)}this.#k.push(...m)}let w=null;const y=this.node;this.Ee=this.De-1;const x=St&&d===a.size&&d>0;if(0===a.size&&0===c.size&&(l.size>0||h.size>0)){if(l.size>0){const t=Array.from(this.#i),n=Array.from(l);n.sort(((t,e)=>t.index-e.index));for(const e of n){const n=this.#D.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",Re:"reorder"},t:"/docs/error-codes.md#bind"}),t[e.index]=n;const o=t[e.index-1]?.ke(f)??y;n.Ue(f,o)}e=t}if(h.size>0)for(const e of h){const n=this.#D.get(e);void 0===n&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",Re:"overwrites"},t:"./docs/error-codes.md#bind"}),n.v(t)}}else{const n=new Map;for(let t=0;t<this.#V.length;t++)n.set(this.#V[t],t);const i=x?document.createDocumentFragment():f,r=x?null:y,c=[];for(let d=0;d<o.length;d++){const l=o[d],h=w?.ke(i)??r;let u;if(a.has(l))u=this.Pe(t,l),u.Ue(i,h),u.v(t);else{u=this.#D.get(l),void 0===u&&s({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",Re:"reuse"},t:"./docs/error-codes.md#bind"}),h?.nextSibling!==u.Ae&&u.Ue(i,h);const t=n.get(l);void 0!==t&&t!==d&&c.push(l)}e.push(u),w=u}if(x){const t=y.nextSibling;f.insertBefore(i,t)}for(const e of c){const n=this.binding.Fe.get(e)??[];for(const e of n)t.ee.has(e)||e.v(t)}}this.De=this.Ee+1,this.#i=e,this.#F=[...n],this.#V=[...o],this.#H=i}}const vt=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new It(s,o,t,r,n)};const Ct={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},Tt={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Bt=new Set(["value","valueAsNumber","valueAsDate"]),Ut=new Set;class Pt extends N{get value(){return this.node[this.name]}get M(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,i){super(t,e,n,o,i);if(!(this.node instanceof HTMLElement))return;if(!((r=this.node)instanceof HTMLInputElement||r instanceof HTMLTextAreaElement||r instanceof HTMLSelectElement))return;var r;const c=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Bt:t instanceof HTMLInputElement?Tt[t.type]??Bt:Ut)(this.node);if(!c.has(this.name))return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const a=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Ct[this.name]??"readonly";if("readonly"===a||"ro"===a)return;const d=this.binding.Bt;this.node.addEventListener(a,(async()=>{const e=this.binding.Se.Ne,n=this.M;await ft(d,(async s=>{await s.update(e,(async(e,s)=>{t.ve(e,s,n)}))}))}))}init(){}N(t){(null==t||Number.isNaN(t))&&(t=""),this.node[this.name]=t}}const $t=(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Pt(s,o,t,r,n)};class Lt extends N{get value(){return this.node.value}get M(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(t,e,n,o,i){super(t,e,n,o,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&s({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeRadio.constructor",name:this.name,be:i.length},t:"/docs/error-codes.md#bind",o:"error"});const r=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===r||"ro"===r)return;const c=this.binding.Bt;this.node.addEventListener(r,(async e=>{const n=this.binding.Se.Ne,s=this.M;await ft(c,(async e=>{await e.update(n,(async(e,n)=>{t.ve(e,n,s)}))}))}))}N(t){null==t&&(t="");this.node.checked=t===this.M}}class Mt extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}N(t){(null==t||Number.isNaN(t))&&(t="");this.node.style.setProperty(this.u,t.toString())}}const Et="component-state-input",Dt=Symbol.for(`${Et}.AssignState`),kt=Symbol.for(`${Et}.NotifyRedraw`),Rt=new WeakMap;class At extends N{#r;get u(){return this.#r}constructor(t,e,n,s,o){super(t,e,n,s,o);const[,i]=this.name.split(".");this.#r=i}Ve(t){const e=this.node,n=e.tagName.toLowerCase();customElements.whenDefined(n).then((()=>{e.He.promise.then((()=>{e.state[kt](t)}))}))}I(t){const e=[],n=this.binding.T.Xt,s=n.ht,o=(s?.length??0)-1;for(const i of t)i.info.pattern!==n.info.pattern&&i.info.F.has(n.info.pattern)&&(o>=0&&i.ht?.at(o)!==s||e.push(i));0!==e.length&&this.Ve(e)}v(t){this.Ve([this.binding.T.Xt])}P(){const t=this.binding.Bt;var e,n;e=t.Zt,n=this.node,Rt.set(n,e);let s=t.ue.get(this.node);void 0===s&&t.ue.set(this.node,s=new Set),s.add(this.binding)}$(){const t=this.binding.Bt;var e;e=this.node,Rt.delete(e);let n=t.ue.get(this.node);void 0!==n&&n.delete(this.binding)}}const Ft={0:{class:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new pt(s,o,t,r,n)},checkbox:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new mt(s,o,t,r,n)},radio:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Lt(s,o,t,r,n)}},1:{if:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new bt(s,o,t,r,n)}}},Vt={class:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new gt(s,o,t,r,n)},attr:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new S(s,o,t,r,n)},style:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new Mt(s,o,t,r,n)},state:(t,e,n)=>(s,o,i)=>{const r=b(i,e);return new At(s,o,t,r,n)}};const Ht={};function Wt(t,e,n,o){const i=t instanceof Comment,r=t instanceof Element,c=i+"\t"+r+"\t"+e,a=Ht[c]??(Ht[c]=function(t,e,n){const o=Ft[t?1:0][n];if(void 0!==o)return o;if(t&&"for"===n)return vt;t&&s(`getBindingNodeCreator: unknown node property ${n}`);const i=n.split("."),r=Vt[i[0]];return void 0!==r?r:e&&n.startsWith("on")?yt:$t}(i,r,e));return a(e,n,o)}class Ot{binding;pattern;info;filters;We=!1;#W=null;#O=null;#z=null;get ht(){return this.Xt.ht}get Xt(){return null===this.#W?(null===this.#z&&s({code:"BIND-201",message:"LoopContext is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"}),null===this.#O&&(this.#O=Z(this.info,this.#z.ht)),this.#O):this.#W??s({code:"BIND-201",message:"ref is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"})}constructor(t,e,n){this.binding=t,this.pattern=e,this.info=P(e),this.filters=n,this.#W=0===this.info.nt?Z(this.info,null):null}Ie(t,e){return nt(this.binding.Bt.state,this.Xt,t,e)}C(t,e){let n=nt(this.binding.Bt.state,this.Xt,t,e);for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}N(t,e,n){st(this.binding.Bt.state,this.Xt,n,t,e)}P(){if(this.info.nt>0){const t=this.info.X??s({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"});this.#z=this.binding.Se.Ne?.find(t)??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",X:t},t:"/docs/error-codes.md#bind",o:"error"}),this.#O=null}this.binding.Bt.Oe(this.Xt,this.binding)}$(){this.binding.Bt.ze(this.Xt,this.binding),this.#O=null,this.#z=null}}class zt{binding;_e;filters;#z=null;get pattern(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get ht(){return this.#z?.ht??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get Xt(){return this.#z?.Xt??s({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get We(){return!0}constructor(t,e,n){this.binding=t;const o=Number(e.slice(1));isNaN(o)&&s({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:e},t:"/docs/error-codes.md#bind"}),this._e=o,this.filters=n}Ie(t,e){return this.ht?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}C(t,e){let n=this.ht?.index??s({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}N(t,e,n){s({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}P(){const t=(this.binding.Se.Ne??s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).Be();this.#z=t[this._e-1]??s({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",_e:this._e},t:"/docs/error-codes.md#bind"});const e=this.#z.je.qe;null==e&&s({code:"BIND-201",message:"Binding for list is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"});const n=e.Fe.get(this.ht);void 0===n?e.Fe.set(this.ht,new Set([this.binding])):n.add(this.binding)}$(){this.#z=null}}const _t=new RegExp(/^\$\d+$/);function qt(t,e){return _t.test(t)?((t,e)=>(n,s)=>{const o=b(s,e);return new zt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=b(s,e);return new Ot(n,t,o)})(t,e)}const jt={};function Gt(t,e=(t=>t.constructor.name+"\t"+(t instanceof Comment?t.textContent?.[2]??"":""))(t)){return jt[e]??(jt[e]=(t=>t instanceof Comment&&":"===t.textContent?.[2]?"Text":t instanceof HTMLElement?"HTMLElement":t instanceof Comment&&"|"===t.textContent?.[2]?"Template":t instanceof SVGElement?"SVGElement":s(`Unknown NodeType: ${t.nodeType}`))(t))}const Zt=t=>t.trim(),Jt=t=>t.length>0,Kt=new RegExp(/^#(.*)#$/),Qt=t=>{const e=Kt.exec(t);return e?decodeURIComponent(e[1]):t},Xt=t=>{const[e,...n]=t.split(",").map(Zt);return{name:e,options:n.map(Qt)}},Yt=t=>{const[e,...n]=t.split("|").map(Zt);return{Ge:e,filters:n.map(Xt)}},te=t=>t.split(";").map(Zt).filter(Jt).map((t=>(t=>{const[e,n=null]=t.split("@").map(Zt),s=n?n.split(",").map(Zt):[],[o,i]=e.split(":").map(Zt),{Ge:r,filters:c}=Yt(o),{Ge:a,filters:d}=Yt(i);return{Ze:r,Je:a,Ke:c,Qe:d,m:s}})(t))),ee={};const ne=t=>{t.removeAttribute("data-bind")},se={HTMLElement:ne,SVGElement:ne,Text:void 0,Xe:void 0};const oe={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,Xe:void 0,SVGElement:void 0};class ie{nodeType;Ye;tn;en=new Map;constructor(t){this.nodeType=Gt(t);const e=function(t,e){switch(t){case"Text":return"textContent:"+(e.textContent?.slice(3).trim()??"");case"HTMLElement":case"SVGElement":return e.getAttribute(I)??"";case"Template":{const t=e.textContent?.slice(3).trim();return(fe(Number(t))??s(`Template not found: ${t}`)).getAttribute(I)??""}default:return""}}(this.nodeType,t);(function(t,e){se[e]?.(t)})(t=function(t,e){return oe[e]?.(t)??t}(t,this.nodeType),this.nodeType),this.Ye=function(t){let e=[];for(;null!==t.parentNode;)e=[Array.from(t.parentNode.childNodes).indexOf(t),...e],t=t.parentNode;return e}(t),this.tn=function(t){return""===t.trim()?[]:ee[t]??(ee[t]=te(t))}(e);for(let e=0;e<this.tn.length;e++){const n=this.tn[e],s={nn:Wt(t,n.Ze,n.Ke,n.m),sn:qt(n.Je,n.Qe)};this.en.set(n,s)}}}function re(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(I)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(v)||0===t.textContent?.indexOf(C))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const ce={},ae={},de={};function le(t){return re(t).map((t=>function(t){return new ie(t)}(t)))}const he={};function ue(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=le(e),o=de[n]??(de[n]=new Set),i=ae[n]??(ae[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.tn.length;t++){const n=e.tn[t];o.add(n.Je),"for"===n.Ze&&i.add(n.Je)}}ce[t]=s}(t,e.content,n),he[t]=e,t}function fe(t){return he[t]??s({code:"TMP-001",message:`Template not found: ${t}`,context:{h:"registerTemplate.getTemplateById",rn:t},t:"./docs/error-codes.md#tmp"})}class me{Se;node;Bt;cn;T;version;Fe=new WeakMap;isActive=!1;constructor(t,e,n,s,o){this.Se=t,this.node=e,this.Bt=n,this.cn=s(this,e,n.an),this.T=o(this,n.dn)}get p(){return this.cn.p}ve(t,e,n){return this.T.N(t,e,n)}I(t){this.cn.I(t)}v(t){if(t.ee.has(this))return;t.ee.add(this),this.cn.v(t);const e=this.T.Xt;if(!this.T.We&&!this.Bt.Tt.fe.has(e.info.pattern)){1===this.Bt.ce(e).length&&t.se.add(e)}}P(){this.isActive=!0,this.T.P(),this.cn.P()}$(){this.isActive=!1,this.cn.$(),this.T.$()}}function pe(t,e,n,s,o){return new me(t,e,n,s,o)}class ge{#O;#_;#L;constructor(t,e){this.#O=t,this.#_=t.info,this.#L=e}get Xt(){return this.#O??s({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.#_.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.Xt.info.pattern}get info(){return this.Xt.info}get ht(){return this.Xt.ht??s({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.#_.pattern},t:"/docs/error-codes.md#list"})}$e(t){this.#O=Z(this.#_,t)}ln(){this.#O=null}get je(){return this.#L}#q;get hn(){if(void 0===this.#q){let t=this.je;for(;null!==t;){if(null!==t.Kt&&t.Kt!==this){this.#q=t.Kt;break}t=t.qe?.Se??null}void 0===this.#q&&(this.#q=null)}return this.#q}#j={};find(t){let e=this.#j[t];if(void 0===e){let n=this;for(;null!==n&&n.path!==t;)n=n.hn;e=this.#j[t]=n}return e}un(t){let e=this;for(;null!==e;)t(e),e=e.hn}Be(){const t=[];return this.un((e=>{t.unshift(e)})),t}}function we(t){const e=fe(t)??s({code:"BIND-101",message:`Template not found: ${t}`,context:{h:"BindContent.createContent",rn:t},t:"./docs/error-codes.md#bind"}),n=document.importNode(e.content,!0);if(Object.keys(ze).length>0){const t=n.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){qe(t[e].tagName.toLowerCase())}}return n}function ye(t,e,n,o){const i=(t=>ce[t])(e)??s({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",rn:e},t:"./docs/error-codes.md#bind"}),r=[];for(let c=0;c<i.length;c++){const a=i[c],d=w(o,a.Ye)??s({code:"BIND-102",message:`Node not found: ${a.Ye}`,context:{h:"BindContent.createBindings",rn:e,Ye:a.Ye},t:"./docs/error-codes.md#bind"});for(let o=0;o<a.tn.length;o++){const i=a.tn[o],c=a.en.get(i)??s({code:"BIND-103",message:`Creator not found: ${i}`,context:{h:"BindContent.createBindings",rn:e,fn:i},t:"./docs/error-codes.md#bind"}),l=pe(t,d,n,c.nn,c.sn);r.push(l)}}return r}class xe{Kt;qe;childNodes;fragment;Bt;mn=[];isActive=!1;id;Ae;pn;get gn(){return this.childNodes.length>0&&this.childNodes[0].parentNode!==this.fragment}ke(t){const e=this.mn[this.mn.length-1],n=this.pn;if(void 0!==e&&e.node===n&&e.p.length>0){const n=(e.p.at(-1)??s({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",rn:this.id},t:"./docs/error-codes.md#bind"})).ke(t);if(null!==n)return n}return t!==n?.parentNode?null:n}#G;get Ne(){if(void 0===this.#G){let t=this;for(;null!==t&&null===t.Kt;)t=t.qe?.Se??null;this.#G=t?.Kt??null}return this.#G}constructor(t,e,n,s){this.qe=t,this.id=e,this.fragment=we(e),this.childNodes=Array.from(this.fragment.childNodes),this.Ae=this.childNodes[0]??null,this.pn=this.childNodes[this.childNodes.length-1]??null,this.Bt=n,this.Kt=null!==s.ht?new ge(s,this):null;const o=ye(this,e,n,this.fragment);this.mn=o}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}wn(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}Ue(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){this.#G=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}$e(t){null==this.Kt&&s({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",rn:this.id},t:"./docs/error-codes.md#bind"}),this.Kt.$e(t)}v(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.mn.length;e++){const n=this.mn[e];t.ee.has(n)||n.v(t)}}P(){this.isActive=!0;for(let t=0;t<this.mn.length;t++)this.mn[t].P()}$(){this.isActive=!1,this.Kt?.ln();for(let t=0;t<this.mn.length;t++)this.mn[t].$()}}function be(t,e,n,s){return new xe(t,e,n,s)}function Ne(t,e,n){if(e.enableShadowDom)if(null===e.yn||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.yn)){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[n]}}else s(`ComponentEngine: Shadow DOM not supported for builtin components that extend ${e.yn}`);else{const e=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=e.adoptedStyleSheets;s.includes(n)||(e.adoptedStyleSheets=[...s,n])}}class Se{xn=new Set;bn=new Set;Nn=new Map;Sn=new Map;In=new Map;vn=new Map;mn=new WeakSet;Cn(t){if(this.mn.has(t))return;const e=t.T.pattern,n=t.cn.u;this.Nn.has(e)&&s({code:"STATE-303",message:`Parent path "${e}" already has a child path`,context:{tt:e,Tn:this.Nn.get(e)},t:"./docs/error-codes.md#state"}),this.Sn.has(n)&&s({code:"STATE-303",message:`Child path "${n}" already has a parent path`,context:{Bn:n,Un:this.Sn.get(n)},t:"./docs/error-codes.md#state"}),this.Nn.set(e,n),this.Sn.set(n,e),this.xn.add(e),this.bn.add(n),this.In.set(e,t),this.vn.set(n,t),this.mn.add(t)}Pn(t){return this.Nn.get(t)}$n(t){return this.Sn.get(t)}Ln(t){const e=P(t).F.intersection(this.bn);0===e.size&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Bn:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],i=t.slice(o.length),r=this.Sn.get(o);return void 0===r&&s({code:"STATE-302",message:`No parent path found for child path "${t}"`,context:{Bn:t,Mn:o},t:"./docs/error-codes.md#state"}),r+i}En(t){const e=P(t).F.intersection(this.xn);0===e.size&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{tt:t},t:"./docs/error-codes.md#state"});const n=Array.from(e),o=n[n.length-1],i=t.slice(o.length),r=this.Nn.get(o);return void 0===r&&s({code:"STATE-302",message:`No child path found for parent path "${t}"`,context:{tt:t,Mn:o},t:"./docs/error-codes.md#state"}),r+i}Dn(t){if(0===this.bn.size)return null;const e=t.F.intersection(this.bn);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.kn(e);for(const t of n??[])this.Cn(t)}}class Ie{Rn;Bt;constructor(t,e){this.Rn=e,this.Bt=t}An(t){ft(this.Bt,(e=>{e.update(null,((e,n)=>{for(const[n,s]of Object.entries(t)){const t=Z(P(n),null);e[R](t,s)}}))}))}I(t){ft(this.Bt,(e=>{for(const n of t){let t;try{t=this.Rn.En(n.info.pattern)}catch(t){continue}const o=P(t),i=o.nt-1,r=i>=0?n.ht?.at(i)??null:null;i>=0&&null===r&&s({code:"LIST-201",message:`ListIndex not found for parent ref: ${n.info.pattern}`,context:{h:"ComponentStateInput.notifyRedraw",Fn:n.info.pattern,Vn:o.pattern},t:"/docs/error-codes.md#list"});const c=Z(o,r);this.Bt.getPropertyValue(c),e.zt(c)}}))}get(t,e,n){if(e===Dt)return this.An.bind(this);if(e===kt)return this.I.bind(this);if("string"==typeof e){const t=Z(P(e),null);return this.Bt.getPropertyValue(t)}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}set(t,e,n,o){if("string"==typeof e){const t=Z(P(e),null);return this.Bt.Hn(t,n),!0}s(`Property "${String(e)}" is not supported in ComponentStateInput.`)}}class ve{binding;Wn;#Z=new Set;constructor(t,e){this.binding=t,this.Wn=e}get(t){const e=this.binding.Dn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.vn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=Z(P(this.binding.Ln(t.info.pattern)),t.ht??n.T.ht);if(!this.#Z.has(o.info.pattern)){const e=this.Wn.Tt.Pt.has(t.info.pattern);n.Bt.Tt.addPath(o.info.pattern,e),this.#Z.add(o.info.pattern)}return n.Bt.getPropertyValue(o)}set(t,e){const n=this.binding.Dn(t.info);null===n&&s(`No child path found for path "${t.info.toString()}".`);const o=this.binding.vn.get(n);void 0===o&&s(`No binding found for child path "${n}".`);const i=Z(P(this.binding.Ln(t.info.pattern)),t.ht??o.T.ht);if(!this.#Z.has(i.info.pattern)){const e=this.Wn.Tt.Pt.has(t.info.pattern);o.Bt.Tt.addPath(i.info.pattern,e),this.#Z.add(i.info.pattern)}return o.Bt.Hn(i,e),!0}startsWith(t){return null!==this.binding.Dn(t)}Jt(t){const e=this.binding.Dn(t.info);null===e&&s(`No child path found for path "${t.info.toString()}".`);const n=this.binding.vn.get(e);void 0===n&&s(`No binding found for child path "${e}".`);const o=Z(P(this.binding.Ln(t.info.pattern)),t.ht);return n.Bt.Jt(o)}}class Ce{type="autonomous";config;On;styleSheet;zn;state;an;dn;#L=null;get je(){return null===this.#L&&s({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",_n:this.Zt.constructor.id},t:"./docs/error-codes.md#bind"}),this.#L}qn=HTMLElement;Zt;ue=new WeakMap;he=new Set;#J=Promise.withResolvers();#K=null;#Q=function(){return new Se}();jn;kt;#X=null;#Y=null;#tt=!1;#et=0;get Gn(){return this.#et}me(){return++this.#et}Mt=new Map;constructor(t,e){this.config=t,this.config.yn&&(this.type="builtin");const n=e.constructor;var s;this.On=n.On,this.styleSheet=n.styleSheet,this.zn=n.zn,this.state=new this.zn,this.an=n.an,this.dn=n.dn,this.Zt=e,this.jn=function(t,e){const n=new Ie(t,e);return new Proxy({},n)}(this,this.#Q),this.kt=(s=this.#Q,new ve(s,this))}get Tt(){return this.Zt.constructor.Tt}Zn(){for(const t in this.state)T.has(t)||this.Tt.Jn.has(t)||(this.Tt.Jn.add(t),E(this.Tt.ae,t));const t=this.Zt.constructor,e=Z(P(""),null);this.#L=be(null,t.id,this,e)}get He(){return this.#J}async connectedCallback(){if(await(this.#K?.promise),await(this.Zt.Kn?.He.promise),this.Zt.dataset.state)try{const t=JSON.parse(this.Zt.dataset.state);this.jn[Dt](t)}catch(t){s({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",Qn:this.Zt.dataset.state},t:"./docs/error-codes.md#state",i:t})}const t=this.Zt.Kn;if(t&&(t.Xn(this.Zt),this.#Q.bind(t,this.Zt)),this.config.Yn)Ne(this.Zt,this.config,this.styleSheet);else{this.#Y=this.Zt.parentNode,this.#X=document.createComment("Structive block placeholder");try{this.#tt=!0,this.Zt.replaceWith(this.#X)}finally{this.#tt=!1}}if(this.config.Yn)this.je.mount(this.Zt.shadowRoot??this.Zt);else{const t=this.#Y??s({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.je.Ue(t,this.#X)}await ft(this,(async t=>{t.ye((t=>{this.je.P(),t.oe(((e,n)=>{this.je.v(t)}))})),await t.update(null,(async(t,e)=>{await t[A]()}))})),queueMicrotask((()=>{this.#J.resolve()}))}async disconnectedCallback(){this.#K=Promise.withResolvers();try{if(this.#tt)return;await ft(this,(async t=>{await t.update(null,(async(t,e)=>{await t[F]()}))})),this.Zt.Kn?.ts(this.Zt),this.config.Yn||(this.#X?.remove(),this.#X=null,this.#Y=null)}finally{this.#K.resolve()}}Jt(t){if(this.kt.startsWith(t.info))return this.kt.Jt(t);let e=null;return ft(this,(n=>{e=n.oe(((e,n)=>e[W](t)))})),e}getPropertyValue(t){let e;return ft(this,(n=>{e=n.oe(((e,n)=>e[k](t)))})),e}Hn(t,e){ft(this,(n=>{n.update(null,((n,s)=>{n[R](t,e)}))}))}Xn(t){this.he.add(t)}ts(t){this.he.delete(t)}#nt=new WeakMap;Lt(t){return this.#nt.get(t)?.es??null}Vt(t,e){let n=this.#nt.get(t);void 0===n?this.#nt.set(t,{mn:[],es:e}):n.es=e}ce(t){return this.#nt.get(t)?.mn??[]}Oe(t,e){const n=this.#nt.get(t);void 0===n?this.#nt.set(t,{mn:[e],es:null}):n.mn.push(e)}ze(t,e){const n=this.#nt.get(t);if(void 0!==n){const t=n.mn.indexOf(e);t>=0&&n.mn.splice(t,1)}}}const Te=/\{\{([^\}]+)\}\}/g,Be=new Set(["if","for","endif","endfor","elseif","else"]);const Ue="http://www.w3.org/2000/svg";function Pe(t,e,n=t){if(e.parentNode?.replaceChild(document.createComment(`${C}${t}`),e),e.namespaceURI===Ue){const t=document.createElement("template"),n=Array.from(e.childNodes);for(let e=0;e<n.length;e++){const s=n[e];t.content.appendChild(s)}const s=e.getAttribute(I);t.setAttribute(I,s??""),e=t}return e.content.querySelectorAll("template").forEach((t=>{Pe(f(),t,n)})),ue(t,e,n),t}function $e(t,e){const n=document.createElement("template");n.dataset.id=t.toString(),n.innerHTML=function(t){const e=[];return t.replaceAll(Te,((t,n)=>{n=n.trim();const[o]=n.split(":");if(!Be.has(o))return`\x3c!--${v}${n}--\x3e`;const i=n.slice(o.length+1).trim(),r={type:o,ns:n,ss:i};if("if"===o||"for"===o)return e.push(r),`<template data-bind="${n}">`;if("endif"===o){const t=[];for(;;){const o=e.pop()??s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",ns:n,rs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===o.type){t.push("</template>");break}"elseif"===o.type?t.push("</template>"):s({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",cs:o.type,ns:n},t:"./docs/error-codes.md#tmp"})}return t.join("")}if("endfor"===o){const t=e.pop()??s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",ns:n,rs:e.length},t:"./docs/error-codes.md#tmp"});if("for"===t.type)return"</template>";s({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",cs:t.type,ns:n},t:"./docs/error-codes.md#tmp"})}else if("elseif"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",ns:n,rs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type||"elseif"===t.type)return e.push(r),`</template><template data-bind="if:${t.ss}|not"><template data-bind="if:${i}">`;s({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",cs:t.type,ns:n},t:"./docs/error-codes.md#tmp"})}else if("else"===o){const t=e.at(-1)??s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",ns:n,rs:e.length},t:"./docs/error-codes.md#tmp"});if("if"===t.type)return`</template><template data-bind="if:${t.ss}|not">`;s({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",cs:t.type,ns:n},t:"./docs/error-codes.md#tmp"})}else s({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:o,ns:n},t:"./docs/error-codes.md#tmp"})}))}(e),Pe(t,n)}const Le=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Me=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function Ee(t,e){const n=new Set(t.A).intersection(e);let o=-1,i="";for(const t of n){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,i=t))}if(i.length>0){Me.test(i)||s({code:"STATE-202",message:`Invalid path: ${i}`,context:{ds:i},t:"./docs/error-codes.md#state"});const e=P(i),n=[];let o=e.nt;for(let r=e.k.length;r<t.k.length;r++){const e=t.k[r];"*"===e?(n.push("[this.$"+(o+1)+"]"),o++):(Le.test(e)||s({code:"STATE-202",message:`Invalid segment name: ${e}`,context:{ls:e,ds:i},t:"./docs/error-codes.md#state"}),n.push("."+e))}const r=n.join(""),c=`this["${i}"]${r} = value;`;return{get:new Function("",`return this["${i}"]${r};`),set:new Function("value",c)}}{const e=[];let n=0;for(let o=0;o<t.k.length;o++){const i=t.k[o];"*"===i?(e.push("[this.$"+(n+1)+"]"),n++):(Le.test(i)||s({code:"STATE-202",message:`Invalid segment name: ${i}`,context:{ls:i},t:"./docs/error-codes.md#state"}),e.push((e.length>0?".":"")+i))}const o=e.join(""),i=`this.${o} = value;`;return{get:new Function("",`return this.${o};`),set:new Function("value",i)}}}class De{Jn=new Set;Pt=new Set;elements=new Set;hs=new Set;$t=new Set;Ct=new Set;Ot=new Set;us=new Set;fs=new Set;ps=new Map;fe=new Map;ae=function(){return new $("","",0)}();#u;#st;constructor(t){this.#u=t.id,this.#st=t.zn;const e=(t=>de[t]??[])(this.#u);for(const t of e){const e=P(t);this.Jn=this.Jn.union(e.F)}const n=(t=>ae[t]??[])(this.#u);this.Pt=this.Pt.union(n);for(const t of n){const e=t+".*";this.elements.add(e)}let s=this.#st.prototype;for(;s&&s!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(s);if(t)for(const[e,n]of Object.entries(t)){if(T.has(e))continue;if("function"==typeof n.value){this.hs.add(e);continue}const t=void 0!==n.get,s=void 0!==n.set,o=P(e);this.Jn=this.Jn.union(o.F),t&&this.$t.add(e),s&&this.Ot.add(e),t&&!s&&this.Ct.add(e),t&&s&&this.us.add(e)}s=Object.getPrototypeOf(s)}for(const t of this.Jn){if(this.$t.has(t))continue;if(this.Ot.has(t))continue;const e=P(t);if(1===e.k.length)continue;const n=Ee(e,this.$t);Object.defineProperty(this.#st.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.fs.add(t)}for(const t of this.Jn){E(this.ae,t);const e=P(t);e.tt&&(this.ps.get(e.tt)?.add(t)??this.ps.set(e.tt,new Set([t])))}}addPath(t,e=!1){const n=P(t);if(e&&!this.Pt.has(t)){this.Pt.add(t);const e=t+".*";this.elements.add(e)}for(const t of n.F){if(this.Jn.has(t))continue;this.Jn.add(t),E(this.ae,t);const e=P(t);if(e.k.length>1){const n=Ee(e,this.$t);Object.defineProperty(this.#st.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.fs.add(t)}e.tt&&(this.ps.get(e.tt)?.add(t)??this.ps.set(e.tt,new Set([t])))}}#ot=new Set;Ut(t,e){const n=e+"=>"+t;this.#ot.has(n)||(this.Jn.has(e)||this.addPath(e),this.#ot.add(n),this.fe.get(e)?.add(t)??this.fe.set(e,new Set([t])))}}function ke(t){const n=function(t){const n=e();return{Yn:void 0===t.Yn||t.Yn,enableShadowDom:t.enableShadowDom??n.enableShadowDom,yn:t.yn??null}}(t.zn.gs??{}),o=f(),{ws:i,ys:r,zn:c}=t,a=Object.assign({},h),d=Object.assign({},l);c.xs=!0,$e(o,i),g(o,r),function(t,e){m[t]=e}(o,c);const u=function(t){return t?document.createElement(t).constructor:HTMLElement}(n.yn),w=n.yn;return class extends u{#b;constructor(){super(),this.#b=function(t,e){return new Ce(t,e)}(n,this),this.#b.Zn()}connectedCallback(){this.#b.connectedCallback()}disconnectedCallback(){this.#b.disconnectedCallback()}#it;get Kn(){var t;return void 0===this.#it&&(this.#it=(t=this,Rt.get(t)??null)),this.#it}get state(){return this.#b.jn}get bs(){return this.#b.zn.xs??!1}get He(){return this.#b.He}kn(t){return this.#b.ue.get(t)??null}Xn(t){this.#b.Xn(t)}ts(t){this.#b.ts(t)}static define(t){w?customElements.define(t,this,{yn:w}):customElements.define(t,this)}static get id(){return o}static#rt=i;static get ws(){return this.#rt}static set ws(t){this.#rt=t,$e(this.id,t),this.#ct=null,this.#at=null}static#dt=r;static get ys(){return this.#dt}static set ys(t){this.#dt=t,g(this.id,t),this.#lt=null}static#ct=null;static get On(){return this.#ct||(this.#ct=fe(this.id)),this.#ct}static#lt=null;static get styleSheet(){return this.#lt||(this.#lt=function(t){return p[t]??s({code:"CSS-001",message:`Stylesheet not found: ${t}`,context:{h:"registerStyleSheet.getStyleSheetById",Ns:t},t:"./docs/error-codes.md#css"})}(this.id)),this.#lt}static#st=null;static get zn(){return this.#st||(this.#st=function(t){return m[t]??s({code:"STATE-101",message:`StateClass not found: ${t}`,context:{h:"registerStateClass.getStateClassById",Ss:t},t:"./docs/error-codes.md#state"})}(this.id)),this.#st}static#ht=a;static get an(){return this.#ht}static#ut=d;static get dn(){return this.#ut}static#at=null;static get Tt(){return this.#at||(this.#at=new De(this)),this.#at}}}function Re(t){return t.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((t,e)=>`{{${e}}}`))}let Ae=0;async function Fe(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t){const e=document.createElement("template");e.innerHTML=function(t){return t.replaceAll(/\{\{([^\}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(t);const n=e.content.querySelector("template");n?.remove();const s=e.content.querySelector("script[type=module]");let o={};if(s){const t=`\r\n/*__UNIQ_ID_${Ae++}__*/`,e=btoa(String.fromCodePoint(...(new TextEncoder).encode(s.text+t)));o=await import("data:application/javascript;base64,"+e)}s?.remove();const i=e.content.querySelector("style");i?.remove();const r=o.default??class{};return{text:t,ws:Re(n?.innerHTML??"").trim(),ys:i?.textContent??"",zn:r}}(await n.text())}function Ve(t,e){e.define(t)}const He="@routes/",We="@components/",Oe="#lazy",ze={};async function _e(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(He)){s=n.endsWith(Oe);const e=n.slice(7,s?-5:void 0);t="routes"+e.replace(/:[^\s/]+/g,"").replace(/\//g,"-"),Ke(t,"/root"===e?"/":e)}n.startsWith(We)&&(s=n.endsWith(Oe),t=n.slice(12,s?-5:void 0)),t&&(s?ze[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){Ve(t,ke(await Fe(n)))}}}function qe(t){const e=ze[t];if(e)delete ze[t],queueMicrotask((async()=>{const n=ke(await Fe(e));Ve(t,n)}));else{const e={code:"IMP-201",message:`Alias not found for tagName: ${t}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:t},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(e.message,{code:e.code,context:e.context,t:e.t,o:e.o})}}const je="routes:",Ge=[];let Ze=null;class Je extends HTMLElement{Is=window.location.pathname;vs=window.location.pathname.split("/").pop()||"";Cs=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Ts;constructor(){super(),this.Ts=this.Bs.bind(this)}connectedCallback(){Ze=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Ts),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Ts),Ze=null}Bs(t){t.preventDefault(),this.ie()}navigate(t){const e="/"===t[0]?this.Cs+t.slice(1):t;history.pushState({},"",e),this.ie()}ie(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.vs&&(t[t.length-1]="");const e=t.join("/").replace(this.Cs,""),n="/"!==e[0]?"/"+e:e;let s,o={};for(const[t,e]of Ge){const i=new RegExp("^"+t.replace(/:[^\s/]+/g,"([^/]+)")+"$");if(i.test(n)){s=e;const r=n.match(i);if(r){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=r[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return ze.hasOwnProperty(t)}(s)&&qe(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function Ke(t,e){e.startsWith(je)&&(e=e.substring(je.length)),Ge.push([e,t])}const Qe="router",Xe=`<slot name="${Qe}"></slot>`;class Ye extends HTMLElement{constructor(){super(),n.enableShadowDom&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Us(),this.ie()}get root(){return this.shadowRoot??this}async Us(){if(n.layoutPath){const t=await fetch(n.layoutPath);if(t.ok){const e=await t.text(),n=document.createElement("template");n.innerHTML=e;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else s({code:"TMP-101",message:`Failed to load layout from ${n.layoutPath}`,context:{layoutPath:n.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=Xe}ie(){if(n.enableRouter){const t=document.createElement(n.routerTagName);t.setAttribute("slot",Qe),this.root.appendChild(t)}}}const tn=n;let en=!1;async function nn(t){await async function(t){for(const[e,s]of Object.entries(t)){let t=null;if(n.enableRouter){const t=s.startsWith("@routes")?s.slice(7):s;Ke(e,"/root"===t?"/":t)}t=await Fe(s),Ve(e,ke(t))}}(t),tn.autoInit&&await sn()}async function sn(){en||(await async function(){if(n.autoLoadFromImportMap&&await _e(),n.enableRouter&&customElements.define(n.routerTagName,Je),n.enableMainWrapper&&(customElements.define(n.mainTagName,Ye),n.autoInsertMainWrapper)){const t=document.createElement(n.mainTagName);document.body.appendChild(t)}}(),en=!0)}export{sn as bootstrapStructive,tn as config,nn as defineComponents};
//# sourceMappingURL=structive.min.js.map
