function t(t){if("string"==typeof t)throw new Error(t);const{message:e,code:n,context:s,hint:o,t:r,o:i,i:c}=t,d=new Error(e);throw d.code=n,s&&(d.context=s),o&&(d.hint=o),r&&(d.t=r),i&&(d.o=i),c&&(d.i=c),d}const e={debug:!1,locale:"en-US",shadowDomMode:"auto",enableMainWrapper:!0,enableRouter:!0,autoInsertMainWrapper:!1,autoInit:!0,mainTagName:"app-main",routerTagName:"view-router",layoutPath:"",autoLoadFromImportMap:!1};function n(){return e}const s=n();function o(e){t({code:"FLT-202",message:`${e} requires at least one option`,context:{l:e},t:"./docs/error-codes.md#flt"})}function r(e){t({code:"FLT-202",message:`${e} requires a number as option`,context:{l:e},t:"./docs/error-codes.md#flt"})}function i(e){t({code:"FLT-202",message:`${e} requires a number value`,context:{l:e},t:"./docs/error-codes.md#flt"})}function c(e){t({code:"FLT-202",message:`${e} requires a string value`,context:{l:e},t:"./docs/error-codes.md#flt"})}function d(e){t({code:"FLT-202",message:`${e} requires a date value`,context:{l:e},t:"./docs/error-codes.md#flt"})}const a=n();function l(t){return!(!t||isNaN(Number(t)))}const h={eq:t=>{const e=t?.[0]??o("eq");return t=>"number"==typeof t?(l(e)&&r("eq"),t===Number(e)):t===e},ne:t=>{const e=t?.[0]??o("ne");return t=>"number"==typeof t?(l(e)&&r("ne"),t!==Number(e)):t!==e},not:e=>e=>{var n;return"boolean"!=typeof e&&t({code:"FLT-202",message:`${n="not"} requires a boolean value`,context:{l:n},t:"./docs/error-codes.md#flt"}),!e},lt:t=>{const e=t?.[0]??o("lt");return l(e)&&r("lt"),t=>("number"!=typeof t&&i("lt"),t<Number(e))},le:t=>{const e=t?.[0]??o("le");return l(e)&&r("le"),t=>("number"!=typeof t&&i("le"),t<=Number(e))},gt:t=>{const e=t?.[0]??o("gt");return l(e)&&r("gt"),t=>("number"!=typeof t&&i("gt"),t>Number(e))},ge:t=>{const e=t?.[0]??o("ge");return l(e)&&r("ge"),t=>("number"!=typeof t&&i("ge"),t>=Number(e))},inc:t=>{const e=t?.[0]??o("inc");return l(e)&&r("inc"),t=>("number"!=typeof t&&i("inc"),t+Number(e))},dec:t=>{const e=t?.[0]??o("dec");return l(e)&&r("dec"),t=>("number"!=typeof t&&i("dec"),t-Number(e))},mul:t=>{const e=t?.[0]??o("mul");return l(e)&&r("mul"),t=>("number"!=typeof t&&i("mul"),t*Number(e))},div:t=>{const e=t?.[0]??o("div");return l(e)&&r("div"),t=>("number"!=typeof t&&i("div"),t/Number(e))},mod:t=>{const e=t?.[0]??o("mod");return l(e)&&r("mod"),t=>("number"!=typeof t&&i("mod"),t%Number(e))},fix:t=>{const e=t?.[0]??"0";return l(e)&&r("fix"),t=>("number"!=typeof t&&i("fix"),t.toFixed(Number(e)))},locale:t=>{const e=t?.[0]??a.locale;return t=>("number"!=typeof t&&i("locale"),t.toLocaleString(e))},uc:t=>t=>("string"!=typeof t&&c("uc"),t.toUpperCase()),lc:t=>t=>("string"!=typeof t&&c("lc"),t.toLowerCase()),cap:t=>t=>{"string"!=typeof t&&c("cap");const e=(t??"").toString();return 0===e.length?e:1===e.length?e.toUpperCase():e.charAt(0).toUpperCase()+e.slice(1)},trim:t=>t=>("string"!=typeof t&&c("trim"),t.trim()),slice:t=>{const e=t?.[0]??o("slice");return l(e)&&r("slice"),t=>("string"!=typeof t&&c("slice"),t.slice(Number(e)))},substr:t=>{const e=t?.[0]??o("substr");l(e)&&r("substr");const n=t?.[1]??o("substr");return l(n)&&r("substr"),t=>("string"!=typeof t&&c("substr"),t.substr(Number(e),Number(n)))},pad:t=>{const e=t?.[0]??o("pad");l(e)&&r("pad");const n=t?.[1]??"0";return t=>("string"!=typeof t&&c("pad"),t.padStart(Number(e),n))},rep:t=>{const e=t?.[0]??o("rep");return l(e)&&r("rep"),t=>("string"!=typeof t&&c("rep"),t.repeat(Number(e)))},rev:t=>t=>("string"!=typeof t&&c("rev"),t.split("").reverse().join("")),int:t=>t=>("string"!=typeof t&&c("int"),parseInt(t,10)),float:t=>t=>("string"!=typeof t&&c("float"),parseFloat(t)),round:t=>{const e=t?.[0]??"0";return l(e)&&r("round"),t=>{"number"!=typeof t&&i("round");const n=Math.pow(10,Number(e));return Math.round(t*n)/n}},floor:t=>{const e=t?.[0]??"0";return l(e)&&r("floor"),t=>{"number"!=typeof t&&i("floor");const n=Math.pow(10,Number(e));return Math.floor(t*n)/n}},ceil:t=>{const e=t?.[0]??"0";return l(e)&&r("ceil"),t=>{"number"!=typeof t&&i("ceil");const n=Math.pow(10,Number(e));return Math.ceil(t*n)/n}},percent:t=>{const e=t?.[0]??"0";return l(e)&&r("percent"),t=>("number"!=typeof t&&i("percent"),`${(100*t).toFixed(Number(e))}%`)},date:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("date"),t.toLocaleDateString(e))},time:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("time"),t.toLocaleTimeString(e))},datetime:t=>{const e=t?.[0]??a.locale;return t=>(t instanceof Date||d("datetime"),t.toLocaleString(e))},ymd:t=>{const e=t?.[0]??"-";return t=>{t instanceof Date||d("ymd");const n=t.getFullYear().toString(),s=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return`${n}${e}${s}${e}${o}`}},falsy:t=>t=>!1===t||null==t||0===t||""===t||Number.isNaN(t),truthy:t=>t=>!1!==t&&null!=t&&0!==t&&""!==t&&!Number.isNaN(t),defaults:t=>{const e=t?.[0]??o("defaults");return t=>!1===t||null==t||0===t||""===t||Number.isNaN(t)?e:t},boolean:t=>t=>Boolean(t),number:t=>t=>Number(t),string:t=>t=>String(t),null:t=>t=>""===t?null:t},u=h,f=h;let m=0;function p(){return++m}const g={};const y={};function w(t,e){const n=new CSSStyleSheet;n.replaceSync(e),function(t,e){y[t]=e}(t,n)}function x(t,e){let n=t;if(0===e.length)return n;for(let t=0;t<e.length&&(n=n?.childNodes[e[t]]??null,null!==n);t++);return n}function b(e,n){const s=e[n.name];return s||t({code:"FLT-201",message:`Filter not found: ${n.name}`,context:{h:"createFilters.textToFilter",name:n.name},t:"./docs/error-codes.md#flt"}),s(n.options)}const S=new Map;function v(t,e){let n=S.get(e);if(void 0===n){n=[];for(let s=0;s<e.length;s++)n.push(b(t,e[s]));S.set(e,n)}return n}class C{u;m;p;S;v;C;get node(){return this.m}get name(){return this.p}get I(){return this.S}get binding(){return this.u}get N(){return this.C}get filters(){return this.v}get T(){return[]}constructor(t,e,n,s,o,r){this.u=t,this.m=e,this.p=n,this.S=s,this.v=o,this.C=r}U(e){t({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.assignValue",name:this.name},t:"/docs/error-codes.md#bind"})}B(e,n){t({code:"BIND-301",message:"Not implemented",context:{h:"BindingNode.updateElements",name:this.name},t:"/docs/error-codes.md#bind"})}$(t){}P(t){const e=this.binding.M.L(t._,t.k);this.U(e)}D(){}A(){}get R(){return this.node instanceof HTMLSelectElement}get value(){return null}get F(){return null}}class I extends C{U(t){const e=this.node,n=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.setAttribute(this.I,n)}}const N="data-bind",T="@@:",U="@@|",B=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","watch","unwatch","eval","arguments","let","var","const","class","function","null","true","false","new","return"]),$="$connectedCallback",P="$disconnectedCallback",L="$updatedCallback",E={};class M{static id=0;id=++M.id;V=this.id.toString();pattern;O;W;H;j;q;G;Z;J;K;X;Y;tt;et;nt;st;ot;rt;it;ct;dt;constructor(t){const e=e=>t===e?this:_(e),n=t.split("."),s=[],o=[],r=[],i={},c=[],d=[],a=[];let l="",h="",u=0;for(let t=0;t<n.length;t++)l+=n[t],"*"===n[t]&&(r.push(l),i[l]=u,c.push(e(l)),d.push(h),a.push(e(h)),u++),s.push(l),o.push(e(l)),h=l,l+=".";const f=r.length>0?r[r.length-1]:null,m=s.length>1?s[s.length-2]:null;this.pattern=t,this.O=n,this.W=n[n.length-1],this.H=s,this.j=new Set(s),this.q=o,this.G=new Set(o),this.Z=r,this.J=new Set(r),this.X=i,this.K=c,this.Y=new Set(c),this.tt=d,this.et=new Set(d),this.nt=a,this.st=new Set(a),this.ot=f,this.rt=f?e(f):null,this.it=m,this.ct=m?e(m):null,this.dt=u}}function _(e){B.has(e)&&t({code:"STATE-202",message:`Pattern is reserved word: ${e}`,context:{h:"getStructuredPathInfo",ht:e},t:"./docs/error-codes.md#state"});const n=E[e];return void 0!==n?n:E[e]=new M(e)}class k{it;ut;name;ft;level;constructor(t,e,n){this.it=t,this.ut=t?`${t}.${e}`:e,this.name=e,this.level=n,this.ft=new Map}find(t,e=0){if(e>=t.length)return null;const n=t[e],s=this.ft.get(n);return s?e===t.length-1?s:s.find(t,e+1):null}appendChild(t){let e=this.ft.get(t);if(!e){const n=this.it?`${this.it}.${this.name}`:this.name;e=new k(n,t,this.level+1),this.ft.set(t,e)}return e}}const D=new Map;function A(t,e){let n=D.get(t);n||(n=new Map,D.set(t,n));let s=n.get(e)??null;if(s)return s;const o=_(e);return s=t.find(o.O),n.set(e,s),s}function R(t,e){const n=_(e);if(null===n.it)return t.appendChild(e);{let e=A(t,n.it);return null===e&&(e=R(t,n.it)),e.appendChild(n.W)}}const F="state",V=Symbol.for(`${F}.GetByRef`),O=Symbol.for(`${F}.SetByRef`),W=Symbol.for(`${F}.ConnectedCallback`),H=Symbol.for(`${F}.DisconnectedCallback`),j=Symbol.for(`${F}.UpdatedCallback`),q=Symbol.for(`${F}.GetListIndexesByRef`),z=new Map;class G{static id=0;id=++G.id;name;elements;yt;dt;wt;xt;info;constructor(t){const e=t.split("."),n=e.slice(),s=[];let o=0,r=0,i="",c=0,d="none";const a=[];for(let t=0;t<e.length;t++){const d=e[t];if("*"===d)n[t]="*",a.push(null),o++,c++;else{const e=Number(d);Number.isNaN(e)||(n[t]="*",a.push(e),r++,c++)}i+=d,s.push(i),i+=t<e.length-1?".":""}const l=_(n.join("."));(o>0||r>0)&&(d=o===c?"context":r===c?"all":"partial"),this.name=t,this.elements=e,this.yt=s,this.dt=c,this.wt=d,this.xt=a,this.info=l}}function Z(t){let e;return z.get(t)??(z.set(t,e=new G(t)),e)}class J{info;bt;get St(){return null===this.bt?null:this.bt.deref()??t({code:"LIST-201",message:"listIndex is null",context:{V:this.info.V,key:this.key},t:"./docs/error-codes.md#list"})}key;constructor(t,e){this.info=t,this.bt=null!==e?new WeakRef(e):null,this.key=null===e?t.V:`${t.V}#${e.V}`}get vt(){const t=this.info.ct;if(!t)return null;return X(t,(this.info.dt>t.dt?this.St?.at(-2):this.St)??null)}}const K=new WeakMap,Q={};function X(t,e){let n=null;if(null!==e){let s;if(void 0===(s=K.get(e)))n=new J(t,e),K.set(e,{[t.pattern]:n});else if(void 0===(n=s[t.pattern]))return s[t.pattern]=new J(t,e)}else if(void 0===(n=Q[t.pattern]))return Q[t.pattern]=new J(t,null);return n}function Y(t,e){const n=t.Ct;if(null===n)return null;if(null===n.St)return null;const s=n.info.X[e];return void 0!==s?n.St.at(s):null}function tt(e,n,s){switch(e.wt){case"none":return null;case"context":return Y(s,e.info.ot??t({code:"STATE-202",message:"lastWildcardPath is null",context:{h:"getListIndex",pattern:e.info.pattern},t:"/docs/error-codes.md#state"}))??t({code:"LIST-201",message:`ListIndex not found: ${e.info.pattern}`,context:{h:"getListIndex",pattern:e.info.pattern},t:"/docs/error-codes.md#list"});case"all":{let s=null;for(let o=0;o<e.info.dt;o++){const r=e.info.nt[o]??t({code:"STATE-202",message:"wildcardParentPattern is null",context:{h:"getListIndex",pattern:e.info.pattern,index:o},t:"/docs/error-codes.md#state"}),i=X(r,s),c=n[q](i)??t({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",It:r.pattern},t:"/docs/error-codes.md#list"}),d=e.xt[o]??t({code:"STATE-202",message:"wildcardIndex is null",context:{h:"getListIndex",pattern:e.info.pattern,index:o},t:"/docs/error-codes.md#state"});s=c[d]??t({code:"LIST-201",message:`ListIndex not found: ${r.pattern}`,context:{h:"getListIndex",It:r.pattern,Nt:d},t:"/docs/error-codes.md#list"})}return s}case"partial":t({code:"STATE-202",message:`Partial wildcard type is not supported yet: ${e.info.pattern}`,context:{h:"getListIndex",pattern:e.info.pattern},t:"/docs/error-codes.md#state"})}}const et={};for(let t=0;t<32;t++)et[`$${t+1}`]=t;let nt=0,st=0;class ot{id=++st;V=st.toString();Tt;position;length;Ut;Bt;$t;Pt;constructor(t,e){this.Tt=t,this.position=t?t.position+1:0,this.length=this.position+1,this.Ut=e,this.Bt=nt}get index(){return this.Ut}set index(t){this.Ut=t,this.Bt=++nt,this.Lt[this.position]=t}get version(){return this.Bt}get Et(){return null!==this.Tt&&(this.Tt.Et||this.Tt.version>this.Bt)}get Lt(){return null===this.Tt?void 0===this.$t&&(this.$t=[this.Ut]):(void 0===this.$t||this.Et)&&(this.$t=[...this.Tt.Lt,this.Ut],this.Bt=nt),this.$t}get Mt(){return null===this.Tt?void 0===this.Pt&&(this.Pt=[new WeakRef(this)]):void 0===this.Pt&&(this.Pt=[...this.Tt.Mt,new WeakRef(this)]),this.Pt}get _t(){return`$${this.position+1}`}at(t){return t>=0?this.Mt[t]?.deref()||null:this.Mt[this.Mt.length+t]?.deref()||null}}function rt(t,e){return new ot(t,e)}function it(e,n,s,o){let r;!function(t,e){if(t.kt>=0){const n=t.Ct?.info??null;null!==n&&t.Rt.At.Dt.has(n.pattern)&&n.pattern!==e.info.pattern&&t.Rt.At.Ft(n.pattern,e.info.pattern)}}(o,n);const i=o.Rt.At.Vt.has(n.info.pattern),c=n.info.dt>0||o.Rt.At.Ot.has(n.info.pattern);let d=null;if(c||i){d=o.Rt.Wt(n);const t=o.Rt.Ht.get(n.info.pattern);if(null!==d){if(void 0===t)return d.value;if(d.version>o.jt.version)return d.value;if(!(d.version<t.version||d.qt<t.qt))return d.value}}if(o.Rt.zt.startsWith(n.info)&&0===o.Rt.At.Ot.intersection(n.info.j).size)return o.Rt.zt.get(n);if(n.info.pattern in e){0===o.Gt.length&&t({code:"STC-002",message:"handler.refStack is empty in getByRef"}),o.kt++,o.kt>=o.Gt.length&&o.Gt.push(null),o.Gt[o.kt]=o.Ct=n;try{return r=Reflect.get(e,n.info.pattern,s)}finally{if(o.Gt[o.kt]=null,o.kt--,o.Ct=o.kt>=0?o.Gt[o.kt]:null,c||i){let e=null;if(i){if(null!==o.Zt&&!o.Zt.Jt.has(n))if(d){const e=d.Mt??[],s=d.value;Array.isArray(s)||t({code:"STC-001",message:`Property "${n.info.pattern}" is expected to be an array for list management.`,t:"./docs/error-codes.md#stc"}),o.Zt.Jt.set(n,{Mt:e,value:s})}else o.Zt.Jt.set(n,{Mt:[],value:[]});e=function(t,e,n,s){const o=Array.isArray(e)?e:[],r=Array.isArray(n)?n:[],i=[];if(0===r.length)return[];if(0===o.length){for(let e=0;e<r.length;e++){const n=rt(t,e);i.push(n)}return i}if(function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}(o,r))return s;const c=new Map;for(let t=0;t<o.length;t++)c.set(o[t],t);for(let e=0;e<r.length;e++){const n=r[e],o=c.get(n);if(void 0===o){const n=rt(t,e);i.push(n)}else{const t=s[o];t.index!==e&&(t.index=e),i.push(t)}}return i}(n.St,d?.value,r,d?.Mt??[])}const s=d??{value:null,Mt:null,version:0,qt:0};s.value=r,s.Mt=e,s.version=o.jt.version,s.qt=o.jt.qt,o.Rt.Kt(n,s)}}}else t({code:"STC-001",message:`Property "${n.info.pattern}" does not exist in state.`,t:"./docs/error-codes.md#stc"})}function ct(e,n,s,o,r){const i=r.Rt.At.elements.has(n.info.pattern);let c=null,d=null;if(i&&(c=n.vt??t({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef (element)",Qt:n.info.pattern},t:"/docs/error-codes.md#state"}),d=r.jt.Xt.get(c)||null,null===d)){const e=o[V](c)??[];Array.isArray(e)||t({code:"STATE-202",message:"Expected array value for list elements",context:{h:"setByRef (element)",Qt:c.info.pattern},t:"/docs/error-codes.md#state"}),d={value:[...e],Mt:[...o[q](c)??[]]},r.jt.Xt.set(c,d)}try{if(r.Rt.zt.startsWith(n.info)&&0===r.Rt.At.Yt.intersection(n.info.j).size)return r.Rt.zt.set(n,s);if(!(n.info.pattern in e)){const i=n.info.ct??t({code:"STATE-202",message:"propRef.stateProp.parentInfo is undefined",context:{h:"setByRef",Qt:n.info.pattern},t:"/docs/error-codes.md#state"}),c=X(i,i.dt<n.info.dt?n.St?.Tt??null:n.St),d=it(e,c,o,r);null!==d&&"object"==typeof d||t({code:"STATE-202",message:"Parent value is not an object",context:{h:"setByRef",Qt:c.info.pattern},t:"/docs/error-codes.md#state"});const a=n.info.W;if("*"===a){const e=n.St?.index??t({code:"STATE-202",message:"propRef.listIndex?.index is undefined",context:{h:"setByRef",Qt:n.info.pattern},t:"/docs/error-codes.md#state"});return Reflect.set(d,e,s)}return Reflect.set(d,a,s)}r.kt++,r.kt>=r.Gt.length&&r.Gt.push(null),r.Gt[r.kt]=r.Ct=n;try{return Reflect.set(e,n.info.pattern,s,o)}finally{r.Gt[r.kt]=null,r.kt--,r.Ct=r.kt>=0?r.Gt[r.kt]:null}}finally{if(r.jt.te(n),i){const e=d.value.indexOf(s),i=o[q](c)??[],a=n.St.index,l=-1!==e?d.Mt[e]:rt(c.St,-1);i[a]=l;const h=o[V](c)??[];null!==h&&Array.isArray(h)||t({code:"STATE-202",message:"Parent value is not an array during swap check",context:{h:"setByRef (element swap)",Qt:c.info.pattern},t:"/docs/error-codes.md#state"});if(new Set(h).size===d.value.length){for(let t=0;t<i.length;t++)i[t].index=t;r.jt.Xt.delete(c)}}}}function dt(e,n,s,o){return(n,r,i)=>{const c=_(n),d=o.Ct?.info??null;null!==d&&d.pattern!==c.pattern&&o.Rt.At.Dt.has(d.pattern)&&o.Rt.At.Ft(d.pattern,c.pattern),c.nt.length>r.length&&t({code:"STATE-202",message:`indexes length is insufficient: ${n}`,context:{path:n,ee:c.nt.length,se:r.length},t:"/docs/error-codes.md#state",o:"error"});let a=null;for(let n=0;n<c.nt.length;n++){const i=c.nt[n],d=X(i,a);it(e,d,s,o);const l=s[q](d);null===l&&t({code:"LIST-201",message:`ListIndexes not found: ${i.pattern}`,context:{pattern:i.pattern},t:"/docs/error-codes.md#list",o:"error"});const h=r[n];a=l[h]??t({code:"LIST-201",message:`ListIndex not found: ${i.pattern}`,context:{pattern:i.pattern,index:h},t:"/docs/error-codes.md#list",o:"error"})}const l=X(c,a),h=void 0!==i;if(O in s){if(!h)return it(e,l,s,o);ct(e,l,i,s,o)}else{if(!h)return it(e,l,s,o);t({code:"STATE-202",message:`Cannot set value on a readonly proxy: ${n}`,context:{path:n},t:"/docs/error-codes.md#state",o:"error"})}}}function at(e,n,s,o){const r=et[n];if(void 0!==r){const e=o.Ct?.St;return e?.Lt[r]??t({code:"LIST-201",message:`ListIndex not found: ${n.toString()}`,context:{oe:String(n),Lt:e?.Lt??null,index:r},t:"/docs/error-codes.md#list",o:"error"})}if("string"==typeof n){if("$"===n[0])switch(n){case"$resolve":return dt(e,0,s,o);case"$getAll":return function(e,n,s,o){const r=dt(e,0,s,o);return(n,i)=>{let c=i;const d=_(n),a=o.Ct?.info??null;if(null!==a&&a.pattern!==d.pattern&&o.Rt.At.Dt.has(a.pattern)&&o.Rt.At.Ft(a.pattern,d.pattern),void 0===c){for(let e=0;e<d.K.length;e++){const n=d.K[e]??t({code:"BIND-201",message:"wildcardPattern is null",context:{index:e,re:d.pattern},t:"/docs/error-codes.md#bind",o:"error"}),s=Y(o,n.pattern);if(s){c=s.Lt;break}}void 0===c&&(c=[])}const l=(n,r,i,c,d,a,h)=>{const u=n[r]??null;if(null===u)return void h.push(a);const f=X(u,i);it(e,f,s,o);const m=s[q](f);null===m&&t({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern},t:"/docs/error-codes.md#list",o:"error"});const p=c[d]??null;if(null===p)for(let t=0;t<m.length;t++){const e=m[t];l(n,r+1,e,c,d+1,a.concat(e.index),h)}else{const e=m[p]??t({code:"LIST-201",message:`ListIndex not found: ${u.pattern}`,context:{pattern:u.pattern,index:p},t:"/docs/error-codes.md#list",o:"error"});r+1<n.length?l(n,r+1,e,c,d+1,a.concat(e.index),h):h.push(a.concat(e.index))}},h=[];l(d.nt,0,null,c,0,[],h);const u=[];for(let t=0;t<h.length;t++)u.push(r(d.pattern,h[t]));return u}}(e,0,s,o);case"$trackDependency":return function(e,n,s,o){return e=>{const n=o.Ct?.info??t({code:"STATE-202",message:"Internal error: lastRefStack is null",context:{h:"trackDependency",path:e},t:"/docs/error-codes.md#state"});o.Rt.At.Ot.has(n.pattern)&&n.pattern!==e&&o.Rt.At.Ft(n.pattern,e)}}(0,0,0,o);case"$navigate":return t=>Ye?.navigate(t);case"$component":return o.Rt.ie}const r=Z(n),i=tt(r,s,o),c=X(r.info,i);return it(e,c,s,o)}if("symbol"==typeof n){if(!o.symbols.has(n))return Reflect.get(e,n,s);switch(n){case V:return t=>it(e,t,s,o);case O:return(t,n)=>ct(e,t,n,s,o);case q:return n=>function(e,n,s,o){if(o.Rt.At.Vt.has(n.info.pattern)||t({code:"LIST-201",message:`path is not a list: ${n.info.pattern}`,context:{h:"getListIndexesByRef",pattern:n.info.pattern},t:"/docs/error-codes.md#state"}),o.Rt.zt.startsWith(n.info)&&0===o.Rt.At.Ot.intersection(n.info.j).size)return o.Rt.zt.ce(n)??[];it(e,n,s,o);const r=o.Rt.Wt(n);null===r&&t({code:"LIST-202",message:`List cache entry not found: ${n.info.pattern}`,context:{h:"getListIndexesByRef",pattern:n.info.pattern},t:"/docs/error-codes.md#state"});const i=r.Mt;return null===i&&t({code:"LIST-203",message:`List indexes not found in cache entry: ${n.info.pattern}`,context:{h:"getListIndexesByRef",pattern:n.info.pattern},t:"/docs/error-codes.md#state"}),i}(e,n,s,o);case W:return()=>function(t,e,n){const s=Reflect.get(t,$);if("function"==typeof s)return s.call(n)}(e,0,s);case H:return()=>function(t,e,n){const s=Reflect.get(t,P);if("function"==typeof s)return s.call(n)}(e,0,s);case j:return t=>function(t,e,n){const s=Reflect.get(t,L);if("function"==typeof s){const t=new Set,o={};for(const n of e){const e=n.info.pattern;if(t.add(e),n.info.dt>0){const t=n.St.index,s=o[e];void 0===s?o[e]=[t]:s.push(t)}}return s.call(n,Array.from(t),o)}}(e,t,s)}}}let lt=class{Rt;jt;Zt;Gt=Array(32).fill(null);kt=-1;Ct=null;de=null;symbols=new Set([V,q]);ae=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e,n){this.Rt=t,this.jt=e,this.Zt=n}get(t,e,n){return at(t,e,n,this)}set(e,n,s,o){t({code:"STATE-202",message:`Cannot set property ${String(n)} of readonly state`,context:{h:"createReadonlyStateProxy.set",oe:String(n)},t:"./docs/error-codes.md#state"})}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.ae.has(e)}};function ht(t,e,n){return new lt(t,e,n)}function ut(t,e){return new Proxy(t,e)}class ft{Rt;jt;Zt=null;Gt=Array(32).fill(null);kt=-1;Ct=null;de=null;symbols=new Set([V,O,q,W,H,j]);ae=new Set(["$resolve","$getAll","$trackDependency","$navigate","$component"]);constructor(t,e){this.Rt=t,this.jt=e}get(t,e,n){return at(t,e,n,this)}set(t,e,n,s){return function(t,e,n,s,o){if("string"==typeof e){const r=Z(e),i=tt(r,s,o);return ct(t,X(r.info,i),n,s,o),!0}return Reflect.set(t,e,n,s)}(t,e,n,s,this)}has(t,e){return Reflect.has(t,e)||this.symbols.has(e)||this.ae.has(e)}}function mt(e,n,s,o,r){const i=new ft(e,n),c=new Proxy(s,i);return function(e,n,s){let o;e.de&&t({code:"STATE-301",message:"already in loop context",context:{h:"setLoopContext",he:!0},t:"/docs/error-codes.md#state",hint:"Ensure handler.loopContext is cleared before invoking setLoopContext again.",o:"error"}),e.de=n;try{if(n){0===e.Gt.length&&t({code:"STC-002",message:"handler.refStack is empty in getByRef",context:{h:"setLoopContext",kt:e.kt,ue:e.Gt.length},t:"/docs/error-codes.md#state",hint:"Invoke setLoopContext only after initializing refStack via asyncSetStatePropertyRef.",o:"error"}),e.kt++,e.kt>=e.Gt.length&&e.Gt.push(null),e.Gt[e.kt]=e.Ct=n.fe;try{o=s()}finally{e.Gt[e.kt]=null,e.kt--,e.Ct=e.kt>=0?e.Gt[e.kt]:null}}else o=s()}finally{o instanceof Promise&&o.finally((()=>{e.de=null})).catch((e=>{t({code:"STC-002",message:"Error in setLoopContext finally block",context:{h:"setLoopContext.cleanup"},t:"/docs/error-codes.md#state",hint:"Inspect the promise returned by the callback for cleanup failures.",o:"error",i:e})})),e.de=null}return o}(i,o,(()=>r(c,i)))}class pt{me=new Set;pe=new Set;Jt=new Map;ye;we;xe=[];be=new Set;Se=null;ve=null;constructor(t,e){this.ye=t,this.we=e}get Ce(){return this.xe}get Ie(){return this.be}get _(){return this.Se||t({code:"UPD-002",message:"ReadonlyState not initialized",t:"./docs/error-codes.md#upd"}),this.Se}get k(){return this.ve||t({code:"UPD-002",message:"ReadonlyHandler not initialized",t:"./docs/error-codes.md#upd"}),this.ve}Ne(t){const e=ht(this.ye,this.we,this),n=ut(this.ye.state,e);this.Se=n,this.ve=e;try{return t(n,e)}finally{this.Se=null,this.ve=null}}Te(e){this.pe.clear(),this.me.clear(),this.xe=[...e],this.be=new Set(e),this.Ne((()=>{const n=[],s=new Map,o=new Set;for(let r=0;r<e.length;r++){const i=e[r];if(o.add(i),!this.ye.At.elements.has(i.info.pattern)){n.push(i);continue}const c=i.vt??t({code:"UPD-004",message:`ParentInfo is null for ref: ${i.key}`,context:{Ue:i.key,pattern:i.info.pattern},t:"./docs/error-codes.md#upd"});s.has(c)||s.set(c,new Set),s.get(c).add(i)}for(const[t,e]of s){if(o.has(t)){for(const t of e)this.pe.add(t);continue}const n=this.ye.Be(t);for(let t=0;t<n.length;t++)this.me.has(n[t])||n[t].P(this);this.pe.add(t)}for(let e=0;e<n.length;e++){const s=n[e],o=A(this.ye.At.$e,s.info.pattern);null===o&&t({code:"PATH-101",message:`PathNode not found: ${s.info.pattern}`,context:{pattern:s.info.pattern},t:"./docs/error-codes.md#path"}),this.pe.has(s)||this.Pe(s,o)}if(this.ye.Le.size>0)for(const t of this.ye.Le){const e=this.ye.Ee.get(t)??new Set;for(const t of e)t.$(n)}}))}Pe(e,n){this.pe.add(e);const s=this.ye.Be(e);for(let t=0;t<s.length;t++)this.me.has(s[t])||s[t].P(this);let o=new Set;if(this.ye.At.Vt.has(e.info.pattern)){const t=new Set(this._[q](e)??[]),{Mt:n}=this.Jt.get(e)??{},s=new Set(n??[]);o=t.difference(s)}for(const[t,s]of n.ft){const n=_(s.ut);if("*"===t)for(const t of o){const e=X(n,t);this.pe.has(e)||this.Pe(e,s)}else{const t=X(n,e.St);this.pe.has(t)||this.Pe(t,s)}}const r=this.ye.At.Me.get(e.info.pattern);if(r)for(const e of r){const n=_(e),s=A(this.ye.At.$e,n.pattern);if(null===s&&t({code:"PATH-101",message:`PathNode not found: ${n.pattern}`,context:{pattern:n.pattern},t:"./docs/error-codes.md#path"}),n.dt>0){const t=n.nt,e=(o,r,i)=>{const c=this._[q](o)||[];if(r+1<t.length)for(let n=0;n<c.length;n++){const s=X(i,c[n]);e(s,r+1,t[r+1])}else for(let t=0;t<c.length;t++){const e=X(n,c[t]);this.pe.has(e)||this.Pe(e,s)}},o=X(n.nt[0],null);e(o,0,n.nt[1]||null)}else{const t=X(n,null);this.pe.has(t)||this.Pe(t,s)}}}}class gt{Xt=new Map;_e=[];ke=!1;ye;Bt;De=0;Ae=[];Re=new Map;constructor(t){this.ye=t,this.Bt=t.Fe()}get version(){return this.Bt}get qt(){return this.De}te(t){this.De++,this._e.push(t),this.Ae.push(t),this.Ve(this.ye,t.info.pattern,this.ye.Ht,this.De),this.ke||(this.ke=!0,queueMicrotask((()=>{this.Oe()})))}update(e,n){const s=mt(this.ye,this,this.ye.state,e,((t,e)=>n(t,e))),o=()=>{if(this.ye.At.We&&this.Ae.length>0){const e=this.Ae;this.Ae=[],queueMicrotask((()=>{const n=this.update(null,(t=>t[j](e)));n instanceof Promise&&n.catch((()=>{t({code:"UPD-005",message:"An error occurred during asynchronous state update.",t:"./docs/error-codes.md#upd"})}))}))}};return s instanceof Promise?s.catch((()=>{t({code:"UPD-005",message:"An error occurred during asynchronous state update.",t:"./docs/error-codes.md#upd"})})).finally((()=>{o()})):o(),s}Oe(){try{for(;this._e.length>0;){const n=this._e;this._e=[],t=n,e=this.ye,new pt(e,this).Te(t)}}finally{this.ke=!1}var t,e}He(t){var e;t((e=this.ye,new pt(e,this)))}je(e,n,s,o,r){if(o.has(n))return;if(r&&e.At.elements.has(n))return;o.add(n);for(const[,t]of s.ft.entries()){const n=t.ut;this.je(e,n,t,o,!1)}const i=e.At.Me.get(n)??[];for(const n of i){const s=A(e.At.$e,n);null===s&&t({code:"UPD-004",message:`Path node not found for pattern: ${n}`,t:"./docs/error-codes.md#upd"}),this.je(e,n,s,o,!1)}}Ve(e,n,s,o){const r=A(e.At.$e,n);null===r&&t({code:"UPD-003",message:`Path node not found for pattern: ${n}`,t:"./docs/error-codes.md#upd"});let i=this.Re.get(n);void 0===i&&(i=new Set,this.je(e,n,r,i,!0));const c={version:this.version,qt:o};for(const t of i)s.set(t,c);this.Re.set(n,i)}Ne(t){const e=ht(this.ye,this,null);return t(ut(this.ye.state,e),e)}}function yt(t,e){return e(new gt(t))}class wt extends C{get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}constructor(e,n,s,o,r,i){super(e,n,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("checkbox"!==this.node.type)return;i.length>1&&t({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeCheckbox.constructor",name:this.name,qe:i.length},t:"/docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Rt;this.node.addEventListener(c,(t=>{const n=this.binding.Ge.ze;yt(d,(t=>{t.update(n,((t,n)=>{e.Ze(t,n,this.F)}))}))}))}U(e){Array.isArray(e)||t({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeCheckbox.update",Je:typeof e},t:"/docs/error-codes.md#bind",o:"error"});this.node.checked=e.includes(this.F)}}class xt extends C{U(e){Array.isArray(e)||t({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeClassList.update",Je:typeof e},t:"/docs/error-codes.md#bind",o:"error"});this.node.className=e.join(" ")}}class bt extends C{U(e){"boolean"!=typeof e&&t({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeClassName.update",Je:typeof e},t:"/docs/error-codes.md#bind",o:"error"});this.node.classList.toggle(this.I,e)}}class St extends C{constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);e.addEventListener(this.I,(t=>this.Ke(t)))}update(){}Ke(e){const n=this.binding.Rt,s=this.binding.Ge.ze,o=s?.Qe().map((t=>t.St.index))??[],r=this.N;r.includes("preventDefault")&&e.preventDefault(),r.includes("stopPropagation")&&e.stopPropagation();const i=yt(n,(n=>n.update(s,((n,s)=>{const r=this.binding.M.Xe(n,s);if("function"==typeof r)return Reflect.apply(r,n,[e,...o]);t({code:"BIND-201",message:`${this.name} is not a function`,context:{h:"BindingNodeEvent.handler",name:this.name,Je:typeof r},t:"/docs/error-codes.md#bind",o:"error"})}))));i instanceof Promise&&i.catch((e=>{const n=e instanceof Error?e.message:String(e);t({code:"BIND-202",message:`Error in event handler for ${this.name}: ${n}`,context:{h:"BindingNodeEvent.handler",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}))}P(t){}}const vt=(t,e,n)=>(s,o,r)=>{const i=v(r,e),c=t.slice(2);return new St(s,o,t,c,i,n)};class Ct extends C{#t;get id(){return this.#t}constructor(e,n,s,o,r,i){super(e,n,s,o,r,i);const c=this.node.textContent?.slice(3)??t({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent??null},t:"/docs/error-codes.md#bind",o:"error"}),[d]=c.split(" ",2),a=Number(d);(a.toString()!==d||isNaN(a)||!isFinite(a)||!Number.isInteger(a)||a<0)&&t({code:"BIND-201",message:"Invalid node",context:{h:"BindingNodeBlock.id",textContent:this.node.textContent},t:"/docs/error-codes.md#bind",o:"error"}),this.#t=a}}class It extends Ct{Ye;tn;en=[];nn;constructor(t,e,n,s,o,r){super(t,e,n,s,o,r);const i=X(_(""),null);this.Ye=Ie(this.binding,this.id,this.binding.Rt,i),this.tn=[this.Ye],this.nn=this.en}get T(){return this.nn}U(e){t({code:"BIND-201",message:"Not implemented",context:{h:"BindingNodeIf.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}P(e){const n=this.binding.M.L(e._,e.k);"boolean"!=typeof n&&t({code:"BIND-201",message:"Value is not boolean",context:{h:"BindingNodeIf.applyChange",valueType:typeof n},t:"/docs/error-codes.md#bind",o:"error"});const s=this.node.parentNode;null===s&&t({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeIf.applyChange",nodeType:this.node.nodeType},t:"/docs/error-codes.md#bind",o:"error"}),n?(this.Ye.D(),this.Ye.sn(s,this.node),this.Ye.P(e),this.nn=this.tn):(this.Ye.unmount(),this.Ye.A(),this.nn=this.en)}A(){this.Ye.unmount(),this.Ye.A(),this.nn=this.en}}const Nt=!0===globalThis.__STRUCTIVE_USE_ALL_APPEND__;class Tt extends Ct{nn=[];rn=new WeakMap;cn=[];dn=0;an=void 0;ln=void 0;hn=[];un=new Set;get T(){return this.nn}get fn(){return this.dn}set fn(t){this.dn=t}get mn(){return this.cn.length}set mn(e){e<0&&t({code:"BIND-202",message:"Length is negative",context:{h:"BindingNodeFor.setPoolLength",length:e},t:"./docs/error-codes.md#bind"}),this.cn.length=e}get pn(){if(void 0===this.an){const t=`${this.binding.M.pattern}.*`;this.an=_(t)}return this.an}gn(t,e){let n;if(this.dn>=0)n=this.cn[this.dn],this.dn--,n.yn(e);else{const t=X(this.pn,e);n=Ie(this.binding,this.id,this.binding.Rt,t)}return this.rn.set(e,n),n.D(),n}wn(t){t.unmount(),t.A()}U(e){t({code:"BIND-301",message:"Not implemented. Use update or applyChange",context:{h:"BindingNodeFor.assignValue"},t:"./docs/error-codes.md#bind"})}P(e){let n=[];const s=e._[V](this.binding.M.fe);Array.isArray(s)||t({code:"BIND-201",message:"Value is not array",context:{h:"BindingNodeFor.applyChange",fe:this.binding.M.fe},t:"./docs/error-codes.md#bind"});const o=e._[q](this.binding.M.fe)??[],r=new Set(o),i=this.ln??[];Array.isArray(i)||t({code:"BIND-201",message:"Old value is not array",context:{h:"BindingNodeFor.applyChange",fe:this.binding.M.fe},t:"./docs/error-codes.md#bind"});const c=i.length??0,d=0===r.size?this.un:this.un.difference(r),a=0===this.un.size?r:r.difference(this.un),l=s?.length??0,h=new Set,u=new Set,f=`${this.binding.M.info.pattern}.*`;for(let n=0;n<e.Ce.length;n++){const s=e.Ce[n];if(s.info.pattern!==f)continue;if(e.pe.has(s))continue;const o=s.St;null===o&&t({code:"BIND-201",message:"ListIndex is null",context:{h:"BindingNodeFor.applyChange",fe:s},t:"./docs/error-codes.md#bind"}),this.un.has(o)?h.add(o):u.add(o),e.pe.add(s)}const m=this.node.parentNode??t({code:"BIND-201",message:"ParentNode is null",context:{h:"BindingNodeFor.applyChange"},t:"./docs/error-codes.md#bind"}),p=new Set,g=c===d.size&&c>0;let y=!1;if(g){const e=Array.from(m.childNodes),n=this.nn.at(-1)??t({code:"BIND-201",message:"Last content is null",context:{h:"BindingNodeFor.applyChange"},t:"/docs/error-codes.md#bind"});let s=e[0];for(;s&&s.nodeType===Node.TEXT_NODE&&""===s.textContent?.trim();)s=s.nextSibling;let o=e.at(-1)??null;for(;o&&o.nodeType===Node.TEXT_NODE&&""===o.textContent?.trim();)o=o.previousSibling;s===this.node&&o===n.xn(m)&&(y=!0)}if(g&&y){m.textContent="",m.append(this.node);for(let t=0;t<this.nn.length;t++)this.nn[t].A();this.cn.push(...this.nn)}else if(d.size>0){for(const e of d){const n=this.rn.get(e);void 0===n&&t({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",bn:"removes"},t:"./docs/error-codes.md#bind"}),this.wn(n),p.add(n)}this.cn.push(...p)}let w=null;const x=this.node;this.fn=this.mn-1;const b=Nt&&l===a.size&&l>0;if(0===a.size&&0===d.size&&(h.size>0||u.size>0)){if(h.size>0){const e=Array.from(this.nn),s=Array.from(h);s.sort(((t,e)=>t.index-e.index));for(const n of s){const s=this.rn.get(n);void 0===s&&t({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",bn:"reorder"},t:"/docs/error-codes.md#bind"}),e[n.index]=s;const o=e[n.index-1]?.xn(m)??x;s.sn(m,o)}n=e}if(u.size>0)for(const n of u){const s=this.rn.get(n);void 0===s&&t({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",bn:"overwrites"},t:"./docs/error-codes.md#bind"}),s.P(e)}}else{const s=new Map;for(let t=0;t<this.hn.length;t++)s.set(this.hn[t],t);const r=b?document.createDocumentFragment():m,i=b?null:x,c=[];for(let d=0;d<o.length;d++){const l=o[d],h=w?.xn(r)??i;let u;if(a.has(l))u=this.gn(e,l),u.sn(r,h),u.P(e);else{u=this.rn.get(l),void 0===u&&t({code:"BIND-201",message:"BindContent not found",context:{h:"BindingNodeFor.applyChange",bn:"reuse"},t:"./docs/error-codes.md#bind"}),h?.nextSibling!==u.Sn&&u.sn(r,h);const e=s.get(l);void 0!==e&&e!==d&&c.push(l)}n.push(u),w=u}if(b){const t=x.nextSibling;m.insertBefore(r,t)}for(const t of c){const n=this.binding.vn.get(t)??[];for(const t of n)e.me.has(t)||t.P(e)}}this.mn=this.fn+1,this.nn=n,this.ln=[...s],this.hn=[...o],this.un=r}A(){for(let t=0;t<this.nn.length;t++){const e=this.nn[t];e.unmount(),e.A()}this.cn.push(...this.nn),this.nn=[],this.rn=new WeakMap,this.dn=0,this.ln=void 0,this.hn=[],this.un=new Set}}const Ut=(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Tt(s,o,t,"",i,n)};const Bt={value:"input",valueAsNumber:"input",valueAsDate:"input",checked:"change",selected:"change"},$t={radio:new Set(["checked"]),checkbox:new Set(["checked"])},Pt=new Set(["value","valueAsNumber","valueAsDate"]),Lt=new Set;class Et extends C{constructor(e,n,s,o,r,i){super(e,n,s,o,r,i);if(!(this.node instanceof HTMLElement))return;if(!((c=this.node)instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c instanceof HTMLSelectElement))return;var c;const d=(t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?Pt:t instanceof HTMLInputElement?$t[t.type]??Pt:Lt)(this.node);if(!d.has(this.name))return;i.length>1&&t({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeProperty.constructor",name:this.name,qe:i.length},t:"/docs/error-codes.md#bind",o:"error"});const a=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??Bt[this.name]??"readonly";if("readonly"===a||"ro"===a)return;const l=this.binding.Rt;this.node.addEventListener(a,(t=>{const n=this.binding.Ge.ze;yt(l,(t=>{t.update(n,((t,n)=>{e.Ze(t,n,this.F)}))}))}))}get value(){return this.node[this.name]}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}U(e){let n;n=null==e||Number.isNaN(e)?"":e,this.name in this.node?this.node[this.name]=n:t({code:"BIND-201",message:`Property "${this.name}" does not exist on node`,context:{h:"BindingNodeProperty.assignValue",name:this.name},t:"/docs/error-codes.md#bind",o:"error"})}}const Mt=(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new Et(s,o,t,"",i,n)};class _t extends C{constructor(e,n,s,o,r,i){super(e,n,s,o,r,i);if(!(this.node instanceof HTMLInputElement))return;if("radio"!==this.node.type)return;i.length>1&&t({code:"BIND-201",message:"Has multiple decorators",context:{h:"BindingNodeRadio.constructor",name:this.name,qe:i.length},t:"/docs/error-codes.md#bind",o:"error"});const c=(i[0]?.startsWith("on")?i[0]?.slice(2):i[0])??null??"input";if("readonly"===c||"ro"===c)return;const d=this.binding.Rt;this.node.addEventListener(c,(t=>{const n=this.binding.Ge.ze;yt(d,(t=>{t.update(n,((t,n)=>{e.Ze(t,n,this.F)}))}))}))}get value(){return this.node.value}get F(){let t=this.value;for(let e=0;e<this.filters.length;e++)t=this.filters[e](t);return t}U(t){let e;e=null==t?"":t;this.node.checked=e===this.F}}class kt extends C{U(t){const e=this.node,n=null==t||"number"==typeof t&&Number.isNaN(t)?"":String(t);e.style.setProperty(this.I,n.toString())}}const Dt="component-state-input",At=Symbol.for(`${Dt}.AssignState`),Rt=Symbol.for(`${Dt}.NotifyRedraw`),Ft=new WeakMap;function Vt(e){return e.tagName.includes("-")?e.tagName.toLowerCase():e.getAttribute("is")?.includes("-")?e.getAttribute("is").toLowerCase():void t({code:"CE-001",message:"Custom tag name not found",context:{h:"ComponentEngine.customTagName.get"},t:"./docs/error-codes.md#ce"})}class Ot extends C{tagName;constructor(e,n,s,o,r,i){super(e,n,s,o,r,i);const c=this.node;c.tagName.includes("-")?this.tagName=c.tagName.toLowerCase():c.getAttribute("is")?.includes("-")?this.tagName=c.getAttribute("is").toLowerCase():t({code:"COMP-401",message:"Cannot determine custom element tag name",context:{h:"BindingNodeComponent.constructor"},t:"/docs/error-codes.md#comp"})}Cn(e){const n=this.node,s=Vt(n);customElements.whenDefined(s).then((()=>{n.state[Rt](e)})).catch((e=>{const n=e instanceof Error?e.message:String(e);t({code:"COMP-402",message:`Failed to define custom element "${s}": ${n}`,context:{h:"BindingNodeComponent._notifyRedraw",tagName:s},t:"/docs/error-codes.md#comp"})}))}$(t){const e=[],n=this.binding.M.fe,s=n.St,o=(s?.length??0)-1;for(const r of t)r.info.pattern!==n.info.pattern&&r.info.j.has(n.info.pattern)&&(o>=0&&r.St?.at(o)!==s||e.push(r));0!==e.length&&this.Cn(e)}P(t){this.Cn([this.binding.M.fe])}D(){const e=this.binding.Rt,n=e.ie,s=this.node,o=Vt(s);customElements.whenDefined(o).then((()=>{n.In(s),s.Tn.Nn(this.binding)})).catch((e=>{const n=e instanceof Error?e.message:String(e);t({code:"COMP-402",message:`Failed to define custom element "${o}": ${n}`,context:{h:"BindingNodeComponent.activate",tagName:o},t:"/docs/error-codes.md#comp"})})),function(t,e){Ft.set(e,t)}(n,s);let r=e.Ee.get(s);void 0===r&&e.Ee.set(s,r=new Set),r.add(this.binding)}A(){const t=this.binding.Rt;var e;e=this.node,Ft.delete(e);const n=t.Ee.get(this.node);void 0!==n&&n.delete(this.binding)}}const Wt={0:{class:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new xt(s,o,t,"",i,n)},checkbox:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new wt(s,o,t,"",i,n)},radio:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new _t(s,o,t,"",i,n)}},1:{if:(t,e,n)=>(s,o,r)=>{const i=v(r,e);return new It(s,o,t,"",i,n)}}},Ht={class:(t,e,n)=>(s,o,r)=>{const i=v(r,e),[,c]=t.split(".");return new bt(s,o,t,c,i,n)},attr:(t,e,n)=>(s,o,r)=>{const i=v(r,e),[,c]=t.split(".");return new I(s,o,t,c,i,n)},style:(t,e,n)=>(s,o,r)=>{const i=v(r,e),[,c]=t.split(".");return new kt(s,o,t,c,i,n)},state:(t,e,n)=>(s,o,r)=>{const i=v(r,e),[,c]=t.split(".");return new Ot(s,o,t,c,i,n)}};const jt={};function qt(e,n,s,o){const r=e instanceof Comment,i=e instanceof Element,c=`${r}\t${i}\t${n}`,d=jt[c]??(jt[c]=function(e,n,s){const o=Wt[e?1:0][s];if(void 0!==o)return o;if(e&&"for"===s)return Ut;e&&t(`getBindingNodeCreator: unknown node property ${s}`);const r=s.split("."),i=Ht[r[0]];return void 0!==i?i:n&&s.startsWith("on")?vt:Mt}(r,i,n));return d(n,s,o)}class zt{pattern;info;filters;Un=!1;u;Bn=null;$n=null;Pn=null;constructor(t,e,n){this.u=t,this.pattern=e,this.info=_(e),this.filters=n,this.Bn=0===this.info.dt?X(this.info,null):null}get St(){return this.fe.St}get fe(){return null===this.Bn?(null===this.Pn&&t({code:"BIND-201",message:"LoopContext is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"}),null===this.$n&&(this.$n=X(this.info,this.Pn.St)),this.$n):this.Bn??t({code:"BIND-201",message:"ref is null",context:{pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"})}Xe(t,e){return it(this.u.Rt.state,this.fe,t,e)}L(t,e){let n=it(this.u.Rt.state,this.fe,t,e);for(let t=0;t<this.filters.length;t++)n=this.filters[t](n);return n}U(t,e,n){ct(this.u.Rt.state,this.fe,n,t,e)}D(){if(this.info.dt>0){const e=this.info.ot??t({code:"BIND-201",message:"Wildcard last parentPath is null",context:{h:"BindingState.init",pattern:this.pattern},t:"/docs/error-codes.md#bind",o:"error"});this.Pn=this.u.Ge.ze?.find(e)??t({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingState.init",ot:e},t:"/docs/error-codes.md#bind",o:"error"})}this.u.Rt.Ln(this.fe,this.u)}A(){this.u.Rt.En(this.fe,this.u),this.$n=null,this.Pn=null}}class Gt{filters;u;Mn;Pn=null;constructor(e,n,s){this.u=e;const o=Number(n.slice(1));isNaN(o)&&t({code:"BIND-202",message:"Pattern is not a number",context:{h:"BindingStateIndex.constructor",pattern:n},t:"/docs/error-codes.md#bind"}),this.Mn=o,this.filters=s}get pattern(){return t({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.pattern"},t:"/docs/error-codes.md#bind"})}get info(){return t({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.info"},t:"/docs/error-codes.md#bind"})}get St(){return this.Pn?.St??t({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.listIndex"},t:"/docs/error-codes.md#list"})}get fe(){return this.Pn?.fe??t({code:"STATE-202",message:"ref is null",context:{h:"BindingStateIndex.ref"},t:"/docs/error-codes.md#state"})}get Un(){return!0}Xe(e,n){return this.St?.index??t({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getValue"},t:"/docs/error-codes.md#list"})}L(e,n){let s=this.St?.index??t({code:"LIST-201",message:"listIndex is null",context:{h:"BindingStateIndex.getFilteredValue"},t:"/docs/error-codes.md#list"});for(let t=0;t<this.filters.length;t++)s=this.filters[t](s);return s}U(e,n,s){t({code:"BIND-301",message:"Not implemented",context:{h:"BindingStateIndex.assignValue"},t:"/docs/error-codes.md#bind"})}D(){const e=(this.u.Ge.ze??t({code:"BIND-201",message:"LoopContext is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"})).Qe();this.Pn=e[this.Mn-1]??t({code:"BIND-201",message:"Current loopContext is null",context:{h:"BindingStateIndex.init",_n:this.Mn},t:"/docs/error-codes.md#bind"});const n=this.Pn.Dn.kn;null===n&&t({code:"BIND-201",message:"Binding for list is null",context:{h:"BindingStateIndex.init"},t:"/docs/error-codes.md#bind"});const s=n.vn.get(this.St);void 0===s?n.vn.set(this.St,new Set([this.u])):s.add(this.u)}A(){this.Pn=null}}const Zt=new RegExp(/^\$\d+$/);function Jt(t,e){return Zt.test(t)?((t,e)=>(n,s)=>{const o=v(s,e);return new Gt(n,t,o)})(t,e):((t,e)=>(n,s)=>{const o=v(s,e);return new zt(n,t,o)})(t,e)}const Kt={};function Qt(e,n=(t=>`${t.constructor.name}\t${t instanceof Comment?t.textContent?.[2]??"":""}`)(e)){return Kt[n]??(Kt[n]=(e=>e instanceof Comment&&":"===e.textContent?.[2]?"Text":e instanceof HTMLElement?"HTMLElement":e instanceof Comment&&"|"===e.textContent?.[2]?"Template":e instanceof SVGElement?"SVGElement":t({code:"BND-001",message:`Unknown NodeType: ${e.nodeType}`,context:{h:"getNodeType.getNodeTypeByNode",nodeType:e.nodeType,nodeName:e.nodeName,An:e.constructor.name},t:"./docs/error-codes.md#bnd"}))(e))}const Xt=t=>t.trim(),Yt=t=>t.length>0,te=new RegExp(/^#(.*)#$/),ee=t=>{const e=te.exec(t);return e?decodeURIComponent(e[1]):t},ne=t=>{const[e,...n]=t.split(",").map(Xt);return{name:e,options:n.map(ee)}},se=t=>{const[e,...n]=t.split("|").map(Xt);return{Rn:e,filters:n.map(ne)}},oe=t=>t.split(";").map(Xt).filter(Yt).map((t=>(t=>{const[e,n=null]=t.split("@").map(Xt),s=n?n.split(",").map(Xt):[],[o,r]=e.split(":").map(Xt),{Rn:i,filters:c}=se(o),{Rn:d,filters:a}=se(r);return{Fn:i,Vn:d,On:c,Wn:a,N:s}})(t))),re={};const ie=t=>{t.removeAttribute("data-bind")},ce={HTMLElement:ie,SVGElement:ie,Text:void 0,Hn:void 0};const de={Text:t=>{const e=document.createTextNode("");return t.parentNode?.replaceChild(e,t),e},HTMLElement:void 0,Hn:void 0,SVGElement:void 0};class ae{nodeType;jn;qn;zn=new Map;constructor(t){this.nodeType=Qt(t);const e=function(t,e){switch(t){case"Text":return`textContent:${e.textContent?.slice(3).trim()??""}`;case"HTMLElement":case"SVGElement":return e.getAttribute(N)??"";case"Template":{const t=e.textContent?.slice(3).trim(),[n]=t?.split(" ",2)??[];return ye(Number(n)).getAttribute(N)??""}default:return""}}(this.nodeType,t),n=function(t,e){return de[e]?.(t)??t}(t,this.nodeType);!function(t,e){ce[e]?.(t)}(n,this.nodeType),this.jn=function(t){let e=[],n=t;for(;null!==n.parentNode;)e=[Array.from(n.parentNode.childNodes).indexOf(n),...e],n=n.parentNode;return e}(n),this.qn=function(t){return""===t.trim()?[]:re[t]??(re[t]=oe(t))}(e);for(let t=0;t<this.qn.length;t++){const e=this.qn[t],s={Gn:qt(n,e.Fn,e.On,e.N),Zn:Jt(e.Vn,e.Wn)};this.zn.set(e,s)}}}function le(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,{acceptNode:t=>t instanceof Element?t.hasAttribute(N)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:function(t){return t instanceof Comment&&(0===t.textContent?.indexOf(T)||0===t.textContent?.indexOf(U))}(t)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;n.nextNode();)e.push(n.currentNode);return e}const he={},ue={},fe={};function me(t){return le(t).map((t=>function(t){return new ae(t)}(t)))}const pe={};function ge(t,e,n){var s;return s=e.content,Array.from(s.childNodes).forEach((t=>{t.nodeType!==Node.TEXT_NODE||(t.nodeValue??"").trim()||s.removeChild(t)})),function(t,e,n=t){const s=me(e),o=fe[n]??(fe[n]=new Set),r=ue[n]??(ue[n]=new Set);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.qn.length;t++){const n=e.qn[t];o.add(n.Vn),"for"===n.Fn&&r.add(n.Vn)}}he[t]=s}(t,e.content,n),pe[t]=e,t}function ye(e){return pe[e]??t({code:"TMP-001",message:`Template not found: ${e}`,context:{h:"registerTemplate.getTemplateById",Jn:e},t:"./docs/error-codes.md#tmp"})}class we{Ge;Rt;node;Kn;M;vn=new WeakMap;Qn=!1;constructor(t,e,n,s,o){this.Ge=t,this.node=e,this.Rt=n,this.Kn=s(this,e,n.Xn),this.M=o(this,n.Yn)}get T(){return this.Kn.T}get isActive(){return this.Qn}Ze(t,e,n){this.M.U(t,e,n)}$(t){this.Kn.$(t)}P(t){if(t.me.has(this))return;t.me.add(this),this.Kn.P(t);const e=this.M.fe;if(!this.M.Un&&!this.Rt.At.Me.has(e.info.pattern)){1===this.Rt.Be(e).length&&t.pe.add(e)}}D(){this.Qn=!0,this.M.D(),this.Kn.D()}A(){this.isActive&&(this.Kn.A(),this.M.A(),this.Qn=!1)}}function xe(t,e,n,s,o){return new we(t,e,n,s,o)}class be{info;Dn;$n;ts;es={};constructor(t,e){this.$n=t,this.info=t.info,this.Dn=e}get fe(){return this.$n??t({code:"STATE-202",message:"ref is null",context:{h:"LoopContext.ref",path:this.info.pattern},t:"/docs/error-codes.md#state"})}get path(){return this.fe.info.pattern}get St(){return this.fe.St??t({code:"LIST-201",message:"listIndex is required",context:{h:"LoopContext.listIndex",path:this.info.pattern},t:"/docs/error-codes.md#list"})}yn(t){this.$n=X(this.info,t)}ns(){this.$n=null}get ss(){if(void 0===this.ts){let t=this.Dn;for(;null!==t;){if(null!==t.de&&t.de!==this){this.ts=t.de;break}t=t.kn?.Ge??null}void 0===this.ts&&(this.ts=null)}return this.ts}find(t){let e=this.es[t];if(void 0===e)if(this.path===t)e=this.es[t]=this;else{let n=this.ss;for(;null!==n&&n.path!==t;)n=n.ss;e=this.es[t]=n}return e}rs(t){t(this);let e=this.ss;for(;null!==e;)t(e),e=e.ss}Qe(){const t=[];return this.rs((e=>{t.unshift(e)})),t}}function Se(e){const n=ye(e)??t({code:"BIND-101",message:`Template not found: ${e}`,context:{h:"BindContent.createContent",Jn:e},t:"./docs/error-codes.md#bind"}),s=document.importNode(n.content,!0);if(Object.keys(Ze).length>0){const t=s.querySelectorAll(":not(:defined)");for(let e=0;e<t.length;e++){Ke(t[e].tagName.toLowerCase())}}return s}function ve(e,n,s,o){const r=(t=>he[t])(n)??t({code:"BIND-101",message:"Data-bind is not set",context:{h:"BindContent.createBindings",Jn:n},t:"./docs/error-codes.md#bind"}),i=[];for(let c=0;c<r.length;c++){const d=r[c],a=x(o,d.jn)??t({code:"BIND-102",message:"Node not found: attribute.nodePath",context:{h:"BindContent.createBindings",Jn:n,jn:d.jn},t:"./docs/error-codes.md#bind"});for(let o=0;o<d.qn.length;o++){const r=d.qn[o],c=d.zn.get(r)??t({code:"BIND-103",message:"Creator not found: bindText",context:{h:"BindContent.createBindings",Jn:n,cs:r},t:"./docs/error-codes.md#bind"}),l=xe(e,a,s,c.Gn,c.Zn);i.push(l)}}return i}class Ce{kn;de;id;Sn;ds;fragment;childNodes;ls=[];ye;Qn=!1;hs;xn(e){const n=this.ls[this.ls.length-1],s=this.ds;if(void 0!==n&&n.node===s&&n.T.length>0){const s=(n.T.at(-1)??t({code:"BIND-104",message:"Child bindContent not found",context:{h:"BindContent.getLastNode",Jn:this.id},t:"./docs/error-codes.md#bind"})).xn(e);if(null!==s)return s}return e!==s?.parentNode?null:s}get ze(){if(void 0===this.hs){if(null!==this.de)return this.hs=this.de,this.hs;let t=this.kn?.Ge??null;for(;null!==t&&null===t.de;)t=t.kn?.Ge??null;this.hs=t?.de??null}return this.hs}constructor(t,e,n,s){this.kn=t,this.id=e,this.fragment=Se(e),this.childNodes=Array.from(this.fragment.childNodes),this.Sn=this.childNodes[0]??null,this.ds=this.childNodes[this.childNodes.length-1]??null,this.ye=n,this.de=null!==s.St?new be(s,this):null;const o=ve(this,e,n,this.fragment);this.ls=o}get isActive(){return this.Qn}mount(t){for(let e=0;e<this.childNodes.length;e++)t.appendChild(this.childNodes[e])}us(t,e){for(let n=0;n<this.childNodes.length;n++)t.insertBefore(this.childNodes[n],e)}sn(t,e){const n=e?.nextSibling??null;for(let e=0;e<this.childNodes.length;e++)t.insertBefore(this.childNodes[e],n)}unmount(){this.hs=void 0;const t=this.childNodes[0]?.parentNode??null;if(null!==t)for(let e=0;e<this.childNodes.length;e++)t.removeChild(this.childNodes[e])}yn(e){null===this.de&&t({code:"BIND-201",message:"LoopContext is null",context:{h:"BindContent.assignListIndex",Jn:this.id},t:"./docs/error-codes.md#bind"}),this.de.yn(e)}P(t){if(null!==(this.childNodes[0]?.parentNode??null))for(let e=0;e<this.ls.length;e++){const n=this.ls[e];t.me.has(n)||n.P(t)}}D(){this.Qn=!0;for(let t=0;t<this.ls.length;t++)this.ls[t].D()}A(){this.Qn=!1,this.de?.ns();for(let t=0;t<this.ls.length;t++)this.ls[t].A()}}function Ie(t,e,n,s){return new Ce(t,e,n,s)}function Ne(t,e){const n=function(t){let e=t;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}}(t.parentNode)||document,s=n.adoptedStyleSheets;s.includes(e)||(n.adoptedStyleSheets=[...s,e])}function Te(t,e){if(!t.shadowRoot){t.attachShadow({mode:"open"}).adoptedStyleSheets=[e]}}function Ue(t,e,n){"none"===e.shadowDomMode?Ne(t,n):"force"===e.shadowDomMode||null===e.fs||function(t){try{const e=document.createElement(t);return"function"==typeof e.attachShadow&&(e.attachShadow({mode:"open"}),!0)}catch{return!1}}(e.fs)?Te(t,n):Ne(t,n)}class Be{ps=new Set;gs=new Set;ys=new Map;ws=new Map;xs=new Map;bs=new Map;Ss=new WeakSet;Nn(e){if(this.Ss.has(e))return;const n=e.M.pattern,s=e.Kn.I;this.xs.has(n)&&t({code:"STATE-303",message:`Parent path "${n}" already has a child path`,context:{it:n,vs:this.xs.get(n)},t:"./docs/error-codes.md#state"}),this.bs.has(s)&&t({code:"STATE-303",message:`Child path "${s}" already has a parent path`,context:{Cs:s,Is:this.bs.get(s)},t:"./docs/error-codes.md#state"}),this.xs.set(n,s),this.bs.set(s,n),this.gs.add(n),this.ps.add(s),this.ys.set(n,e),this.ws.set(s,e),this.Ss.add(e)}Ns(t){return this.xs.get(t)}Ts(t){return this.bs.get(t)}Us(e){const n=_(e).j.intersection(this.ps);0===n.size&&t({code:"STATE-302",message:`No parent path found for child path "${e}"`,context:{Cs:e},t:"./docs/error-codes.md#state"});const s=Array.from(n),o=s[s.length-1],r=e.slice(o.length),i=this.bs.get(o);return void 0===i&&t({code:"STATE-302",message:`No parent path found for child path "${e}"`,context:{Cs:e,Bs:o},t:"./docs/error-codes.md#state"}),i+r}$s(e){const n=_(e).j.intersection(this.gs);0===n.size&&t({code:"STATE-302",message:`No child path found for parent path "${e}"`,context:{it:e},t:"./docs/error-codes.md#state"});const s=Array.from(n),o=s[s.length-1],r=e.slice(o.length),i=this.xs.get(o);return void 0===i&&t({code:"STATE-302",message:`No child path found for parent path "${e}"`,context:{it:e,Bs:o},t:"./docs/error-codes.md#state"}),i+r}Ps(t){if(0===this.ps.size)return null;const e=t.j.intersection(this.ps);if(0===e.size)return null;{const t=Array.from(e);return t[t.length-1]}}bind(t,e){const n=t.Ls(e);for(const t of n??[])this.Nn(t)}}class $e{Es;ye;constructor(t,e){this.Es=e,this.ye=t}Ms(t){yt(this.ye,(e=>{e.update(null,(e=>{for(const[n,s]of Object.entries(t)){const t=X(_(n),null);e[O](t,s)}}))}))}$(e){yt(this.ye,(n=>{for(const s of e){let e;try{e=this.Es.$s(s.info.pattern)}catch(t){continue}const o=_(e),r=o.dt-1,i=r>=0?s.St?.at(r)??null:null;r>=0&&null===i&&t({code:"LIST-201",message:`ListIndex not found for parent ref: ${s.info.pattern}`,context:{h:"ComponentStateInput.notifyRedraw",_s:s.info.pattern,ks:o.pattern},t:"/docs/error-codes.md#list"});const c=X(o,i);n.te(c)}}))}get(e,n,s){if(n===At)return this.Ms.bind(this);if(n===Rt)return this.$.bind(this);if("string"==typeof n){const t=X(_(n),null);return this.ye.getPropertyValue(t)}t(`Property "${String(n)}" is not supported in ComponentStateInput.`)}set(e,n,s,o){if("string"==typeof n){const t=X(_(n),null);return this.ye.Ds(t,s),!0}t(`Property "${String(n)}" is not supported in ComponentStateInput.`)}}class Pe{u;As;Rs=new Set;constructor(t,e){this.u=t,this.As=e}get(e){const n=this.u.Ps(e.info);null===n&&t({code:"CSO-101",message:`No child path found for path "${e.info.pattern}".`,context:{h:"ComponentStateOutput.get",path:e.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.u.ws.get(n);void 0===s&&t({code:"CSO-102",message:`No binding found for child path "${n}".`,context:{h:"ComponentStateOutput.get",Cs:n},t:"./docs/error-codes.md#cso"});const o=X(_(this.u.Us(e.info.pattern)),e.St??s.M.St);if(!this.Rs.has(o.info.pattern)){const t=this.As.At.Vt.has(e.info.pattern);s.Rt.At.addPath(o.info.pattern,t),this.Rs.add(o.info.pattern)}return s.Rt.getPropertyValue(o)}set(e,n){const s=this.u.Ps(e.info);null===s&&t({code:"CSO-101",message:`No child path found for path "${e.info.pattern}".`,context:{h:"ComponentStateOutput.set",path:e.info.pattern},t:"./docs/error-codes.md#cso"});const o=this.u.ws.get(s);void 0===o&&t({code:"CSO-102",message:`No binding found for child path "${s}".`,context:{h:"ComponentStateOutput.set",Cs:s},t:"./docs/error-codes.md#cso"});const r=X(_(this.u.Us(e.info.pattern)),e.St??o.M.St);if(!this.Rs.has(r.info.pattern)){const t=this.As.At.Vt.has(e.info.pattern);o.Rt.At.addPath(r.info.pattern,t),this.Rs.add(r.info.pattern)}return o.Rt.Ds(r,n),!0}startsWith(t){return null!==this.u.Ps(t)}ce(e){const n=this.u.Ps(e.info);null===n&&t({code:"CSO-101",message:`No child path found for path "${e.info.pattern}".`,context:{h:"ComponentStateOutput.getListIndexes",path:e.info.pattern},t:"./docs/error-codes.md#cso"});const s=this.u.ws.get(n);void 0===s&&t({code:"CSO-102",message:`No binding found for child path "${n}".`,context:{h:"ComponentStateOutput.getListIndexes",Cs:n},t:"./docs/error-codes.md#cso"});const o=X(_(this.u.Us(e.info.pattern)),e.St);if(!this.Rs.has(o.info.pattern)){const t=this.As.At.Vt.has(e.info.pattern);s.Rt.At.addPath(o.info.pattern,t),this.Rs.add(o.info.pattern)}return s.Rt.ce(o)}}class Le{type="autonomous";config;Fs;styleSheet;Vs;state;Xn;Yn;Os=HTMLElement;ie;At;Ws=Promise.withResolvers();Hs;zt;Tn;Ee=new WeakMap;Le=new Set;Ht=new Map;Ye=null;js=null;qs=null;zs=!1;Gs=0;Zs=new WeakMap;constructor(t,e){this.config=t,this.config.fs&&(this.type="builtin");const n=e.constructor;var s;this.Fs=n.Fs,this.styleSheet=n.styleSheet,this.Vs=n.Vs,this.state=new this.Vs,this.Xn=n.Xn,this.Yn=n.Yn,this.ie=e,this.Tn=new Be,this.Hs=function(t,e){const n=new $e(t,e);return new Proxy({},n)}(this,this.Tn),this.zt=(s=this.Tn,new Pe(s,this)),this.At=n.At}get Dn(){return null===this.Ye&&t({code:"BIND-201",message:"bindContent not initialized yet",context:{h:"ComponentEngine.bindContent.get",Js:this.ie.constructor.id},t:"./docs/error-codes.md#bind"}),this.Ye}get Ks(){return this.Gs}Fe(){return++this.Gs}Qs(){for(const t in this.state)B.has(t)||this.At.Xs.has(t)||(this.At.Xs.add(t),R(this.At.$e,t));const t=this.ie.constructor,e=X(_(""),null);this.Ye=Ie(null,t.id,this,e)}connectedCallback(){if(this.config.Ys)Ue(this.ie,this.config,this.styleSheet);else{this.qs=this.ie.parentNode,this.js=document.createComment("Structive block placeholder");try{this.zs=!0,this.ie.replaceWith(this.js)}finally{this.zs=!1}}if(this.config.Ys)this.Dn.mount(this.ie.shadowRoot??this.ie);else{const e=this.qs??t({code:"BIND-201",message:"Block parent node is not set",context:{h:"ComponentEngine.connectedCallback",mode:"block"},t:"./docs/error-codes.md#bind"});this.Dn.sn(e,this.js)}if(this.ie.dataset.state)try{const t=JSON.parse(this.ie.dataset.state);this.Hs[At](t)}catch(e){t({code:"STATE-202",message:"Failed to parse state from dataset",context:{h:"ComponentEngine.connectedCallback",eo:this.ie.dataset.state},t:"./docs/error-codes.md#state",i:e})}if(yt(this,(t=>{t.He((t=>{this.Dn.D(),t.Ne((()=>{this.Dn.P(t)}))}))})),this.At.no){const e=yt(this,(t=>t.update(null,(t=>t[W]()))));e instanceof Promise?e.finally((()=>{this.Ws.resolve()})).catch((()=>{t({code:"COMP-301",message:"Error in connectedCallback",context:{h:"ComponentEngine.connectedCallback"},t:"./docs/error-codes.md#comp"})})):this.Ws.resolve()}else this.Ws.resolve()}disconnectedCallback(){if(!this.zs)try{this.At.so&&yt(this,(t=>{t.update(null,(t=>{t[H]()}))}))}finally{this.ie.ro?.oo(this.ie),this.config.Ys||(this.js?.remove(),this.js=null,this.qs=null),yt(this,(t=>{t.He((()=>{this.Dn.A()}))}))}}ce(t){if(this.zt.startsWith(t.info))return this.zt.ce(t);let e=null;return yt(this,(n=>e=n.Ne((e=>e[q](t))))),e}getPropertyValue(t){let e;return yt(this,(n=>{e=n.Ne((e=>e[V](t)))})),e}Ds(t,e){yt(this,(n=>{n.update(null,(n=>{n[O](t,e)}))}))}In(t){this.Le.add(t)}oo(t){this.Le.delete(t)}Wt(t){return this.Zs.get(t)?.io??null}Kt(t,e){const n=this.Zs.get(t);void 0===n?this.Zs.set(t,{ls:[],io:e}):n.io=e}Be(t){return this.Zs.get(t)?.ls??[]}Ln(t,e){const n=this.Zs.get(t);void 0===n?this.Zs.set(t,{ls:[e],io:null}):n.ls.push(e)}En(t,e){const n=this.Zs.get(t);if(void 0!==n){const t=n.ls.indexOf(e);t>=0&&n.ls.splice(t,1)}}}const Ee=/\{\{([^}]+)\}\}/g;const Me="http://www.w3.org/2000/svg";function _e(t,e,n=t){let o=e;const r=o.getAttribute(N),i=s.debug?r??"":"";if(o.parentNode?.replaceChild(document.createComment(`${U}${t} ${i}`),o),o.namespaceURI===Me){const t=document.createElement("template"),e=Array.from(o.childNodes);for(let n=0;n<e.length;n++){const s=e[n];t.content.appendChild(s)}t.setAttribute(N,r??""),o=t}return o.content.querySelectorAll("template").forEach((t=>{_e(p(),t,n)})),ge(t,o,n),t}function ke(e,n){const s=document.createElement("template");s.dataset.id=e.toString(),s.innerHTML=function(e){const n=[];return e.replaceAll(Ee,((e,s)=>{const o=s.trim(),[r]=o.split(":");if("if"!==r&&"for"!==r&&"endif"!==r&&"endfor"!==r&&"elseif"!==r&&"else"!==r)return`\x3c!--${T}${o}--\x3e`;const i=o.slice(r.length+1).trim(),c={type:r,co:o,do:i};if("if"===r||"for"===r)return n.push(c),`<template data-bind="${o}">`;if("endif"===r){const e=[];for(0===n.length&&t({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",co:o,ao:n.length},t:"./docs/error-codes.md#tmp"});n.length>0;){const s=n.pop();if("if"===s.type){e.push("</template>");break}"elseif"===s.type?(e.push("</template>"),0===n.length&&t({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",co:o,ao:n.length},t:"./docs/error-codes.md#tmp"})):t({code:"TMP-102",message:"Endif without if",context:{h:"replaceMustacheWithTemplateTag",lo:s.type,co:o},t:"./docs/error-codes.md#tmp"})}return e.join("")}if("endfor"===r){const e=n.pop()??t({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",co:o,ao:n.length},t:"./docs/error-codes.md#tmp"});if("for"===e.type)return"</template>";t({code:"TMP-102",message:"Endfor without for",context:{h:"replaceMustacheWithTemplateTag",lo:e.type,co:o},t:"./docs/error-codes.md#tmp"})}else if("elseif"===r){const e=n.at(-1)??t({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",co:o,ao:n.length},t:"./docs/error-codes.md#tmp"});if("if"===e.type||"elseif"===e.type)return n.push(c),`</template><template data-bind="if:${e.do}|not"><template data-bind="if:${i}">`;t({code:"TMP-102",message:"Elseif without if",context:{h:"replaceMustacheWithTemplateTag",lo:e.type,co:o},t:"./docs/error-codes.md#tmp"})}else if("else"===r){const e=n.at(-1)??t({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",co:o,ao:n.length},t:"./docs/error-codes.md#tmp"});if("if"===e.type)return`</template><template data-bind="if:${e.do}|not">`;t({code:"TMP-102",message:"Else without if",context:{h:"replaceMustacheWithTemplateTag",lo:e.type,co:o},t:"./docs/error-codes.md#tmp"})}else t({code:"TMP-102",message:"Unknown type",context:{h:"replaceMustacheWithTemplateTag",type:r,co:o},t:"./docs/error-codes.md#tmp"})}))}(n),_e(e,s)}const De=/^[a-zA-Z_$][0-9a-zA-Z_$]*$/,Ae=/^[a-zA-Z_$][0-9a-zA-Z_$]*(\.[a-zA-Z_$][0-9a-zA-Z_$]*|\.\*)*$/;function Re(e,n){const s=new Set(e.H).intersection(n);let o=-1,r="";for(const t of s){const e=t.split(".");1!==e.length&&(e.length>o&&(o=e.length,r=t))}if(r.length>0){Ae.test(r)||t({code:"STATE-202",message:`Invalid path: ${r}`,context:{ho:r},t:"./docs/error-codes.md#state"});const n=_(r),s=[];let o=n.dt;for(let i=n.O.length;i<e.O.length;i++){const n=e.O[i];"*"===n?(s.push(`[this.$${o+1}]`),o++):(De.test(n)||t({code:"STATE-202",message:`Invalid segment name: ${n}`,context:{uo:n,ho:r},t:"./docs/error-codes.md#state"}),s.push(`.${n}`))}const i=s.join(""),c=`this["${r}"]${i} = value;`;return{get:new Function("",`return this["${r}"]${i};`),set:new Function("value",c)}}{const n=[];let s=0;for(let o=0;o<e.O.length;o++){const r=e.O[o];"*"===r?(n.push(`[this.$${s+1}]`),s++):(De.test(r)||t({code:"STATE-202",message:`Invalid segment name: ${r}`,context:{uo:r},t:"./docs/error-codes.md#state"}),n.push((n.length>0?".":"")+r))}const o=n.join(""),r=`this.${o} = value;`;return{get:new Function("",`return this.${o};`),set:new Function("value",r)}}}class Fe{Xs=new Set;Vt=new Set;elements=new Set;fo=new Set;Ot=new Set;Dt=new Set;Yt=new Set;mo=new Set;po=new Set;yo=new Map;Me=new Map;$e=function(){return new k("","",0)}();no=!1;so=!1;We=!1;wo;xo;bo=new Set;constructor(t){this.wo=t.id,this.xo=t.Vs;const e=(t=>fe[t]??[])(this.wo),n=new Set;for(const t of e){const e=_(t);this.Xs=this.Xs.union(e.j);for(const t of e.j){const e=_(t);"*"===e.W&&n.add(e.it)}}const s=(t=>ue[t]??[])(this.wo);this.Vt=this.Vt.union(s).union(n);for(const t of this.Vt){const e=`${t}.*`;this.elements.add(e)}let o=this.xo.prototype;for(;o&&o!==Object.prototype;){const t=Object.getOwnPropertyDescriptors(o);if(t)for(const[e,n]of Object.entries(t)){if(B.has(e))continue;if("function"==typeof n.value){this.fo.add(e),e===$&&(this.no=!0),e===P&&(this.so=!0),e===L&&(this.We=!0);continue}const t=void 0!==n.get,s=void 0!==n.set,o=_(e);this.Xs=this.Xs.union(o.j),t&&this.Ot.add(e),s&&this.Yt.add(e),t&&!s&&this.Dt.add(e),t&&s&&this.mo.add(e)}o=Object.getPrototypeOf(o)}for(const t of this.Xs){if(this.Ot.has(t))continue;if(this.Yt.has(t))continue;const e=_(t);if(1===e.O.length)continue;const n=Re(e,this.Ot);Object.defineProperty(this.xo.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.po.add(t)}for(const t of this.Xs){R(this.$e,t);const e=_(t);if(e.it){const n=this.yo.get(e.it);void 0!==n?n.add(t):this.yo.set(e.it,new Set([t]))}}}addPath(t,e=!1){const n=_(t);if(e&&!this.Vt.has(t)){this.Vt.add(t);const e=`${t}.*`;this.elements.add(e)}else"*"===n.W&&(this.elements.add(t),this.Vt.add(n.it));for(const t of n.j){if(this.Xs.has(t))continue;this.Xs.add(t),R(this.$e,t);const e=_(t);if("*"===e.W&&(this.elements.add(t),this.Vt.add(e.it)),e.O.length>1){const n=Re(e,this.Ot);Object.defineProperty(this.xo.prototype,t,{get:n.get,set:n.set,enumerable:!0,configurable:!0}),this.po.add(t)}if(e.it){const n=this.yo.get(e.it);void 0!==n?n.add(t):this.yo.set(e.it,new Set([t]))}}}Ft(t,e){const n=`${e}=>${t}`;if(this.bo.has(n))return;this.Xs.has(e)||this.addPath(e),this.bo.add(n);const s=this.Me.get(e);void 0!==s?s.add(t):this.Me.set(e,new Set([t]))}}function Ve(e){const s=function(t){const e=n();return{Ys:void 0===t.Ys||t.Ys,shadowDomMode:t.shadowDomMode??e.shadowDomMode,fs:t.fs??null}}(e.Vs.So??{}),o=p(),{vo:r,Co:i,Vs:c}=e,d=Object.assign({},f),a=Object.assign({},u);c.Io=!0,ke(o,r),w(o,i),function(t,e){g[t]=e}(o,c);const l=function(t){return t?document.createElement(t).constructor:HTMLElement}(s.fs),h=s.fs;return class extends l{static define(t){h?customElements.define(t,this,{fs:h}):customElements.define(t,this)}static get id(){return o}static No=r;static get vo(){return this.No}static set vo(t){this.No=t,ke(this.id,t),this.To=null,this.Uo=null}static Bo=i;static get Co(){return this.Bo}static set Co(t){this.Bo=t,w(this.id,t),this.$o=null}static To=null;static get Fs(){return this.To||(this.To=ye(this.id)),this.To}static $o=null;static get styleSheet(){return this.$o||(this.$o=function(e){return y[e]??t({code:"CSS-001",message:`Stylesheet not found: ${e}`,context:{h:"registerStyleSheet.getStyleSheetById",Po:e},t:"./docs/error-codes.md#css"})}(this.id)),this.$o}static xo=null;static get Vs(){return this.xo||(this.xo=function(e){return g[e]??t({code:"STATE-101",message:`StateClass not found: ${e}`,context:{h:"registerStateClass.getStateClassById",Lo:e},t:"./docs/error-codes.md#state"})}(this.id)),this.xo}static Eo=d;static get Xn(){return this.Eo}static Mo=a;static get Yn(){return this.Mo}static Uo=null;static get At(){return this.Uo||(this.Uo=new Fe(this)),this.Uo}ye;_o;constructor(){super(),this.ye=function(t,e){return new Le(t,e)}(s,this),this.ye.Qs()}connectedCallback(){this.ye.connectedCallback()}disconnectedCallback(){this.ye.disconnectedCallback()}get ro(){var t;return void 0===this._o&&(this._o=(t=this,Ft.get(t)??null)),this._o}get state(){return this.ye.Hs}get Tn(){return this.ye.Tn}get ko(){return this.ye.Vs.Io??!1}get Ws(){return this.ye.Ws}Ls(t){return this.ye.Ee.get(t)??null}In(t){this.ye.In(t)}oo(t){this.ye.oo(t)}}}function Oe(t){return t.replaceAll(/<!--\{\{([^}]+)}}-->/g,((t,e)=>`{{${e}}}`))}let We=0;async function He(t){const e=import.meta.resolve?import.meta.resolve(t):t,n=await fetch(e);return async function(t,e){const n=document.createElement("template");n.innerHTML=function(t){return t.replaceAll(/\{\{([^}]+)\}\}/g,((t,e)=>`\x3c!--{{${e}}}--\x3e`))}(e);const s=n.content.querySelector("template");s?.remove();const o=n.content.querySelector("script[type=module]");let r={};if(o){const e=`\n// uniq id: ${We++}\n//# sourceURL=${t}\n`;if("function"==typeof URL.createObjectURL){const t=new Blob([o.text+e],{type:"application/javascript"}),n=URL.createObjectURL(t);try{r=await import(n)}finally{URL.revokeObjectURL(n)}}else{const t=btoa(String.fromCodePoint(...(new TextEncoder).encode(o.text+e)));r=await import(`data:application/javascript;base64,${t}`)}}o?.remove();const i=n.content.querySelector("style");i?.remove();const c=r.default??class{};return{text:e,vo:Oe(s?.innerHTML??"").trim(),Co:i?.textContent??"",Vs:c}}(t,await n.text())}function je(t,e){e.define(t)}const qe="@routes/",ze="@components/",Ge="#lazy",Ze={};async function Je(){const t=function(){const t={};return document.querySelectorAll("script[type='importmap']").forEach((e=>{const n=JSON.parse(e.innerHTML);n.imports&&(t.imports=Object.assign(t.imports||{},n.imports))})),t}();if(t.imports){const e=new Map;for(const[n,s]of Object.entries(t.imports)){let t,s;if(n.startsWith(qe)){s=n.endsWith(Ge);const e=n.slice(7,s?-5:void 0);t=`routes${e.replace(/:[^\s/]+/g,"").replace(/\//g,"-")}`,en(t,"/root"===e?"/":e)}n.startsWith(ze)&&(s=n.endsWith(Ge),t=n.slice(12,s?-5:void 0)),t&&(s?Ze[t]=n:e.set(t,n))}for(const[t,n]of e.entries()){je(t,Ve(await He(n)))}}}function Ke(e){const n=Ze[e];if(n)delete Ze[e],queueMicrotask((()=>{He(n).then((t=>{const n=Ve(t);je(e,n)})).catch((n=>{t({code:"IMP-202",message:`Failed to load lazy component for tagName: ${e}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:e,error:n},t:"./docs/error-codes.md#imp",o:"error"})}))}));else{const t={code:"IMP-201",message:`Alias not found for tagName: ${e}`,context:{h:"loadFromImportMap.loadLazyLoadComponent",tagName:e},t:"./docs/error-codes.md#imp",o:"warn"};console.warn(t.message,{code:t.code,context:t.context,t:t.t,o:t.o})}}const Qe="routes:",Xe=[];let Ye=null;class tn extends HTMLElement{Do=window.location.pathname.split("/").pop()||"";Ao=document.querySelector("base")?.href.replace(window.location.origin,"")||"/";Ro;constructor(){super(),this.Ro=this.Fo.bind(this)}connectedCallback(){Ye=this,this.innerHTML='<slot name="content"></slot>',window.addEventListener("popstate",this.Ro),window.dispatchEvent(new Event("popstate"))}disconnectedCallback(){window.removeEventListener("popstate",this.Ro),Ye=null}Fo(t){t.preventDefault(),this.Te()}navigate(t){const e="/"===t[0]?this.Ao+t.slice(1):t;history.pushState({},"",e),this.Te()}Te(){Array.from(this.childNodes).filter((t=>"content"===t.getAttribute?.("slot"))).forEach((t=>this.removeChild(t)));const t=window.location.pathname.split("/");t.at(-1)===this.Do&&(t[t.length-1]="");const e=t.join("/").replace(this.Ao,""),n="/"!==e[0]?`/${e}`:e;let s;const o={};for(const[t,e]of Xe){const r=new RegExp(`^${t.replace(/:[^\s/]+/g,"([^/]+)")}$`);if(r.test(n)){s=e;const i=n.match(r);if(i){(t.match(/:[^\s/]+/g)||[]).forEach(((t,e)=>{o[t.substring(1)]=i[e+1]}))}break}}if(s){const t=document.createElement(s);t.setAttribute("data-state",JSON.stringify(o)),t.setAttribute("slot","content"),this.appendChild(t),function(t){return t in Ze}(s)&&Ke(s)}else{const t=document.createElement("h1");t.setAttribute("slot","content"),t.textContent="404 Not Found",this.appendChild(t)}}}function en(t,e){let n;n=e.startsWith(Qe)?e.substring(Qe.length):e,Xe.push([n,t])}const nn="router",sn=`<slot name="${nn}"></slot>`;class on extends HTMLElement{constructor(){super(),"none"!==s.shadowDomMode&&this.attachShadow({mode:"open"})}async connectedCallback(){await this.Vo(),this.Te()}get root(){return this.shadowRoot??this}async Vo(){if(s.layoutPath){const e=await fetch(s.layoutPath);if(e.ok){const t=await e.text(),n=document.createElement("template");n.innerHTML=t;const s=n.content.querySelector("template"),o=n.content.querySelector("style");if(this.root.appendChild(s?.content??document.createDocumentFragment()),o){const t=this.shadowRoot??document,e=t.adoptedStyleSheets;e.includes(o)||(t.adoptedStyleSheets=[...e,o])}}else t({code:"TMP-101",message:`Failed to load layout from ${s.layoutPath}`,context:{layoutPath:s.layoutPath},t:"/docs/error-codes.md#tmp",o:"error"})}else this.root.innerHTML=sn}Te(){if(s.enableRouter){const t=document.createElement(s.routerTagName);t.setAttribute("slot",nn),this.root.appendChild(t)}}}const rn=s;let cn=!1;async function dn(t){await async function(t){for(const[e,n]of Object.entries(t)){let t=null;if(s.enableRouter){const t=n.startsWith("@routes")?n.slice(7):n;en(e,"/root"===t?"/":t)}t=await He(n),je(e,Ve(t))}}(t),rn.autoInit&&await an()}async function an(){cn||(await async function(){if(s.autoLoadFromImportMap&&await Je(),s.enableRouter&&customElements.define(s.routerTagName,tn),s.enableMainWrapper&&(customElements.define(s.mainTagName,on),s.autoInsertMainWrapper)){const t=document.createElement(s.mainTagName);document.body.appendChild(t)}}(),cn=!0)}export{an as bootstrapStructive,rn as config,dn as defineComponents};
//# sourceMappingURL=structive.min.js.map
